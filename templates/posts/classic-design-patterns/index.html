<!DOCTYPE html><html  lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href="../../img/favicon/favicon-192x192%EF%B9%96hash=b4b7ad3f7c.png" rel=icon type=image/png><meta content=#f9c412 name=theme-color><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name=robots><title>Learning JavaScript Design Patterns</title><meta content="Learning JavaScript Design Patterns" property=og:title><meta content="The classic JavaScript design patterns book, updated to ES2015+ syntax." name=description><meta content="The classic JavaScript design patterns book, updated to ES2015+ syntax." property=og:description><meta content=summary_large_image name=twitter:card><meta content=@update_me name=twitter:site><meta content=@update_me name=twitter:creator><meta content=https://patterns.dev/img/remote/ZcRaN0.jpg property=og:image><link href=https://patterns.dev/posts/classic-design-patterns/ rel=canonical><meta content=no-referrer-when-downgrade name=referrer><link href=../../feed/feed.xml rel=alternate type=application/atom+xml title=Patterns.dev><link href=../../index.html rel=preconnect crossorigin=""><script src="../../js/min%EF%B9%96hash=6d02859105.js" defer async data-cwv-src="/js/web-vitals.js?hash=4a3c7b61e1"></script><script src="../../js/cached%EF%B9%96hash=9030142fbb.js" defer async></script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>/*
! tailwindcss v3.1.8 | MIT License | https://tailwindcss.com
*/*,:after,:before{border:0 solid #eaeaea;box-sizing:border-box}:after,:before{--tw-content:""}html{-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#999}input::placeholder,textarea::placeholder{color:#999}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[multiple],[type=date],[type=datetime-local],[type=email],[type=month],[type=number],[type=password],[type=search],[type=tel],[type=text],[type=time],[type=url],[type=week],select,textarea{--tw-shadow:0 0 #0000;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#fff;border-color:#7f7f7f;border-radius:0;border-width:1px;font-size:1rem;line-height:1.5rem;padding:.5rem .75rem}[multiple]:focus,[type=date]:focus,[type=datetime-local]:focus,[type=email]:focus,[type=month]:focus,[type=number]:focus,[type=password]:focus,[type=search]:focus,[type=tel]:focus,[type=text]:focus,[type=time]:focus,[type=url]:focus,[type=week]:focus,select:focus,textarea:focus{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:#0070f4;--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);border-color:#0070f4;box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow);outline:2px solid transparent;outline-offset:2px}input::-moz-placeholder,textarea::-moz-placeholder{color:#7f7f7f;opacity:1}input::placeholder,textarea::placeholder{color:#7f7f7f;opacity:1}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-date-and-time-value{min-height:1.5em}::-webkit-datetime-edit,::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-meridiem-field,::-webkit-datetime-edit-millisecond-field,::-webkit-datetime-edit-minute-field,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-second-field,::-webkit-datetime-edit-year-field{padding-bottom:0;padding-top:0}select{color-adjust:exact;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%237F7F7F' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E");background-position:right .5rem center;background-repeat:no-repeat;background-size:1.5em 1.5em;padding-right:2.5rem;-webkit-print-color-adjust:exact;print-color-adjust:exact}[multiple]{color-adjust:unset;background-image:none;background-position:0 0;background-repeat:unset;background-size:initial;padding-right:.75rem;-webkit-print-color-adjust:unset;print-color-adjust:unset}[type=checkbox],[type=radio]{color-adjust:exact;--tw-shadow:0 0 #0000;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#fff;background-origin:border-box;border-color:#7f7f7f;border-width:1px;color:#0070f4;display:inline-block;flex-shrink:0;height:1rem;padding:0;-webkit-print-color-adjust:exact;print-color-adjust:exact;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle;width:1rem}[type=checkbox]{border-radius:0}[type=radio]{border-radius:100%}[type=checkbox]:focus,[type=radio]:focus{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:2px;--tw-ring-offset-color:#fff;--tw-ring-color:#0070f4;--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow);outline:2px solid transparent;outline-offset:2px}[type=checkbox]:checked,[type=radio]:checked{background-color:currentColor;background-position:50%;background-repeat:no-repeat;background-size:100% 100%;border-color:transparent}[type=checkbox]:checked{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 16 16' fill='%23fff' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12.207 4.793a1 1 0 0 1 0 1.414l-5 5a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L6.5 9.086l4.293-4.293a1 1 0 0 1 1.414 0z'/%3E%3C/svg%3E")}[type=radio]:checked{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 16 16' fill='%23fff' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='3'/%3E%3C/svg%3E")}[type=checkbox]:checked:focus,[type=checkbox]:checked:hover,[type=radio]:checked:focus,[type=radio]:checked:hover{background-color:currentColor;border-color:transparent}[type=checkbox]:indeterminate{background-color:currentColor;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 16 16'%3E%3Cpath stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M4 8h8'/%3E%3C/svg%3E");background-position:50%;background-repeat:no-repeat;background-size:100% 100%;border-color:transparent}[type=checkbox]:indeterminate:focus,[type=checkbox]:indeterminate:hover{background-color:currentColor;border-color:transparent}[type=file]{background:unset;border-color:inherit;border-radius:0;border-width:0;font-size:unset;line-height:inherit;padding:0}[type=file]:focus{outline:1px solid ButtonText;outline:1px auto -webkit-focus-ring-color}*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(0,112,243,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::-webkit-backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(0,112,243,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(0,112,243,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.form-input,.form-multiselect,.form-select,.form-textarea{--tw-shadow:0 0 #0000;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#fff;border-color:#7f7f7f;border-radius:0;border-width:1px;font-size:1rem;line-height:1.5rem;padding:.5rem .75rem}.form-input:focus,.form-multiselect:focus,.form-select:focus,.form-textarea:focus{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:#0070f4;--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);border-color:#0070f4;box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow);outline:2px solid transparent;outline-offset:2px}.form-input::-moz-placeholder,.form-textarea::-moz-placeholder{color:#7f7f7f;opacity:1}.form-input::placeholder,.form-textarea::placeholder{color:#7f7f7f;opacity:1}.form-input::-webkit-datetime-edit-fields-wrapper{padding:0}.form-input::-webkit-date-and-time-value{min-height:1.5em}.form-input::-webkit-datetime-edit,.form-input::-webkit-datetime-edit-day-field,.form-input::-webkit-datetime-edit-hour-field,.form-input::-webkit-datetime-edit-meridiem-field,.form-input::-webkit-datetime-edit-millisecond-field,.form-input::-webkit-datetime-edit-minute-field,.form-input::-webkit-datetime-edit-month-field,.form-input::-webkit-datetime-edit-second-field,.form-input::-webkit-datetime-edit-year-field{padding-bottom:0;padding-top:0}.form-select{color-adjust:exact;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%237F7F7F' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E");background-position:right .5rem center;background-repeat:no-repeat;background-size:1.5em 1.5em;padding-right:2.5rem;-webkit-print-color-adjust:exact;print-color-adjust:exact}.prose{color:var(--tw-prose-body);max-width:65ch}.prose :where([class~=lead]):not(:where([class~=not-prose] *)){color:var(--tw-prose-lead);font-size:1.25em;line-height:1.6;margin-bottom:1.2em;margin-top:1.2em}.prose :where(a):not(:where([class~=not-prose] *)){color:var(--tw-prose-links);font-weight:500;text-decoration:underline}.prose :where(strong):not(:where([class~=not-prose] *)){color:var(--tw-prose-bold);font-weight:600}.prose :where(a strong):not(:where([class~=not-prose] *)){color:inherit}.prose :where(blockquote strong):not(:where([class~=not-prose] *)){color:inherit}.prose :where(thead th strong):not(:where([class~=not-prose] *)){color:inherit}.prose :where(ol):not(:where([class~=not-prose] *)){list-style-type:decimal;margin-bottom:1.25em;margin-top:1.25em;padding-left:1.625em}.prose :where(ol[type=A]):not(:where([class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a]):not(:where([class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=A s]):not(:where([class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a s]):not(:where([class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=I]):not(:where([class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i]):not(:where([class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type=I s]):not(:where([class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i s]):not(:where([class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type="1"]):not(:where([class~=not-prose] *)){list-style-type:decimal}.prose :where(ul):not(:where([class~=not-prose] *)){list-style-type:disc;margin-bottom:1.25em;margin-top:1.25em;padding-left:1.625em}.prose :where(ol>li):not(:where([class~=not-prose] *))::marker{color:var(--tw-prose-counters);font-weight:400}.prose :where(ul>li):not(:where([class~=not-prose] *))::marker{color:var(--tw-prose-bullets)}.prose :where(hr):not(:where([class~=not-prose] *)){border-color:var(--tw-prose-hr);border-top-width:1px;margin-bottom:3em;margin-top:3em}.prose :where(blockquote):not(:where([class~=not-prose] *)){border-left-color:var(--tw-prose-quote-borders);border-left-width:.25rem;color:var(--tw-prose-quotes);font-style:italic;font-weight:500;margin-bottom:1.6em;margin-top:1.6em;padding-left:1em;quotes:"\201C""\201D""\2018""\2019"}.prose :where(blockquote p:first-of-type):not(:where([class~=not-prose] *)):before{content:open-quote}.prose :where(blockquote p:last-of-type):not(:where([class~=not-prose] *)):after{content:close-quote}.prose :where(h1):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-size:2.25em;font-weight:800;line-height:1.1111111;margin-bottom:.8888889em;margin-top:0}.prose :where(h1 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:900}.prose :where(h2):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.5em;font-weight:700;line-height:1.3333333;margin-bottom:1em;margin-top:2em}.prose :where(h2 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:800}.prose :where(h3):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.25em;font-weight:600;line-height:1.6;margin-bottom:.6em;margin-top:1.6em}.prose :where(h3 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(h4):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;line-height:1.5;margin-bottom:.5em;margin-top:1.5em}.prose :where(h4 strong):not(:where([class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(img):not(:where([class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(figure>*):not(:where([class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose :where(figcaption):not(:where([class~=not-prose] *)){color:var(--tw-prose-captions);font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose :where(a code):not(:where([class~=not-prose] *)){color:inherit}.prose :where(h1 code):not(:where([class~=not-prose] *)){color:inherit}.prose :where(h2 code):not(:where([class~=not-prose] *)){color:inherit;font-size:.875em}.prose :where(h3 code):not(:where([class~=not-prose] *)){color:inherit;font-size:.9em}.prose :where(h4 code):not(:where([class~=not-prose] *)){color:inherit}.prose :where(blockquote code):not(:where([class~=not-prose] *)){color:inherit}.prose :where(thead th code):not(:where([class~=not-prose] *)){color:inherit}.prose :where(pre code):not(:where([class~=not-prose] *)):before{content:none}.prose :where(pre code):not(:where([class~=not-prose] *)):after{content:none}.prose :where(table):not(:where([class~=not-prose] *)){font-size:.875em;line-height:1.7142857;margin-bottom:2em;margin-top:2em;table-layout:auto;text-align:left;width:100%}.prose :where(thead):not(:where([class~=not-prose] *)){border-bottom-color:var(--tw-prose-th-borders);border-bottom-width:1px}.prose :where(thead th):not(:where([class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;padding-bottom:.5714286em;padding-left:.5714286em;padding-right:.5714286em;vertical-align:bottom}.prose :where(tbody tr):not(:where([class~=not-prose] *)){border-bottom-color:var(--tw-prose-td-borders);border-bottom-width:1px}.prose :where(tbody tr:last-child):not(:where([class~=not-prose] *)){border-bottom-width:0}.prose :where(tbody td):not(:where([class~=not-prose] *)){vertical-align:baseline}.prose :where(tfoot):not(:where([class~=not-prose] *)){border-top-color:var(--tw-prose-th-borders);border-top-width:1px}.prose :where(tfoot td):not(:where([class~=not-prose] *)){vertical-align:top}.prose{--tw-prose-body:#374151;--tw-prose-headings:#111827;--tw-prose-lead:#4b5563;--tw-prose-links:#111827;--tw-prose-bold:#111827;--tw-prose-counters:#6b7280;--tw-prose-bullets:#d1d5db;--tw-prose-hr:#e5e7eb;--tw-prose-quotes:#111827;--tw-prose-quote-borders:#e5e7eb;--tw-prose-captions:#6b7280;--tw-prose-code:#111827;--tw-prose-pre-code:#e5e7eb;--tw-prose-pre-bg:#1f2937;--tw-prose-th-borders:#d1d5db;--tw-prose-td-borders:#e5e7eb;--tw-prose-invert-body:#d1d5db;--tw-prose-invert-headings:#fff;--tw-prose-invert-lead:#9ca3af;--tw-prose-invert-links:#fff;--tw-prose-invert-bold:#fff;--tw-prose-invert-counters:#9ca3af;--tw-prose-invert-bullets:#4b5563;--tw-prose-invert-hr:#374151;--tw-prose-invert-quotes:#f3f4f6;--tw-prose-invert-quote-borders:#374151;--tw-prose-invert-captions:#9ca3af;--tw-prose-invert-code:#fff;--tw-prose-invert-pre-code:#d1d5db;--tw-prose-invert-pre-bg:rgba(0,0,0,.5);--tw-prose-invert-th-borders:#4b5563;--tw-prose-invert-td-borders:#374151;font-size:1rem;line-height:1.75}.prose :where(p):not(:where([class~=not-prose] *)){margin-bottom:1.25em;margin-top:1.25em}.prose :where(video):not(:where([class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(figure):not(:where([class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(li):not(:where([class~=not-prose] *)){margin-bottom:.5em;margin-top:.5em}.prose :where(ol>li):not(:where([class~=not-prose] *)){padding-left:.375em}.prose :where(ul>li):not(:where([class~=not-prose] *)){padding-left:.375em}.prose :where(.prose>ul>li p):not(:where([class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose :where(.prose>ul>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ul>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.25em}.prose :where(.prose>ol>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ol>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.25em}.prose :where(ul ul,ul ol,ol ul,ol ol):not(:where([class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose :where(hr+*):not(:where([class~=not-prose] *)){margin-top:0}.prose :where(h2+*):not(:where([class~=not-prose] *)){margin-top:0}.prose :where(h3+*):not(:where([class~=not-prose] *)){margin-top:0}.prose :where(h4+*):not(:where([class~=not-prose] *)){margin-top:0}.prose :where(thead th:first-child):not(:where([class~=not-prose] *)){padding-left:0}.prose :where(thead th:last-child):not(:where([class~=not-prose] *)){padding-right:0}.prose :where(tbody td,tfoot td):not(:where([class~=not-prose] *)){padding:.5714286em}.prose :where(tbody td:first-child,tfoot td:first-child):not(:where([class~=not-prose] *)){padding-left:0}.prose :where(tbody td:last-child,tfoot td:last-child):not(:where([class~=not-prose] *)){padding-right:0}.prose :where(.prose>:first-child):not(:where([class~=not-prose] *)){margin-top:0}.prose :where(.prose>:last-child):not(:where([class~=not-prose] *)){margin-bottom:0}.prose-sm :where(.prose>ul>li p):not(:where([class~=not-prose] *)){margin-bottom:.5714286em;margin-top:.5714286em}.prose-sm :where(.prose>ul>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.1428571em}.prose-sm :where(.prose>ul>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.1428571em}.prose-sm :where(.prose>ol>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.1428571em}.prose-sm :where(.prose>ol>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.1428571em}.prose-sm :where(.prose>:first-child):not(:where([class~=not-prose] *)){margin-top:0}.prose-sm :where(.prose>:last-child):not(:where([class~=not-prose] *)){margin-bottom:0}.prose-base :where(.prose>ul>li p):not(:where([class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose-base :where(.prose>ul>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.25em}.prose-base :where(.prose>ul>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.25em}.prose-base :where(.prose>ol>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.25em}.prose-base :where(.prose>ol>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.25em}.prose-base :where(.prose>:first-child):not(:where([class~=not-prose] *)){margin-top:0}.prose-base :where(.prose>:last-child):not(:where([class~=not-prose] *)){margin-bottom:0}.prose-lg :where(.prose>ul>li p):not(:where([class~=not-prose] *)){margin-bottom:.8888889em;margin-top:.8888889em}.prose-lg :where(.prose>ul>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.3333333em}.prose-lg :where(.prose>ul>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.3333333em}.prose-lg :where(.prose>ol>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.3333333em}.prose-lg :where(.prose>ol>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.3333333em}.prose-lg :where(.prose>:first-child):not(:where([class~=not-prose] *)){margin-top:0}.prose-lg :where(.prose>:last-child):not(:where([class~=not-prose] *)){margin-bottom:0}.prose-xl :where(.prose>ul>li p):not(:where([class~=not-prose] *)){margin-bottom:.8em;margin-top:.8em}.prose-xl :where(.prose>ul>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.2em}.prose-xl :where(.prose>ul>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.2em}.prose-xl :where(.prose>ol>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.2em}.prose-xl :where(.prose>ol>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.2em}.prose-xl :where(.prose>:first-child):not(:where([class~=not-prose] *)){margin-top:0}.prose-xl :where(.prose>:last-child):not(:where([class~=not-prose] *)){margin-bottom:0}.prose-2xl :where(.prose>ul>li p):not(:where([class~=not-prose] *)){margin-bottom:.8333333em;margin-top:.8333333em}.prose-2xl :where(.prose>ul>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.3333333em}.prose-2xl :where(.prose>ul>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.3333333em}.prose-2xl :where(.prose>ol>li>:first-child):not(:where([class~=not-prose] *)){margin-top:1.3333333em}.prose-2xl :where(.prose>ol>li>:last-child):not(:where([class~=not-prose] *)){margin-bottom:1.3333333em}.prose-2xl :where(.prose>:first-child):not(:where([class~=not-prose] *)){margin-top:0}.prose-2xl :where(.prose>:last-child):not(:where([class~=not-prose] *)){margin-bottom:0}.h1{font-size:2.625rem}.h1,.h2{font-weight:800;letter-spacing:-.02em;line-height:1.25}.h2,.h3{font-size:2rem}.h3{line-height:1.25}.h3,.h4{font-weight:700}.h4{font-size:1.5rem;letter-spacing:-.01em;line-height:1.375}@media (min-width:768px){.h1{font-size:3.25rem}.h2{font-size:2.625rem}}.btn,.btn-sm{align-items:center;border-color:transparent;border-radius:.25rem;border-width:1px;display:inline-flex;font-weight:500;justify-content:center;line-height:1.375;transition-duration:.15s;transition-property:color,background-color,border-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-text-decoration-color,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-text-decoration-color,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.btn{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.04),0 4px 6px -2px rgba(0,0,0,.02);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -2px var(--tw-shadow-color);padding:.75rem 2rem}.btn,.btn-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.btn-sm{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color);padding:.5rem 1rem}input[type=range]{--thumb-size:36px;-webkit-appearance:none;-moz-appearance:none;appearance:none;background:#ccc;border-radius:3px;height:6px;margin-bottom:15px;margin-top:15px}input[type=range]::-webkit-slider-thumb{appearance:none;-webkit-appearance:none;background-color:#000;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 .5v7L12 4zM0 4l4 3.5v-7z' fill='%23FFF'/%3E%3C/svg%3E");background-position:50%;background-repeat:no-repeat;border:0;border-radius:50%;cursor:pointer;height:36px;width:36px}input[type=range]::-moz-range-thumb{background-color:#000;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 .5v7L12 4zM0 4l4 3.5v-7z' fill='%23FFF'/%3E%3C/svg%3E");background-position:50%;background-repeat:no-repeat;border:none;border-radius:50%;cursor:pointer;height:36px;width:36px}input[type=range]::-ms-thumb{background-color:#000;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 .5v7L12 4zM0 4l4 3.5v-7z' fill='%23FFF'/%3E%3C/svg%3E");background-position:50%;background-repeat:no-repeat;border:0;border-radius:50%;cursor:pointer;height:36px;width:36px}input[type=range]::-moz-focus-outer{border:0}.form-switch{position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:68px}.form-switch label{border-radius:.25rem;cursor:pointer;display:block;height:38px;overflow:hidden}.form-switch label>span:first-child{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color);border-radius:.25rem;box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow);display:block;height:30px;left:4px;position:absolute;right:50%;top:4px;transition:all .15s ease-out;width:30px}.form-switch input[type=checkbox]:checked+label{--tw-bg-opacity:1;background-color:rgb(0 112 244/var(--tw-bg-opacity))}.form-switch input[type=checkbox]:checked+label>span:first-child{left:34px}html{scroll-behavior:smooth}.btn-sm:focus,.btn:focus,:focus,button:focus{outline:2px solid rgba(0,112,244,.5)}.hamburger svg>:first-child,.hamburger svg>:nth-child(2),.hamburger svg>:nth-child(3){transform-origin:center}.hamburger svg>:first-child{transition:y .1s ease-in .25s,transform .22s cubic-bezier(.55,.055,.675,.19),opacity .1s ease-in}.hamburger svg>:nth-child(2){transition:transform .22s cubic-bezier(.55,.055,.675,.19)}.hamburger svg>:nth-child(3){transition:y .1s ease-in .25s,transform .22s cubic-bezier(.55,.055,.675,.19),width .1s ease-in .25s}.hamburger.active svg>:first-child{y:11;opacity:0;transform:rotate(225deg);transition:y .1s ease-out,transform .22s cubic-bezier(.215,.61,.355,1) .12s,opacity .1s ease-out .12s}.hamburger.active svg>:nth-child(2){transform:rotate(225deg);transition:transform .22s cubic-bezier(.215,.61,.355,1) .12s}.hamburger.active svg>:nth-child(3){y:11;transform:rotate(135deg);transition:y .1s ease-out,transform .22s cubic-bezier(.215,.61,.355,1) .12s,width .1s ease-out}.blur{backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px)}@-webkit-keyframes pulseLoop{0%{opacity:.15;transform:scale(1) translateZ(0)}30%{opacity:.15}60%{opacity:0}80%{opacity:0;transform:scale(1.8) translateZ(0)}}@keyframes pulseLoop{0%{opacity:.15;transform:scale(1) translateZ(0)}30%{opacity:.15}60%{opacity:0}80%{opacity:0;transform:scale(1.8) translateZ(0)}}@-webkit-keyframes pulseMiniLoop{0%{opacity:0;transform:scale(1) translateZ(0)}30%{opacity:.3}50%{opacity:.3}80%{opacity:0;transform:scale(3) translateZ(0)}}@keyframes pulseMiniLoop{0%{opacity:0;transform:scale(1) translateZ(0)}30%{opacity:.3}50%{opacity:.3}80%{opacity:0;transform:scale(3) translateZ(0)}}.pulse{-webkit-animation:pulseLoop 10s linear infinite;animation:pulseLoop 10s linear infinite;opacity:0;transform:scale(1);transform-origin:center}.pulse-mini{-webkit-animation:pulseMiniLoop 6s linear infinite;animation:pulseMiniLoop 6s linear infinite}.pulse-1{-webkit-animation-delay:-3s;animation-delay:-3s}.pulse-2{-webkit-animation-delay:-6s;animation-delay:-6s}.animation-delay-500{-webkit-animation-delay:.5s!important;animation-delay:.5s!important}.animation-delay-1000{-webkit-animation-delay:1s!important;animation-delay:1s!important}.translate-z-0{transform:translateZ(0)}[data-aos=zoom-y-out]{opacity:0;transform:scaleX(1.03);transition-property:transform,opacity}@-webkit-keyframes softFloatUp{0%{transform:translateY(0)}to{transform:translateY(-10%)}}@keyframes softFloatUp{0%{transform:translateY(0)}to{transform:translateY(-10%)}}@-webkit-keyframes softFloatDown{0%{transform:translateY(0)}to{transform:translateY(10%)}}@keyframes softFloatDown{0%{transform:translateY(0)}to{transform:translateY(10%)}}.space-card-container{grid-gap:24px;display:grid;grid-template-columns:repeat(auto-fit,minmax(275px,1fr));padding:24px;position:relative;transform-style:preserve-3d}@media (min-width:1200px){.space-card-container{grid-template-columns:repeat(3,360px);justify-content:center}}.space-card-card{transform-origin:top left;will-change:transform}.space-card-anchor{display:block;min-height:100%;will-change:transform}.space-card-anchor,.space-card-shadow{border-radius:8px}.space-card-darkness{border-radius:6px}.space-card-header{border-radius:5px 5px 0 0}.space-card-actions{display:none}@media (min-width:768px) and (prefers-reduced-motion:no-preference){.space-card-actions{display:block}}.space-card-button{transition:opacity .4s}.space-card-button:disabled{cursor:not-allowed;opacity:.5;transition:opacity 50ms}.space-card-anchor:focus{outline:none}.space-card-anchor:focus .space-card-shadow{outline:5px solid #6a5acd;outline-color:-webkit-focus-ring-color;outline-offset:2px}.space-card-anchor:focus .space-card-contents,.space-card-anchor:hover .space-card-contents{opacity:0;transition:opacity .2s}.space-card-anchor:focus .space-card-preview-image,.space-card-anchor:hover .space-card-preview-image{opacity:1;transition:opacity .2s}.space-card-contents{transition:opacity .35s .15s}.space-card-preview-image{border-radius:5px;bottom:4px;height:calc(100% - 8px);left:4px;-o-object-fit:cover;object-fit:cover;opacity:0;pointer-events:none;position:absolute;right:4px;top:4px;transition:opacity .4s;width:calc(100% - 8px)}.space-card-pattern-name:before{content:"The";display:block;font-size:.6em}.sr-only{clip:rect(0,0,0,0);border-width:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px}.pointer-events-none{pointer-events:none}.invisible{visibility:hidden}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{bottom:0;left:0;right:0;top:0}.left-1\/2{left:50%}.top-1\/2{top:50%}.left-auto{left:auto}.top-full{top:100%}.right-auto{right:auto}.left-0{left:0}.right-0{right:0}.bottom-0{bottom:0}.top-0{top:0}.z-30{z-index:30}.z-20{z-index:20}.z-50{z-index:50}.order-first{order:-9999}.col-span-2{grid-column:span 2/span 2}.col-start-2{grid-column-start:2}.col-end-4{grid-column-end:4}.m-auto{margin:auto}.-m-1{margin:-.25rem}.m-1{margin:.25rem}.-m-2{margin:-.5rem}.m-2{margin:.5rem}.-m-px{margin:-1px}.my-2{margin-bottom:.5rem;margin-top:.5rem}.mx-auto{margin-left:auto;margin-right:auto}.-mx-4{margin-left:-1rem;margin-right:-1rem}.my-12{margin-bottom:3rem;margin-top:3rem}.mx-3{margin-left:.75rem;margin-right:.75rem}.my-4{margin-bottom:1rem;margin-top:1rem}.-my-2{margin-bottom:-.5rem;margin-top:-.5rem}.-mx-3{margin-left:-.75rem;margin-right:-.75rem}.my-8{margin-bottom:2rem;margin-top:2rem}.-my-3{margin-bottom:-.75rem;margin-top:-.75rem}.-my-1{margin-bottom:-.25rem;margin-top:-.25rem}.mx-6{margin-left:1.5rem;margin-right:1.5rem}.-my-6{margin-bottom:-1.5rem;margin-top:-1.5rem}.mx-4{margin-left:1rem;margin-right:1rem}.-mx-5{margin-left:-1.25rem;margin-right:-1.25rem}.mx-5{margin-left:1.25rem;margin-right:1.25rem}.my-1{margin-bottom:.25rem;margin-top:.25rem}.-mr-1{margin-right:-.25rem}.-ml-px{margin-left:-1px}.ml-4{margin-left:1rem}.mb-4{margin-bottom:1rem}.mb-0{margin-bottom:0}.mr-8{margin-right:2rem}.mt-8{margin-top:2rem}.-mb-4{margin-bottom:-1rem}.ml-2{margin-left:.5rem}.mr-3{margin-right:.75rem}.ml-1{margin-left:.25rem}.-mb-1{margin-bottom:-.25rem}.mt-1{margin-top:.25rem}.mb-1{margin-bottom:.25rem}.mt-6{margin-top:1.5rem}.mb-8{margin-bottom:2rem}.mb-2{margin-bottom:.5rem}.mr-2{margin-right:.5rem}.mb-3{margin-bottom:.75rem}.mt-4{margin-top:1rem}.mt-16{margin-top:4rem}.mb-6{margin-bottom:1.5rem}.-mt-4{margin-top:-1rem}.ml-6{margin-left:1.5rem}.-ml-12{margin-left:-3rem}.-mt-1{margin-top:-.25rem}.mb-16{margin-bottom:4rem}.ml-3{margin-left:.75rem}.mr-4{margin-right:1rem}.mt-3{margin-top:.75rem}.mb-20{margin-bottom:5rem}.mr-20{margin-right:5rem}.-mb-2{margin-bottom:-.5rem}.mr-5{margin-right:1.25rem}.-mt-5{margin-top:-1.25rem}.-mt-8{margin-top:-2rem}.mt-20{margin-top:5rem}.-mt-3{margin-top:-.75rem}.-mr-8{margin-right:-2rem}.mb-12{margin-bottom:3rem}.-ml-2{margin-left:-.5rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.h-screen{height:100vh}.h-4{height:1rem}.h-3{height:.75rem}.h-28{height:7rem}.h-12{height:3rem}.h-0{height:0}.h-1\/2{height:50%}.h-36{height:9rem}.h-full{height:100%}.h-auto{height:auto}.h-px{height:1px}.h-6{height:1.5rem}.h-20{height:5rem}.h-16{height:4rem}.h-8{height:2rem}.h-1{height:.25rem}.max-h-full{max-height:100%}.min-h-screen{min-height:100vh}.w-full{width:100%}.w-auto{width:auto}.w-4{width:1rem}.w-3{width:.75rem}.w-28{width:7rem}.w-12{width:3rem}.w-0{width:0}.w-6{width:1.5rem}.w-px{width:1px}.w-16{width:4rem}.w-8{width:2rem}.w-64{width:16rem}.w-1\/2{width:50%}.w-32{width:8rem}.min-w-48{min-width:12rem}.max-w-6xl{max-width:72rem}.max-w-3xl{max-width:48rem}.max-w-sm{max-width:24rem}.max-w-xl{max-width:36rem}.max-w-5xl{max-width:64rem}.max-w-none{max-width:none}.max-w-xs{max-width:20rem}.max-w-full{max-width:100%}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.flex-grow,.grow{flex-grow:1}.table-auto{table-layout:auto}.origin-center{transform-origin:center}.-translate-x-1\/2{--tw-translate-x:-50%}.-translate-x-1\/2,.-translate-y-1\/2{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\/2{--tw-translate-y:-50%}.translate-y-1\/2{--tw-translate-y:50%}.translate-y-16,.translate-y-1\/2{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-16{--tw-translate-y:4rem}.translate-y-0{--tw-translate-y:0px}.-translate-y-16,.translate-y-0{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-16{--tw-translate-y:-4rem}.translate-x-0{--tw-translate-x:0px}.translate-x-0,.translate-x-full{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-full{--tw-translate-x:100%}.-translate-y-8{--tw-translate-y:-2rem}.-translate-y-8,.translate-y-8{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-8{--tw-translate-y:2rem}.-translate-x-2{--tw-translate-x:-0.5rem}.-translate-x-2,.translate-x-2{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-2{--tw-translate-x:0.5rem}.rotate-180{--tw-rotate:180deg}.rotate-180,.rotate-90{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-90{--tw-rotate:90deg}.scale-105{--tw-scale-x:1.05;--tw-scale-y:1.05}.scale-105,.scale-95{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-95{--tw-scale-x:.95;--tw-scale-y:.95}.scale-100{--tw-scale-x:1;--tw-scale-y:1}.scale-100,.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@-webkit-keyframes float{0%,to{transform:translateY(0)}50%{transform:translateY(-5%)}}@keyframes float{0%,to{transform:translateY(0)}50%{transform:translateY(-5%)}}.animate-float{-webkit-animation:float 3s ease-in-out infinite;animation:float 3s ease-in-out infinite}.cursor-pointer{cursor:pointer}.list-inside{list-style-position:inside}.list-disc{list-style-type:disc}.appearance-none{-webkit-appearance:none;-moz-appearance:none;appearance:none}.auto-cols-min{grid-auto-columns:-webkit-min-content;grid-auto-columns:min-content}.grid-flow-row{grid-auto-flow:row}.grid-flow-col{grid-auto-flow:column}.auto-rows-max{grid-auto-rows:-webkit-max-content;grid-auto-rows:max-content}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.items-baseline{align-items:baseline}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-6{gap:1.5rem}.gap-5{gap:1.25rem}.gap-12{gap:3rem}.gap-8{gap:2rem}.gap-2{gap:.5rem}.space-x-6>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(1.5rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(1.5rem*var(--tw-space-x-reverse))}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(.5rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(.5rem*var(--tw-space-x-reverse))}.self-start{align-self:flex-start}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-scroll{overflow:scroll}.overflow-x-auto{overflow-x:auto}.rounded{border-radius:.25rem}.rounded-lg{border-radius:.5rem}.rounded-full{border-radius:9999px}.rounded-sm{border-radius:.125rem}.border{border-width:1px}.border-0{border-width:0}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-l{border-left-width:1px}.border-t{border-top-width:1px}.border-gray-200{--tw-border-opacity:1;border-color:rgb(234 234 234/var(--tw-border-opacity))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(223 223 223/var(--tw-border-opacity))}.border-blue-200{--tw-border-opacity:1;border-color:rgb(204 226 252/var(--tw-border-opacity))}.border-transparent{border-color:transparent}.border-gray-700{--tw-border-opacity:1;border-color:rgb(76 76 76/var(--tw-border-opacity))}.border-blue-500{--tw-border-opacity:1;border-color:rgb(0 112 243/var(--tw-border-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(223 223 223/var(--tw-bg-opacity))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(0 112 244/var(--tw-bg-opacity))}.bg-violet-500{--tw-bg-opacity:1;background-color:rgb(139 92 246/var(--tw-bg-opacity))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(25 25 25/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(234 234 234/var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(251 251 251/var(--tw-bg-opacity))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(230 240 253/var(--tw-bg-opacity))}.bg-yellow-400{--tw-bg-opacity:1;background-color:rgb(250 204 21/var(--tw-bg-opacity))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(0 112 243/var(--tw-bg-opacity))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(51 51 51/var(--tw-bg-opacity))}.bg-yellow-500{--tw-bg-opacity:1;background-color:rgb(234 179 8/var(--tw-bg-opacity))}.bg-opacity-75{--tw-bg-opacity:0.75}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.bg-gradient-to-b{background-image:linear-gradient(to bottom,var(--tw-gradient-stops))}.from-pink-200{--tw-gradient-from:#ec008c;--tw-gradient-to:rgba(236,0,140,0);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-gray-100{--tw-gradient-from:#fbfbfb;--tw-gradient-to:hsla(0,0%,98%,0);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-blue-100{--tw-gradient-from:#e6f0fd;--tw-gradient-to:rgba(230,240,253,0);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-white{--tw-gradient-from:#fff;--tw-gradient-to:hsla(0,0%,100%,0);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-blue-500{--tw-gradient-from:#0070f3;--tw-gradient-to:rgba(0,112,243,0);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.to-teal-400{--tw-gradient-to:#2dd4bf}.to-teal-300{--tw-gradient-to:#5eead4}.to-blue-500{--tw-gradient-to:#0070f3}.to-white{--tw-gradient-to:#fff}.to-gray-200{--tw-gradient-to:#eaeaea}.to-gray-100{--tw-gradient-to:#fbfbfb}.bg-clip-text{-webkit-background-clip:text;background-clip:text}.fill-current{fill:currentColor}.stroke-current{stroke:currentColor}.object-cover{-o-object-fit:cover;object-fit:cover}.object-center{-o-object-position:center;object-position:center}.p-6{padding:1.5rem}.p-10{padding:2.5rem}.p-4{padding:1rem}.p-2{padding:.5rem}.p-px{padding:1px}.p-1{padding:.25rem}.p-5{padding:1.25rem}.p-3{padding:.75rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1\.5{padding-bottom:.375rem;padding-top:.375rem}.py-1{padding-bottom:.25rem;padding-top:.25rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-4{padding-bottom:1rem;padding-top:1rem}.py-12{padding-bottom:3rem;padding-top:3rem}.py-10{padding-bottom:2.5rem;padding-top:2.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-5{padding-bottom:1.25rem;padding-top:1.25rem}.px-12{padding-left:3rem;padding-right:3rem}.px-2{padding-left:.5rem;padding-right:.5rem}.py-3{padding-bottom:.75rem;padding-top:.75rem}.py-6{padding-bottom:1.5rem;padding-top:1.5rem}.py-8{padding-bottom:2rem;padding-top:2rem}.pb-16{padding-bottom:4rem}.pb-9\/16{padding-bottom:56.25%}.pr-12{padding-right:3rem}.pb-3\/4{padding-bottom:75%}.pt-32{padding-top:8rem}.pb-12{padding-bottom:3rem}.pb-4{padding-bottom:1rem}.pl-10{padding-left:2.5rem}.pl-5{padding-left:1.25rem}.pt-4{padding-top:1rem}.pb-2{padding-bottom:.5rem}.pt-px{padding-top:1px}.pt-6{padding-top:1.5rem}.pb-20{padding-bottom:5rem}.pl-12{padding-left:3rem}.pb-5{padding-bottom:1.25rem}.pt-12{padding-top:3rem}.pb-14{padding-bottom:3.5rem}.pt-24{padding-top:6rem}.pr-2{padding-right:.5rem}.pl-2{padding-left:.5rem}.pt-5{padding-top:1.25rem}.pt-16{padding-top:4rem}.pt-8{padding-top:2rem}.pt-20{padding-top:5rem}.text-left{text-align:left}.text-center{text-align:center}.font-inter{font-family:Inter UI,sans-serif}.text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-base{font-size:1rem}.text-xl{font-size:1.25rem}.text-5xl{font-size:3.25rem}.text-3xl{font-size:2rem}.text-4xl{font-size:2.625rem}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-extrabold{font-weight:800}.font-bold{font-weight:700}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.italic{font-style:italic}.not-italic{font-style:normal}.leading-tight{line-height:1.25}.leading-loose{line-height:2}.leading-tighter{line-height:1.125}.leading-snug{line-height:1.375}.tracking-tighter{letter-spacing:-.02em}.tracking-tight{letter-spacing:-.01em}.text-gray-200{--tw-text-opacity:1;color:rgb(234 234 234/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.text-transparent{color:transparent}.text-gray-800{--tw-text-opacity:1;color:rgb(51 51 51/var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgb(153 153 153/var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgb(25 25 25/var(--tw-text-opacity))}.text-blue-600{--tw-text-opacity:1;color:rgb(0 112 244/var(--tw-text-opacity))}.text-gray-600{--tw-text-opacity:1;color:rgb(102 102 102/var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgb(76 76 76/var(--tw-text-opacity))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38/var(--tw-text-opacity))}.text-blue-300{--tw-text-opacity:1;color:rgb(153 197 250/var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgb(127 127 127/var(--tw-text-opacity))}.text-blue-500{--tw-text-opacity:1;color:rgb(0 112 243/var(--tw-text-opacity))}.text-green-500{--tw-text-opacity:1;color:rgb(34 197 94/var(--tw-text-opacity))}.text-gray-100{--tw-text-opacity:1;color:rgb(251 251 251/var(--tw-text-opacity))}.text-gray-300{--tw-text-opacity:1;color:rgb(223 223 223/var(--tw-text-opacity))}.text-blue-400{--tw-text-opacity:1;color:rgb(102 169 247/var(--tw-text-opacity))}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.placeholder-gray-500::-moz-placeholder{--tw-placeholder-opacity:1;color:rgb(127 127 127/var(--tw-placeholder-opacity))}.placeholder-gray-500::placeholder{--tw-placeholder-opacity:1;color:rgb(127 127 127/var(--tw-placeholder-opacity))}.opacity-75{opacity:.75}.opacity-0{opacity:0}.opacity-100{opacity:1}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.04),0 2px 4px -1px rgba(0,0,0,.03);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -1px var(--tw-shadow-color)}.shadow-2xl,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgba(0,0,0,.15);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.04),0 4px 6px -2px rgba(0,0,0,.02);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -2px var(--tw-shadow-color)}.shadow-lg,.shadow-xl{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgba(0,0,0,.12),0 10px 10px -5px rgba(0,0,0,.02);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color),0 10px 10px -5px var(--tw-shadow-color)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.16);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color)}.shadow,.shadow-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.blur{--tw-blur:blur(8px)}.blur,.drop-shadow-lg{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-lg{--tw-drop-shadow:drop-shadow(0 10px 8px rgba(0,0,0,.04)) drop-shadow(0 4px 3px rgba(0,0,0,.1))}.drop-shadow{--tw-drop-shadow:drop-shadow(0 1px 2px rgba(0,0,0,.1)) drop-shadow(0 1px 1px rgba(0,0,0,.06))}.drop-shadow,.drop-shadow-xl{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-xl{--tw-drop-shadow:drop-shadow(0 20px 13px rgba(0,0,0,.03)) drop-shadow(0 8px 5px rgba(0,0,0,.08))}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur{--tw-backdrop-blur:blur(8px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-text-decoration-color,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-text-decoration-color,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-all{transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-150,.transition-opacity{transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.duration-700{transition-duration:.7s}.duration-100{transition-duration:.1s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.ease-out{transition-timing-function:cubic-bezier(0,0,.2,1)}[x-cloak]{display:none}[data-aos][data-aos][data-aos-duration="50"],body[data-aos-duration="50"] [data-aos]{transition-duration:50ms}[data-aos][data-aos][data-aos-delay="50"],body[data-aos-delay="50"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="50"].aos-animate,body[data-aos-delay="50"] [data-aos].aos-animate{transition-delay:50ms}[data-aos][data-aos][data-aos-duration="100"],body[data-aos-duration="100"] [data-aos]{transition-duration:.1s}[data-aos][data-aos][data-aos-delay="100"],body[data-aos-delay="100"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="100"].aos-animate,body[data-aos-delay="100"] [data-aos].aos-animate{transition-delay:.1s}[data-aos][data-aos][data-aos-duration="150"],body[data-aos-duration="150"] [data-aos]{transition-duration:.15s}[data-aos][data-aos][data-aos-delay="150"],body[data-aos-delay="150"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="150"].aos-animate,body[data-aos-delay="150"] [data-aos].aos-animate{transition-delay:.15s}[data-aos][data-aos][data-aos-duration="200"],body[data-aos-duration="200"] [data-aos]{transition-duration:.2s}[data-aos][data-aos][data-aos-delay="200"],body[data-aos-delay="200"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="200"].aos-animate,body[data-aos-delay="200"] [data-aos].aos-animate{transition-delay:.2s}[data-aos][data-aos][data-aos-duration="250"],body[data-aos-duration="250"] [data-aos]{transition-duration:.25s}[data-aos][data-aos][data-aos-delay="250"],body[data-aos-delay="250"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="250"].aos-animate,body[data-aos-delay="250"] [data-aos].aos-animate{transition-delay:.25s}[data-aos][data-aos][data-aos-duration="300"],body[data-aos-duration="300"] [data-aos]{transition-duration:.3s}[data-aos][data-aos][data-aos-delay="300"],body[data-aos-delay="300"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="300"].aos-animate,body[data-aos-delay="300"] [data-aos].aos-animate{transition-delay:.3s}[data-aos][data-aos][data-aos-duration="350"],body[data-aos-duration="350"] [data-aos]{transition-duration:.35s}[data-aos][data-aos][data-aos-delay="350"],body[data-aos-delay="350"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="350"].aos-animate,body[data-aos-delay="350"] [data-aos].aos-animate{transition-delay:.35s}[data-aos][data-aos][data-aos-duration="400"],body[data-aos-duration="400"] [data-aos]{transition-duration:.4s}[data-aos][data-aos][data-aos-delay="400"],body[data-aos-delay="400"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="400"].aos-animate,body[data-aos-delay="400"] [data-aos].aos-animate{transition-delay:.4s}[data-aos][data-aos][data-aos-duration="450"],body[data-aos-duration="450"] [data-aos]{transition-duration:.45s}[data-aos][data-aos][data-aos-delay="450"],body[data-aos-delay="450"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="450"].aos-animate,body[data-aos-delay="450"] [data-aos].aos-animate{transition-delay:.45s}[data-aos][data-aos][data-aos-duration="500"],body[data-aos-duration="500"] [data-aos]{transition-duration:.5s}[data-aos][data-aos][data-aos-delay="500"],body[data-aos-delay="500"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="500"].aos-animate,body[data-aos-delay="500"] [data-aos].aos-animate{transition-delay:.5s}[data-aos][data-aos][data-aos-duration="550"],body[data-aos-duration="550"] [data-aos]{transition-duration:.55s}[data-aos][data-aos][data-aos-delay="550"],body[data-aos-delay="550"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="550"].aos-animate,body[data-aos-delay="550"] [data-aos].aos-animate{transition-delay:.55s}[data-aos][data-aos][data-aos-duration="600"],body[data-aos-duration="600"] [data-aos]{transition-duration:.6s}[data-aos][data-aos][data-aos-delay="600"],body[data-aos-delay="600"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="600"].aos-animate,body[data-aos-delay="600"] [data-aos].aos-animate{transition-delay:.6s}[data-aos][data-aos][data-aos-duration="650"],body[data-aos-duration="650"] [data-aos]{transition-duration:.65s}[data-aos][data-aos][data-aos-delay="650"],body[data-aos-delay="650"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="650"].aos-animate,body[data-aos-delay="650"] [data-aos].aos-animate{transition-delay:.65s}[data-aos][data-aos][data-aos-duration="700"],body[data-aos-duration="700"] [data-aos]{transition-duration:.7s}[data-aos][data-aos][data-aos-delay="700"],body[data-aos-delay="700"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="700"].aos-animate,body[data-aos-delay="700"] [data-aos].aos-animate{transition-delay:.7s}[data-aos][data-aos][data-aos-duration="750"],body[data-aos-duration="750"] [data-aos]{transition-duration:.75s}[data-aos][data-aos][data-aos-delay="750"],body[data-aos-delay="750"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="750"].aos-animate,body[data-aos-delay="750"] [data-aos].aos-animate{transition-delay:.75s}[data-aos][data-aos][data-aos-duration="800"],body[data-aos-duration="800"] [data-aos]{transition-duration:.8s}[data-aos][data-aos][data-aos-delay="800"],body[data-aos-delay="800"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="800"].aos-animate,body[data-aos-delay="800"] [data-aos].aos-animate{transition-delay:.8s}[data-aos][data-aos][data-aos-duration="850"],body[data-aos-duration="850"] [data-aos]{transition-duration:.85s}[data-aos][data-aos][data-aos-delay="850"],body[data-aos-delay="850"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="850"].aos-animate,body[data-aos-delay="850"] [data-aos].aos-animate{transition-delay:.85s}[data-aos][data-aos][data-aos-duration="900"],body[data-aos-duration="900"] [data-aos]{transition-duration:.9s}[data-aos][data-aos][data-aos-delay="900"],body[data-aos-delay="900"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="900"].aos-animate,body[data-aos-delay="900"] [data-aos].aos-animate{transition-delay:.9s}[data-aos][data-aos][data-aos-duration="950"],body[data-aos-duration="950"] [data-aos]{transition-duration:.95s}[data-aos][data-aos][data-aos-delay="950"],body[data-aos-delay="950"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="950"].aos-animate,body[data-aos-delay="950"] [data-aos].aos-animate{transition-delay:.95s}[data-aos][data-aos][data-aos-duration="1000"],body[data-aos-duration="1000"] [data-aos]{transition-duration:1s}[data-aos][data-aos][data-aos-delay="1000"],body[data-aos-delay="1000"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1000"].aos-animate,body[data-aos-delay="1000"] [data-aos].aos-animate{transition-delay:1s}[data-aos][data-aos][data-aos-duration="1050"],body[data-aos-duration="1050"] [data-aos]{transition-duration:1.05s}[data-aos][data-aos][data-aos-delay="1050"],body[data-aos-delay="1050"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1050"].aos-animate,body[data-aos-delay="1050"] [data-aos].aos-animate{transition-delay:1.05s}[data-aos][data-aos][data-aos-duration="1100"],body[data-aos-duration="1100"] [data-aos]{transition-duration:1.1s}[data-aos][data-aos][data-aos-delay="1100"],body[data-aos-delay="1100"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1100"].aos-animate,body[data-aos-delay="1100"] [data-aos].aos-animate{transition-delay:1.1s}[data-aos][data-aos][data-aos-duration="1150"],body[data-aos-duration="1150"] [data-aos]{transition-duration:1.15s}[data-aos][data-aos][data-aos-delay="1150"],body[data-aos-delay="1150"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1150"].aos-animate,body[data-aos-delay="1150"] [data-aos].aos-animate{transition-delay:1.15s}[data-aos][data-aos][data-aos-duration="1200"],body[data-aos-duration="1200"] [data-aos]{transition-duration:1.2s}[data-aos][data-aos][data-aos-delay="1200"],body[data-aos-delay="1200"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1200"].aos-animate,body[data-aos-delay="1200"] [data-aos].aos-animate{transition-delay:1.2s}[data-aos][data-aos][data-aos-duration="1250"],body[data-aos-duration="1250"] [data-aos]{transition-duration:1.25s}[data-aos][data-aos][data-aos-delay="1250"],body[data-aos-delay="1250"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1250"].aos-animate,body[data-aos-delay="1250"] [data-aos].aos-animate{transition-delay:1.25s}[data-aos][data-aos][data-aos-duration="1300"],body[data-aos-duration="1300"] [data-aos]{transition-duration:1.3s}[data-aos][data-aos][data-aos-delay="1300"],body[data-aos-delay="1300"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1300"].aos-animate,body[data-aos-delay="1300"] [data-aos].aos-animate{transition-delay:1.3s}[data-aos][data-aos][data-aos-duration="1350"],body[data-aos-duration="1350"] [data-aos]{transition-duration:1.35s}[data-aos][data-aos][data-aos-delay="1350"],body[data-aos-delay="1350"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1350"].aos-animate,body[data-aos-delay="1350"] [data-aos].aos-animate{transition-delay:1.35s}[data-aos][data-aos][data-aos-duration="1400"],body[data-aos-duration="1400"] [data-aos]{transition-duration:1.4s}[data-aos][data-aos][data-aos-delay="1400"],body[data-aos-delay="1400"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1400"].aos-animate,body[data-aos-delay="1400"] [data-aos].aos-animate{transition-delay:1.4s}[data-aos][data-aos][data-aos-duration="1450"],body[data-aos-duration="1450"] [data-aos]{transition-duration:1.45s}[data-aos][data-aos][data-aos-delay="1450"],body[data-aos-delay="1450"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1450"].aos-animate,body[data-aos-delay="1450"] [data-aos].aos-animate{transition-delay:1.45s}[data-aos][data-aos][data-aos-duration="1500"],body[data-aos-duration="1500"] [data-aos]{transition-duration:1.5s}[data-aos][data-aos][data-aos-delay="1500"],body[data-aos-delay="1500"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1500"].aos-animate,body[data-aos-delay="1500"] [data-aos].aos-animate{transition-delay:1.5s}[data-aos][data-aos][data-aos-duration="1550"],body[data-aos-duration="1550"] [data-aos]{transition-duration:1.55s}[data-aos][data-aos][data-aos-delay="1550"],body[data-aos-delay="1550"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1550"].aos-animate,body[data-aos-delay="1550"] [data-aos].aos-animate{transition-delay:1.55s}[data-aos][data-aos][data-aos-duration="1600"],body[data-aos-duration="1600"] [data-aos]{transition-duration:1.6s}[data-aos][data-aos][data-aos-delay="1600"],body[data-aos-delay="1600"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1600"].aos-animate,body[data-aos-delay="1600"] [data-aos].aos-animate{transition-delay:1.6s}[data-aos][data-aos][data-aos-duration="1650"],body[data-aos-duration="1650"] [data-aos]{transition-duration:1.65s}[data-aos][data-aos][data-aos-delay="1650"],body[data-aos-delay="1650"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1650"].aos-animate,body[data-aos-delay="1650"] [data-aos].aos-animate{transition-delay:1.65s}[data-aos][data-aos][data-aos-duration="1700"],body[data-aos-duration="1700"] [data-aos]{transition-duration:1.7s}[data-aos][data-aos][data-aos-delay="1700"],body[data-aos-delay="1700"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1700"].aos-animate,body[data-aos-delay="1700"] [data-aos].aos-animate{transition-delay:1.7s}[data-aos][data-aos][data-aos-duration="1750"],body[data-aos-duration="1750"] [data-aos]{transition-duration:1.75s}[data-aos][data-aos][data-aos-delay="1750"],body[data-aos-delay="1750"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1750"].aos-animate,body[data-aos-delay="1750"] [data-aos].aos-animate{transition-delay:1.75s}[data-aos][data-aos][data-aos-duration="1800"],body[data-aos-duration="1800"] [data-aos]{transition-duration:1.8s}[data-aos][data-aos][data-aos-delay="1800"],body[data-aos-delay="1800"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1800"].aos-animate,body[data-aos-delay="1800"] [data-aos].aos-animate{transition-delay:1.8s}[data-aos][data-aos][data-aos-duration="1850"],body[data-aos-duration="1850"] [data-aos]{transition-duration:1.85s}[data-aos][data-aos][data-aos-delay="1850"],body[data-aos-delay="1850"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1850"].aos-animate,body[data-aos-delay="1850"] [data-aos].aos-animate{transition-delay:1.85s}[data-aos][data-aos][data-aos-duration="1900"],body[data-aos-duration="1900"] [data-aos]{transition-duration:1.9s}[data-aos][data-aos][data-aos-delay="1900"],body[data-aos-delay="1900"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1900"].aos-animate,body[data-aos-delay="1900"] [data-aos].aos-animate{transition-delay:1.9s}[data-aos][data-aos][data-aos-duration="1950"],body[data-aos-duration="1950"] [data-aos]{transition-duration:1.95s}[data-aos][data-aos][data-aos-delay="1950"],body[data-aos-delay="1950"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="1950"].aos-animate,body[data-aos-delay="1950"] [data-aos].aos-animate{transition-delay:1.95s}[data-aos][data-aos][data-aos-duration="2000"],body[data-aos-duration="2000"] [data-aos]{transition-duration:2s}[data-aos][data-aos][data-aos-delay="2000"],body[data-aos-delay="2000"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2000"].aos-animate,body[data-aos-delay="2000"] [data-aos].aos-animate{transition-delay:2s}[data-aos][data-aos][data-aos-duration="2050"],body[data-aos-duration="2050"] [data-aos]{transition-duration:2.05s}[data-aos][data-aos][data-aos-delay="2050"],body[data-aos-delay="2050"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2050"].aos-animate,body[data-aos-delay="2050"] [data-aos].aos-animate{transition-delay:2.05s}[data-aos][data-aos][data-aos-duration="2100"],body[data-aos-duration="2100"] [data-aos]{transition-duration:2.1s}[data-aos][data-aos][data-aos-delay="2100"],body[data-aos-delay="2100"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2100"].aos-animate,body[data-aos-delay="2100"] [data-aos].aos-animate{transition-delay:2.1s}[data-aos][data-aos][data-aos-duration="2150"],body[data-aos-duration="2150"] [data-aos]{transition-duration:2.15s}[data-aos][data-aos][data-aos-delay="2150"],body[data-aos-delay="2150"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2150"].aos-animate,body[data-aos-delay="2150"] [data-aos].aos-animate{transition-delay:2.15s}[data-aos][data-aos][data-aos-duration="2200"],body[data-aos-duration="2200"] [data-aos]{transition-duration:2.2s}[data-aos][data-aos][data-aos-delay="2200"],body[data-aos-delay="2200"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2200"].aos-animate,body[data-aos-delay="2200"] [data-aos].aos-animate{transition-delay:2.2s}[data-aos][data-aos][data-aos-duration="2250"],body[data-aos-duration="2250"] [data-aos]{transition-duration:2.25s}[data-aos][data-aos][data-aos-delay="2250"],body[data-aos-delay="2250"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2250"].aos-animate,body[data-aos-delay="2250"] [data-aos].aos-animate{transition-delay:2.25s}[data-aos][data-aos][data-aos-duration="2300"],body[data-aos-duration="2300"] [data-aos]{transition-duration:2.3s}[data-aos][data-aos][data-aos-delay="2300"],body[data-aos-delay="2300"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2300"].aos-animate,body[data-aos-delay="2300"] [data-aos].aos-animate{transition-delay:2.3s}[data-aos][data-aos][data-aos-duration="2350"],body[data-aos-duration="2350"] [data-aos]{transition-duration:2.35s}[data-aos][data-aos][data-aos-delay="2350"],body[data-aos-delay="2350"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2350"].aos-animate,body[data-aos-delay="2350"] [data-aos].aos-animate{transition-delay:2.35s}[data-aos][data-aos][data-aos-duration="2400"],body[data-aos-duration="2400"] [data-aos]{transition-duration:2.4s}[data-aos][data-aos][data-aos-delay="2400"],body[data-aos-delay="2400"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2400"].aos-animate,body[data-aos-delay="2400"] [data-aos].aos-animate{transition-delay:2.4s}[data-aos][data-aos][data-aos-duration="2450"],body[data-aos-duration="2450"] [data-aos]{transition-duration:2.45s}[data-aos][data-aos][data-aos-delay="2450"],body[data-aos-delay="2450"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2450"].aos-animate,body[data-aos-delay="2450"] [data-aos].aos-animate{transition-delay:2.45s}[data-aos][data-aos][data-aos-duration="2500"],body[data-aos-duration="2500"] [data-aos]{transition-duration:2.5s}[data-aos][data-aos][data-aos-delay="2500"],body[data-aos-delay="2500"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2500"].aos-animate,body[data-aos-delay="2500"] [data-aos].aos-animate{transition-delay:2.5s}[data-aos][data-aos][data-aos-duration="2550"],body[data-aos-duration="2550"] [data-aos]{transition-duration:2.55s}[data-aos][data-aos][data-aos-delay="2550"],body[data-aos-delay="2550"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2550"].aos-animate,body[data-aos-delay="2550"] [data-aos].aos-animate{transition-delay:2.55s}[data-aos][data-aos][data-aos-duration="2600"],body[data-aos-duration="2600"] [data-aos]{transition-duration:2.6s}[data-aos][data-aos][data-aos-delay="2600"],body[data-aos-delay="2600"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2600"].aos-animate,body[data-aos-delay="2600"] [data-aos].aos-animate{transition-delay:2.6s}[data-aos][data-aos][data-aos-duration="2650"],body[data-aos-duration="2650"] [data-aos]{transition-duration:2.65s}[data-aos][data-aos][data-aos-delay="2650"],body[data-aos-delay="2650"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2650"].aos-animate,body[data-aos-delay="2650"] [data-aos].aos-animate{transition-delay:2.65s}[data-aos][data-aos][data-aos-duration="2700"],body[data-aos-duration="2700"] [data-aos]{transition-duration:2.7s}[data-aos][data-aos][data-aos-delay="2700"],body[data-aos-delay="2700"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2700"].aos-animate,body[data-aos-delay="2700"] [data-aos].aos-animate{transition-delay:2.7s}[data-aos][data-aos][data-aos-duration="2750"],body[data-aos-duration="2750"] [data-aos]{transition-duration:2.75s}[data-aos][data-aos][data-aos-delay="2750"],body[data-aos-delay="2750"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2750"].aos-animate,body[data-aos-delay="2750"] [data-aos].aos-animate{transition-delay:2.75s}[data-aos][data-aos][data-aos-duration="2800"],body[data-aos-duration="2800"] [data-aos]{transition-duration:2.8s}[data-aos][data-aos][data-aos-delay="2800"],body[data-aos-delay="2800"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2800"].aos-animate,body[data-aos-delay="2800"] [data-aos].aos-animate{transition-delay:2.8s}[data-aos][data-aos][data-aos-duration="2850"],body[data-aos-duration="2850"] [data-aos]{transition-duration:2.85s}[data-aos][data-aos][data-aos-delay="2850"],body[data-aos-delay="2850"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2850"].aos-animate,body[data-aos-delay="2850"] [data-aos].aos-animate{transition-delay:2.85s}[data-aos][data-aos][data-aos-duration="2900"],body[data-aos-duration="2900"] [data-aos]{transition-duration:2.9s}[data-aos][data-aos][data-aos-delay="2900"],body[data-aos-delay="2900"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2900"].aos-animate,body[data-aos-delay="2900"] [data-aos].aos-animate{transition-delay:2.9s}[data-aos][data-aos][data-aos-duration="2950"],body[data-aos-duration="2950"] [data-aos]{transition-duration:2.95s}[data-aos][data-aos][data-aos-delay="2950"],body[data-aos-delay="2950"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="2950"].aos-animate,body[data-aos-delay="2950"] [data-aos].aos-animate{transition-delay:2.95s}[data-aos][data-aos][data-aos-duration="3000"],body[data-aos-duration="3000"] [data-aos]{transition-duration:3s}[data-aos][data-aos][data-aos-delay="3000"],body[data-aos-delay="3000"] [data-aos]{transition-delay:0}[data-aos][data-aos][data-aos-delay="3000"].aos-animate,body[data-aos-delay="3000"] [data-aos].aos-animate{transition-delay:3s}[data-aos][data-aos][data-aos-easing=linear],body[data-aos-easing=linear] [data-aos]{transition-timing-function:cubic-bezier(.25,.25,.75,.75)}[data-aos][data-aos][data-aos-easing=ease],body[data-aos-easing=ease] [data-aos]{transition-timing-function:ease}[data-aos][data-aos][data-aos-easing=ease-in],body[data-aos-easing=ease-in] [data-aos]{transition-timing-function:ease-in}[data-aos][data-aos][data-aos-easing=ease-out],body[data-aos-easing=ease-out] [data-aos]{transition-timing-function:ease-out}[data-aos][data-aos][data-aos-easing=ease-in-out],body[data-aos-easing=ease-in-out] [data-aos]{transition-timing-function:ease-in-out}[data-aos][data-aos][data-aos-easing=ease-in-back],body[data-aos-easing=ease-in-back] [data-aos]{transition-timing-function:cubic-bezier(.6,-.28,.735,.045)}[data-aos][data-aos][data-aos-easing=ease-out-back],body[data-aos-easing=ease-out-back] [data-aos]{transition-timing-function:cubic-bezier(.175,.885,.32,1.275)}[data-aos][data-aos][data-aos-easing=ease-in-out-back],body[data-aos-easing=ease-in-out-back] [data-aos]{transition-timing-function:cubic-bezier(.68,-.55,.265,1.55)}[data-aos][data-aos][data-aos-easing=ease-in-sine],body[data-aos-easing=ease-in-sine] [data-aos]{transition-timing-function:cubic-bezier(.47,0,.745,.715)}[data-aos][data-aos][data-aos-easing=ease-out-sine],body[data-aos-easing=ease-out-sine] [data-aos]{transition-timing-function:cubic-bezier(.39,.575,.565,1)}[data-aos][data-aos][data-aos-easing=ease-in-out-sine],body[data-aos-easing=ease-in-out-sine] [data-aos]{transition-timing-function:cubic-bezier(.445,.05,.55,.95)}[data-aos][data-aos][data-aos-easing=ease-in-quad],body[data-aos-easing=ease-in-quad] [data-aos]{transition-timing-function:cubic-bezier(.55,.085,.68,.53)}[data-aos][data-aos][data-aos-easing=ease-out-quad],body[data-aos-easing=ease-out-quad] [data-aos]{transition-timing-function:cubic-bezier(.25,.46,.45,.94)}[data-aos][data-aos][data-aos-easing=ease-in-out-quad],body[data-aos-easing=ease-in-out-quad] [data-aos]{transition-timing-function:cubic-bezier(.455,.03,.515,.955)}[data-aos][data-aos][data-aos-easing=ease-in-cubic],body[data-aos-easing=ease-in-cubic] [data-aos]{transition-timing-function:cubic-bezier(.55,.085,.68,.53)}[data-aos][data-aos][data-aos-easing=ease-out-cubic],body[data-aos-easing=ease-out-cubic] [data-aos]{transition-timing-function:cubic-bezier(.25,.46,.45,.94)}[data-aos][data-aos][data-aos-easing=ease-in-out-cubic],body[data-aos-easing=ease-in-out-cubic] [data-aos]{transition-timing-function:cubic-bezier(.455,.03,.515,.955)}[data-aos][data-aos][data-aos-easing=ease-in-quart],body[data-aos-easing=ease-in-quart] [data-aos]{transition-timing-function:cubic-bezier(.55,.085,.68,.53)}[data-aos][data-aos][data-aos-easing=ease-out-quart],body[data-aos-easing=ease-out-quart] [data-aos]{transition-timing-function:cubic-bezier(.25,.46,.45,.94)}[data-aos][data-aos][data-aos-easing=ease-in-out-quart],body[data-aos-easing=ease-in-out-quart] [data-aos]{transition-timing-function:cubic-bezier(.455,.03,.515,.955)}[data-aos^=fade][data-aos^=fade]{opacity:0;transition-property:opacity,transform}[data-aos^=fade][data-aos^=fade].aos-animate{opacity:1;transform:translateZ(0)}[data-aos=fade-up]{transform:translate3d(0,10px,0)}[data-aos=fade-down]{transform:translate3d(0,-10px,0)}[data-aos=fade-right]{transform:translate3d(-10px,0,0)}[data-aos=fade-left]{transform:translate3d(10px,0,0)}[data-aos=fade-up-right]{transform:translate3d(-10px,10px,0)}[data-aos=fade-up-left]{transform:translate3d(10px,10px,0)}[data-aos=fade-down-right]{transform:translate3d(-10px,-10px,0)}[data-aos=fade-down-left]{transform:translate3d(10px,-10px,0)}[data-aos^=zoom][data-aos^=zoom]{opacity:0;transition-property:opacity,transform}[data-aos^=zoom][data-aos^=zoom].aos-animate{opacity:1;transform:translateZ(0) scale(1)}[data-aos=zoom-in]{transform:scale(.6)}[data-aos=zoom-in-up]{transform:translate3d(0,10px,0) scale(.6)}[data-aos=zoom-in-down]{transform:translate3d(0,-10px,0) scale(.6)}[data-aos=zoom-in-right]{transform:translate3d(-10px,0,0) scale(.6)}[data-aos=zoom-in-left]{transform:translate3d(10px,0,0) scale(.6)}[data-aos=zoom-out]{transform:scale(1.2)}[data-aos=zoom-out-up]{transform:translate3d(0,10px,0) scale(1.2)}[data-aos=zoom-out-down]{transform:translate3d(0,-10px,0) scale(1.2)}[data-aos=zoom-out-right]{transform:translate3d(-10px,0,0) scale(1.2)}[data-aos=zoom-out-left]{transform:translate3d(10px,0,0) scale(1.2)}[data-aos^=slide][data-aos^=slide]{transition-property:transform}[data-aos^=slide][data-aos^=slide].aos-animate{transform:translateZ(0)}[data-aos=slide-up]{transform:translate3d(0,100%,0)}[data-aos=slide-down]{transform:translate3d(0,-100%,0)}[data-aos=slide-right]{transform:translate3d(-100%,0,0)}[data-aos=slide-left]{transform:translate3d(100%,0,0)}[data-aos^=flip][data-aos^=flip]{-webkit-backface-visibility:hidden;backface-visibility:hidden;transition-property:transform}[data-aos=flip-left]{transform:perspective(2500px) rotateY(-100deg)}[data-aos=flip-left].aos-animate{transform:perspective(2500px) rotateY(0)}[data-aos=flip-right]{transform:perspective(2500px) rotateY(100deg)}[data-aos=flip-right].aos-animate{transform:perspective(2500px) rotateY(0)}[data-aos=flip-up]{transform:perspective(2500px) rotateX(-100deg)}[data-aos=flip-up].aos-animate{transform:perspective(2500px) rotateX(0)}[data-aos=flip-down]{transform:perspective(2500px) rotateX(100deg)}[data-aos=flip-down].aos-animate{transform:perspective(2500px) rotateX(0)}@font-face{font-display:optional;font-family:Inter UI;font-style:normal;font-weight:100;src:url(../../fonts/Inter-Thin.woff2) format("woff2"),url(../../fonts/Inter-Thin.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:italic;font-weight:100;src:url(../../fonts/Inter-ThinItalic.woff2) format("woff2"),url(../../fonts/Inter-ThinItalic.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:normal;font-weight:200;src:url(../../fonts/Inter-ExtraLight.woff2) format("woff2"),url(../../fonts/Inter-ExtraLight.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:italic;font-weight:200;src:url(../../fonts/Inter-ExtraLightItalic.woff2) format("woff2"),url(../../fonts/Inter-ExtraLightItalic.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:normal;font-weight:300;src:url(../../fonts/Inter-Light.woff2) format("woff2"),url(../../fonts/Inter-Light.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:italic;font-weight:300;src:url(../../fonts/Inter-LightItalic.woff2) format("woff2"),url(../../fonts/Inter-LightItalic.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:normal;font-weight:400;src:url(../../fonts/Inter-Regular.woff2) format("woff2"),url(../../fonts/Inter-Regular.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:italic;font-weight:400;src:url(../../fonts/Inter-Italic.woff2) format("woff2"),url(../../fonts/Inter-Italic.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:normal;font-weight:500;src:url(../../fonts/Inter-Medium.woff2) format("woff2"),url(../../fonts/Inter-Medium.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:italic;font-weight:500;src:url(../../fonts/Inter-MediumItalic.woff2) format("woff2"),url(../../fonts/Inter-MediumItalic.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:normal;font-weight:600;src:url(../../fonts/Inter-SemiBold.woff2) format("woff2"),url(../../fonts/Inter-SemiBold.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:italic;font-weight:600;src:url(../../fonts/Inter-SemiBoldItalic.woff2) format("woff2"),url(../../fonts/Inter-SemiBoldItalic.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:normal;font-weight:700;src:url(../../fonts/Inter-Bold.woff2) format("woff2"),url(../../fonts/Inter-Bold.woff) format("woff")}@font-face{font-family:Inter UI;font-style:italic;font-weight:700;src:url(../../fonts/Inter-BoldItalic.woff2) format("woff2"),url(../../fonts/Inter-BoldItalic.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:normal;font-weight:800;src:url(../../fonts/Inter-ExtraBold.woff2) format("woff2"),url(../../fonts/Inter-ExtraBold.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:italic;font-weight:800;src:url(../../fonts/Inter-ExtraBoldItalic.woff2) format("woff2"),url(../../fonts/Inter-ExtraBoldItalic.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:normal;font-weight:900;src:url(../../fonts/Inter-Black.woff2) format("woff2"),url(../../fonts/Inter-Black.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI;font-style:italic;font-weight:900;src:url(../../fonts/Inter-BlackItalic.woff2) format("woff2"),url(../../fonts/Inter-BlackItalic.woff) format("woff")}@font-face{font-display:optional;font-family:Inter UI var;font-style:oblique 0deg 10deg;font-weight:100 900;src:url(https://www.patterns.dev/fonts/Inter.var.woff2) format("woff2")}@font-face{font-named-instance:"Regular";font-display:optional;font-family:Inter UI var alt;font-style:normal;font-weight:100 900;src:url(../../fonts/Inter-roman.var.woff2) format("woff2")}@font-face{font-named-instance:"Italic";font-display:optional;font-family:Inter UI var alt;font-style:italic;font-weight:100 900;src:url(../../fonts/Inter-italic.var.woff2) format("woff2")}.hover\:-translate-y-1:hover{--tw-translate-y:-0.25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgb(51 51 51/var(--tw-bg-opacity))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(0 100 218/var(--tw-bg-opacity))}.hover\:bg-gray-100:hover{--tw-bg-opacity:1;background-color:rgb(251 251 251/var(--tw-bg-opacity))}.hover\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(0 112 244/var(--tw-bg-opacity))}.hover\:bg-violet-700:hover{--tw-bg-opacity:1;background-color:rgb(109 40 217/var(--tw-bg-opacity))}.hover\:bg-white:hover{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.hover\:bg-blue-200:hover{--tw-bg-opacity:1;background-color:rgb(204 226 252/var(--tw-bg-opacity))}.hover\:text-gray-900:hover{--tw-text-opacity:1;color:rgb(25 25 25/var(--tw-text-opacity))}.hover\:underline:hover{-webkit-text-decoration-line:underline;text-decoration-line:underline}.hover\:shadow-lg:hover{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.04),0 4px 6px -2px rgba(0,0,0,.02);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.focus\:border-gray-600:focus{--tw-border-opacity:1;border-color:rgb(102 102 102/var(--tw-border-opacity))}.focus\:bg-blue-700:focus{--tw-bg-opacity:1;background-color:rgb(0 100 218/var(--tw-bg-opacity))}.focus\:shadow-lg:focus{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.04),0 4px 6px -2px rgba(0,0,0,.02);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-0:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.active\:bg-blue-800:active{--tw-bg-opacity:1;background-color:rgb(0 89 194/var(--tw-bg-opacity))}.active\:shadow-lg:active{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.04),0 4px 6px -2px rgba(0,0,0,.02);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.group:hover .group-hover\:text-blue-600{--tw-text-opacity:1;color:rgb(0 112 244/var(--tw-text-opacity))}@media (min-width:640px){.sm\:col-span-12{grid-column:span 12/span 12}.sm\:col-span-6{grid-column:span 6/span 6}.sm\:-mx-3{margin-left:-.75rem;margin-right:-.75rem}.sm\:-my-8{margin-bottom:-2rem;margin-top:-2rem}.sm\:mb-0{margin-bottom:0}.sm\:mt-2{margin-top:.5rem}.sm\:ml-4{margin-left:1rem}.sm\:ml-8{margin-left:2rem}.sm\:mb-2{margin-bottom:.5rem}.sm\:mr-2{margin-right:.5rem}.sm\:flex{display:flex}.sm\:w-auto{width:auto}.sm\:w-1\/2{width:50%}.sm\:max-w-none{max-width:none}.sm\:max-w-xs{max-width:20rem}.sm\:max-w-5xl{max-width:64rem}.sm\:max-w-md{max-width:28rem}.sm\:grid-cols-12{grid-template-columns:repeat(12,minmax(0,1fr))}.sm\:grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.sm\:flex-row{flex-direction:row}.sm\:flex-wrap{flex-wrap:wrap}.sm\:items-center{align-items:center}.sm\:justify-center{justify-content:center}.sm\:justify-between{justify-content:space-between}.sm\:px-6{padding-left:1.5rem;padding-right:1.5rem}.sm\:px-3{padding-left:.75rem;padding-right:.75rem}.sm\:py-8{padding-bottom:2rem;padding-top:2rem}.sm\:text-left{text-align:left}.sm\:text-lg{font-size:1.125rem}.sm\:text-base{font-size:1rem}}@media (min-width:768px){.md\:visible{visibility:visible}.md\:order-1{order:1}.md\:col-span-7{grid-column:span 7/span 7}.md\:col-span-5{grid-column:span 5/span 5}.md\:col-span-3{grid-column:span 3/span 3}.md\:col-auto{grid-column:auto}.md\:my-0{margin-bottom:0;margin-top:0}.md\:mx-0{margin-left:0;margin-right:0}.md\:mt-2{margin-top:.5rem}.md\:mt-6{margin-top:1.5rem}.md\:mb-0{margin-bottom:0}.md\:mt-24{margin-top:6rem}.md\:mb-16{margin-bottom:4rem}.md\:ml-4{margin-left:1rem}.md\:ml-12{margin-left:3rem}.md\:mt-0{margin-top:0}.md\:mr-12{margin-right:3rem}.md\:block{display:block}.md\:flex{display:flex}.md\:grid{display:grid}.md\:hidden{display:none}.md\:h-20{height:5rem}.md\:h-auto{height:auto}.md\:w-full{width:100%}.md\:w-64{width:16rem}.md\:w-1\/3{width:33.333333%}.md\:w-1\/2{width:50%}.md\:w-auto{width:auto}.md\:max-w-none{max-width:none}.md\:max-w-2xl{max-width:42rem}.md\:max-w-3xl{max-width:48rem}.md\:max-w-4xl{max-width:56rem}.md\:flex-shrink-0{flex-shrink:0}.md\:flex-grow{flex-grow:1}.md\:-translate-x-1\/2{--tw-translate-x:-50%}.md\:-translate-x-1\/2,.md\:translate-x-1\/2{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.md\:translate-x-1\/2{--tw-translate-x:50%}.md\:grid-cols-12{grid-template-columns:repeat(12,minmax(0,1fr))}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.md\:grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.md\:flex-nowrap{flex-wrap:nowrap}.md\:items-center{align-items:center}.md\:justify-start{justify-content:flex-start}.md\:justify-between{justify-content:space-between}.md\:gap-6{gap:1.5rem}.md\:gap-16{gap:4rem}.md\:bg-opacity-90{--tw-bg-opacity:0.9}.md\:py-20{padding-bottom:5rem;padding-top:5rem}.md\:px-12{padding-left:3rem;padding-right:3rem}.md\:py-16{padding-bottom:4rem;padding-top:4rem}.md\:py-12{padding-bottom:3rem;padding-top:3rem}.md\:py-8{padding-bottom:2rem;padding-top:2rem}.md\:pt-40{padding-top:10rem}.md\:pb-20{padding-bottom:5rem}.md\:pb-16{padding-bottom:4rem}.md\:pt-20{padding-top:5rem}.md\:pr-4{padding-right:1rem}.md\:pt-16{padding-top:4rem}.md\:pt-12{padding-top:3rem}.md\:pb-4{padding-bottom:1rem}.md\:text-left{text-align:left}.md\:text-6xl{font-size:5.5rem}.md\:text-4xl{font-size:2.625rem}}@media (min-width:1024px){.lg\:col-span-6{grid-column:span 6/span 6}.lg\:col-span-3{grid-column:span 3/span 3}.lg\:col-span-2{grid-column:span 2/span 2}.lg\:mx-0{margin-left:0;margin-right:0}.lg\:mt-0{margin-top:0}.lg\:mb-0{margin-bottom:0}.lg\:mr-16{margin-right:4rem}.lg\:ml-20{margin-left:5rem}.lg\:ml-16{margin-left:4rem}.lg\:mr-20{margin-right:5rem}.lg\:block{display:block}.lg\:flex{display:flex}.lg\:w-1\/2{width:50%}.lg\:w-auto{width:auto}.lg\:max-w-none{max-width:none}.lg\:max-w-5xl{max-width:64rem}.lg\:max-w-xl{max-width:36rem}.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.lg\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.lg\:flex-row{flex-direction:row}.lg\:justify-between{justify-content:space-between}.lg\:px-5{padding-left:1.25rem;padding-right:1.25rem}.lg\:px-4{padding-left:1rem;padding-right:1rem}.lg\:pr-12{padding-right:3rem}.lg\:text-left{text-align:left}.lg\:text-right{text-align:right}.lg\:text-5xl{font-size:3.25rem}}@media (min-width:1280px){.xl\:max-w-none{max-width:none}.xl\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.xl\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.xl\:gap-6{gap:1.5rem}.xl\:pr-16{padding-right:4rem}}</style><link href=../../fonts/Inter-ExtraBold.woff2 rel=preload type=font/woff2 as=font crossorigin=""><script src="../../js/alpine%EF%B9%96hash=368db641d1.js" defer></script><script src="../../js/aos%EF%B9%96hash=03b0189357.js" defer></script><script src="../../js/sticky.min%EF%B9%96hash=df3df31a2b.js" defer></script><script csp-hash="">document.addEventListener('DOMContentLoaded', () => {
        AOS.init({
          once: true,
          disable: 'phone',
          duration: 700,
          easing: 'ease-out-cubic',
        });

        new Sticky('[data-sticky]');
      });</script><style>article *{scroll-margin-top:50px}header nav{z-index:1}:root{--main-width:calc(100vw - 3em)}@media (min-width:37.5em){:root{--main-width:calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}share-widget div{width:30px;height:30px;background-image:url(../../img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(../../img/share-apple.svg)}share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}dialog{background-color:#8dff80}header aside{font-style:italic}code:not(pre>code){background-color:#f3f3f0;padding:4px 10px;border-radius:4px;font-size:90%}.code{overflow:hidden}</style><body class="text-gray-900 antialiased bg-white font-inter tracking-tight"><header>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<noscript><img alt="" height=1 src="https://www.patterns.dev/.netlify/functions/ga?v=1&amp;_v=j83&amp;t=pageview&amp;dr=https%3A%2F%2Fno-script.com&amp;_s=1&amp;dh=patterns.dev&amp;dp=%2Fposts%2Fclassic-design-patterns%2F&amp;ul=en-us&amp;de=UTF-8&amp;dt=Learning%20JavaScript%20Design%20Patterns&amp;tid=UA-195058122-1" width=1 style=display:none></noscript></header><div class="flex flex-col min-h-screen overflow-hidden"><header class="w-full duration-300 ease-in-out fixed md:bg-opacity-90 transition z-30" :class="{ 'bg-white backdrop-blur shadow-lg' : !top }" @scroll.window="top = window.pageYOffset > 10 ? false : true" x-data="{ top: true }"><div class="mx-auto max-w-6xl sm:px-6 px-5"><div class="flex items-center h-16 justify-between md:h-20"><div class="flex-shrink-0 mr-4"><a href=../../index.html class=block aria-label=Cruip><svg viewBox="0 0 122 28" xmlns=http://www.w3.org/2000/svg height=28px version=1.1 width=122px xmlns:xlink=http://www.w3.org/1999/xlink><title>patterns@1.5x</title><g fill=none fill-rule=evenodd id=Page-1 stroke=none stroke-width=1><g fill=#000000 fill-rule=nonzero id=01 transform="translate(-215.000000, -16.000000)"><path d="M221.372159,43.1363636 L221.372159,34.3153409 L221.457386,34.3153409 C221.684659,34.8693182 222.009588,35.3647017 222.432173,35.8014915 C222.854759,36.2382812 223.366122,36.5827415 223.966264,36.8348722 C224.566406,37.0870028 225.25,37.2130682 226.017045,37.2130682 C227.181818,37.2130682 228.252486,36.9076705 229.229048,36.296875 C230.205611,35.6860795 230.986861,34.759233 231.572798,33.5163352 C232.158736,32.2734375 232.451705,30.7073864 232.451705,28.8181818 C232.451705,26.84375 232.144531,25.2386364 231.530185,24.0028409 C230.915838,22.7670455 230.120384,21.8615057 229.143821,21.2862216 C228.167259,20.7109375 227.139205,20.4232955 226.059659,20.4232955 C225.25,20.4232955 224.539773,20.5635653 223.928977,20.8441051 C223.318182,21.1246449 222.806818,21.4975142 222.394886,21.9627131 C221.982955,22.4279119 221.670455,22.9375 221.457386,23.4914773 L221.457386,23.4914773 L221.329545,23.4914773 L221.329545,20.6363636 L215.491477,20.6363636 L215.491477,43.1363636 L221.372159,43.1363636 Z M223.84375,32.6960227 C223.303977,32.6960227 222.840554,32.5379972 222.45348,32.221946 C222.066406,31.9058949 221.768111,31.4584517 221.558594,30.8796165 C221.349077,30.3007812 221.244318,29.6136364 221.244318,28.8181818 C221.244318,28.0085227 221.349077,27.3142756 221.558594,26.7354403 C221.768111,26.1566051 222.066406,25.7127131 222.45348,25.4037642 C222.840554,25.0948153 223.303977,24.9403409 223.84375,24.9403409 C224.383523,24.9403409 224.843395,25.0948153 225.223366,25.4037642 C225.603338,25.7127131 225.894531,26.1566051 226.096946,26.7354403 C226.299361,27.3142756 226.400568,28.0085227 226.400568,28.8181818 C226.400568,29.6278409 226.299361,30.3220881 226.096946,30.9009233 C225.894531,31.4797585 225.603338,31.9236506 225.223366,32.2325994 C224.843395,32.5415483 224.383523,32.6960227 223.84375,32.6960227 Z M238.624587,37.2556818 C239.334815,37.2556818 239.986448,37.1704545 240.579488,37 C241.172528,36.8295455 241.701647,36.556108 242.166846,36.1796875 C242.632045,35.803267 243.027996,35.3096591 243.354701,34.6988636 L243.354701,34.6988636 L243.482542,34.6988636 L243.482542,37 L248.979701,37 L248.979701,25.7926136 C248.979701,25.0326705 248.807471,24.3277699 248.463011,23.6779119 C248.11855,23.028054 247.619616,22.4598722 246.966207,21.9733665 C246.312798,21.4868608 245.520894,21.1068892 244.590496,20.8334517 C243.660099,20.5600142 242.608962,20.4232955 241.437087,20.4232955 C239.810667,20.4232955 238.454133,20.6772017 237.367485,21.1850142 C236.280837,21.6928267 235.455198,22.3675426 234.890567,23.2091619 C234.325937,24.0507812 234.00811,24.96875 233.937087,25.9630682 L233.937087,25.9630682 L239.349019,25.9630682 C239.420042,25.4588068 239.631335,25.0841619 239.982897,24.8391335 C240.33446,24.5941051 240.790781,24.4715909 241.35186,24.4715909 C241.863224,24.4715909 242.282258,24.5852273 242.608962,24.8125 C242.935667,25.0397727 243.099019,25.3664773 243.099019,25.7926136 L243.099019,25.7926136 L243.099019,25.8352273 C243.099019,26.1477273 242.974729,26.3980824 242.72615,26.5862926 C242.47757,26.7745028 242.074516,26.9200994 241.516988,27.0230824 C240.95946,27.1260653 240.222599,27.2130682 239.306406,27.2840909 C238.461235,27.3480114 237.674658,27.4865057 236.946675,27.6995739 C236.218692,27.912642 235.581263,28.2215909 235.034388,28.6264205 C234.487513,29.03125 234.061377,29.5514915 233.755979,30.1871449 C233.450582,30.8227983 233.297883,31.5880682 233.297883,32.4829545 C233.297883,33.5696023 233.525156,34.4644886 233.979701,35.1676136 C234.434246,35.8707386 235.061022,36.3945312 235.860028,36.7389915 C236.659033,37.0834517 237.580553,37.2556818 238.624587,37.2556818 Z M240.542201,33.5482955 C240.045042,33.5482955 239.636661,33.4275568 239.317059,33.1860795 C238.997457,32.9446023 238.837656,32.5965909 238.837656,32.1420455 C238.837656,31.8579545 238.906903,31.6004972 239.045397,31.3696733 C239.183891,31.1388494 239.39696,30.9435369 239.684602,30.7837358 C239.972244,30.6239347 240.343337,30.5085227 240.797883,30.4375 C241.032258,30.4019886 241.257755,30.3629261 241.474374,30.3203125 C241.690994,30.2776989 241.89696,30.2315341 242.092272,30.1818182 C242.287585,30.1321023 242.472244,30.0788352 242.646249,30.022017 C242.820255,29.9651989 242.985383,29.9048295 243.141633,29.8409091 L243.141633,29.8409091 L243.141633,31.2045455 C243.141633,31.7017045 243.017343,32.1242898 242.768763,32.4723011 C242.520184,32.8203125 242.198806,33.0866477 241.80463,33.2713068 C241.410454,33.4559659 240.989644,33.5482955 240.542201,33.5482955 Z M254.737101,36.8135653 C255.653294,37.1651278 256.786107,37.3053977 258.135538,37.234375 C258.803152,37.1988636 259.380212,37.1242898 259.866717,37.0106534 C260.353223,36.897017 260.727868,36.8011364 260.990652,36.7230114 L260.990652,36.7230114 L260.138379,32.5894886 C260.024743,32.6178977 259.848962,32.6534091 259.611035,32.6960227 C259.373109,32.7386364 259.165368,32.7599432 258.987811,32.7599432 C258.732129,32.7599432 258.522612,32.7226562 258.35926,32.6480824 C258.195908,32.5735085 258.075169,32.4598722 257.997044,32.3071733 C257.918919,32.1544744 257.879857,31.9644886 257.879857,31.7372159 L257.879857,31.7372159 L257.879,24.898 L260.692357,24.8977273 L260.692357,20.6363636 L257.879,20.637 L257.879857,16.7159091 L251.999175,16.7159091 L251.999,20.637 L249.911107,20.6363636 L249.911107,24.8977273 L251.999,24.898 L251.999175,32.2911932 C251.986261,33.3307076 252.169981,34.2117416 252.550335,34.9342952 L252.670339,35.1463068 C253.131987,35.90625 253.820908,36.4620028 254.737101,36.8135653 Z M266.02362,36.8135653 C266.939813,37.1651278 268.072626,37.3053977 269.422057,37.234375 C270.089671,37.1988636 270.666731,37.1242898 271.153236,37.0106534 C271.639742,36.897017 272.014387,36.8011364 272.277171,36.7230114 L272.277171,36.7230114 L271.424898,32.5894886 C271.311262,32.6178977 271.135481,32.6534091 270.897555,32.6960227 C270.659629,32.7386364 270.451887,32.7599432 270.27433,32.7599432 C270.018648,32.7599432 269.809131,32.7226562 269.645779,32.6480824 C269.482427,32.5735085 269.361688,32.4598722 269.283563,32.3071733 C269.205438,32.1544744 269.166376,31.9644886 269.166376,31.7372159 L269.166376,31.7372159 L269.166,24.898 L271.978876,24.8977273 L271.978876,20.6363636 L269.166,20.637 L269.166376,16.7159091 L263.285694,16.7159091 L263.285,20.637 L261.197626,20.6363636 L261.197626,24.8977273 L263.285,24.898 L263.285694,32.2911932 C263.272781,33.3307076 263.456501,34.2117416 263.836854,34.9342952 L263.956859,35.1463068 C264.418506,35.90625 265.107427,36.4620028 266.02362,36.8135653 Z M281.177327,37.2982955 C282.690111,37.2982955 284.012909,37.0692472 285.145722,36.6111506 C286.278534,36.153054 287.189401,35.5067472 287.878321,34.6722301 C288.567241,33.8377131 289.004031,32.8522727 289.18869,31.7159091 L289.18869,31.7159091 L283.819372,31.7159091 C283.705736,32.0213068 283.528179,32.2823153 283.286702,32.4989347 C283.045224,32.715554 282.755807,32.8806818 282.418449,32.9943182 C282.081091,33.1079545 281.709997,33.1647727 281.305168,33.1647727 C280.722781,33.1647727 280.225622,33.0475852 279.81369,32.8132102 C279.401758,32.5788352 279.085707,32.2556818 278.865537,31.84375 C278.645366,31.4318182 278.535281,30.9630682 278.535281,30.4375 L278.535281,30.4375 L278.535,30.182 L289.18869,30.1818182 L289.18869,28.8181818 C289.18869,27.5184659 288.996929,26.350142 288.613406,25.3132102 C288.229883,24.2762784 287.683008,23.393821 286.972781,22.6658381 C286.262554,21.9378551 285.40673,21.3821023 284.40531,20.9985795 C283.403889,20.6150568 282.285281,20.4232955 281.049486,20.4232955 C279.359145,20.4232955 277.892526,20.774858 276.649628,21.477983 C275.40673,22.181108 274.444372,23.1647727 273.762554,24.4289773 C273.080736,25.6931818 272.739827,27.1704545 272.739827,28.8607955 C272.739827,30.6221591 273.07896,32.1331676 273.757227,33.393821 C274.435494,34.6544744 275.404954,35.6203835 276.665608,36.2915483 C277.926261,36.9627131 279.430168,37.2982955 281.177327,37.2982955 Z M278.535281,26.9431818 C278.549486,26.4673295 278.675551,26.0518466 278.913477,25.696733 C279.151403,25.3416193 279.46923,25.0628551 279.866957,24.8604403 C280.264685,24.6580256 280.701474,24.5568182 281.177327,24.5568182 C281.667383,24.5568182 282.105949,24.6580256 282.493023,24.8604403 C282.880097,25.0628551 283.189045,25.3433949 283.419869,25.7020597 C283.650693,26.0607244 283.769656,26.4744318 283.776758,26.9431818 L283.776758,26.9431818 L278.535281,26.9431818 Z M296.597369,37 L296.597369,28.4772727 C296.597369,27.8522727 296.728761,27.3071733 296.991545,26.8419744 C297.254329,26.3767756 297.614769,26.0145597 298.072866,25.7553267 C298.530962,25.4960938 299.047653,25.3664773 299.622937,25.3664773 C299.928334,25.3664773 300.294102,25.3913352 300.720238,25.4410511 C301.146374,25.490767 301.505039,25.5653409 301.796232,25.6647727 L301.796232,25.6647727 L301.796232,20.647017 C301.561857,20.5759943 301.318604,20.5209517 301.066474,20.4818892 C300.814343,20.4428267 300.560437,20.4232955 300.304755,20.4232955 C299.431175,20.4232955 298.669457,20.6896307 298.019599,21.2223011 C297.369741,21.7549716 296.895664,22.5965909 296.597369,23.7471591 L296.597369,23.7471591 L296.426914,23.7471591 L296.426914,20.6363636 L290.716687,20.6363636 L290.716687,37 L296.597369,37 Z M308.73616,37 L308.73616,27.7954545 C308.743263,27.2556818 308.842695,26.7922585 309.034456,26.4051847 C309.226217,26.0181108 309.50143,25.7198153 309.860095,25.5102983 C310.21876,25.3007812 310.63957,25.1960227 311.122524,25.1960227 C311.86116,25.1960227 312.43822,25.4268466 312.853703,25.8884943 C313.269186,26.350142 313.473376,26.9857955 313.466274,27.7954545 L313.466274,27.7954545 L313.466274,37 L319.347114,37 L319.347114,26.5596591 C319.354058,25.3735795 319.121459,24.318892 318.649158,23.3955966 C318.176856,22.4723011 317.512794,21.7460938 316.65697,21.2169744 C315.801146,20.6878551 314.794399,20.4232955 313.636729,20.4232955 C312.436445,20.4232955 311.387084,20.7180398 310.488646,21.3075284 C309.590209,21.897017 308.963433,22.7102273 308.60832,23.7471591 L308.60832,23.7471591 L308.437865,23.7471591 L308.437865,20.6363636 L302.855479,20.6363636 L302.855479,37 L308.73616,37 Z M328.886316,37.2982955 C330.3991,37.2982955 331.746756,37.065696 332.929285,36.6004972 C334.111813,36.1352983 335.045762,35.4747869 335.731131,34.6189631 C336.416501,33.7631392 336.762736,32.7528409 336.769839,31.5880682 C336.762736,30.3806818 336.349029,29.4165483 335.528717,28.6956676 C334.708404,27.9747869 333.46018,27.4616477 331.784043,27.15625 L331.784043,27.15625 L328.46018,26.5596591 C327.83518,26.4460227 327.41437,26.2862216 327.197751,26.0802557 C326.981131,25.8742898 326.876373,25.6505682 326.883475,25.4090909 C326.876373,25.0681818 327.05393,24.8053977 327.416146,24.6207386 C327.778361,24.4360795 328.2116,24.34375 328.715861,24.34375 C329.106486,24.34375 329.463376,24.409446 329.786529,24.5408381 C330.109682,24.6722301 330.374242,24.8586648 330.580208,25.100142 C330.786174,25.3416193 330.903361,25.6292614 330.931771,25.9630682 L330.931771,25.9630682 L336.343702,25.9630682 C336.27268,24.2301136 335.553574,22.8735795 334.186387,21.8934659 C332.819199,20.9133523 330.953077,20.4232955 328.588021,20.4232955 C327.032623,20.4232955 325.688518,20.6310369 324.555705,21.0465199 C323.422893,21.4620028 322.552864,22.065696 321.94562,22.8575994 C321.338376,23.6495028 321.038305,24.6136364 321.045407,25.75 C321.038305,27.0355114 321.450236,28.0866477 322.281202,28.9034091 C323.112168,29.7201705 324.362168,30.2741477 326.031202,30.5653409 L326.031202,30.5653409 L328.92893,31.0767045 C329.568134,31.1903409 330.03866,31.3394886 330.340506,31.5241477 C330.642353,31.7088068 330.796827,31.9573864 330.80393,32.2698864 C330.796827,32.6107955 330.617495,32.8735795 330.265932,33.0582386 C329.91437,33.2428977 329.468702,33.3352273 328.92893,33.3352273 C328.261316,33.3352273 327.709114,33.1949574 327.272324,32.9144176 C326.835535,32.6338778 326.578077,32.234375 326.499952,31.7159091 L326.499952,31.7159091 L320.661884,31.7159091 C320.825236,33.3920455 321.611813,34.7414773 323.021614,35.7642045 C324.431415,36.7869318 326.386316,37.2982955 328.886316,37.2982955 Z" id=patterns></path></g></g></svg></a></div><nav class="hidden md:flex md:flex-grow"><ul class="flex items-center flex-grow flex-wrap justify-end"><li><a href="https://docs.google.com/forms/d/e/1FAIpQLSfe0IUVRTR2lmVwumrMXLqV3VfhOSqduSXTd0ScfN7IayWxcA/viewform?usp=pp_url&amp;entry.1237294424=/posts/classic-design-patterns/" class="btn-sm bg-gray-900 hover:bg-gray-800 ml-3 text-gray-200" target=_blank>Send feedback</a></ul></nav><div class="flex md:hidden" x-data="{ expanded: false }"><button :aria-expanded=expanded :class="{ 'active': expanded }" @click.stop="expanded = !expanded" aria-controls=mobile-nav class="z-30 hamburger"><span class=sr-only>Menu</span> <svg viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg class="fill-current h-6 text-gray-900 w-6"><rect height=2 width=24 y=4></rect><rect height=2 width=24 y=11></rect><rect height=2 width=24 y=18></rect></svg></button><nav class="w-full duration-300 ease-in-out absolute bg-white h-screen left-0 overflow-scroll p-4 pb-16 top-0 top-full transition-all z-20" @click.away="expanded = false" @keydown.escape.window="expanded = false" id=mobile-nav x-cloak="" x-show=expanded x-transition:enter="transition ease-out duration-200 transform" x-transition:enter-end="opacity-100 translate-y-0" x-transition:enter-start="opacity-0 -translate-y-2" x-transition:leave="transition ease-out duration-200" x-transition:leave-end=opacity-0 x-transition:leave-start=opacity-100><div data-sticky="" data-sticky-for=768 data-sticky-wrap=""><nav><ul class="font-medium -my-4"><li class=py-2 x-data="{ open: true }"><a href=#0 class="hover:underline flex items-center" :aria-expanded=open @click.prevent="open = !open" aria-haspopup=true><div class="flex items-center flex-grow"><svg viewBox="0 0 16 16" xmlns=http://www.w3.org/2000/svg class="fill-current flex-shrink-0 h-4 mr-3 text-blue-600 w-4"><circle cx=4.5 cy=4.5 r=4.5></circle><circle cx=12 cy=13 r=3></circle><circle cx=14.5 cy=5.5 r=1.5></circle></svg> <span>Performance Patterns</span></div></a><ul class="-mb-1 border-gray-300 border-l font-normal ml-2 mt-1 pl-5" :class="{ 'hidden': !open }"><li class=py-1><a href=../loading-sequence/index.html class="text-gray-600 hover:underline">Optimize your loading sequence</a><li class=py-1><a href=../static-import/index.html class="text-gray-600 hover:underline">Static Import</a><li class=py-1><a href=../dynamic-import/index.html class="text-gray-600 hover:underline">Dynamic Import</a><li class=py-1><a href=../import-on-visibility/index.html class="text-gray-600 hover:underline">Import On Visibility</a><li class=py-1><a href=../import-on-interaction/index.html class="text-gray-600 hover:underline">Import On Interaction</a><li class=py-1><a href=../route-based/index.html class="text-gray-600 hover:underline">Route Based Splitting</a><li class=py-1><a href=../bundle-splitting/index.html class="text-gray-600 hover:underline">Bundle Splitting</a><li class=py-1><a href=../prpl/index.html class="text-gray-600 hover:underline">PRPL Pattern</a><li class=py-1><a href=../tree-shaking/index.html class="text-gray-600 hover:underline">Tree Shaking</a><li class=py-1><a href=../preload/index.html class="text-gray-600 hover:underline">Preload</a><li class=py-1><a href=../prefetch/index.html class="text-gray-600 hover:underline">Prefetch</a><li class=py-1><a href=../third-party/index.html class="text-gray-600 hover:underline">Optimize loading third-parties</a><li class=py-1><a href=../virtual-lists/index.html class="text-gray-600 hover:underline">List Virtualization</a><li class=py-1><a href=../compression/index.html class="text-gray-600 hover:underline">Compressing JavaScript</a></ul><li class=py-2 x-data="{ open: true }"><a href=#0 class="hover:underline flex items-center" :aria-expanded=open @click.prevent="open = !open" aria-haspopup=true><div class="flex items-center flex-grow"><svg viewBox="0 0 16 16" xmlns=http://www.w3.org/2000/svg class="fill-current flex-shrink-0 h-4 mr-3 text-blue-600 w-4"><path d="M15 4H4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1h11c.6 0 1 .4 1 1v2c0 .6-.4 1-1 1zM12 10H1c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h11c.6 0 1 .4 1 1v2c0 .6-.4 1-1 1zM15 16H4c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1h11c.6 0 1 .4 1 1v2c0 .6-.4 1-1 1z"></path></svg> <span>Design Patterns</span></div></a><ul class="-mb-1 border-gray-300 border-l font-normal ml-2 mt-1 pl-5" :class="{ 'hidden': !open }"><li class=py-1><a href=../introduction/index.html class="text-gray-600 hover:underline">Introduction</a><li class=py-1><a href=../singleton-pattern/index.html class="text-gray-600 hover:underline">Singleton Pattern</a><li class=py-1><a href=../proxy-pattern/index.html class="text-gray-600 hover:underline">Proxy Pattern</a><li class=py-1><a href=../provider-pattern/index.html class="text-gray-600 hover:underline">Provider Pattern</a><li class=py-1><a href=../prototype-pattern/index.html class="text-gray-600 hover:underline">Prototype Pattern</a><li class=py-1><a href=../presentational-container-pattern/index.html class="text-gray-600 hover:underline">Container/Presentational Pattern</a><li class=py-1><a href=../observer-pattern/index.html class="text-gray-600 hover:underline">Observer Pattern</a><li class=py-1><a href=../module-pattern/index.html class="text-gray-600 hover:underline">Module Pattern</a><li class=py-1><a href=../mixin-pattern/index.html class="text-gray-600 hover:underline">Mixin Pattern</a><li class=py-1><a href=../mediator-pattern/index.html class="text-gray-600 hover:underline">Mediator/Middleware Pattern</a><li class=py-1><a href=../hoc-pattern/index.html class="text-gray-600 hover:underline">HOC Pattern</a><li class=py-1><a href=../render-props-pattern/index.html class="text-gray-600 hover:underline">Render Props Pattern</a><li class=py-1><a href=../hooks-pattern/index.html class="text-gray-600 hover:underline">Hooks Pattern</a><li class=py-1><a href=../flyweight-pattern/index.html class="text-gray-600 hover:underline">Flyweight Pattern</a><li class=py-1><a href=../factory-pattern/index.html class="text-gray-600 hover:underline">Factory Pattern</a><li class=py-1><a href=../compound-pattern/index.html class="text-gray-600 hover:underline">Compound Pattern</a><li class=py-1><a href=../command-pattern/index.html class="text-gray-600 hover:underline">Command Pattern</a><li class=py-1><a href=index.html class="text-gray-600 hover:underline" aria-current=page>Learning JavaScript Design Patterns</a></ul></ul></nav></div></nav></div></div></div></header><main class=flex-grow><link href="../../css/dracula-prism.min%EF%B9%96hash=e6e6e99a84.css" rel=stylesheet><script src="../../js/prism%EF%B9%96hash=4b6fa7188f.js"></script><section><div class="mx-auto max-w-6xl sm:px-6 px-4"><div class="md:pb-20 md:pt-40 pb-12 pt-32"><div class="mx-auto max-w-4xl lg:max-w-none"><article><header class="mx-auto max-w-4xl mb-20"><dialog id=message></dialog><h1 class="mb-4 bg-clip-text bg-gradient-to-r break-words font-extrabold from-pink-200 h1 leading-tighter md:text-6xl text-5xl text-center text-transparent to-blue-500 tracking-tighter" style="word-break: break-word;">Learning JavaScript Design Patterns</h1><p class="text-gray-900 mb-8 text-center text-xl">The classic JavaScript design patterns book, updated to ES2015+ syntax.</header><div class="lg:flex lg:justify-between" data-sticky-container=""><aside class="hidden lg:block lg:mr-20 md:flex-shrink-0 md:mr-12 md:my-0 md:w-64 my-12 relative" x-data="{ expanded: false }"><div data-sticky="" data-sticky-for=768 data-sticky-wrap="" data-margin-top=100><nav class=md:block :class="{ 'hidden' : !expanded }"><ul class="font-medium -my-2"><li class=py-2 x-data="{ open: true }"><a href=#0 class="hover:underline flex items-center" :aria-expanded=open @click.prevent="open = !open" aria-haspopup=true><div class="flex items-center flex-grow"><svg viewBox="0 0 16 16" xmlns=http://www.w3.org/2000/svg class="fill-current flex-shrink-0 h-4 mr-3 text-blue-600 w-4"><path d="M15 4H4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1h11c.6 0 1 .4 1 1v2c0 .6-.4 1-1 1zM12 10H1c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h11c.6 0 1 .4 1 1v2c0 .6-.4 1-1 1zM15 16H4c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1h11c.6 0 1 .4 1 1v2c0 .6-.4 1-1 1z"></path></svg> <span>Design Patterns</span></div></a><ul class="-mb-1 border-gray-300 border-l font-normal ml-2 mt-1 pl-5" :class="{ 'hidden': !open }"><li class=py-1><a href=../introduction/index.html class="text-gray-600 hover:underline">Introduction</a><li class=py-1><a href=../singleton-pattern/index.html class="text-gray-600 hover:underline">Singleton Pattern</a><li class=py-1><a href=../proxy-pattern/index.html class="text-gray-600 hover:underline">Proxy Pattern</a><li class=py-1><a href=../provider-pattern/index.html class="text-gray-600 hover:underline">Provider Pattern</a><li class=py-1><a href=../prototype-pattern/index.html class="text-gray-600 hover:underline">Prototype Pattern</a><li class=py-1><a href=../presentational-container-pattern/index.html class="text-gray-600 hover:underline">Container/Presentational Pattern</a><li class=py-1><a href=../observer-pattern/index.html class="text-gray-600 hover:underline">Observer Pattern</a><li class=py-1><a href=../module-pattern/index.html class="text-gray-600 hover:underline">Module Pattern</a><li class=py-1><a href=../mixin-pattern/index.html class="text-gray-600 hover:underline">Mixin Pattern</a><li class=py-1><a href=../mediator-pattern/index.html class="text-gray-600 hover:underline">Mediator/Middleware Pattern</a><li class=py-1><a href=../hoc-pattern/index.html class="text-gray-600 hover:underline">HOC Pattern</a><li class=py-1><a href=../render-props-pattern/index.html class="text-gray-600 hover:underline">Render Props Pattern</a><li class=py-1><a href=../hooks-pattern/index.html class="text-gray-600 hover:underline">Hooks Pattern</a><li class=py-1><a href=../flyweight-pattern/index.html class="text-gray-600 hover:underline">Flyweight Pattern</a><li class=py-1><a href=../factory-pattern/index.html class="text-gray-600 hover:underline">Factory Pattern</a><li class=py-1><a href=../compound-pattern/index.html class="text-gray-600 hover:underline">Compound Pattern</a><li class=py-1><a href=../command-pattern/index.html class="text-gray-600 hover:underline">Command Pattern</a><li class=py-1><a href=index.html class="text-gray-600 hover:underline" aria-current=page style=font-weight:bold>Learning JavaScript Design Patterns</a></ul><li class=py-2 x-data="{ open: true }"><a href=#0 class="hover:underline flex items-center" :aria-expanded=open @click.prevent="open = !open" aria-haspopup=true><div class="flex items-center flex-grow"><svg viewBox="0 0 16 16" xmlns=http://www.w3.org/2000/svg class="fill-current flex-shrink-0 h-4 mr-3 text-blue-600 w-4"><path d="M15 4H4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1h11c.6 0 1 .4 1 1v2c0 .6-.4 1-1 1zM12 10H1c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h11c.6 0 1 .4 1 1v2c0 .6-.4 1-1 1zM15 16H4c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1h11c.6 0 1 .4 1 1v2c0 .6-.4 1-1 1z"></path></svg> <span>Rendering Patterns</span></div></a><ul class="-mb-1 border-gray-300 border-l font-normal ml-2 mt-1 pl-5" :class="{ 'hidden': !open }"><li class=py-1><a href=../rendering-introduction/index.html class="text-gray-600 hover:underline">Introduction</a><li class=py-1><a href=../reactjs/index.html class="text-gray-600 hover:underline">Overview of React.js</a><li class=py-1><a href=../nextjs/index.html class="text-gray-600 hover:underline">Overview of Next.js</a><li class=py-1><a href=../client-side-rendering/index.html class="text-gray-600 hover:underline">Client-side Rendering</a><li class=py-1><a href=../server-side-rendering/index.html class="text-gray-600 hover:underline">Server-side Rendering</a><li class=py-1><a href=../static-rendering/index.html class="text-gray-600 hover:underline">Static Rendering</a><li class=py-1><a href=../incremental-static-rendering/index.html class="text-gray-600 hover:underline">Incremental Static Generation</a><li class=py-1><a href=../progressive-hydration/index.html class="text-gray-600 hover:underline">Progressive Hydration</a><li class=py-1><a href=../ssr/index.html class="text-gray-600 hover:underline">Streaming Server-Side Rendering</a><li class=py-1><a href=../react-server-components/index.html class="text-gray-600 hover:underline">React Server Components</a><li class=py-1><a href=../react-selective-hydration/index.html class="text-gray-600 hover:underline">Selective Hydration</a><li class=py-1><a href=../islands-architecture/index.html class="text-gray-600 hover:underline">Islands Architecture</a></ul><li class=py-2 x-data="{ open: true }"><a href=#0 class="hover:underline flex items-center" :aria-expanded=open @click.prevent="open = !open" aria-haspopup=true><div class="flex items-center flex-grow"><svg viewBox="0 0 16 16" xmlns=http://www.w3.org/2000/svg class="fill-current flex-shrink-0 h-4 mr-3 text-blue-600 w-4"><circle cx=4.5 cy=4.5 r=4.5></circle><circle cx=12 cy=13 r=3></circle><circle cx=14.5 cy=5.5 r=1.5></circle></svg> <span>Performance Patterns</span></div></a><ul class="-mb-1 border-gray-300 border-l font-normal ml-2 mt-1 pl-5" :class="{ 'hidden': !open }"><li class=py-1><a href=../loading-sequence/index.html class="text-gray-600 hover:underline">Optimize your loading sequence</a><li class=py-1><a href=../static-import/index.html class="text-gray-600 hover:underline">Static Import</a><li class=py-1><a href=../dynamic-import/index.html class="text-gray-600 hover:underline">Dynamic Import</a><li class=py-1><a href=../import-on-visibility/index.html class="text-gray-600 hover:underline">Import On Visibility</a><li class=py-1><a href=../import-on-interaction/index.html class="text-gray-600 hover:underline">Import On Interaction</a><li class=py-1><a href=../route-based/index.html class="text-gray-600 hover:underline">Route Based Splitting</a><li class=py-1><a href=../bundle-splitting/index.html class="text-gray-600 hover:underline">Bundle Splitting</a><li class=py-1><a href=../prpl/index.html class="text-gray-600 hover:underline">PRPL Pattern</a><li class=py-1><a href=../tree-shaking/index.html class="text-gray-600 hover:underline">Tree Shaking</a><li class=py-1><a href=../preload/index.html class="text-gray-600 hover:underline">Preload</a><li class=py-1><a href=../prefetch/index.html class="text-gray-600 hover:underline">Prefetch</a><li class=py-1><a href=../third-party/index.html class="text-gray-600 hover:underline">Optimize loading third-parties</a><li class=py-1><a href=../virtual-lists/index.html class="text-gray-600 hover:underline">List Virtualization</a><li class=py-1><a href=../compression/index.html class="text-gray-600 hover:underline">Compressing JavaScript</a></ul></ul></nav></div></aside><div><div class="flex items-center mb-6"><div></div></div><hr class="mb-6 bg-gray-200 border-0 h-px pt-px w-16"><div class="prose text-gray-800 text-lg"><div class="container inner wrap"><p><p class=copyright>Copyright © Addy Osmani 2012-2021.<p class=copyright><em>Learning JavaScript Design Patterns</em> is released under a <a href=http://creativecommons.org/licenses/by-nc-nd/3.0/ >Creative Commons Attribution-Noncommercial-No Derivative Works 3.0</a> unported license. It is available for purchase via <a href=http://shop.oreilly.com/product/0636920025832.do>O'Reilly</a> Media but will remain available for both free online and as a physical (or eBook) purchase for readers wishing to support the project. This edition was updated to ES2015+ syntax in 2021.<p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="../../img/remote/Z2dzbwc-1920w.avif 1920w, ../../img/remote/Z2dzbwc-1280w.avif 1280w, ../../img/remote/Z2dzbwc-640w.avif 640w, ../../img/remote/Z2dzbwc-320w.avif 320w" type=image/avif><source sizes="(max-width: 608px) 100vw, 608px" srcset="../../img/remote/Z2dzbwc-1920w.webp 1920w, ../../img/remote/Z2dzbwc-1280w.webp 1280w, ../../img/remote/Z2dzbwc-640w.webp 640w, ../../img/remote/Z2dzbwc-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="../../img/remote/Z2dzbwc-1920w.jpg 1920w, ../../img/remote/Z2dzbwc-1280w.jpg 1280w, ../../img/remote/Z2dzbwc-640w.jpg 640w, ../../img/remote/Z2dzbwc-320w.jpg 320w" type=image/jpeg><img alt="Book cover for Learning JavaScript Design Patterns" height=393 src=../../img/remote/Z2dzbwc.jpg width=300 decoding=async loading=lazy></picture><p class=copyright> <div class=content><section><h1>Preface</h1><p>Design patterns are reusable solutions to commonly occurring problems in software design. They are both exciting and a fascinating topic to explore in any programming language.<p>One reason for this is that they help us build upon the combined experience of many developers that came before us and ensure we structure our code in an optimized way, meeting the needs of problems we're attempting to solve.<p>Design patterns also provide us a common vocabulary to describe solutions. This can be significantly simpler than describing syntax and semantics when we're attempting to convey a way of structuring a solution in code form to others.<p>In this book we will explore applying both classical and modern design patterns to the JavaScript programming language.<p> <h2>Target Audience</h2><p>This book is targeted at professional developers wishing to improve their knowledge of design patterns and how they can be applied to the JavaScript programming language.<p>Some of the concepts covered (closures, prototypal inheritance) will assume a level of basic prior knowledge and understanding. If you find yourself needing to read further about these topics, a list of suggested titles is provided for convenience.<p>If you would like to learn how to write beautiful, structured and organized code, I believe this is the book for you.<h2>Acknowledgments</h2><p>I will always be grateful for the talented technical reviewers who helped review and improve this book, including those from the community at large. The knowledge and enthusiasm they brought to the project was simply amazing. The official technical reviewers tweets and blogs are also a regular source of both ideas and inspiration and I wholeheartedly recommend checking them out.<p><ul><li>Nicholas Zakas (<a href=http://nczonline.net/ >http://nczonline.net</a>, <a href=http://twitter.com/slicknet>@slicknet</a>)<li>Andrée Hansson (<a href=http://andreehansson.se/ >http://andreehansson.se</a>, <a href=http://twitter.com/peolanha>@peolanha</a>)<li>Luke Smith (<a href=http://lucassmith.name>http://lucassmith.name</a>, <a href=http://twitter.com/ls_n>@ls_n</a>)<li>Eric Ferraiuolo (<a href=http://ericf.me/ >http://ericf.me/</a>, <a href=https://twitter.com/ericf>@ericf</a>)<li>Peter Michaux (<a href=http://michaux.ca>http://michaux.ca</a>, <a href=http://twitter.com/petermichaux>@petermichaux</a>)<li>Alex Sexton (<a href=http://alexsexton.com>http://alexsexton.com</a>, <a href=http://twitter.com/slexaxton>@slexaxton</a>)</ul><p><p>I would also like to thank Rebecca Murphey (<a href=http://rmurphey.com>http://rmurphey.com</a>, <a href=http://twitter.com/rmurphey>@rmurphey</a>) for providing the inspiration to write this book and more importantly, continue to make it both available on GitHub and via O'Reilly.<h2>Credits</h2><p>Whilst some of the patterns covered in this book were implemented based on personal experience, many of them have been previously identified by the JavaScript community. This work is as such the production of the combined experience of a number of developers. Similar to Stoyan Stefanov's logical approach to preventing interruption of the narrative with credits (in <em>JavaScript Patterns</em>), I have listed credits and suggested reading for any content covered in the references section.<h2>Reading</h2><p>Whilst this book is targeted at both beginners and intermediate developers, a basic understanding of JavaScript fundamentals is assumed. Should you wish to learn more about the language, I am happy to recommend the following titles:<ul><li><em>JavaScript: The Definitive Guide</em> by David Flanagan<li><em>Eloquent JavaScript</em> by Marijn Haverbeke<li><em>JavaScript Patterns</em> by Stoyan Stefanov<li><em>Writing Maintainable JavaScript</em> by Nicholas Zakas<li><em>JavaScript: The Good Parts</em> by Douglas Crockford</ul><p> <h1><em>Table Of Contents</em></h1><div id=contents-list><ul><li><a href=#introduction>Introduction</a><li><a href=#whatisapattern>What is a Pattern?</a><li><a href=#patternity>"Pattern"-ity Testing, Proto-Patterns & The Rule Of Three</a><li><a href=#designpatternstructure>The Structure Of A Design Pattern</a><li><a href=#writingdesignpatterns>Writing Design Patterns</a><li><a href=#javascriptmodules>JavaScript JavaScript Syntax and Features</a><li><a href=#antipatterns>Anti-Patterns</a><li><a href=#categoriesofdesignpatterns>Categories Of Design Pattern</a><li><a href=#summarytabledesignpatterns>Summary Table Of Design Pattern Categorization</a><li><a href=#designpatternsjavascript>JavaScript Design Patterns</a><ul><li class=subitem><a href=#constructorpatternjavascript>Constructor Pattern</a><li class=subitem><a href=#modulepatternjavascript>Module Pattern</a><li class=subitem><a href=#revealingmodulepatternjavascript>Revealing Module Pattern</a><li class=subitem><a href=#singletonpatternjavascript>Singleton Pattern</a><li class=subitem><a href=#observerpatternjavascript>Observer Pattern</a><li class=subitem><a href=#mediatorpatternjavascript>Mediator Pattern</a><li class=subitem><a href=#prototypepatternjavascript>Prototype Pattern</a><li class=subitem><a href=#commandpatternjavascript>Command Pattern</a><li class=subitem><a href=#facadepatternjavascript>Facade Pattern</a><li class=subitem><a href=#factorypatternjavascript>Factory Pattern</a><li class=subitem><a href=#mixinpatternjavascript>Mixin Pattern</a><li class=subitem><a href=#decoratorpatternjavascript>Decorator Pattern</a><li class=subitem><a href=#detailflyweight>Flyweight Pattern</a></ul><li><a href=#detailmvcmvp>JavaScript MV* Patterns</a><ul><li class=subitem><a href=#detailmvc>MVC Pattern</a><li class=subitem><a href=#detailmvp>MVP Pattern</a><li class=subitem><a href=#detailmvvm>MVVM Pattern</a></ul><li><a href=#modularjavascript>Modular Design Patterns for Classic JavaScript</a><ul><li class=subitem><a href=#detailamd>AMD</a><li class=subitem><a href=#detailcommonjs>CommonJS</a><li class=subitem><a href=#detailumd>UMD</a></ul><li><a href=#designpatternsjquery>Design Patterns In jQuery</a><ul><li class=subitem><a href=#compositepatternjquery>Composite Pattern</a><li class=subitem><a href=#wrapperpatternjquery>Adapter Pattern</a><li class=subitem><a href=#facadepatternjquery>Facade Pattern</a><li class=subitem><a href=#observerpatternjquery>Observer Pattern</a><li class=subitem><a href=#iteratorpatternjquery>Iterator Pattern</a><li class=subitem><a href=#lazyinitialisationjquery>Lazy Initialization Pattern</a><li class=subitem><a href=#proxypatternjquery>Proxy Pattern</a><li class=subitem><a href=#builderpatternjquery>Builder Pattern</a></ul><li><a href=#jquerypluginpatterns>jQuery Plugin Design Patterns</a><li><a href=#detailnamespacing>JavaScript Namespacing Patterns</a><li><a href=#conclusions>Conclusions</a><li><a href=#references>References</a></ul></div><p><p> <h1 id=introduction><a href=#introduction class=subhead-link>#</a> Introduction</h1><p>One of the most important aspects of writing maintainable code is being able to notice the recurring themes in that code and optimize them. This is an area where knowledge of design patterns can prove invaluable.<p>Maintainable code is much more difficult to write than maintainable design patterns. The reason for this is that the code you write is not only used by other developers, but also by yourself in the future. If you are not able to notice the patterns in your code, you will be unable to optimize them.<p>In the first part of this book, we will explore the history and importance of design patterns which can really be applied to any programming language. If you're already sold on or are familiar with this history, feel free to skip to the chapter "<a href=#whatisapattern>What is a Pattern?</a>" to continue reading.<p>Design patterns can be traced back to the early work of an architect named <a href=http://en.wikipedia.org/wiki/Christopher_Alexander>Christopher Alexander</a>. He would often write publications about his experience in solving design issues and how they related to buildings and towns. One day, it occurred to Alexander that when used time and time again, certain design constructs lead to a desired optimal effect.<p>In collaboration with Sara Ishikawa and Murray Silverstein, Alexander produced a pattern language that would help empower anyone wishing to design and build at any scale. This was published back in 1977 in a paper titled "A Pattern Language", which was later released as a complete hardcover <a href="http://www.amazon.co.uk/Pattern-Language-Buildings-Construction-Environmental/dp/0195019199/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1329440685&amp;sr=1-1">book</a>.<p>Some 30 years ago, software engineers began to incorporate the principles Alexander had written about into the first documentation about design patterns, which was to be a guide for novice developers looking to improve their coding skills. It's important to note that the concepts behind design patterns have actually been around in the programming industry since its inception, albeit in a less formalized form.<p>One of the first and arguably most iconic formal works published on design patterns in software engineering was a book in 1995 called <em>Design Patterns: Elements Of Reusable Object-Oriented Software</em>. This was written by <a href=http://en.wikipedia.org/wiki/Erich_Gamma>Erich Gamma</a>,<a href="http://en.wikipedia.org/w/index.php?title=Richard_Helm&amp;action=edit&amp;redlink=1"> Richard Helm</a>,<a href=http://en.wikipedia.org/wiki/Ralph_Johnson> Ralph Johnson</a> and<a href=http://en.wikipedia.org/wiki/John_Vlissides> John Vlissides</a> - a group that became known as the Gang of Four (or GoF for short).<p>The GoF's publication is considered quite instrumental to pushing the concept of design patterns further in our field as it describes a number of development techniques and pitfalls as well as providing twenty-three core Object-Oriented design patterns frequently used around the world today. We will be covering these patterns in more detail in the section "Categories of Design Patterns".<p>In this book, we will take a look at a number of popular JavaScript design patterns and explore why certain patterns may be more suitable for your projects than others. Remember that patterns can be applied not just to vanilla JavaScript (i.e standard JavaScript code), but also to abstracted libraries such as <a href=http://jquery.com>jQuery</a> or <a href=http://dojotoolkit.org>dojo</a> as well. Before we begin, let’s look at the exact definition of a "pattern" in software design.<p> <p> <h1 id=whatisapattern>What is a Pattern?</h1><p>A pattern is a reusable solution that can be applied to commonly occurring problems in software design - in our case - in writing JavaScript web applications. Another way of looking at patterns are as templates for how we solve problems - ones which can be used in quite a few different situations.<p>So, why is it important to understand patterns and be familiar with them? Design patterns have three main benefits:<ol start=1 type=1><li><strong>Patterns are proven solutions:</strong> They provide solid approaches to solving issues in software development using proven techniques that reflect the experience and insights the developers that helped define them bring to the pattern.<li><strong>Patterns can be easily reused: </strong>A pattern usually reflects an out of the box solution that can be adapted to suit our own needs. This feature makes them quite robust.<li><strong>Patterns can be expressive: </strong>When we look at a pattern there’s generally a set structure and <em>vocabulary</em> to the solution presented that can help express rather large solutions quite elegantly.</ol><p>Patterns are <strong>not</strong> an exact solution. It’s important that we remember the role of a pattern is merely to provide us with a solution scheme. Patterns don’t solve all design problems nor do they replace good software designers, however, they <strong>do</strong> support them. Next we’ll take a look at some of the other advantages patterns have to offer.<ul><li><strong>Reusing patterns assists in preventing minor issues that can cause major problems in the application development process. </strong>What this means is when code is built on proven patterns, we can afford to spend less time worrying about the structure of our code and more time focusing on the quality of our overall solution. This is because patterns can encourage us to code in a more structured and organized fashion avoiding the need to refactor it for cleanliness purposes in the future.<li><strong>Patterns can provide generalized solutions which are documented in a fashion that doesn't require them to be tied to a specific problem.</strong> This generalized approach means that regardless of the application (and in many cases the programming language) we are working with, design patterns can be applied to improve the structure of our code.<li><strong>Certain patterns can actually decrease the overall file-size footprint of our code by avoiding repetition. </strong>By encouraging developers to look more closely at their solutions for areas where instant reductions in <span id=internal-source-marker_0.982673292361492>repetition</span> can be made, e.g. reducing the number of functions performing similar processes in favor of a single generalized function, the overall size of our codebase can be decreased. This is also known as making code more <em>DRY</em>.<li><strong>Patterns add to a developer's vocabulary, which makes communication faster.</strong><li><strong>Patterns that are frequently used can be improved over time by harnessing the collective experiences other developers using those patterns contribute back to the design pattern community.</strong> In some cases this leads to the creation of entirely new design patterns whilst in others it can lead to the provision of improved guidelines on how specific patterns can be best used. This can ensure that pattern-based solutions continue to become more robust than ad-hoc solutions may be.</ul><p> </section><section><h3>We already use patterns everyday</h3><p>To understand how useful patterns can be, let's review a very simple element selection problem that the jQuery library solves for us.<p>Imagine that we have a script where for each DOM element found on a page with class "foo" we wish to increment a counter. What's the most efficient way to query for this collection of elements? Well, there are a few different ways this problem could be tackled:<p><ol><li>Select all of the elements in the page and then store references to them. Next, filter this collection and use regular expressions (or another means) to only store those with the class "foo".<li>Use a modern native browser feature such as <code>querySelectorAll()</code> to select all of the elements with the class "foo".<li>Use a native feature such as <code>getElementsByClassName()</code> to similarly get back the desired collection.</ol><p><p>So, which of these options is the fastest? It's actually option 3. by a factor of 8-10 times the <a href=http://jsperf.com/getelementsbyclassname-vs-queryselectorall/5>alternatives</a>. In a real-world application however, 3. will not work in versions of Internet Explorer below 9 and thus it's necessary to use 1. where both 2. and 3. aren't supported.<p>Developers using jQuery don't have to worry about this problem however, as it's luckily abstracted away for us using the <em>Facade</em> pattern. As we'll review in more detail later, this pattern provides a simple set of abstracted interfaces (e.g <code>$el.css()</code>, <code>$el.animate()</code>) to several more complex underlying bodies of code. As we've seen, this means less time having to be concerned about implementation level details.<p>Behind the scenes, the library simply opts for the most optimal approach to selecting elements depending on what our current browser supports and we just consume the abstraction layer.<p>We're probably all also familiar with jQuery's <code>$("selector")</code>. This is significantly more easy to use for selecting HTML elements on a page versus having to manually opt for <code>getElementById()</code>, <code>getElementsByClassName()</code>, <code>getElementsByTagName()</code> and so on.<p>Although we know that <code>querySelectorAll()</code> attempts to solve this problem, compare the effort involved in using jQuery's Facade interfaces vs. selecting the most optimal selection paths ourselves. There's no contest! Abstractions using patterns can offer real-world value.<p>We'll be looking at this and more design patterns later on in the book.<p> <h1 id=patternity>"Pattern"-ity Testing, Proto-Patterns & The Rule Of Three</h1><p>Remember that not every algorithm, best practice or solution represents what might be considered a complete pattern. There may be a few key ingredients here that are missing and the pattern community is generally wary of something claiming to be one unless it has been heavily vetted. Even if something is presented to us which <strong>appears</strong> to meet the criteria for a pattern, it should not be considered one until it has undergone suitable periods of scrutiny and testing by others.<p>Looking back upon the work by Alexander once more, he claims that a pattern should both be a process and a "thing". This definition is obtuse on purpose as he follows by saying that it is the process which should create the "thing". This is a reason why patterns generally focus on addressing a visually identifiable structure i.e we should be able to visually depict (or draw) a picture representing the structure that placing the pattern into practice results in.<p>In studying design patterns, it's not irregular to come across the term "proto-pattern". What is this? Well, a pattern that has not yet been known to pass the "pattern"-ity tests is usually referred to as a proto-pattern. Proto-patterns may result from the work of someone that has established a particular solution that is worthy of sharing with the community, but may not have yet had the opportunity to have been vetted heavily due to its very young age.<p>Alternatively, the individual(s) sharing the pattern may not have the time or interest of going through the "pattern"-ity process and might release a short description of their proto-pattern instead. Brief descriptions or snippets of this type of pattern are known as patlets.<p>The work involved in fully documenting a qualified pattern can be quite daunting. Looking back at some of the earliest work in the field of design patterns, a pattern may be considered "good" if it does the following:<ul type=disc><li><strong>Solves a particular problem</strong>: Patterns are not supposed to just capture principles or strategies. They need to capture solutions. This is one of the most essential ingredients for a good pattern.<li><strong>The solution to this problem cannot be obvious</strong>: We can find that problem-solving techniques often attempt to derive from well-known first principles. The best design patterns usually provide solutions to problems indirectly - this is considered a necessary approach for the most challenging problems related to design.<li><strong>The concept described must have been proven</strong>: Design patterns require proof that they function as described and without this proof the design cannot be seriously considered. If a pattern is highly speculative in nature, only the brave may attempt to use it.<li><strong>It must describe a relationship</strong>: In some cases it may appear that a pattern describes a type of module. Although an implementation may appear this way, the official description of the pattern must describe much deeper system structures and mechanisms that explain its relationship to code.</ul><p>We would be forgiven for thinking that a proto-pattern which fails to meet guidelines isn't worth learning from, however, this is far from the truth. Many proto-patterns are actually quite good. I’m not saying that all proto-patterns are worth looking at, but there are quite a few useful ones in the wild that could assist us with future projects. Use best judgment with the above list in mind and you’ll be fine in your selection process.<p>One of the additional requirements for a pattern to be valid is that they display some recurring phenomenon. This is often something that can be qualified in at least three key areas, referred to as the <em>rule of three</em>. To show recurrence using this rule, one must demonstrate:<ol start=1 type=1><li><strong>Fitness of purpose</strong> - how is the pattern considered successful?<li><strong>Usefulness</strong> - why is the pattern considered successful?<li><strong>Applicability</strong> - is the design worthy of being a pattern because it has wider applicability? If so, this needs to be explained. When reviewing or defining a pattern, it is important to keep the above in mind.</ol><p> <h1 id=designpatternstructure><a href=#designpatternstructure class=subhead-link>#</a> The Structure Of A Design Pattern</h1><p>You may be curious about how a pattern author might approach outlining structure, implementation and purpose of a new pattern.  A pattern is initially presented in the form of a <strong>rule</strong> that establishes a relationship between:<p><ul><li>A <strong>context</strong><li>A system of <strong>forces</strong> that arises in that context and<li>A <strong>configuration</strong> that allows these forces to resolve themselves in context</ul><p>With this in mind, let’s now take a look at a summary of the component elements for a design pattern. A design pattern should have a:<ul><li><strong>Pattern name</strong> and a <strong>description</strong><li><strong>Context outline</strong> – the contexts in which the pattern is effective in responding to the users needs.<li><strong>Problem statement</strong> – a statement of the problem being addressed so we can understand the intent of the pattern.<li><strong>Solution</strong> – a description of how the user’s problem is being solved in an understandable list of steps and perceptions.<li><strong>Design</strong> – a description of the pattern’s design and in particular, the user’s behavior in interacting with it<li><strong>Implementation </strong>– a guide to how the pattern would be implemented<li><strong>Illustrations</strong> – a visual representation of classes in the pattern (e.g. a diagram)<li><strong>Examples</strong> – an implementation of the pattern in a minimal form<li><strong>Co-requisites</strong> – what other patterns may be needed to support use of the pattern being described?<li><strong>Relations</strong> – what patterns does this pattern resemble? does it closely mimic any others?<li><strong>Known usage</strong> – is the pattern being used in the <em>wild</em>? If so, where and how?<li><strong>Discussions</strong> – the team or author’s thoughts on the exciting benefits of the pattern</ul><p>Design patterns are quite a powerful approach to getting all of the developers in an organization or team on the same page when creating or maintaining solutions. If considering working on a pattern of your own, remember that although they may have a heavy initial cost in the planning and write-up phases, the value returned from that investment can be quite worth it. Always research thoroughly before working on new patterns however, as you may find it more beneficial to use or build on top of existing proven patterns than starting afresh.<p> <h1 id=writingdesignpatterns><a href=#writingdesignpatterns class=subhead-link>#</a> Writing Design Patterns</h1><p>Although this book is aimed at those new to design patterns, a fundamental understanding of how a design pattern is written can offer a number of useful benefits. For starters, we can gain a deeper appreciation for the reasoning behind why a pattern is needed. We can also learn how to tell if a pattern (or proto-pattern) is up to scratch when reviewing it for our own needs.<p>Writing good patterns is a challenging task. Patterns not only need to (ideally) provide a substantial quantity of reference material for end-users, but they also need to be able to defend why they are necessary.<p>Having read the previous section on <em>what</em> a pattern is, we may think that this in itself is enough to help us identify patterns we see in the wild. This is actually not completely true. It's not always clear if a piece of code we're looking at is following a set pattern or just accidentally happens to appear like it does.<p>When we're looking at a body of code we think may be using a pattern, we should consider writing down some of the aspects of the code that we believe falls under a particular existing pattern or set of patterns.<p>In many cases of pattern-analysis we can find that we're just looking at code that follows good principles and design practices that could happen to overlap with the rules for a pattern by accident. Remember - solutions in which neither interactions nor defined rules appear are <em>not</em> patterns.<p>If interested in venturing down the path of writing your own design patterns I recommend learning from others who have already been through the process and done it well. Spend time absorbing the information from a number of different design pattern descriptions and take in what’s meaningful to you.<p>Explore structure and semantics - this can be done by examining the interactions and context of the patterns you are interested in so you can identify the principles that assist in organizing those patterns together in useful configurations.<p>Once we've exposed ourselves to a wealth of information on pattern literature, we may wish to begin writing our pattern using an <em>existing</em> format and see if we can brainstorm new ideas for improving it or integrating our ideas in there.<p>An example of a developer that did this is in recent years is Christian Heilmann, who took the existing <em>Module</em> pattern and made some fundamentally useful changes to it to create the <em>Revealing Module</em> pattern (this is one of the patterns covered later in this book).<p>The following are tips I would suggest if interested in creating a new design pattern:<ul type=disc><li><strong>How practical is the pattern?</strong>: Ensure the pattern describes proven solutions to recurring problems rather than just speculative solutions which haven’t been qualified.<li><strong>Keep best practices in mind:</strong> The design decisions we make should be based on principles we derive from an understanding of best practices.<li><strong>Our design patterns should be transparent to the user</strong>: Design patterns should be entirely transparent to any type of user-experience. They are primarily there to serve the developers using them and should not force changes to behavior in the user-experience that would not be incurred without the use of a pattern.<li><strong>Remember that originality is <em>not</em> key in pattern design</strong>: When writing a pattern, we do not need to be the original discoverer of the solutions being documented nor do you have to worry about our design overlapping with minor pieces of other patterns. If the approach is strong enough to have broad useful applicability, it has a chance of being recognized as a valid pattern.<li><strong>Patterns need a strong set of examples:</strong> A good pattern description needs to be followed by an equally strong set of examples demonstrating the successful application of our pattern. To show broad usage, examples that exhibit good design principles are ideal.</ul><p>Pattern writing is a careful balance between creating a design that is general, specific and above all, useful. Try to ensure that if writing a pattern you cover the widest possible areas of application and you should be fine.  I hope that this brief introduction to writing patterns has given you some insights that will assist your learning process for the next sections of this book.<p> <p><strong>When to use var, const and let</strong><p>This book includes a number of code examples using <code>var</code>, <code>const</code> and <code>let</code>. The difference between var, const and let is that var is a block-scoped variable, const is a block-scoped constant and let is a block-scoped variable that is only accessible within the block it is declared in. Often, you will want to use <code>let</code> but if you want to avoid variable assignment, you can use <code>const</code> instead. Ultimately, use the convention already in the codebase you're using.<h1 id=javascriptmodules><a href=#javascriptmodules class=subhead-link>#</a> Modern JavaScript Syntax and Features</h1><p>Implementing patterns requires a language and the obvious language of choice for this book was JavaScript. JavaScript however, has been around for many decades now and has gone through multiple revisions. In general, I have used modern ES2015+ syntax for all the examples discussed here. This is supplemented by the corresponding classic JavaScript (pre ES2015+) code at the end of each pattern.<p>Some key changes were introduced to JavaScript syntax with ES2015 that are especially relevant to our discussion on patterns. These are covered well in the <a href=https://babeljs.io/docs/en/learn/ >BabelJS ES2015 guide</a>. To provide a holistic understanding of the past and present of design patterns, this book will present ES2015+ and class (ES5) versions of code snippets.<div><h2>The Importance Of Decoupling Applications</h2></div><p>Modular JavaScript is a pattern that allows you to break up your application into smaller pieces. This is done by defining a module that can be imported by other modules. The modules can then be used by other modules and the application can be composed of many modules.<p>In the world of scalable JavaScript, when we say an application is <strong>modular</strong>, we often mean it's composed of a set of highly decoupled, distinct pieces of functionality stored in modules. <a href=http://arguments.callee.info/2009/05/18/javascript-design-patterns--mediator/ >Loose coupling</a> facilitates easier maintainability of apps by removing <i>dependencies</i> where possible. When this is implemented efficiently, it's quite easy to see how changes to one part of a system may affect another.<p>Unlike some more traditional programming languages, however, the older iterations of JavaScript till ES5 or (<a href=https://262.ecma-international.org/5.1/ >Standard ECMA-262 5.1 Edition</a>) did not provide developers with the means to import such modules of code in a clean, organized manner. It was one of the concerns with the specifications that had not required great thought until more recent years where the need for more organized JavaScript applications became apparent.<p>Instead, developers were left to fall back on variations of the <a href=http://www.adequatelygood.com/2010/3/JavaScript-Module-Pattern-In-Depth>module</a> pattern or <a href=http://rmurphey.com/blog/2009/10/15/using-objects-to-organize-your-code/ >object literal</a> patterns. With many of these, module scripts are strung together with namespaces being described by a single global object where it's still possible to incur naming collisions in our architecture. There was also no clean way to handle dependency management without some manual effort or third-party tools.<p><a href=https://github.com/amdjs/amdjs-api/wiki/AMD>AMD</a> and <a href=https://en.wikipedia.org/wiki/CommonJS>CommonJS</a> Modules were the most popular patterns for the first versions of JavaScript. It was a common practice to create a single global object that contained all the modules and their dependencies. This was a very clean and simple way to manage dependencies and was the only way to do it in the first versions of JavaScript.<p>Native solutions to these problems arrived with <a href=https://262.ecma-international.org/6.0/ >ES6 or ES2015</a>. <a href=http://www.ecma-international.org/memento/TC39.htm>TC39</a>, the standards body charged with defining the syntax and semantics of ECMAScript and its future iterations, is composed of a number of very intelligent developers. Some of these developers (such as <a href=http://twitter.com/slightlylate>Alex Russell</a>) had been keeping a close eye on the evolution of JavaScript usage for large-scale development and were acutely aware of the need for better language features for writing more modular JS.<p>This led to the development and standardization of syntax that could be used to create modules in JavaScript with the release of ECMAScript Modules in ES2015. Today, JavaScript modules are widely supported by all major browsers and have become the de-facto method of implementing modern-day modular programming in JavaScript. In this section, we'll explore code samples using the syntax for modules in ES2015+.<h3>Modules With Imports And Exports</h3><p>Modules allow us to separate our application code into independent units each containing code for one aspect of the functionality. Modules also encourage reusability of code and expose features that can be integrated into different applications.<p>To support modular programming, the language should have features that allow you to <code>import</code> module dependencies and <code>export</code> the module interface (the public API/variables we allow other modules to consume). This support for <a href=https://v8.dev/features/modules>JavaScript Modules (also referred to as ES Modules)</a> was introduced to JavaScript in ES2015, which allows you to succinctly specify module dependencies using an <code>import</code> keyword. Similarly, the <code>export</code> keyword can be used to export just about anything from within the module.<p><ul><li><strong>import</strong> declarations bind a module's exports as local variables and may be renamed to avoid name collisions/conflicts.<li><strong>export</strong> declarations declare that a local binding of a module is externally visible such that other modules may read the exports but can't modify them. Interestingly, modules may export child modules but can't export modules that have been defined elsewhere. We can also rename exports so their external name differs from their local names.</ul><p><p><strong>Note:</strong> .mjs is an extension used for JavaScript modules that helps us distinguish between module files and classic scripts (.js).<pre><code class=language-javascript>
// Filename: staff.mjs
// =========================================
// specify (public) exports that can be consumed by other modules
export const baker = {
   bake(item) {
      console.log( `Woo! I just baked ${item}` );
    }
};

// Filename: cakeFactory.mjs
// =========================================
// specify dependencies
import baker from "/modules/staff.mjs";

export const oven = {
    makeCupcake(toppings) {
       baker.bake( "cupcake", toppings );
    },
    makeMuffin(mSize) {
        baker.bake( "muffin", size );
    }
}

// Filename: bakery.mjs
// =========================================
import {cakeFactory} from "/modules/cakeFactory.mjs";
cakeFactory.oven.makeCupcake( "sprinkles" );
cakeFactory.oven.makeMuffin( "large" );
</code></pre><p>You can tell browsers to accept "script" tags that contain JavaScript modules by specifying the `type` attribute with a value of `module`:<pre><code class=language-javascript>
&lt;script type="module" src="main.mjs">&lt;/script>
&lt;script nomodule src="fallback.js">&lt;/script>
</code></pre><p>The `nomodule` attribute tells modern browsers not to load a classic script as a module. This is useful for fallback scripts that don't use the module syntax. It allows you to use the module syntax in your HTML and have it work in browsers that don't support it. This is useful for a number of reasons, including performance. Modern browsers don't require polyfilling for modern features, allowing you to only serve larger transpiled code to legacy browsers.<p>In the browser, module scripts are only evaluated once while classic scripts get evaluated as often as they are added to the DOM. This means that with JS modules, if you have a module that depends on a module that depends on a module that depends on a module, the module that depends on the innermost module will be evaluated first. This is a good thing because it means that the innermost module will be evaluated first and will have access to the exports of the modules that depend on it.<h3>Modules Loaded From Remote Sources</h3><p>ES2015+ also caters for modules which are remotely based (e.g. third-party libraries) making it simplistic to load modules in from external locations. Here's an example of pulling in the module we defined above and utilizing it:<pre><code class=language-javascript>
import {cakeFactory} from "https://example.com/modules/cakeFactory.mjs"; // eagerly loaded static import

cakeFactory.oven.makeCupcake( "sprinkles" );
cakeFactory.oven.makeMuffin( "large" );
</code></pre><h3>Dynamic Imports</h3><p>The type of import discussed above is called static import. With static import, the module graph needs to be downloaded and executed before the main code can run. This can sometimes lead to over-eagerly loading a lot of code upfront on initial page-load, which can be expensive and delay key features being available earlier.<pre><code class=language-javascript>
import {cakeFactory} from "/modules/cakeFactory.mjs"; // eagerly loaded static import

cakeFactory.oven.makeCupcake( "sprinkles" );
cakeFactory.oven.makeMuffin( "large" );
</code></pre><p>Sometimes, you don’t want to load a module up-front, but rather on-demand, when needed. Lazy-loading modules allows you to only load what you need when you need it. For example, when the user clicks a link or a button. This improves the initial load-time performance. <a href=https://v8.dev/features/dynamic-import>Dynamic import()</a> was introduced to make this possible.<p>Dynamic import introduces a new function-like form of import. <code>import(url)</code> returns a promise for the module namespace object of the requested module, which is created after fetching, instantiating, and evaluating all of the module’s dependencies, as well as the module itself. Here is an example that shows dynamic imports for the <code>cakeFactory</code> module.<pre><code class=language-javascript>
form.addEventListener("submit", e => {
  e.preventDefault();
  import("/modules/cakeFactory.js")
    .then((module) => {
      // Do something with the module.
      module.oven.makeCupcake("sprinkles");
      module.oven.makeMuffin("large");
    });
});
</code></pre><p>Dynamic import can also be supported using the <code>await</code> keyword:<pre><code class=language-javascript>
let module = await import("/modules/cakeFactory.js");
</code></pre><p>With dynamic import, the module graph is only downloaded and evaluated when the module is actually used.<p>Features such as <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import>import</a> and <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export>export</a> are supported in all modern browsers and can be used in a module without any fallback.<h3>Modules For The Server</h3><p>JavaScript Modules are supported in Node from 15.3.0 onwards. They function without an experimental flag and are now relatively compatible with the rest of the `npm` package ecosystem. Node <a href=https://nodejs.org/api/packages.html#packages_determining_module_system>treats</a> files ending in `.mjs` and ending in `.js` with a top-level `type` field value of `module` as JavaScript Modules.<pre><code class=language-javascript>
{
  "name": "js-modules",
  "version": "1.0.0",
  "description": "A package using JS Modules",
  "main": "index.js",
  "type": "module",
  "author": "",
  "license": "MIT"
}
</code></pre><h3>Classes With Constructors, Getters & Setters</h3><p>The notion of a class had always been a contentious issue with purists and with classic JavaScript we either fallback on JavaScript's <a href=http://javascript.crockford.com/prototypal.html>prototypal</a> nature or use frameworks or abstractions that offer the ability to use <i>class</i> definitions in a form that de-sugars to the same prototypal behavior.<p>With ES2015+, in addition to modules, it's also possible to define <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>classes</a> with constructors and some sense of privacy. JavaScript Classes are defined with the <code>class</code> keyword. In the following example, we define a class <code>Cake</code> with a constructor and two getters and setters:<pre><code class=language-javascript>
class Cake{

    // We can define the body of a class" constructor
    // function by using the keyword "constructor" 
    // with a list of class variables.
    constructor( name, toppings, price, cakeSize ){
        this.name = name;
        this.cakeSize = cakeSize;
        this.toppings = toppings;
        this.price = price;
    }

    // As a part of ES2015+ efforts to decrease the unnecessary
    // use of "function" for everything, you'll notice that it's
    // dropped for cases such as the following. Here an identifier
    // followed by an argument list and a body defines a new method

    addTopping( topping ){
        this.toppings.push( topping );
    }

    // Getters can be defined by declaring get before
    // an identifier/method name and a curly body.
    get allToppings(){
        return this.toppings;
    }

    get qualifiesForDiscount(){
        return this.price > 5;
    }

    // Similar to getters, setters can be defined by using
    // the "set" keyword before an identifier
    set cakeSize( size ){
        if ( size &lt; 0){
            throw new Error( "Cake must be a valid size -
            either small, medium or large" );
        }
       this.cakeSize = size;
    }
}

// Usage
let cake = new Cake( "chocolate", ["chocolate chips"], 5, "large" );
</code></pre><p>You can also use the <code>extends</code> keyword to indicate that a class inherits from another class.<pre><code class=language-javascript>
class BirthdayCake extends Cake {
  surprise() {
    console.log(`Happy Birthday!`);
  }
}

let birthdayCake = new BirthdayCake( "chocolate", ["chocolate chips"], 5, "large" );
birthdayCake.surprise();
</code></pre><p>ES2015 classes are supported in all modern browsers and Node. They are also compatible with the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>new-style class syntax</a> introduced in ES6.<p>The difference between JavaScript Modules and Classes is that Modules are <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import>imported</a> and <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export>exported</a> and Classes are defined with the <code>class</code> keyword.<p>Reading through, one may also notice the lack of the word "function" in the above examples. This isn't a typo error: TC39 has made a conscious effort to decrease our abuse of the <code>function</code> keyword for everything and the hope is that this will help simplify how we write code.<p>JavaScript classes also support the <code>super</code> keyword, which <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/super>allows</a> you to call a parent class' constructor. This is useful for implementing the <a href=http://www.phpied.com/self-inheritance-in-javascript/ >self-inheritance</a> pattern. You can use super to call the methods of super class.<pre><code class=language-javascript>
class Cookie {
  constructor(flavor) {
    this.flavor = flavor;
  }

  showTitle() {
    console.log(`The flavor of this cookie is ${this.flavor}.`);
  }
}

class FavoriteCookie extends Cookie {
  showTitle() {
    super.showTitle();
    console.log(`${this.flavor} is amazing.`);
  }
}

let myCookie = new FavoriteCookie('chocolate');
myCookie.showTitle();
// The flavor of this cookie is chocolate.
// chocolate is amazing.
</code></pre><p>Modern JavaScript supports public and private class members. Public class members are accessible to other classes. Private class membersare accessible only to the class in which they are defined. Class fields are by default public. <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields>Private class fields</a> can be created by using the <code>#</code> hash prefix.<pre><code class=language-javascript>
class CookieWithPrivateField {
  #privateField;
}

class CookieWithPrivateMethod {
  #privateMethod() {
    return 'delicious cookies';
  }
}
</code></pre><h3>ES Modules Considerations</h3><p>As we've seen, ES2015+ has many exciting additions over classic JavaScript that will ease the development of modular applications and handling concerns such as dependency management. Currently, they are also supported by all major <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules#browser_support>browsers</a> for both desktops and mobiles. Some key considerations of using ES modules instead of classic scripts also discussed <a href=https://v8.dev/features/modules>here</a> are as follows<ul><li>Modules have strict mode enabled by default.<li>HTML-style comments syntax is not supported in modules, although it works in classic scripts.<li>Modules have a lexical top-level scope. This means that a variable defined within a module is not a global variable, accessible through the window object in a browser, although that would be the case in a classic script.<li>Similarly, the <code>this</code> within modules does not refer to the global this, and instead is undefined. (Use <code>globalThis</code> if you need access to the global this.)<li>The new static import and export syntax is only available within modules — it doesn’t work in classic scripts.<li><a href=https://v8.dev/features/top-level-await>Top-level await</a> is available in modules, but not in classic scripts. Relatedly, await cannot be used as a variable name anywhere in a module, although variables in classic scripts can be named await outside of async functions.</ul><p><div class="alert-message block-message info"><p><b>Related Reading</b><p><a href=https://v8.dev/features/modules>JavaScript Modules on v8</a><p><a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules>JavaScript Modules on MDN</a></div><p> <h1 id=antipatterns><a href=#antipatterns class=subhead-link>#</a> Anti-Patterns</h1><p>If we consider that a pattern represents a best practice, an anti-pattern represents a lesson that has been learned. The term anti-patterns was coined in 1995 by Andrew Koenig in the November C++ Report that year, inspired by the GoF's book <em>Design Patterns</em>. In Koenig’s report, there are two notions of anti-patterns that are presented. Anti-Patterns:<ul type=disc><li>Describe a <em>bad</em> solution to a particular problem which resulted in a bad situation occurring<li>Describe <em>how</em> to get out of said situation and how to go from there to a good solution</ul><p><p>On this topic, Alexander writes about the difficulties in achieving a good balance between good design structure and good context:<p><em>“These notes are about the process of design; the process of inventing physical things which display a new physical order, organization, form, in response to function.…every design problem begins with an effort to achieve fitness between two entities: the form in question and its context. The form is the solution to the problem; the context defines the problem”.</em><p>While it’s quite important to be aware of design patterns, it can be equally important to understand anti-patterns. Let us qualify the reason behind this. When creating an application, a project’s life-cycle begins with construction however once you’ve got the initial release done, it needs to be maintained. The quality of a final solution will either be <em>good</em> or <em>bad</em>, depending on the level of skill and time the team have invested in it. Here <em>good</em> and <em>bad</em> are considered in context - a ‘perfect’ design may qualify as an anti-pattern if applied in the wrong context.<p>The bigger challenges happen after an application has hit production and is ready to go into maintenance mode. A developer working on such a system who hasn’t worked on the application before may introduce a <em>bad</em> design into the project by accident. If said <em>bad</em> practices are created as anti-patterns, they allow developers a means to recognize these in advance so that they can avoid common mistakes that can occur - this is parallel to the way in which design patterns provide us with a way to recognize common techniques that are <em>useful.</em><p>To summarize, an anti-pattern is a bad design that is worthy of documenting. Examples of anti-patterns in JavaScript are the following:<ul type=disc><li>Polluting the global namespace by defining a large number of variables in the global context<li>Passing strings rather than functions to either setTimeout or setInterval as this triggers the use of <code>eval()</code> internally.<li>Modifying the <code>Object</code> class prototype (this is a particularly bad anti-pattern)<li>Using JavaScript in an inline form as this is inflexible<li>The use of document.write where native DOM alternatives such as document.createElement are more appropriate. document.write has been grossly misused over the years and has quite a few disadvantages including that if it's executed after the page has been loaded it can actually overwrite the page we're on, whilst document.createElement does not. We can see <a href=http://jsfiddle.net/addyosmani/6T9vX/ >here</a> for a live example of this in action. It also doesn't work with XHTML which is another reason opting for more DOM-friendly methods such as document.createElement is favorable.</ul><p>Knowledge of anti-patterns is critical for success. Once we are able to recognize such anti-patterns, we're able to refactor our code to negate them so that the overall quality of our solutions improves instantly.<p> <h1 id=categoriesofdesignpatterns><a href=#categoriesofdesignpatterns class=subhead-link>#</a> Categories Of Design Pattern</h1><p> <p>A glossary from the well-known design book, <em>Domain-Driven Terms</em>, rightly states that:<p><i>“A design pattern names, abstracts, and identifies the key aspects of a common design structure that make it useful for creating a reusable object-oriented design. The design pattern identifies the participating classes and their instances, their roles and collaborations, and the distribution of responsibilities.</i><p><i>Each design pattern focuses on a particular object-oriented design problem or issue. It describes when it applies, whether or not it can be applied in view of other design constraints, and the consequences and trade-offs of its use. Since we must eventually implement our designs, a design pattern also provides sample ... code to illustrate an implementation.</i><p><i>Although design patterns describe object-oriented designs, they are based on practical solutions that have been implemented in mainstream object-oriented programming languages ....”</i><p>Design patterns can be broken down into a number of different categories. In this section we’ll review three of these categories and briefly mention a few examples of the patterns that fall into these categories before exploring specific ones in more detail.<p> </section><section><h2>Creational Design Patterns</h2><p><p>Creational design patterns focus on handling object creation mechanisms where objects are created in a manner suitable for the situation we're working in. The basic approach to object creation might otherwise lead to added complexity in a project whilst these patterns aim to solve this problem by <em>controlling</em> the creation process.<p>Some of the patterns that fall under this category are: Constructor, Factory, Abstract, Prototype, Singleton and Builder.<h2>Structural Design Patterns</h2><p>Structural patterns are concerned with object composition and typically identify simple ways to realize relationships between different objects. They help ensure that when one part of a system changes, the entire structure of the system doesn't need to do the same. They also assist in recasting parts of the system which don't fit a particular purpose into those that do.<p>Patterns that fall under this category include: Decorator, Facade, Flyweight, Adapter and Proxy.<h2>Behavioral Design Patterns</h2><p>Behavioral patterns focus on improving or streamlining the communication between disparate objects in a system.<p>Some behavioral patterns include: Iterator, Mediator, Observer and Visitor.<p> <h1 id=summarytabledesignpatterns><a href=#summarytabledesignpatterns class=subhead-link>#</a> Design Pattern Categorization</h1><p>In my early experiences of learning about design patterns, I personally found the following table a very useful reminder of what a number of patterns has to offer - it covers the 23 Design Patterns mentioned by the GoF. The original table was summarized by Elyse Nielsen back in 2004 and I've modified it where necessary to suit our discussion in this section of the book.<p>I recommend using this table as reference, but do remember that there are a number of additional patterns that are not mentioned here but will be discussed later in the book.<h3>A brief recap on classes</h3><p><strong>Note:</strong> ES2015 introduced native support for classes to JavaScript, however, they are primarily syntactical sugar over JavaScript's existing prototype-based inheritance model. We will not be covering ES2015 classes in this book, but <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>MDN</a> has an excellent introduction to them.<p>Keep in mind that there will be patterns in this table that reference the concept of "classes". In ES5, JavaScript is a class-less language, however classes can be simulated using functions.<p>The most common approach to achieving this is by defining a JavaScript function where we then create an object using the <code>new</code> keyword. <code>this</code> can be used to help define new properties and methods for the object as follows:<pre><code class=language-javascript>
// A car "class"
function Car( model ) {

  this.model = model;
  this.color = "silver";
  this.year = "2022";

  this.getInfo = function () {
    return this.model + " " + this.year;
  };

}
</code></pre><p>We can then instantiate the object using the Car constructor we defined above like this:<pre><code class=language-javascript>
let myCar = new Car("ford");

myCar.year = "2024";

console.log( myCar.getInfo() );
</code></pre><p>For more ways to define "classes" using JavaScript, see Stoyan Stefanov's useful <a href=http://www.phpied.com/3-ways-to-define-a-javascript-class/ >post</a> on them.<p>An ES2015+ version of the above pattern can be found below:<pre><code class=language-javascript>
//********************** Snippet 1 **********************//

// A car "class"
// [ES2015+] Below we used new class declaration, using keyword class
// [ES2015+] We used new constructor method and method declaration
// [ES2015+] Classes are syntactic sugar over JavaScript's prototype-based inheritance
// [ES2015+] We used new template literals for string interpolation
class Car {
    constructor(model) {
        this.model = model;
        this.color = 'silver';
        this.year = '2022';
    }

    getInfo() {
        return `${this.model} ${this.year}`;
    }
}

//********************** Snippet 2 **********************//

// Usage:
// [ES2015+] We used new keyword const for immutable constant declaration
let myCar = new Car('ford');

myCar.year = '2024';

console.log(myCar.getInfo());
</code></pre><p>Let us now proceed to review the table.<p><p><table align=center bgcolor=white border=0 cellpadding=1 cellspacing=1 width=100%><tr bgcolor=#fff><td colspan=4><strong>  <b>Creational</b></strong><td colspan=4>  Based on the concept of creating an object.<tr bgcolor=#DBDBDB><td colspan=8><em><strong>    Class</strong></em><tr bgcolor=#F9F9F9><td colspan=5><em>      Factory Method</em><td colspan=3>This makes an instance of several derived classes based on interfaced data or events.<tr bgcolor=#DBDBDB><td colspan=8><em><strong>    Object</strong></em><tr bgcolor=#F9F9F9><td colspan=5><em>      Abstract Factory</em><td colspan=3>Creates an instance of several families of classes without detailing concrete classes.<tr bgcolor=#F9F9F9><td colspan=5><em>      Builder</em><td colspan=3>Separates object construction from its representation, always creates the same type of object.<tr bgcolor=#F9F9F9><td colspan=5><em>      Prototype</em><td colspan=3>A fully initialized instance used for copying or cloning.<tr bgcolor=#F9F9F9><td colspan=5><em>      Singleton</em><td colspan=3>A class with only a single instance with global access points.<tr><td width=6 height=20> <td width=6> <td width=6> <td width=139> <td width=1> <td width=18> <td width=18> <td width=681> <tr bgcolor=#fff><td colspan=4><strong>  <b>Structural</b></strong><td colspan=4>  Based on the idea of building blocks of objects.<tr bgcolor=#DBDBDB><td colspan=8><em><strong>    Class</strong></em><tr bgcolor=#F9F9F9><td colspan=5><em>      Adapter</em><td colspan=3>Match interfaces of different classes therefore classes can work together despite incompatible interfaces.<tr bgcolor=#DBDBDB><td colspan=8><em><strong>    Object</strong></em><tr bgcolor=#F9F9F9><td colspan=5><em>      Adapter</em><td colspan=3>Match interfaces of different classes therefore classes can work together despite incompatible interfaces.<tr bgcolor=#F9F9F9><td colspan=5><em>      Bridge</em><td colspan=3>Separates an object's interface from its implementation so the two can vary independently.<tr bgcolor=#F9F9F9><td colspan=5><em>      Composite</em><td colspan=3>A structure of simple and composite objects which makes the total object more than just the sum of its parts.<tr bgcolor=#F9F9F9><td colspan=5><em>      Decorator</em><td colspan=3>Dynamically add alternate processing to objects.<tr bgcolor=#F9F9F9><td colspan=5><em>      Facade</em><td colspan=3>A single class that hides the complexity of an entire subsystem.<tr bgcolor=#F9F9F9><td colspan=5><em>      Flyweight</em><td colspan=3>A fine-grained instance used for efficient sharing of information that is contained elsewhere.<tr bgcolor=#F9F9F9><td colspan=5><em>      Proxy</em><td colspan=3>A place holder object representing the true object.<tr><td colspan=8> <tr bgcolor=#fff><td colspan=4><strong>  <b>Behavioral</b></strong><td colspan=4>  Based on the way objects play and work together.<tr bgcolor=#DBDBDB><td colspan=8><em><strong>    Class</strong></em><tr bgcolor=#F9F9F9><td colspan=5><em>      Interpreter</em><td colspan=3>A way to include language elements in an application to match the grammar of the intended language.<tr bgcolor=#F9F9F9><td colspan=5><em>      Template<br>       Method</em><td colspan=3>Creates the shell of an algorithm in a method, then defer the exact steps to a subclass.<tr bgcolor=#DBDBDB><td colspan=8><em><strong>    Object</strong></em><tr bgcolor=#F9F9F9><td colspan=5><em>      Chain of<br>      Responsibility</em><td colspan=3>A way of passing a request between a chain of objects to find the object that can handle the request.<tr bgcolor=#F9F9F9><td colspan=5><em>      Command</em><td colspan=3>Encapsulate a command request as an object to enable, logging and/or queuing of requests, and provides error-handling for unhandled requests.<tr bgcolor=#F9F9F9><td colspan=5><em>      Iterator</em><td colspan=3>Sequentially access the elements of a collection without knowing the inner workings of the collection.<tr bgcolor=#F9F9F9><td colspan=5><em>      Mediator</em><td colspan=3>Defines simplified communication between classes to prevent a group of classes from referring explicitly to each other.<tr bgcolor=#F9F9F9><td colspan=5><em>      Memento</em><td colspan=3>Capture an object's internal state to be able to restore it later.<tr bgcolor=#F9F9F9><td colspan=5><em>      Observer</em><td colspan=3>A way of notifying change to a number of classes to ensure consistency between the classes.<tr bgcolor=#F9F9F9><td colspan=5><em>      State</em><td colspan=3>Alter an object's behavior when its state changes.<tr bgcolor=#F9F9F9><td colspan=5><em>      Strategy</em><td colspan=3>Encapsulates an algorithm inside a class separating the selection from the implementation.<tr bgcolor=#F9F9F9><td colspan=5><em>      Visitor</em><td colspan=3>Adds a new operation to a class without changing the class.</table><p><p> <p> <h1 id=designpatternsjavascript><a href=#designpatternsjavascript class=subhead-link>#</a> JavaScript Design Patterns</h1><p> <p>In this section, we will explore JavaScript implementations of a number of both classic and modern design patterns.<p>Developers commonly wonder whether there is an <em>ideal</em> pattern or set of patterns they should be using in their workflow. There isn't a true single answer to this question; each script and web application we work on is likely to have its own individual needs and we need to think about where we feel a pattern can offer real value to an implementation.<p>For example, some projects may benefit from the decoupling benefits offered by the Observer pattern (which reduces how dependent parts of an application are on one another) whilst others may simply be too small for decoupling to be a concern at all.<p>That said, once we have a firm grasp of design patterns and the specific problems they are best suited to, it becomes much easier to integrate them into our application architectures.<p> <p><strong>The patterns we will be exploring in this section are the:</strong><ul><li class=subitem><a href=#constructorpatternjavascript>Constructor Pattern</a><li class=subitem><a href=#modulepatternjavascript>Module Pattern</a><li class=subitem><a href=#revealingmodulepatternjavascript>Revealing Module Pattern</a><li class=subitem><a href=#singletonpatternjavascript>Singleton Pattern</a><li class=subitem><a href=#observerpatternjavascript>Observer Pattern</a><li class=subitem><a href=#mediatorpatternjavascript>Mediator Pattern</a><li class=subitem><a href=#prototypepatternjavascript>Prototype Pattern</a><li class=subitem><a href=#commandpatternjavascript>Command Pattern</a><li class=subitem><a href=#facadepatternjavascript>Facade Pattern</a><li class=subitem><a href=#factorypatternjavascript>Factory Pattern</a><li class=subitem><a href=#mixinpatternjavascript>Mixin Pattern</a><li class=subitem><a href=#decoratorpatternjavascript>Decorator Pattern</a><li class=subitem><a href=#detailflyweight>Flyweight Pattern</a></ul><p> <section><h2 id=constructorpatternjavascript><a href=#constructorpatternjavascript class=subhead-link>#</a> The Constructor Pattern</h2><p>In classical object-oriented programming languages, a constructor is a special method used to initialize a newly created object once memory has been allocated for it. With ES2015+ the syntax for creating <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>classes</a> with constructors was introduced to JavaScript. This allows creation of objects as an instance of an a class using the default <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/constructor>constructor</a>.<p>In JavaScript, almost everything is an object, and classes are syntactic sugar for JavaScript’s prototypal approach to inheritance. With classic JavaScript we were most often interested in <em>object</em> constructors.<p>Object constructors are used to create specific types of objects - both preparing the object for use and accepting arguments which a constructor can use to set the values of member properties and methods when the object is first created.<h3>Object Creation</h3><p>The three common ways to create new objects in JavaScript (ES2015+) are as follows:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const
// Each of the following options will create a new empty object

const newObject = {};

// or
const newObject = Object.create(Object.prototype);

// or
const newObject = new Object();

</code></pre><p>Here, we have declared each object as a <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const>constant</a> which creates a readonly block-scoped variable.<p>The "Object" constructor in the final example creates an object wrapper for a specific value, or where no value is passed, it will create an empty object and return it.<p>There are then four ways in which keys and values can be assigned to an object:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, arrow function expression
// 1. Dot syntax

// Set properties
newObject.someKey = 'Hello World';

// Get properties
const value = newObject.someKey;

// 2. Square bracket syntax

// Set properties
newObject['Some Key'] = 'Hello World';

// Get properties
const value = newObject['Some Key'];

// For more information see: http://kangax.github.io/compat-table/es5/

// 3. Object.defineProperty

// Set properties
Object.defineProperty(newObject, 'someKey', {
    value: "for more control of the property's behavior",
    writable: true,
    enumerable: true,
    configurable: true,
});

// If the above feels a little difficult to read, a shorthand could
// be written as follows:
const defineProp = (obj, key, value) => {
    const config = {
        value: value,
        writable: true,
        enumerable: true,
        configurable: true,
    };
    Object.defineProperty(obj, key, config);
};

// To use, we then create a new empty "person" object
const person = Object.create(Object.prototype);

// Populate the object with properties
defineProp(person, 'car', 'Delorean');
defineProp(person, 'dateOfBirth', '1981');
defineProp(person, 'hasBeard', false);

console.log(person);
// Outputs: Object {car: "Delorean", dateOfBirth: "1981", hasBeard: false}

// 4. Object.defineProperties

// Set properties
Object.defineProperties(newObject, {
    someKey: {
        value: 'Hello World',
        writable: true,
    },

    anotherKey: {
        value: 'Foo bar',
        writable: false,
    },
});

// Getting properties for 3. and 4. can be done using any of the
// options in 1. and 2.

</code></pre><p>As we will see a little later in the book, these methods can even be used for inheritance, as follows:<p><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const
// Usage:

// Create a race car driver that inherits from the person object
const driver = Object.create(person);

// Set some properties for the driver
defineProp(driver, 'topSpeed', '100mph');

// Get an inherited property (1981)
console.log(driver.dateOfBirth);

// Get the property we set (100mph)
console.log(driver.topSpeed);

</code></pre><p><details><summary><strong>Object Constructors: ES5 / classic approach</strong></summary><p>Object constructors were most useful in classic JS and could be defined as follows:<p><strong>Create empty objects</strong><pre><code class=language-javascript>
// Each of the following options will create a new empty object:
// Similar to ES2015+, but the object is defined as a var instead of const
var newObject = {};
<p>// or<br>
var newObject = Object.create( Object.prototype );</p>
</code><p><code class=language-javascript>// or<br>
var newObject = new Object();<br>
</code></pre><p><p><strong>Get and set properties</strong><pre><code class=language-javascript>
// ECMAScript 3 compatible approaches

// 1. Dot syntax

// Set properties
newObject.someKey = "Hello World";

// Get properties
var value = newObject.someKey;



// 2. Square bracket syntax

// Set properties
newObject["someKey"] = "Hello World";

// Get properties
var value = newObject["someKey"];



// ECMAScript 5 only compatible approaches
// For more information see: http://kangax.github.io/compat-table/es5/

// 3. Object.defineProperty

// Set properties
Object.defineProperty( newObject, "someKey", {
    value: "for more control of the property's behavior",
    writable: true,
    enumerable: true,
    configurable: true
});

// If the above feels a little difficult to read, a short-hand could
// be written as follows:
// Arrow function expressions are not available in ES5

var defineProp = function ( obj, key, value ){
  var config = {
    value: value,
    writable: true,
    enumerable: true,
    configurable: true
  };
  Object.defineProperty( obj, key, config );
};

// To use, we then create a new empty "person" object
var person = Object.create( Object.prototype );

// Populate the object with properties
defineProp( person, "car", "Delorean" );
defineProp( person, "dateOfBirth", "1981" );
defineProp( person, "hasBeard", false );

console.log(person);
// Outputs: Object {car: "Delorean", dateOfBirth: "1981", hasBeard: false}


// 4. Object.defineProperties

// Set properties
Object.defineProperties( newObject, {

  "someKey": {
    value: "Hello World",
    writable: true
  },

  "anotherKey": {
    value: "Foo bar",
    writable: false
  }

});

// Getting properties for 3. and 4. can be done using any of the
// options in 1. and 2.

</code></pre><p><strong>Use for Inheritance</strong><pre><code class=language-javascript>
// Create a race car driver that inherits from the person object
var driver = Object.create( person );
<p>// Set some properties for the driver<br>
defineProp(driver, "topSpeed", "100mph");</p>
<p>// Get an inherited property (1981)<br>
console.log( driver.dateOfBirth );</p>
</code><p><code class=language-javascript>// Get the property we set (100mph)<br>
console.log( driver.topSpeed );<br>
</code></pre><p><p></details><h3>Basic Constructors</h3><p>The concept of classes was introduced in ES2015 allows us to define templates for JavaScript Objects. They allow us to implement encapsulation and <a href=https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Inheritance#inheritance_with_class_syntax>inheritance</a> using JavaScript.<p>In the following declaration of a class, we have used the keyword <code>class</code>. Classes must include and declare a method named <code>constructor()</code>.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: let, class, constructor, 
//          template literals for string interpolation

class Car {
    constructor(model, year, miles) {
        this.model = model;
        this.year = year;
        this.miles = miles;
    }

    toString() {
        return `${this.model} has done ${this.miles} miles`;
    }
}

// Usage:

// We can create new instances of the car
let civic = new Car('Honda Civic', 2009, 20000);
let mondeo = new Car('Ford Mondeo', 2010, 5000);

// and then open our browser console to view the
// output of the toString() method being called on
// these objects
console.log(civic.toString());
console.log(mondeo.toString());
</code></pre><details><summary><strong>Basic Constructors with ES5 / classic approach</strong></summary><p>Before ES2015, one had to use special constructor functions that work with objects. By simply prefixing a call to a constructor function with the keyword "new", we can tell JavaScript we would like the function to behave like a constructor and instantiate a new object with the members defined by that function.<p>Inside a constructor, the keyword <em>this</em> references the new object that's being created. Revisiting object creation, a basic constructor may look as follows:<p><pre><code class=language-javascript>
function Car( model, year, miles ) {

  this.model = model;
  this.year = year;
  this.miles = miles;

  this.toString = function () {
    return this.model + " has done " + this.miles + " miles";
  };
}

// Usage:

// We can create new instances of the car
let civic = new Car( "Honda Civic", 2009, 20000 );
let mondeo = new Car( "Ford Mondeo", 2010, 5000 );

// and then open our browser console to view the
// output of the toString() method being called on
// these objects
console.log( civic.toString() );
console.log( mondeo.toString() );


</code></pre><p><p>The above is a simple version of the constructor pattern but it does suffer from some problems. One is that it makes inheritance difficult and the other is that functions such as <code>toString()</code> are redefined for each of the new objects created using the Car constructor. This isn't very optimal as the function should ideally be shared between all of the instances of the Car type.</details><h3>Constructors With Prototypes</h3><p>Prototypes in JavaScript allow you to easily define methods to all instances of a particular object, be it a function or a class. When we call a JavaScript constructor to create an object, all the properties of the constructor's prototype are then made available to the new object. In this fashion, multiple Car objects can be created which access the same prototype. We can thus extend the original example as follows<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: let, class, constructor, 
//          template literals for string interpolation

class Car {
    constructor(model, year, miles) {
        this.model = model;
        this.year = year;
        this.miles = miles;
    }
}

// Note here that we are using Object.prototype.newMethod rather than
// Object.prototype so as to avoid redefining the prototype object
// We still could use Object.prototype for adding new methods, because internally we use the same structure

Car.prototype.toString = function() {
    return `${this.model} has done ${this.miles} miles`;
};

// Usage:
let civic = new Car('Honda Civic', 2009, 20000);
let mondeo = new Car('Ford Mondeo', 2010, 5000);

console.log(civic.toString());
console.log(mondeo.toString());
</code></pre><p>Above, a single instance of toString() will now be shared between all of the Car objects.<details><summary><strong>Constructors with Prototypes in ES5/Classic approach</strong></summary><p>Functions, like almost all objects in JavaScript, contain a "prototype" object. In the classic JavaScript approach, we use the functions prototype object to include properties and methods in the constructor.<p><pre><code class=language-javascript>
function Car( model, year, miles ) {

  this.model = model;
  this.year = year;
  this.miles = miles;

}

// Note here that we are using Object.prototype.newMethod rather than
// Object.prototype so as to avoid redefining the prototype object
Car.prototype.toString = function () {
  return this.model + " has done " + this.miles + " miles";
};

// Usage:

var civic = new Car( "Honda Civic", 2009, 20000 );
var mondeo = new Car( "Ford Mondeo", 2010, 5000 );

console.log( civic.toString() );
console.log( mondeo.toString() );

</code></pre><p></details><p> </section><section><h2 id=modulepatternjavascript><a href=#modulepatternjavascript class=subhead-link>#</a> The Module Pattern</h2><h2 id=detailmodule>Modules</h2><p>Modules are an integral piece of any robust application's architecture and typically help in keeping the units of code for a project both cleanly separated and organized.<p>In JavaScript, there are several options for implementing modules. These include:<ul><li>The Module pattern<li>Object literal notation<li>AMD modules<li>CommonJS modules<li>JavaScript modules</ul><p><a href=https://v8.dev/features/modules#intro>JavaScript modules</a> also known as “ES modules” or “ECMAScript modules” have already been introduced in an earlier section <em>JavaScript Modules and ES2015+</em>. We will primarily use ES modules for the examples in this section. Before ES2015, CommonJS modules or AMD modules were popular alternatives as they allowed you to export the contents of a module. We will be exploring AMD, CommonJS, and UMD modules later on in the book in the section <em>Modular Design Patterns for Classic JavaScript</em>. First, let us understand the Module Pattern and its origins.<p>The Module pattern is based in part on object literals and so it makes sense to refresh our knowledge of them first.<h3>Object Literals</h3><p>In object literal notation, an object is described as a set of comma-separated name/value pairs enclosed in curly braces (<code>{}</code>). Names inside the object may be either strings or identifiers that are followed by a colon. There should be no comma used after the final name/value pair in the object as this may result in errors.<p><pre><code class=language-javascript>
//*******************************************************//
// Object Literals
//*******************************************************//

// ES2015+ keywords/syntax used: const, method declaration
const myObjectLiteral = {
    variableKey: variableValue,
    functionKey() {
        // ...
    }
};
</code></pre><p><p>Object literals don't require instantiation using the <code>new</code> operator but shouldn't be used at the start of a statement as the opening <code>{</code> may be interpreted as the beginning of a block. Outside of an object, new members may be added to it using assignment as follows <code>myModule.property = "someValue";</code>. We can see a more complete example of a module defined using object literal notation below:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, method declaration, template literals for string interpolation
const myModule = {
    myProperty: 'someValue',
    // object literals can contain properties and methods.
    // e.g we can define a further object for module configuration:
    myConfig: {
        useCaching: true,
        language: 'en',
    },
    // a very basic method
    saySomething() {
        console.log('Where is Paul Irish debugging today?');
    },
    // output a value based on the current configuration
    reportMyConfig() {
        console.log(
            `Caching is: ${this.myConfig.useCaching ? 'enabled' : 'disabled'}`
        );
    },
    // override the current configuration
    updateMyConfig(newConfig) {
        if (typeof newConfig === 'object') {
            this.myConfig = newConfig;
            console.log(this.myConfig.language);
        }
    },
};

// Outputs: What is Paul Irish debugging today?
myModule.saySomething();

// Outputs: Caching is: enabled
myModule.reportMyConfig();

// Outputs: fr
myModule.updateMyConfig({
    language: 'fr',
    useCaching: false,
});

// Outputs: Caching is: disabled
myModule.reportMyConfig();
</code></pre><p>Using object literals can assist in encapsulating and organizing your code and Rebecca Murphey has previously written about this topic in <a href=https://github.com/rmurphey/rmurphey/blob/master/public/blog/using-objects-to-organize-your-code.md>depth</a> should you wish to read into object literals further.<p>That said, if we're opting for this technique, we may be equally as interested in the Module pattern. It still uses object literals but only as the return value from a scoping function.<details><summary><strong>Object Literals with ES5/Classic approach</strong></summary><p>The Object Literal construct was available in classic JavaScript and could be used as shown in the following code snippet. Note the only difference is that we have not used the keyword <code>const</code>, template literals or the new method declaration syntax which were not available in ES5 and older versions.<p><strong>The Basic Structure</strong><pre><code class=language-javascript>
var myObjectLiteral = {
  variableKey: variableValue,
    functionKey: function () {
      // ...
    }
};
</code></pre><p><strong>The <code>myModule</code> example using classic JavaScript</strong><pre><code class=language-javascript>
var myModule = {
<p>myProperty: "someValue",</p>
<p>// object literals can contain properties and methods.<br>
// e.g we can define a further object for module configuration:<br>
myConfig: {<br>
useCaching: true,<br>
language: "en"<br>
},</p>
<p>// a very basic method<br>
saySomething: function () {<br>
console.log( "What is Paul Irish debugging today?" );<br>
},</p>
<p>// output a value based on the current configuration<br>
reportMyConfig: function () {<br>
console.log( "Caching is: " + ( this.myConfig.useCaching ? "enabled" : "disabled") );<br>
},</p>
<p>// override the current configuration<br>
updateMyConfig: function( newConfig ) {<br>
if ( typeof newConfig === "object" ) {<br>
this.myConfig = newConfig;<br>
console.log( this.myConfig.language );<br>
}<br>
}<br>
};</p>
<p>// Outputs: What is Paul Irish debugging today?<br>
myModule.saySomething();</p>
<p>// Outputs: Caching is: enabled<br>
myModule.reportMyConfig();</p>
<p>// Outputs: fr<br>
myModule.updateMyConfig({<br>
language: "fr",<br>
useCaching: false<br>
});</p>
<p>// Outputs: Caching is: disabled<br>
myModule.reportMyConfig();</p>
</code><p><code class=language-javascript></code></pre><p><p></details><h3>The Module Pattern</h3><p>The Module pattern was originally defined as a way to provide both private and public encapsulation for classes in conventional software engineering.<p>Organizing a JavaScript application of any reasonable size was a challenge at one point. Developers would rely on separate scripts to split and organize reusable chunks of logic and it wasn't a surprise to find 10-20 scripts being imported manually in an HTML file just to keep things tidy. Using objects, the module pattern was just one way to encapsulate logic in a file with both public and "private" methods. Over time, a number of custom module systems came about to make this smoother. Now, developers can just use JavaScript <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules>modules</a> to organize objects, functions, classes or variables in a way they can be easily exported or imported into other files. This helps to prevent conflicts between classes or function names included in different modules.<h4>Privacy</h4><p>The Module pattern encapsulates "privacy", state and organization using closures. It provides a way of wrapping a mix of public and private methods and variables, protecting pieces from leaking into the global scope and accidentally colliding with another developer's interface. With this pattern, only a public API is returned, keeping everything else within the closure private.<p>This gives us a clean solution for shielding logic doing the heavy lifting whilst only exposing an interface we wish other parts of our application to use. The pattern utilizes an immediately-invoked function expression (<a href=http://benalman.com/news/2010/11/immediately-invoked-function-expression/ >IIFE</a> - see the section on namespacing patterns for more on this) where an object is returned.<p>It should be noted that there isn't really an explicitly true sense of "privacy" inside JavaScript because unlike some traditional languages, it doesn't have access modifiers. Variables can't technically be declared as being public nor private and so we use function scope to simulate this concept. Within the Module pattern, variables or methods declared are only available inside the module itself thanks to closure. Variables or methods defined within the returning object however are available to everyone.<p>A workaround to implement privacy of variables in returned objects uses <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap>WeakMap()</a> discussed later in this chapter in Modern Module Pattern with WeakMap. WeakMap() only takes objects as keys and cannot be iterated. Thus, the only way to access the object inside a module is through its reference. Outside the module, you can only access it through a public method defined within the module. Thus, it ensures privacy for the object.<h4>History</h4><p>From a historical perspective, the Module pattern was originally developed by a number of people including <a href=http://groups.google.com/group/comp.lang.javascript/msg/9f58bd11bd67d937>Richard Cornford</a> in 2003. It was later popularized by Douglas Crockford in his lectures. Another piece of trivia is that if you've ever played with Yahoo's YUI library, some of its features may appear quite familiar and the reason for this is that the Module pattern was a strong influence for YUI when creating their components.<h4>Examples</h4><p>Let's begin looking at an implementation of the Module pattern by creating a module that is self-contained.<p><a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules>Modules</a> became available in JavaScript with ES2015 and can be used to implement the module pattern here. We use the <code>import</code> and <code>export</code> keywords in our implementation. Export allows you to provide access to module features outside the module. Import allows us to import bindings that are exported by a module to our script.<pre><code class=language-javascript>  
//*******************************************************//
// The Module Pattern
//*******************************************************//

// ES2015+ keywords used: import, export, let, const

let counter = 0;

const testModule = {
  incrementCounter() {
    return counter++;
  },
  resetCounter() {
    console.log(`counter value prior to reset: ${counter}`);
    counter = 0;
  },
};

// Default export module, without name
export default testModule;

// Usage:

// Import module from path
import testModule from './testModule';

// Increment our counter
testModule.incrementCounter();

// Check the counter value and reset
// Outputs: counter value prior to reset: 1
testModule.resetCounter();

</code></pre><p>Here, other parts of the code are unable to directly read the value of our <code>incrementCounter()</code> or <code>resetCounter()</code>. The counter variable is actually fully shielded from our global scope so it acts just like a private variable would - its existence is limited to within the module's closure so that the only code able to access its scope are our two functions. Our methods are effectively namespaced so in the test section of our code, we need to prefix any calls with the name of the module (e.g. "testModule").<p>When working with the Module pattern, we may find it useful to define a simple template that we use for getting started with it. Here's one that covers namespacing, public and private variables:<p><pre><code class=language-javascript>
// ES2015+ keywords used: import, export, let, const

// A private counter variable
let myPrivateVar = 0;

// A private function which logs any arguments
// Parentheses are optional in ES2015+ when there is only one parameter
const myPrivateMethod = foo => {
  console.log(foo);
};

const myNamespace = {
  // A public variable
  myPublicVar: 'foo',

  // A public function utilizing privates
  myPublicFunction(bar) {
    // Increment our private counter
    myPrivateVar++;

    // Call our private method using bar
    myPrivateMethod(bar);
  },
};

export default myNamespace;

</code></pre><p><p>Looking at another example, below we can see a shopping basket implemented using this pattern. The module itself is completely self-contained in a global variable called <code>basketModule</code>. The <code>basket</code> array in the module is kept private and so other parts of our application are unable to directly read it. It only exists with the module's closure and so the only methods able to access it are those with access to its scope (i.e. <code>addItem()</code>, <code>getItemCount()</code> etc).<pre><code class=language-javascript>
// ES2015+ keywords/methods used: import, export, let, const, reduce()

// privates

const basket = [];

const doSomethingPrivate = () => {
  //...
};

const doSomethingElsePrivate = () => {
  //...
};

// Create an object exposed to the public
const basketModule = {
  // Add items to our basket
  addItem(values) {
    basket.push(values);
  },

  // Get the count of items in the basket
  getItemCount() {
    return basket.length;
  },

  // Public alias to a private function
  doSomething() {
    doSomethingPrivate();
  },

  // Get the total value of items in the basket
  // The reduce() method applies a function against an accumulator and each element in the array (from left to right) to reduce it to a single value.
  getTotal() {
    return basket.reduce((currentSum, item) => item.price + currentSum, 0);
  },
};

export default basketModule;


</code></pre><p>Inside the module, you may have noticed that we return an <code>object</code>. This gets automatically assigned to <code>basketModule</code> so that we can interact with it as follows:<pre><code class=language-javascript>
// Import module from path
import basketModule from './basketModule';

// basketModule returns an object with a public API we can use

basketModule.addItem({
  item: 'bread',
  price: 0.5,
});

basketModule.addItem({
  item: 'butter',
  price: 0.3,
});

// Outputs: 2
console.log(basketModule.getItemCount());

// Outputs: 0.8
console.log(basketModule.getTotal());

// However, the following will not work:

// Outputs: undefined
// This is because the basket itself is not exposed as a part of our
// public API
console.log(basketModule.basket);

// This also won't work as it only exists within the scope of our
// basketModule closure, but not in the returned public object
console.log(basket);
</code></pre><p>The methods above are effectively namespaced inside <code>basketModule</code>.<p>Notice how the scoping function in the above basket module is wrapped around all of our functions, which we then call and immediately store the return value of. This has a number of advantages including:<ul><li>The freedom to have private functions and private members which can only be consumed by our module. As they aren't exposed to the rest of the page (only our exported API is), they're considered truly private.<li>Given that functions are declared normally and are named, it can be easier to show call stacks in a debugger when we're attempting to discover what function(s) threw an exception.<li>As T.J Crowder has pointed out in the past, it also enables us to return different functions depending on the environment. In the past, I've seen developers use this to perform UA testing in order to provide a code-path in their module specific to IE, but we can easily opt for feature detection these days to achieve a similar goal.</ul><details><summary><strong>Module Pattern - ES5/Classic Approach</strong></summary><p>Classic JavaScript did not allow you to import and export modules similar to its modern counterpart. However, you could still compartmentalize your code as shown in the following snippets.<p><strong>Self-contained Module</strong><pre><code class=language-javascript>  
//*******************************************************//
// The Module Pattern
//*******************************************************//
<p>var testModule = (function () {</p>
<p>var counter = 0;</p>
<p>return {</p>
<pre><code>incrementCounter: function () {
  return counter++;
},

resetCounter: function () {
  console.log( "counter value prior to reset: " + counter );
  counter = 0;
}
</code></pre>
<p>};</p>
<p>})();</p>
<p>// Usage:</p>
<p>// Increment our counter<br>
testModule.incrementCounter();</p>
</code><p><code class=language-javascript>// Check the counter value and reset<br>
// Outputs: counter value prior to reset: 1<br>
testModule.resetCounter();<br>
</code></pre><p><p><strong>A simple template for Module pattern</strong><pre><code class=language-javascript> 
var myNamespace = (function () {
<p>var myPrivateVar, myPrivateMethod;</p>
<p>// A private counter variable<br>
myPrivateVar = 0;</p>
<p>// A private function which logs any arguments<br>
myPrivateMethod = function( foo ) {<br>
console.log( foo );<br>
};</p>
<p>return {</p>
<pre><code>// A public variable
myPublicVar: "foo",

// A public function utilizing privates
myPublicFunction: function( bar ) {

  // Increment our private counter
  myPrivateVar++;

  // Call our private method using bar
  myPrivateMethod( bar );

}
</code></pre>
<p>};</p>
<p>})();</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Shopping basket implementation using Module pattern</strong><pre><code class=language-javascript> 
var basketModule = (function () {
<p>// privates</p>
<p>var basket = [];</p>
<p>function doSomethingPrivate() {<br>
//...<br>
}</p>
<p>function doSomethingElsePrivate() {<br>
//...<br>
}</p>
<p>// Return an object exposed to the public<br>
return {</p>
<pre><code>// Add items to our basket
addItem: function( values ) {
  basket.push(values);
},

// Get the count of items in the basket
getItemCount: function () {
  return basket.length;
},

// Public alias to a private function
doSomething: doSomethingPrivate,

// Get the total value of items in the basket
getTotal: function () {

  var q = this.getItemCount(),
      p = 0;

  while (q--) {
    p += basket[q].price;
  }

  return p;
}
</code></pre>
<p>};<br>
})();</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Using the shopping basket</strong><pre><code class=language-javascript> 
// basketModule returns an object with a public API we can use
<p>basketModule.addItem({<br>
item: "bread",<br>
price: 0.5<br>
});</p>
<p>basketModule.addItem({<br>
item: "butter",<br>
price: 0.3<br>
});</p>
<p>// Outputs: 2<br>
console.log( basketModule.getItemCount() );</p>
<p>// Outputs: 0.8<br>
console.log( basketModule.getTotal() );</p>
<p>// However, the following will not work:</p>
<p>// Outputs: undefined<br>
// This is because the basket itself is not exposed as a part of our<br>
// public API<br>
console.log( basketModule.basket );</p>
</code><p><code class=language-javascript>// This also won't work as it only exists within the scope of our<br>
// basketModule closure, but not in the returned public object<br>
console.log( basket );<br>
</code></pre><p></details><h4>Module Pattern Variations</h4><p><strong>Import mixins</strong><p>This variation of the pattern demonstrates how globals (e.g jQuery, Underscore) can be passed in as arguments to our module's anonymous function. This effectively allows us to <em>import</em> them and locally alias them as we wish.<pre><code class=language-javascript>
// ES2015+ keywords/methods used: import, export, const

const privateMethod1 = () => {
    $(".container").html("test");
}

const privateMethod2 = () => {
    console.log(_.min([10, 5, 100, 2, 1000]));
}

const myModule = {
    publicMethod() {
        privateMethod1();
    }
};

// Default export module, without name
export default myModule;


// Import module from path
import myModule from './MyModule';

myModule.publicMethod();

</code></pre><p><strong>Exports</strong><p>This next variation allows us to declare globals without consuming them and could similarly support the concept of global imports seen in the last example.<pre><code class=language-javascript>
// ES2015+ keywords/methods used: import, export, const

// Module object
const module = {};
const privateVariable = 'Hello World';

const privateMethod = () => {
  // ...
};

module.publicProperty = 'Foobar';
module.publicMethod = () => {
  console.log(privateVariable);
};

// Default export module, without name
export default module;
</code></pre><details><summary><strong>Module Pattern Variations - ES5/Classic Approach</strong></summary><p>Global imports and exports can also be implemented using classic JavaScript as shown in the following code snippets.<p><strong>Import Mixins</strong><pre><code class=language-javascript>
//*******************************************************//
// Module Pattern Variations
//*******************************************************//
// Global module
var myModule = (function ( jQ, _ ) {

    function privateMethod1(){
        jQ(".container").html("test");
    }

    function privateMethod2(){
      console.log( _.min([10, 5, 100, 2, 1000]) );
    }

    return{
        publicMethod: function(){
            privateMethod1();
        }
    };

// Pull in jQuery and Underscore
})( jQuery, _ );

myModule.publicMethod();
</code></pre><p><strong>Export</strong><pre><code class=language-javascript>
// Global module
var myModule = (function () {
<p>// Module object<br>
var module = {},<br>
privateVariable = "Hello World";</p>
<p>function privateMethod() {<br>
// ...<br>
}</p>
<p>module.publicProperty = "Foobar";<br>
module.publicMethod = function () {<br>
console.log( privateVariable );<br>
};</p>
<p>return module;</p>
<p>})();</p>
</code><p><code class=language-javascript></code></pre><p></details><h4>Toolkit And Framework-specific Module Pattern Implementations</h4><p><strong>Dojo</strong><p>Dojo provides a convenience method for working with objects called <code>dojo.setObject()</code>. This takes as its first argument a dot-separated string such as <code>myObj.parent.child</code> which refers to a property called "child" within an object "parent" defined inside "myObj". Using <code>setObject()</code> allows us to set the value of children, creating any of the intermediate objects in the rest of the path passed if they don't already exist.<p>For example, if we wanted to declare <code>basket.core</code> as an object of the <code>store</code> namespace, this could be achieved as follows using the traditional way:<pre><code class=language-javascript>
// ES2015+ keywords used: const

const store = window.store || {};

// var store = window.store || {}; for ES5 and earlier versions

if (!store['basket']) {
  store.basket = {};
}

if (!store.basket['core']) {
  store.basket.core = {};
}

store.basket.core = {
  // ...rest of our logic
};

</code></pre><p><p>Or as follows using Dojo 1.7 (AMD-compatible version) and above:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, new arrow function syntax

require(['dojo/_base/customStore'], store => {
  // using dojo.setObject()
  store.setObject(
    'basket.core',
    (() => {
      const basket = [];

      const privateMethod = () => {
        console.log(basket);
      };

      return {
        publicMethod() {
          privateMethod();
        },
      };
    })()
  );
});
</code></pre><details><summary><strong>Dojo 1.7 + Classic JavaScript syntax</strong></summary><pre><code class=language-javascript>
require(["dojo/_base/customStore"], function( store ){
<p>// using dojo.setObject()<br>
store.setObject( "basket.core", (function() {<br>
var basket = [];</p>
<pre><code>function privateMethod() {
  console.log(basket);
}

return {
    publicMethod: function(){
          privateMethod();
    }
};
</code></pre>
</code><p><code class=language-javascript>})());<br>
});<br>
</code></pre><p><p></details><p>For more information on <code>dojo.setObject()</code>, see the official <a href=http://dojotoolkit.org/reference-guide/1.7/dojo/setObject.html>documentation</a>.<p><strong>ExtJS</strong><p>For those using Sencha's ExtJS, an example demonstrating how to correctly use the Module pattern with the framework can be found below.<p>Here, we see an example of how to define a namespace which can then be populated with a module containing both a private and public API. With the exception of some semantic differences, it's quite close to how the Module pattern is implemented in vanilla JavaScript:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, let, 
//        new arrow function syntax, template literals for string interpolation

// create namespace
Ext.namespace('myNameSpace');

// create application
myNameSpace.app = (() => {
  // do NOT access DOM from here; elements don't exist yet

  // private variables
  let btn1;
  const privVar1 = 11;

  // private functions
  const btn1Handler = (button, event) => {
    console.log(`privVar1=${privVar1}`);
    console.log(`this.btn1Text=${this.btn1Text}`);
  };

  // public space
  return {
    // public properties, e.g. strings to translate
    btn1Text: 'Button 1',

    // public methods
    init() {
      if (Ext.Ext2) {
        btn1 = new Ext.Button({
          renderTo: 'btn1-ct',
          text: this.btn1Text,
          handler: btn1Handler,
        });
      } else {
        btn1 = new Ext.Button('btn1-ct', {
          text: this.btn1Text,
          handler: btn1Handler,
        });
      }
    },
  };
})();

</code></pre><details><summary><strong>ExtJS with ES5/Classic Approach</strong></summary><pre><code class=language-javascript>
// create namespace
Ext.namespace("myNameSpace");
<p>// create application<br>
myNameSpace.app = function () {</p>
<p>// do NOT access DOM from here; elements don't exist yet</p>
<p>// private variables<br>
var btn1,<br>
privVar1 = 11;</p>
<p>// private functions<br>
var btn1Handler = function ( button, event ) {<br>
console.log( "privVar1=" + privVar1 );<br>
console.log( "this.btn1Text=" + this.btn1Text );<br>
};</p>
<p>// public space<br>
return {<br>
// public properties, e.g. strings to translate<br>
btn1Text: "Button 1",</p>
<pre><code>// public methods
init: function () {

  if ( Ext.Ext2 ) {

    btn1 = new Ext.Button({
      renderTo: "btn1-ct",
      text: this.btn1Text,
      handler: btn1Handler
    });

  } else {

    btn1 = new Ext.Button( "btn1-ct", {
      text: this.btn1Text,
      handler: btn1Handler
    });

  }
}
</code></pre>
</code><p><code class=language-javascript>};<br>
}();<br>
</code></pre><p></details><p> <p><strong>YUI</strong><p>Similarly, we can also implement the Module pattern when building applications using YUI3. The following example is heavily based on the original YUI Module pattern implementation by Eric Miraglia, but again, isn't vastly different from the vanilla JavaScript version:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: let, arrow function syntax

Y.namespace('store.basket');
Y.store.basket = (() => {
  let myPrivateVar;
  let myPrivateMethod;

  // private variables:
  myPrivateVar = 'I can be accessed only within Y.store.basket.';

  // private method:
  myPrivateMethod = () => {
    Y.log('I can be accessed only from within YAHOO.store.basket');
  };

  return {
    myPublicProperty: "I'm a public property.",

    myPublicMethod() {
      Y.log("I'm a public method.");

      // Within basket, I can access "private" vars and methods:
      Y.log(myPrivateVar);
      Y.log(myPrivateMethod());

      // The native scope of myPublicMethod is store so we can
      // access public members using "this":
      Y.log(this.myPublicProperty);
    },
  };
})();
</code></pre><details><summary><strong>YUI with ES5/Classic Approach</strong></summary><pre><code class=language-javascript>
Y.namespace( "store.basket" ) ;
Y.store.basket = (function () {
<pre><code>var myPrivateVar, myPrivateMethod;

// private variables:
myPrivateVar = "I can be accessed only within Y.store.basket.";

// private method:
myPrivateMethod = function () {
    Y.log( "I can be accessed only from within YAHOO.store.basket" );
}

return {
    myPublicProperty: "I'm a public property.",

    myPublicMethod: function () {
        Y.log( "I'm a public method." );

        // Within basket, I can access "private" vars and methods:
        Y.log( myPrivateVar );
        Y.log( myPrivateMethod() );

        // The native scope of myPublicMethod is store so we can
        // access public members using "this":
        Y.log( this.myPublicProperty );
    }
};
</code></pre>
</code><p><code class=language-javascript>})();<br>
</code></pre><p></details><p><strong>jQuery</strong><p>There are a number of ways in which jQuery code unspecific to plugins can be wrapped inside the Module pattern. Ben Cherry previously suggested an implementation where a function wrapper is used around module definitions in the event of there being a number of commonalities between modules.<p>In the following example, a <code>library</code> function is defined which declares a new library and automatically binds up the <code>init</code> function to <code>document.ready</code> when new libraries (i.e. modules) are created.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, arrow function syntax

const library = module => {
  $(() => {
    if (module.init) {
      module.init();
    }
  });

  return module;
};

const myLibrary = library(
  (() => ({
    init() {
      // module implementation
    },
  }))()
);
</code></pre><details><summary><strong>jQuery - ES5/Classic Approach</strong></summary><pre><code class=language-javascript>
function library( module ) {
<p>$( function() {<br>
if ( module.init ) {<br>
module.init();<br>
}<br>
});</p>
<p>return module;<br>
}</p>
<p>var myLibrary = library(function () {</p>
<p>return {<br>
init: function () {<br>
// module implementation<br>
}<br>
};<br>
}());</p>
</code><p><code class=language-javascript></code></pre><p></details><h4>Advantages</h4><p>We've seen why the Constructor pattern can be useful, but why is the Module pattern a good choice? For starters, it's a lot cleaner for developers coming from an object-oriented background than the idea of true encapsulation, at least from a JavaScript perspective.<p>Secondly, it supports private data - so, in the Module pattern, public parts of our code are able to touch the private parts, however the outside world is unable to touch the class's private parts (no laughing! Oh, and thanks to David Engfer for the joke).<h4>Disadvantages</h4><p>The disadvantages of the Module pattern are that as we access both public and private members differently, when we wish to change visibility, we actually have to make changes to each place the member was used.<p>We also can't access private members in methods that are added to the object at a later point. That said, in many cases the Module pattern is still quite useful and when used correctly, certainly has the potential to improve the structure of our application.<p>Other disadvantages include the inability to create automated unit tests for private members and additional complexity when bugs require hot fixes. It's simply not possible to patch privates. Instead, one must override all public methods which interact with the buggy privates. Developers can't easily extend privates either, so it's worth remembering privates are not as flexible as they may initially appear.<p>For further reading on the Module pattern, see Ben Cherry's excellent in-depth <a href=http://www.adequatelygood.com/2010/3/JavaScript-Module-Pattern-In-Depth>article</a> on it.<p> <h4>Modern Module Pattern with WeakMap</h4><p>The <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap>WeakMap</a> object is a collection of key/value pairs in which the keys are weakly referenced. The keys must be objects and the values can be arbitrary values. The object is essentially a map where keys are held weakly. This means that keys will be a target for garbage collection (GC) if there is no active reference to the object. Let us look at an implementation of the module pattern that uses the WeakMap object.<p><strong>Basic module Definition</strong><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: let, const, class, constructor, method declaration, weakmap
let _counter = new WeakMap();

class Module {
    constructor() {
        _counter.set(this, 0);
    }
    incrementCounter() {
        let counter = _counter.get(this);
        counter++;
        _counter.set(this, counter);

        return _counter.get(this);
    }
    resetCounter() {
        console.log(`counter value prior to reset: ${_counter.get(this)}`);
        _counter.set(this, 0);
    }
}

const testModule = new Module();

// Usage:

// Increment our counter
testModule.incrementCounter();
// Check the counter value and reset
// Outputs: counter value prior to reset: 1
testModule.resetCounter();
</code></pre><p><strong>Namespaces with Public/Private variables</strong><pre><code class=language-javascript>

// ES2015+ keywords/syntax used: let, const, class, constructor, method declaration, weakmap
const myPrivateVar = new WeakMap();
const myPrivateMethod = new WeakMap();

class MyNamespace {
    constructor() {
        // A private counter variable
        myPrivateVar.set(this, 0);
        // A private function which logs any arguments
        myPrivateMethod.set(this, foo => console.log(foo));
        // A public variable
        this.myPublicVar = 'foo';
    }
    // A public function utilizing privates
    myPublicFunction(bar) {
        let privateVar = myPrivateVar.get(this);
        const privateMethod = myPrivateMethod.get(this);
        // Increment our private counter
        privateVar++;
        myPrivateVar.set(this, privateVar);
        // Call our private method using bar
        privateMethod(bar);
    }
}

</code></pre><p><strong>Shopping Basket Implementation</strong><pre><code class=language-javascript>

// ES2015+ keywords/syntax used: let, const, class, constructor, method declaration, weakmap

const basket = new WeakMap();
const doSomethingPrivate = new WeakMap();
const doSomethingElsePrivate = new WeakMap();

class BasketModule {
    constructor() {
        // privates
        basket.set(this, []);
        doSomethingPrivate.set(this, () => {
            //...
        });
        doSomethingElsePrivate.set(this, () => {
            //...
        });
    }
    // Public aliases to a private functions
    doSomething() {
        doSomethingPrivate.get(this)();
    }
    doSomethingElse() {
        doSomethingElsePrivate.get(this)();
    }
    // Add items to our basket
    addItem(values) {
        const basketData = basket.get(this);
        basketData.push(values);
        basket.set(this, basketData);
    }
    // Get the count of items in the basket
    getItemCount() {
        return basket.get(this).length;
    }
    // Get the total value of items in the basket
    getTotal() {
        return basket
            .get(this)
            .reduce((currentSum, item) => item.price + currentSum, 0);
    }
}
</code></pre></section><section><h2 id=revealingmodulepatternjavascript><a href=#revealingmodulepatternjavascript class=subhead-link>#</a> The Revealing Module Pattern</h2><p>Now that we're a little more familiar with the module pattern, let’s take a look at a slightly improved version - Christian Heilmann’s Revealing Module pattern.<p>The Revealing Module pattern came about as Heilmann was frustrated with the fact that he had to repeat the name of the main object when we wanted to call one public method from another or access public variables.  He also disliked the Module pattern’s requirement for having to switch to object literal notation for the things he wished to make public.<p>The result of his efforts was an updated pattern where we would simply define all of our functions and variables in the private scope and return an anonymous object with pointers to the private functionality we wished to reveal as public.<p>With the modern way of implementing <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules>modules</a> in ES2015+, the scope of functions and variables defined in the module is already private. Also, we use <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules#exporting_module_features>export</a> and <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules#importing_features_into_your_script>import</a> to reveal whatever needs to be revealed.<p>An example of the use of the Revealing Module pattern with ES2015+ is as follows:<p><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: let, const, method declaration, arrow function
//              template literals for string interpolation, import, export

let privateVar = 'Ben Cherry';
const publicVar = 'Hey there!';

const privateFunction = () => {
  console.log(`Name:${privateVar}`);
};

const publicSetName = strName => {
  privateVar = strName;
};

const publicGetName = () => {
  privateFunction();
};

// Reveal public pointers to
// private functions and properties
const myRevealingModule = {
  setName: publicSetName,
  greeting: publicVar,
  getName: publicGetName,
};

export default myRevealingModule;

// Usage:
import myRevealingModule from './myRevealingModule';

myRevealingModule.setName('Paul Kinlan');

</code></pre><p><p>In the above example, we reveal the private variable <code>privateVar</code> through its public get and set methods, <code>publicSetName</code>, and <code>publicGetName</code><p>The pattern can also be used to reveal private functions and properties with a more specific naming scheme if we would prefer:<p><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: let, const, arrow function,import, export

let privateCounter = 0;

const privateFunction = () => {
    privateCounter++;
}

const publicFunction = () => {
    publicIncrement();
}

const publicIncrement = () => {
    privateFunction();
}

const publicGetCount = () => privateCounter;

// Reveal public pointers to
// private functions and properties
const myRevealingModule = {
    start: publicFunction,
    increment: publicIncrement,
    count: publicGetCount
};

export default myRevealingModule;

// Usage:
import myRevealingModule from './myRevealingModule';

myRevealingModule.start();
</code></pre><p><details><summary><strong>Revealing Module Pattern - ES5/Classic Approach</strong></summary><p>ES2015+ simplified the implementation of scoping requirements for variables and functions. The motivation for The Revealing Module Pattern however was classic JavaScript. Understanding the implementation with classic JS may still be relevant in scenarios where a transpiler is not being used to ensure cross-browser support.<p><strong>Revealing Private Variables</strong><pre><code class=language-javascript>
var myRevealingModule = (function () {
<pre><code>    var privateVar = "Ben Cherry",
        publicVar = "Hey there!";

    function privateFunction() {
        console.log( "Name:" + privateVar );
    }

    function publicSetName( strName ) {
        privateVar = strName;
    }

    function publicGetName() {
        privateFunction();
    }


    // Reveal public pointers to
    // private functions and properties

    return {
        setName: publicSetName,
        greeting: publicVar,
        getName: publicGetName
    };

})();
</code></pre>
</code><p><code class=language-javascript>myRevealingModule.setName( "Paul Kinlan" );<br>
</code></pre><p><p><strong>Revealing Private Functions and Properties</strong><pre><code class=language-javascript>
var myRevealingModule = (function () {
<pre><code>    var privateCounter = 0;

    function privateFunction() {
        privateCounter++;
    }

    function publicFunction() {
        publicIncrement();
    }

    function publicIncrement() {
        privateFunction();
    }

    function publicGetCount(){
      return privateCounter;
    }

    // Reveal public pointers to
    // private functions and properties

   return {
        start: publicFunction,
        increment: publicIncrement,
        count: publicGetCount
    };

})();
</code></pre>
</code><p><code class=language-javascript>myRevealingModule.start();<br>
</code></pre><p></details><p><strong>Advantages</strong><p>This pattern allows the syntax of our scripts to be more consistent. It also makes it more clear at the end of the module which of our functions and variables may be accessed publicly which eases readability.<p><strong>Disadvantages</strong><p>A disadvantage of this pattern is that if a private function refers to a public function, that public function can't be overridden if a patch is necessary. This is because the private function will continue to refer to the private implementation and the pattern doesn't apply to public members, only to functions.<p>Public object members which refer to private variables are also subject to the no-patch rule notes above.<p>As a result of this, modules created with the Revealing Module pattern may be more fragile than those created with the original Module pattern, so care should be taken during usage.<p> </section><section><h2 id=singletonpatternjavascript><a href=#singletonpatternjavascript class=subhead-link>#</a> The Singleton Pattern</h2><p>The Singleton pattern is a design pattern that restricts the instantiation of a class to one object. This is useful when exactly one object is needed to coordinate actions across the system. Classically, the Singleton pattern can be implemented by creating a class with a method that creates a new instance of the class if one doesn't exist. In the event of an instance already existing, it simply returns a reference to that object.<p>Singletons differ from static <i>classes</i> (or objects) as we can delay their initialization, generally because they require some information that may not be available during initialization time. They don't provide a way for code that is unaware of a previous reference to them to easily retrieve them. This is because it is neither the object nor "class" that's returned by a Singleton, it's a structure. Think of how closured variables aren't actually closures - the function scope that provides the closure is the closure.<p>ES2015+ allows us to implement the singleton pattern to create a global instance of a JavaScript <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>class</a> that is instantiated once. The singleton instance can be exposed through a <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules#exporting_module_features>module export</a>. This makes access to it more explicit and controlled and differentiates it from other global variables. You cannot create a new instance of the class but can read/modify the instance using public get and set methods defined in the class.<p>We can implement a Singleton as follows:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, let, arrow function syntax
//                  class, constructor, import, export

// Instance stores a reference to the Singleton
let instance;

// Private methods and variables
const privateMethod = () => {
    console.log('I am private');
  };
const privateVariable = 'Im also private';
const randomNumber = Math.random();
  
// Singleton
class MySingleton {
  // Get the Singleton instance if one exists
  // or create one if it doesn't
  constructor() {
    if (!instance) {
      // Public property
      this.publicProperty = 'I am also public';
      instance = this;
    }

    return instance;
  }

  // Public methods
  publicMethod() {
    console.log('The public can see me!');
  }

  getRandomNumber() {
    return randomNumber;
  }
}
// [ES2015+] Default export module, without name
export default MySingleton;
  

// Instance stores a reference to the Singleton
let instance;

// Singleton
class MyBadSingleton {
    // Always create a new Singleton instance
    constructor() {
        this.randomNumber = Math.random();
        instance = this;

        return instance;
    }

    getRandomNumber() {
        return this.randomNumber;
    }
}

export default MyBadSingleton;


// Usage:
import MySingleton from './MySingleton';
import MyBadSingleton from './MyBadSingleton';

const singleA = new MySingleton();
const singleB = new MySingleton();
console.log(singleA.getRandomNumber() === singleB.getRandomNumber()); // true

const badSingleA = new MyBadSingleton();
const badSingleB = new MyBadSingleton();
console.log(badSingleA.getRandomNumber() !== badSingleB.getRandomNumber()); // true

// Note: as we are working with random numbers, there is a
// mathematical possibility both numbers will be the same,
// however unlikely. The above example should otherwise still
// be valid.

</code></pre><p>What makes the Singleton is the global access to the instance (generally through <code>MySingleton.getInstance()</code>) as we don't (at least in static languages) call <code>new MySingleton()</code> directly. This is however possible in JavaScript.<p>In the GoF book, the <i>applicability</i> of the Singleton pattern is described as follows:<p><ul><li>There must be exactly one instance of a class, and it must be accessible to clients from a well-known access point.<li>When the sole instance should be extensible by subclassing, and clients should be able to use an extended instance without modifying their code.</ul><p><p>The second of these points refers to a case where we might need code such as:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: constructor method

constructor() {
    if (this._instance == null) {
        if (isFoo()) {
            this._instance = new FooSingleton();
        } else {
            this._instance = new BasicSingleton();
        }
    }

    return this._instance;
}
</code></pre><p> <p>Here, <code>getInstance</code> becomes a little like a Factory method and we don't need to update each point in our code accessing it. <code>FooSingleton</code> above would be a subclass of <code>BasicSingleton</code> and implement the same interface.<p>Why is deferring execution considered important for a Singleton?:<blockquote>In C++ it serves to isolate from the unpredictability of the order of dynamic initialization, returning control to the programmer.</blockquote><p>It is important to note the difference between a static instance of a class (object) and a Singleton: whilst a Singleton can be implemented as a static instance, it can also be constructed lazily, without the need for resources nor memory until this is actually needed.<p>If we have a static object that can be initialized directly, we need to ensure the code is always executed in the same order (e.g in case <code>objCar</code> needs <code>objWheel</code> during its initialization) and this doesn't scale when you have a large number of source files.<p>Both Singletons and static objects are useful but they shouldn't be overused - the same way in which we shouldn't overuse other patterns.<p>In practice, the Singleton pattern is useful when exactly one object is needed to coordinate others across a system. Here is one example with the pattern being used in this context:<p><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, let, arrow function syntax
//          class, constructor

// options: an object containing configuration options for the singleton
// e.g const options = { name: "test", pointX: 5};
class Singleton {
    constructor(options = {}) {
      // set some properties for our singleton
      this.name = 'SingletonTester';
      this.pointX = options.pointX || 6;
      this.pointY = options.pointY || 10;
    }
  }

  // our instance holder
  let instance;

  // an emulation of static variables and methods
  const SingletonTester = {
    name: 'SingletonTester',
    // Method for getting an instance. It returns
    // a singleton instance of a singleton object
    getInstance(options) {
      if (instance === undefined) {
        instance = new Singleton(options);
      }

      return instance;
    },
  };

  const singletonTest = SingletonTester.getInstance({
    pointX: 5,
  });

  // Log the output of pointX just to verify it is correct
  // Outputs: 5
  console.log(singletonTest.pointX);

</code></pre><p><details><summary><strong>Singleton Pattern: ES5/Classic Approach</strong></summary><p>In classic JavaScript, Singletons serve as a shared resource namespace that isolates implementation code from the global namespace to provide a single point of access for functions. The following snippets of code provide the implementation of the Singleton pattern using JavaScript functions.<p><strong>Singleton - Basic Implementation</strong><pre><code class=language-javascript>
var mySingleton = (function () {
<p>// Instance stores a reference to the Singleton<br>
var instance;</p>
<p>function init() {</p>
<pre><code>// Singleton

// Private methods and variables
function privateMethod(){
    console.log( "I am private" );
}

var privateVariable = "Im also private";

var privateRandomNumber = Math.random();

return {

  // Public methods and variables
  publicMethod: function () {
    console.log( "The public can see me!" );
  },

  publicProperty: "I am also public",

  getRandomNumber: function() {
    return privateRandomNumber;
  }

};
</code></pre>
<p>};</p>
<p>return {</p>
<pre><code>// Get the Singleton instance if one exists
// or create one if it doesn't
getInstance: function () {

  if ( !instance ) {
    instance = init();
  }

  return instance;
}
</code></pre>
<p>};</p>
<p>})();</p>
<p>var myBadSingleton = (function () {</p>
<p>// Instance stores a reference to the Singleton<br>
var instance;</p>
<p>function init() {</p>
<pre><code>// Singleton

var privateRandomNumber = Math.random();

return {

  getRandomNumber: function() {
    return privateRandomNumber;
  }

};
</code></pre>
<p>};</p>
<p>return {</p>
<pre><code>// Always create a new Singleton instance
getInstance: function () {

  instance = init();

  return instance;
}
</code></pre>
<p>};</p>
<p>})();</p>
<p>// Usage:</p>
<p>var singleA = mySingleton.getInstance();<br>
var singleB = mySingleton.getInstance();<br>
console.log( singleA.getRandomNumber() === singleB.getRandomNumber() ); // true</p>
<p>var badSingleA = myBadSingleton.getInstance();<br>
var badSingleB = myBadSingleton.getInstance();<br>
console.log( badSingleA.getRandomNumber() !== badSingleB.getRandomNumber() ); // true</p>
</code><p><code class=language-javascript>// Note: as we are working with random numbers, there is a<br>
// mathematical possibility both numbers will be the same,<br>
// however unlikely. The above example should otherwise still<br>
// be valid.<br>
</code></pre><p><p><strong>Extending Singletons</strong><pre><code class=language-javascript>
mySingleton.getInstance = function(){
  if ( this._instance == null ) {
    if ( isFoo() ) {
       this._instance = new FooSingleton();
    } else {
       this._instance = new BasicSingleton();
    }
  }
  return this._instance;
};
</code><p><code class=language-javascript></code></pre><p><p><strong>Using Singletons for Coordination</strong><pre><code class=language-javascript>

var SingletonTester = (function () {

  // options: an object containing configuration options for the singleton
  // e.g var options = { name: "test", pointX: 5};
  function Singleton( options ) {

    // set options to the options supplied
    // or an empty object if none are provided
    options = options || {};

    // set some properties for our singleton
    this.name = "SingletonTester";

    this.pointX = options.pointX || 6;

    this.pointY = options.pointY || 10;

  }

  // our instance holder
  var instance;

  // an emulation of static variables and methods
  var _static = {

    name: "SingletonTester",

    // Method for getting an instance. It returns
    // a singleton instance of a singleton object
    getInstance: function( options ) {
      if( instance === undefined ) {
        instance = new Singleton( options );
      }

      return instance;

    }
  };

  return _static;

})();

var singletonTest = SingletonTester.getInstance({
  pointX: 5
});

// Log the output of pointX just to verify it is correct
// Outputs: 5
console.log( singletonTest.pointX );

</code></pre></details><p>Whilst the Singleton has valid uses, often when we find ourselves needing it in JavaScript it's a sign that we may need to re-evaluate our design.<p>They're often an indication that modules in a system are either tightly coupled or that logic is overly spread across multiple parts of a codebase. Singletons can be more difficult to test due to issues ranging from hidden dependencies, the difficulty in creating multiple instances, difficulty in stubbing dependencies, and so on.<p>Miller Medeiros has previously recommended <a href=http://www.ibm.com/developerworks/webservices/library/co-single/index.html>this</a> excellent article on the Singleton and its various issues for further reading as well as the comments to <a href=http://misko.hevery.com/2008/10/21/dependency-injection-myth-reference-passing/ >this</a> article, discussing how Singletons can increase tight coupling. I'm happy to second these recommendations as both pieces raise many important points about this pattern that are also worth noting.<p> </section><section><h2 id=observerpatternjavascript><a href=#observerpatternjavascript class=subhead-link>#</a> The Observer Pattern</h2><p>The Observer pattern is a design pattern that allows one object to be notified when another object changes, without requiring the object to have knowledge of its dependents.Often this is a pattern where an object (known as a subject) maintains a list of objects depending on it (observers), automatically notifying them of any changes to its state. In modern frameworks, the observer pattern is used to notify components of changes in state.<p>When a subject needs to notify observers about something interesting happening, it broadcasts a notification to the observers (which can include specific data related to the topic of the notification). >When we no longer wish for a particular observer to be notified of changes by the subject they are registered with, the subject can remove them from the list of observers.<p>It's useful to refer back to published definitions of design patterns that are language agnostic to get a broader sense of their usage and advantages over time. The definition of the Observer pattern provided in the GoF book, <em>Design Patterns: Elements of Reusable Object-Oriented Software</em>, is:<p><i>"One or more observers are interested in the state of a subject and register their interest with the subject by attaching themselves. When something changes in our subject that the observer may be interested in, a notify message is sent which calls the update method in each observer. When the observer is no longer interested in the subject's state, they can simply detach themselves."</i><p>We can now expand on what we've learned to implement the Observer pattern with the following components:<ul><li><strong>Subject</strong>: maintains a list of observers, facilitates adding or removing observers<li><strong>Observer</strong>: provides an update interface for objects that need to be notified of a Subject's changes of state<li><strong>ConcreteSubject</strong>: broadcasts notifications to observers on changes of state, stores the state of ConcreteObservers<li><strong>ConcreteObserver</strong>: stores a reference to the ConcreteSubject, implements an update interface for the Observer to ensure state is consistent with the Subject's</ul><p>ES2015+ allows us to implement the observer pattern using JavaScript <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>classes</a> for observers and subjects with <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes#prototype_methods>methods</a> for notify and update.<p>First, let's model the list of dependent Observers a subject may have using the <code>ObserverList</code> class:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, let
class ObserverList {
    constructor() {
        this.observerList = [];
    }

    add(obj) {
        return this.observerList.push(obj);
    }

    count() {
        return this.observerList.length;
    }

    get(index) {
        if (index > -1 && index &lt; this.observerList.length) {
            return this.observerList[index];
        }
    }

    indexOf(obj, startIndex) {
        let i = startIndex;

        while (i &lt; this.observerList.length) {
            if (this.observerList[i] === obj) {
                return i;
            }
            i++;
        }

        return -1;
    }

    removeAt(index) {
        this.observerList.splice(index, 1);
    }
}
</code></pre><p>Next, let's model the Subject class that has the ability to add, remove or notify observers on the observer list.<p><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, let
  
  class Subject {
    constructor() {
      this.observers = new ObserverList();
    }
  
    addObserver(observer) {
      this.observers.add(observer);
    }
  
    removeObserver(observer) {
      this.observers.removeAt(this.observers.indexOf(observer, 0));
    }
  
    notify(context) {
      const observerCount = this.observers.count();
      for (let i = 0; i &lt; observerCount; i++) {
        this.observers.get(i).update(context);
      }
    }
  }
</code></pre><p><p>We then define a skeleton for creating new Observers. The <code>update</code> functionality here will be overwritten later with custom behaviour.<p><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor
// The Observer
class Observer {
    constructor() {}
    update() {
        // ...
    }
}

</code></pre><p><p>In our sample application using the above Observer components, we now define:<ul><li>A button for adding new observable checkboxes to the page<li>A control checkbox which will act as a subject, notifying other checkboxes they should be checked<li>A container for the new checkboxes being added</ul><p>We then define ConcreteSubject and ConcreteObserver handlers for both adding new observers to the page and implementing the updating interface. We use inheritance to <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes#sub_classing_with_extends>extend</a> our Subject and Observer classes respectively for this. The ConcreteSubject class encapsulates a checkbox and generates a notification when the main checkbox is clicked. ConcreteObserver encapsulates each of the observing checkboxes and implements the update interface by changing the <code>checked</code> value of the checkboxes. See below for inline comments on how these work together in the context of our example.<p><strong>HTML:</strong><p><pre><code class=language-javascript>
<p>&lt;button id="addNewObserver">Add New Observer checkbox&lt;/button><br>
&lt;input id="mainCheckbox" type="checkbox"/><br>
&lt;div id="observersContainer">&lt;/div></p>
</code><p><code class=language-javascript></code></pre><p><p><p><strong>Sample script:</strong><p><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, extends, super
//                  const, let, arrow function syntax

// Concrete Subject
class ConcreteSubject extends Subject {
    constructor(element) {
      // Call the constructor of the super class.
      super();
      this.element = element;
  
      // Clicking the checkbox will trigger notifications to its observers
      this.element.onclick = () => {
        this.notify(this.element.checked);
      };
    }
  }
  
  // Concrete Observer
  
  class ConcreteObserver extends Observer {
    constructor(element) {
      super();
      this.element = element;
    }
  
    // Override with custom update behaviour
    update(value) {
      this.element.checked = value;
    }
  }
  
  // References to our DOM elements
  const addBtn = document.getElementById('addNewObserver');
  const container = document.getElementById('observersContainer');
  const controlCheckbox = new ConcreteSubject(
    document.getElementById('mainCheckbox')
  );
  
  const addNewObserver = () => {
    // Create a new checkbox to be added
    const check = document.createElement('input');
    check.type = 'checkbox';
    const checkObserver = new ConcreteObserver(check);
  
    // Add the new observer to our list of observers
    // for our main subject
    controlCheckbox.addObserver(checkObserver);
  
    // Append the item to the container
    container.appendChild(check);
  };
  
  addBtn.onclick = addNewObserver;

</code></pre><p><p>In this example, we looked at how to implement and utilize the Observer pattern, covering the concepts of a Subject, Observer, ConcreteSubject and ConcreteObserver.<details><summary><strong>Observer Pattern - ES5/Classic Approach</strong></summary><p>Following is an implementation of the Observer Pattern using classic JavaScript. Here we use function prototypes to implement the ObserverList, Subject, Observer, ConcreteObserver and ConcreteSubject classes.<p><strong>ObserverList</strong><pre><code class=language-javascript>
function ObserverList(){
  this.observerList = [];
}
<p>ObserverList.prototype.add = function( obj ){<br>
return this.observerList.push( obj );<br>
};</p>
<p>ObserverList.prototype.count = function(){<br>
return this.observerList.length;<br>
};</p>
<p>ObserverList.prototype.get = function( index ){<br>
if( index > -1 && index &lt; this.observerList.length ){<br>
return this.observerList[ index ];<br>
}<br>
};</p>
<p>ObserverList.prototype.indexOf = function( obj, startIndex ){<br>
var i = startIndex;</p>
<p>while( i &lt; this.observerList.length ){<br>
if( this.observerList[i] === obj ){<br>
return i;<br>
}<br>
}</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Subject</strong><pre><code class=language-javascript>
function Subject(){
  this.observers = new ObserverList();
}
<p>Subject.prototype.addObserver = function( observer ){<br>
this.observers.add( observer );<br>
};</p>
<p>Subject.prototype.removeObserver = function( observer ){<br>
this.observers.removeAt( this.observers.indexOf( observer, 0 ) );<br>
};</p>
<p>Subject.prototype.notify = function( context ){<br>
var observerCount = this.observers.count();<br>
for(var i=0; i &lt; observerCount; i++){<br>
this.observers.get(i).update( context );<br>
}<br>
};</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Observer</strong><pre><code class=language-javascript>
<p>// The Observer<br>
class Observer {<br>
constructor() {}<br>
update() {<br>
// ...<br>
}<br>
}</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>List of Observer checkboxes that observe a main Subject checkbox</strong><pre><code class=language-javascript>
<p>// Extend an object with an extension<br>
function extend( obj, extension ){<br>
for ( var key in extension ){<br>
obj[key] = extension[key];<br>
}<br>
}</p>
<p>// References to our DOM elements</p>
<p>var controlCheckbox = document.getElementById( "mainCheckbox" ),<br>
addBtn = document.getElementById( "addNewObserver" ),<br>
container = document.getElementById( "observersContainer" );</p>
<p>// Concrete Subject</p>
<p>// Extend the controlling checkbox with the Subject class<br>
extend( controlCheckbox, new Subject() );</p>
<p>// Clicking the checkbox will trigger notifications to its observers<br>
controlCheckbox.onclick = function(){<br>
controlCheckbox.notify( controlCheckbox.checked );<br>
};</p>
<p>addBtn.onclick = addNewObserver;</p>
<p>// Concrete Observer</p>
<p>function addNewObserver(){</p>
<p>// Create a new checkbox to be added<br>
var check = document.createElement( "input" );<br>
check.type = "checkbox";</p>
<p>// Extend the checkbox with the Observer class<br>
extend( check, new Observer() );</p>
<p>// Override with custom update behaviour<br>
check.update = function( value ){<br>
this.checked = value;<br>
};</p>
<p>// Add the new observer to our list of observers<br>
// for our main subject<br>
controlCheckbox.addObserver( check );</p>
</code><p><code class=language-javascript>// Append the item to the container<br>
container.appendChild( check );<br>
}<br>
</code></pre><p></details><h3>Differences Between The Observer And Publish/Subscribe Pattern</h3><p>Whilst the Observer pattern is useful to be aware of, quite often in the JavaScript world, we'll find it commonly implemented using a variation known as the Publish/Subscribe pattern. Whilst very similar, there are differences between these patterns worth noting.<p>The first difference between the Observer and Publish/Subscribe Pattern is that the Observer is a one-to-one relationship, whereas the Publish/Subscribe Pattern is a one-to-many relationship. In the Observer Pattern, one Observer is subscribed to one Subject. In the Publish/Subscribe Pattern, one Subject can be subscribed to many Observers.<p>The Observer pattern requires that the observer (or object) wishing to receive topic notifications must subscribe this interest to the object firing the event (the subject).<p>The Publish/Subscribe pattern however uses a topic/event channel which sits between the objects wishing to receive notifications (subscribers) and the object firing the event (the publisher). This event system allows code to define application specific events which can pass custom arguments containing values needed by the subscriber. The idea here is to avoid dependencies between the subscriber and publisher.<h3>Disadvantages</h3><p>Consequently, some of the issues with these patterns actually stem from their main benefits. In Publish/Subscribe, by decoupling publishers from subscribers, it can sometimes become difficult to obtain guarantees that particular parts of our applications are functioning as we may expect.<p>For example, publishers may assume that one or more subscribers are listening to them. Say that we're using such an assumption to log or output errors regarding some application process. If the subscriber performing the logging crashes (or for some reason fails to function), the publisher won't have a way of seeing this due to the decoupled nature of the system.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, let, arrow function syntax

<details>
<summary><strong>Publish/Subscribe Mail Handler - ES5/Classic Approach</strong></summary>
<p>Following is the ES5 compatible implementation of the simple mail handler discussed in the previous sub-section.</p>
<pre><code class=language-javascript>
// A very simple new mail handler

// A count of the number of messages received
let mailCounter = 0;

// Initialize subscribers that will listen out for a topic
// with the name "inbox/newMessage".

// Render a preview of new messages
const subscriber1 = subscribe('inbox/newMessage', (topic, data) => {
  // Log the topic for debugging purposes
  console.log('A new message was received: ', topic);

  // Use the data that was passed from our subject
  // to display a message preview to the user
  $('.messageSender').html(data.sender);
  $('.messagePreview').html(data.body);
});

// Here's another subscriber using the same data to perform
// a different task.

// Update the counter displaying the number of new
// messages received via the publisher

const subscriber2 = subscribe('inbox/newMessage', (topic, data) => {
  $('.newMessageCounter').html(++mailCounter);
});

publish('inbox/newMessage', [
  {
    sender: 'hello@google.com',
    body: 'Hey there! How are you doing today?',
  },
]);

// We could then at a later point unsubscribe our subscribers
// from receiving any new topic notifications as follows:
// unsubscribe( subscriber1 );
// unsubscribe( subscriber2 );

</code></pre>
<p>
 The general idea here is the promotion of loose coupling. Rather than single objects calling on the methods of other objects directly, they instead subscribe to a specific task or activity of another object and are notified when it occurs.</p>
<h3>Advantages</h3>
<p>
The Observer and Publish/Subscribe patterns encourage us to think hard about the relationships between different parts of our application. They also help us identify what layers containing direct relationships which could instead be replaced with sets of subjects and observers. This effectively could be used to break down an application into smaller, more loosely coupled blocks to improve code management and potentials for re-use.</p>
<p>Further motivation behind using the Observer pattern is where we need to maintain consistency between related objects without making classes tightly coupled. For example, when an object needs to be able to notify other objects without making assumptions regarding those objects. </p>
<p>Dynamic relationships can exist between observers and subjects when using either pattern. This provides a great deal of flexibility which may not be as easy to implement when disparate parts of our application are tightly coupled.</p>
<p>
Whilst it may not always be the best solution to every problem, these patterns remain one of the best tools for designing decoupled systems and should be considered an important tool in any JavaScript developer's utility belt.</p>
<h3>Disadvantages</h3>
<p>
Consequently, some of the issues with these patterns actually stem from their main benefits. In Publish/Subscribe, by decoupling publishers from subscribers, it can sometimes become difficult to obtain guarantees that particular parts of our applications are functioning as we may expect.</p>
<p>
For example, publishers may assume that one or more subscribers are listening to them. Say that we're using such an assumption to log or output errors regarding some application process. If the subscriber performing the logging crashes (or for some reason fails to function), the publisher won't have a way of seeing this due to the decoupled nature of the system.</p>
<p>Another draw-back of the pattern is that subscribers are quite ignorant to the existence of each other and are blind to the cost of switching publishers. Due to the dynamic relationship between subscribers and publishers, the update dependency can be difficult to track.</p>
<details>
<summary><strong>Publish/Subscribe Mail Handler - ES5/Classic Approach</strong></summary>
<p>Following is the ES5 compatible implementation of the simple mail handler discussed in the previous sub-section.</p>
<pre><code class=language-javascript>
// A very simple new mail handler
<p>// A count of the number of messages received<br>
var mailCounter = 0;</p>
<p>// Initialize subscribers that will listen out for a topic<br>
// with the name "inbox/newMessage".</p>
<p>// Render a preview of new messages<br>
var subscriber1 = subscribe( "inbox/newMessage", function( topic, data ) {</p>
<p>// Log the topic for debugging purposes<br>
console.log( "A new message was received: ", topic );</p>
<p>// Use the data that was passed from our subject<br>
// to display a message preview to the user<br>
$( ".messageSender" ).html( data.sender );<br>
$( ".messagePreview" ).html( data.body );</p>
<p>});</p>
<p>// Here's another subscriber using the same data to perform<br>
// a different task.</p>
<p>// Update the counter displaying the number of new<br>
// messages received via the publisher</p>
<p>var subscriber2 = subscribe( "inbox/newMessage", function( topic, data ) {</p>
<p>$('.newMessageCounter').html( ++mailCounter );</p>
<p>});</p>
<p>publish( "inbox/newMessage", [{<br>
sender: "<a href=mailto:hello@google.com>hello@google.com</a>",<br>
body: "Hey there! How are you doing today?"<br>
}]);</p>
</code><p><code class=language-javascript>// We could then at a later point unsubscribe our subscribers<br>
// from receiving any new topic notifications as follows:<br>
// unsubscribe( subscriber1 );<br>
// unsubscribe( subscriber2 );<br>
</code></pre><p></p>
</details>
<h3>Publish/Subscribe Implementations</h3>
<p>
Publish/Subscribe fits in very well in JavaScript ecosystems, largely because at the core, ECMAScript implementations are event driven. This is particularly true in browser environments as the DOM uses events as its main interaction API for scripting.</p>
<p>That said, neither ECMAScript nor DOM provide core objects or methods for creating custom events systems in implementation code (except perhaps the DOM3 CustomEvent, which is bound to the DOM and is thus not generically useful).</p>
<p>Luckily, popular JavaScript libraries such as dojo, jQuery (custom events) and YUI already have utilities that can assist in easily implementing a Publish/Subscribe system with very little effort. Below we can see some examples of this:</p>
<pre><code class=language-javascript>
// Publish

// jQuery: $(obj).trigger("channel", [arg1, arg2, arg3]);
$(el).trigger('/login', [
    {
      username: 'test',
      userData: 'test',
    },
  ]);
  
  // Dojo: dojo.publish("channel", [arg1, arg2, arg3] );
  dojo.publish('/login', [
    {
      username: 'test',
      userData: 'test',
    },
  ]);
  
  // YUI: el.publish("channel", [arg1, arg2, arg3]);
  el.publish('/login', {
    username: 'test',
    userData: 'test',
  });
  
// Subscribe

// jQuery: $(obj).on( "channel", [data], fn );
$(el).on('/login', event => {...});

// Dojo: dojo.subscribe( "channel", fn);
const handle = dojo.subscribe('/login', data => {..});

// YUI: el.on("channel", handler);
el.on('/login', data => {...});


// Unsubscribe

// jQuery: $(obj).off( "channel" );
$(el).off('/login');

// Dojo: dojo.unsubscribe( handle );
dojo.unsubscribe(handle);

// YUI: el.detach("channel");
el.detach('/login');

</code></pre>
<p>
For those wishing to use the Publish/Subscribe pattern with vanilla JavaScript (or another library) <a href=http://amplifyjs.com/ >AmplifyJS</a> includes a clean, library-agnostic implementation that can be used with any library or toolkit. Radio.js (<a href=http://radio.uxder.com/ >http://radio.uxder.com/</a>), PubSubJS (<a href=https://github.com/mroderick/PubSubJS>https://github.com/mroderick/PubSubJS</a>) or Pure JS PubSub by Peter Higgins (<a href=https://github.com/phiggins42/bloody-jquery-plugins/blob/55e41df9bf08f42378bb08b93efcb28555b61aeb/pubsub.js>https://github.com/phiggins42/bloody-jquery-plugins/blob/55e41df9bf08f42378bb08b93efcb28555b61aeb/pubsub.js</a>) are also similar alternatives worth checking out.</p>
<p>
jQuery developers in particular have quite a few other options and can opt to use one of the many well-developed implementations ranging from Peter Higgins's jQuery plugin to Ben Alman's (optimized) Pub/Sub jQuery gist on GitHub. Links to just a few of these can be found below.
</p>
<ul>
<li>Ben Alman's Pub/Sub gist <a href=https://gist.github.com/661855>https://gist.github.com/661855</a> (recommended)</li>
<li>Rick Waldron's jQuery-core style take on the above <a href=https://gist.github.com/705311>https://gist.github.com/705311</a></li>
<li>Peter Higgins" plugin <a href=http://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js>http://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js</a>.</li>
<li>AppendTo's Pub/Sub in AmplifyJS <a href=http://amplifyjs.com>http://amplifyjs.com</a></li>
<li>Ben Truyman's gist <a href=https://gist.github.com/826794>https://gist.github.com/826794</a></li>
</ul>
<p>
So that we are able to get an appreciation for how many of the vanilla JavaScript implementations of the Observer pattern might work, let's take a walk through of a minimalist version of Publish/Subscribe I released on GitHub under a project called <a href=http://github.com/addyosmani/pubsubz>pubsubz</a>. This demonstrates the core concepts of subscribe, publish as well as the concept of unsubscribing.</p>
<p>
I've opted to base our examples on this code as it sticks closely to both the method signatures and approach of implementation I would expect to see in a JavaScript version of the classic Observer pattern.</p>
<h4>A Publish/Subscribe Implementation</h4>
<p>
<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, const, let

class PubSub {
    constructor() {
        // Storage for topics that can be broadcast
        // or listened to
        this.topics = {};

        // A topic identifier
        this.subUid = -1;
    }

    publish(topic, args) {
        if (!this.topics[topic]) {
            return false;
        }

        const subscribers = this.topics[topic];
        let len = subscribers ? subscribers.length : 0;

        while (len--) {
            subscribers[len].func(topic, args);
        }

        return this;
    }

    subscribe(topic, func) {
        if (!this.topics[topic]) {
            this.topics[topic] = [];
        }

        const token = (++this.subUid).toString();
        this.topics[topic].push({
            token,
            func,
        });
        return token;
    }

    unsubscribe(token) {
        for (const m in this.topics) {
            if (this.topics[m]) {
                for (let i = 0, j = this.topics[m].length; i &lt; j; i++) {
                    if (this.topics[m][i].token === token) {
                        this.topics[m].splice(i, 1);

                        return token;
                    }
                }
            }
        }
        return this;
    }
}

const pubsub = new PubSub();

pubsub.publish('/addFavorite', ['test']);
pubsub.subscribe('/addFavorite', (topic, args) => {
    console.log('test', topic, args);
});
</code></pre>
<p></p>
<p>Here we have defined a basic <code>PubSub</code> class that maintains a list of topics with subscribers who have subscribed to it. The <code>Subscribe</code> method creates a new subscriber to a topic using the function to be called when publishing a topic and a unique token. The <code>Unsubscribe</code> method removes a subscriber from the list based on the token value passed. The <code>Publish</code> method publishes content on a given topic to all its subscribers by calling the registered function.</p>
<h4>Example: Using Our Implementation</h4>
<p>We can now use the implementation to publish and subscribe to events of interest as follows:</p>
<p>
<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, arrow function syntax, 
//              template literals for string interpolation

// Another simple message handler

// A simple message logger that logs any topics and data received through our
// subscriber
const messageLogger = (topics, data) => {
    console.log(`Logging: ${topics}: ${data}`);
};

// Subscribers listen for topics they have subscribed to and
// invoke a callback function (e.g messageLogger) once a new
// notification is broadcast on that topic
const subscription = pubsub.subscribe('inbox/newMessage', messageLogger);

// Publishers are in charge of publishing topics or notifications of
// interest to the application. e.g:

pubsub.publish('inbox/newMessage', 'hello world!');

// or
pubsub.publish('inbox/newMessage', ['test', 'a', 'b', 'c']);

// or
pubsub.publish('inbox/newMessage', {
    sender: 'hello@google.com',
    body: 'Hey again!',
});

// We can also unsubscribe if we no longer wish for our subscribers
// to be notified
pubsub.unsubscribe(subscription);

// Once unsubscribed, this for example won't result in our
// messageLogger being executed as the subscriber is
// no longer listening
pubsub.publish('inbox/newMessage', 'Hello! are you still there?');
</code></pre>
<p></p>
<h4>Example: User-Interface Notifications</h4>
<p>Next, let's imagine we have a web application responsible for displaying real-time stock information.</p>
<p>
The application might have a grid for displaying the stock stats and a counter for displaying the last point of update. When the data model changes, the application will need to update the grid and counter. In this scenario, our subject (which will be publishing topics/notifications) is the data model and our subscribers are the grid and counter.</p>
<p>
When our subscribers receive notification that the model itself has changed, they can update themselves accordingly.
</p>
<p>
In our implementation, our subscriber will listen to the topic "newDataAvailable" to find out if new stock information is available. If a new notification is published to this topic, it will trigger <code>gridUpdate</code> to add a new row to our grid containing this information. It will also update a <em>last updated</em> counter to log the last time data was added
</p>
<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, arrow function syntax, 
//              template literals for string interpolation

// Return the current local time to be used in our UI later
getCurrentTime = () => {
    const date = new Date();
    const m = date.getMonth() + 1;
    const d = date.getDate();
    const y = date.getFullYear();
    const t = date.toLocaleTimeString().toLowerCase();
  
    return `${m}/${d}/${y} ${t}`;
  };
  
  // Add a new row of data to our fictional grid component
  const addGridRow = data => {
    // ui.grid.addRow( data );
    console.log(`updated grid component with:${data}`);
  };
  
  // Update our fictional grid to show the time it was last
  // updated
  const updateCounter = data => {
    // ui.grid.updateLastChanged( getCurrentTime() );
    console.log(`data last updated at: ${getCurrentTime()} with ${data}`);
  };
  
  // Update the grid using the data passed to our subscribers
  const gridUpdate = (topic, data) => {
    if (data !== undefined) {
      addGridRow(data);
      updateCounter(data);
    }
  };


// Create a subscription to the newDataAvailable topic
const subscriber = pubsub.subscribe('newDataAvailable', gridUpdate);

// The following represents updates to our data layer. This could be
// powered by ajax requests which broadcast that new data is available
// to the rest of the application.

// Publish changes to the gridUpdated topic representing new entries
pubsub.publish('newDataAvailable', {
  summary: 'Apple made $5 billion',
  identifier: 'APPL',
  stockPrice: 570.91,
});

pubsub.publish('newDataAvailable', {
  summary: 'Microsoft made $20 million',
  identifier: 'MSFT',
  stockPrice: 30.85,
});


</code></pre>
<h4>Example: Decoupling applications using Ben Alman's Pub/Sub implementation</h4>
<p>
In the following movie ratings example, we'll be using Ben Alman's jQuery implementation of Publish/Subscribe to demonstrate how we can decouple a user interface. Notice how submitting a rating only has the effect of publishing the fact that new user and rating data is available.
</p>
<p>
It's left up to the subscribers to those topics to then delegate what happens with that data. In our case we're pushing that new data into existing arrays and then rendering them using the Underscore library's <code>.template()</code> method for templating.</p>
<p><strong>HTML/Templates</strong></p>
<pre><code class=language-javascript>

&lt;script id="userTemplate" type="text/html">
   &lt;li>&lt;%= name %>&lt;/li>
&lt;/script>


&lt;script id="ratingsTemplate" type="text/html">
   &lt;li>&lt;strong>&lt;%= title %>&lt;/strong> was rated &lt;%= rating %>/5&lt;/li>
&lt;/script>


&lt;div id="container">

   &lt;div class="sampleForm">
       &lt;p>
           &lt;label for="twitter_handle">Twitter handle:&lt;/label>
           &lt;input type="text" id="twitter_handle" />
       &lt;/p>
       &lt;p>
           &lt;label for="movie_seen">Name a movie you've seen this year:&lt;/label>
           &lt;input type="text" id="movie_seen" />
       &lt;/p>
       &lt;p>

           &lt;label for="movie_rating">Rate the movie you saw:&lt;/label>
           &lt;select id="movie_rating">
                 &lt;option value="1">1&lt;/option>
                  &lt;option value="2">2&lt;/option>
                  &lt;option value="3">3&lt;/option>
                  &lt;option value="4">4&lt;/option>
                  &lt;option value="5" selected>5&lt;/option>

          &lt;/select>
        &lt;/p>
        &lt;p>

            &lt;button id="add">Submit rating&lt;/button>
        &lt;/p>
    &lt;/div>



    &lt;div class="summaryTable">
        &lt;div id="users">&lt;h3>Recent users&lt;/h3>&lt;/div>
        &lt;div id="ratings">&lt;h3>Recent movies rated&lt;/h3>&lt;/div>
    &lt;/div>

 &lt;/div>

</code></pre>
<p><strong>JavaScript</strong></p>
<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, arrow function syntax, 

;($ => {
    // Pre-compile templates and "cache" them using closure
    const userTemplate = _.template($('#userTemplate').html());
  
    const ratingsTemplate = _.template($('#ratingsTemplate').html());
  
    // Subscribe to the new user topic, which adds a user
    // to a list of users who have submitted reviews
    $.subscribe('/new/user', (e, data) => {
      if (data) {
        $('#users').append(userTemplate(data));
      }
    });
  
    // Subscribe to the new rating topic. This is composed of a title and
    // rating. New ratings are appended to a running list of added user
    // ratings.
    $.subscribe('/new/rating', (e, data) => {
      if (data) {
        $('#ratings').append(ratingsTemplate(data));
      }
    });
  
    // Handler for adding a new user
    $('#add').on('click', e => {
      e.preventDefault();
  
      const strUser = $('#twitter_handle').val();
      const strMovie = $('#movie_seen').val();
      const strRating = $('#movie_rating').val();
  
      // Inform the application a new user is available
      $.publish('/new/user', {
        name: strUser,
      });
  
      // Inform the app a new rating is available
      $.publish('/new/rating', {
        title: strMovie,
        rating: strRating,
      });
    });
  })(jQuery);


</code></pre>
<h4>Example: Decoupling an Ajax-based jQuery application</h4>
<p>
In our final example, we're going to take a practical look at how decoupling our code using Pub/Sub early on in the development process can save us some potentially painful refactoring later on.</p>
<p>
Quite often in Ajax-heavy applications, once we've received a response to a request we want to achieve more than just one unique action. One could simply add all of their post-request logic into a success callback, but there are drawbacks to this approach.</p>
<p>
Highly coupled applications sometimes increase the effort required to reuse functionality due to the increased inter-function/code dependency. What this means is that although keeping our post-request logic hardcoded in a callback might be fine if we're just trying to grab a result set once, it's not as appropriate when we want to make further Ajax-calls to the same data source (and different end-behavior) without rewriting parts of the code multiple times. Rather than having to go back through each layer that calls the same data-source and generalizing them later on, we can use pub/sub from the start and save time.</p>
<p>
Using Observers, we can also easily separate application-wide notifications regarding different events down to whatever level of granularity we're comfortable with - something which can be less elegantly done using other patterns.</p>
<p>
Notice how in our sample below, one topic notification is made when a user indicates they want to make a search query and another is made when the request returns and actual data is available for consumption. It's left up to the subscribers to then decide how to use knowledge of these events (or the data returned). The benefits of this are that, if we wanted, we could have 10 different subscribers utilizing the data returned in different ways but as far as the Ajax-layer is concerned, it doesn't care. Its sole duty is to request and return data then pass it on to whoever wants to use it. This separation of concerns can make the overall design of our code a little cleaner.</p>
<p><strong>HTML/Templates</strong>:</p>
<pre><code class=language-javascript>

&lt;form id="flickrSearch">

   &lt;input type="text" name="tag" id="query"/>

   &lt;input type="submit" name="submit" value="submit"/>

&lt;/form>



&lt;div id="lastQuery">&lt;/div>

&lt;ol id="searchResults">&lt;/ol>



&lt;script id="resultTemplate" type="text/html">
    &lt;% _.each(items, function( item ){ %>
        &lt;li>&lt;img src="&lt;%= item.media.m %>"/>&lt;/li>
    &lt;% });%>
&lt;/script>

</code></pre>
<p><strong>JavaScript</strong>:</p>
<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, arrow function syntax, 
//              template literals for string interpolation, 
//              destructuring assignment syntax
//              shorthand property names in object creation

;($ => {
    // Pre-compile template and "cache" it using closure
    const resultTemplate = _.template($('#resultTemplate').html());
  
    // Subscribe to the new search tags topic
    $.subscribe('/search/tags', (e, tags) => {
      $('#lastQuery').html(`Searched for: ${tags}`);
    });
  
    // Subscribe to the new results topic
    $.subscribe('/search/resultSet', (e, results) => {
      $('#searchResults')
        .empty()
        .append(resultTemplate(results));
    });
  
    // Submit a search query and publish tags on the /search/tags topic
    $('#flickrSearch').submit(function(e) {
      e.preventDefault();
      const tags = $(this)
        .find('#query')
        .val();
  
      if (!tags) {
        return;
      }
  
      $.publish('/search/tags', [$.trim(tags)]);
    });
  
    // Subscribe to new tags being published and perform
    // a search query using them. Once data has returned
    // publish this data for the rest of the application
    // to consume
    // We used the destructuring assignment syntax that makes it possible to unpack values from data structures into distinct variables.
    $.subscribe('/search/tags', (e, tags) => {
      $.getJSON(
        'http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?',
        {
          tags,
          tagmode: 'any',
          format: 'json',
        },
        // The destructuring assignment as function parameter
        ({ items }) => {
          if (!items.length) {
            return;
          }
          //shorthand property names in object creation, if variable name equal to object key
          $.publish('/search/resultSet', { items });
        }
      );
    });
  })(jQuery);


</code></pre>
<p>
The Observer pattern is useful for decoupling several different scenarios in application design and if you haven't been using it, I recommend picking up one of the pre-written implementations mentioned today and just giving it a try out. It's one of the easier design patterns to get started with but also one of the most powerful.</p>
<p> </p>
<details>
<summary><strong>Publish/Subscribe Implementations - ES5/Classic Approach</strong></summary>
<p>Following are the examples of Publish/Subscribe implementations discussed earlier using classic JavaScript syntax.</p>
<p><strong>Basic Implementation</strong></p>
<p>This is the implementation of the PubSub class that uses the classic approach of using functions to implement classes.</p>
<pre><code class=language-javascript>
var pubsub = {};
<p>(function(myObject) {</p>
<pre><code>// Storage for topics that can be broadcast
// or listened to
var topics = {};

// A topic identifier
var subUid = -1;

// Publish or broadcast events of interest
// with a specific topic name and arguments
// such as the data to pass along
myObject.publish = function( topic, args ) {

    if ( !topics[topic] ) {
        return false;
    }

    var subscribers = topics[topic],
        len = subscribers ? subscribers.length : 0;

    while (len--) {
        subscribers[len].func( topic, args );
    }

    return this;
};

// Subscribe to events of interest
// with a specific topic name and a
// callback function, to be executed
// when the topic/event is observed
myObject.subscribe = function( topic, func ) {

    if (!topics[topic]) {
        topics[topic] = [];
    }

    var token = ( ++subUid ).toString();
    topics[topic].push({
        token: token,
        func: func
    });
    return token;
};

// Unsubscribe from a specific
// topic, based on a tokenized reference
// to the subscription
myObject.unsubscribe = function( token ) {
    for ( var m in topics ) {
        if ( topics[m] ) {
            for ( var i = 0, j = topics[m].length; i &lt; j; i++ ) {
                if ( topics[m][i].token === token ) {
                    topics[m].splice( i, 1 );
                    return token;
                }
            }
        }
    }
    return this;
};
</code></pre>
</code><p><code class=language-javascript>}( pubsub ));<br>
</code></pre><p></p>
<p><strong>Using our Implementation</strong></p>
<p>Using the PubSub class (function) to implement a message handler.</p>
<pre><code class=language-javascript>
// Another simple message handler
<p>// A simple message logger that logs any topics and data received through our<br>
// subscriber<br>
var messageLogger = function ( topics, data ) {<br>
console.log( "Logging: " + topics + ": " + data );<br>
};</p>
<p>// Subscribers listen for topics they have subscribed to and<br>
// invoke a callback function (e.g messageLogger) once a new<br>
// notification is broadcast on that topic<br>
var subscription = pubsub.subscribe( "inbox/newMessage", messageLogger );</p>
<p>// Publishers are in charge of publishing topics or notifications of<br>
// interest to the application. e.g:</p>
<p>pubsub.publish( "inbox/newMessage", "hello world!" );</p>
<p>// or<br>
pubsub.publish( "inbox/newMessage", ["test", "a", "b", "c"] );</p>
<p>// or<br>
pubsub.publish( "inbox/newMessage", {<br>
sender: "<a href=mailto:hello@google.com>hello@google.com</a>",<br>
body: "Hey again!"<br>
});</p>
<p>// We can also unsubscribe if we no longer wish for our subscribers<br>
// to be notified<br>
pubsub.unsubscribe( subscription );</p>
<p>// Once unsubscribed, this for example won't result in our<br>
// messageLogger being executed as the subscriber is<br>
// no longer listening<br>
pubsub.publish( "inbox/newMessage", "Hello! are you still there?" );</p>
</code><p><code class=language-javascript></code></pre><p></p>
<p><strong>User Interface Notifications</strong></p>
<p>Real-time stock-price grid update using publishers and subscribers implemented in classic JavaScript.</p>
<pre><code class=language-javascript>
<p>// Return the current local time to be used in our UI later<br>
getCurrentTime = function (){</p>
<p>var date = new Date(),<br>
m = date.getMonth() + 1,<br>
d = date.getDate(),<br>
y = date.getFullYear(),<br>
t = date.toLocaleTimeString().toLowerCase();</p>
<pre><code>    return (m + "/" + d + "/" + y + " " + t);
</code></pre>
<p>};</p>
<p>// Add a new row of data to our fictional grid component<br>
function addGridRow( data ) {</p>
<p>// ui.grid.addRow( data );<br>
console.log( "updated grid component with:" + data );</p>
<p>}</p>
<p>// Update our fictional grid to show the time it was last<br>
// updated<br>
function updateCounter( data ) {</p>
<p>// ui.grid.updateLastChanged( getCurrentTime() );<br>
console.log( "data last updated at: " + getCurrentTime() + " with " + data);</p>
<p>}</p>
<p>// Update the grid using the data passed to our subscribers<br>
gridUpdate = function( topic, data ){</p>
<p>if ( data !== undefined ) {<br>
addGridRow( data );<br>
updateCounter( data );<br>
}</p>
<p>};</p>
<p>// Create a subscription to the newDataAvailable topic<br>
var subscriber = pubsub.subscribe( "newDataAvailable", gridUpdate );</p>
<p>// The following represents updates to our data layer. This could be<br>
// powered by ajax requests which broadcast that new data is available<br>
// to the rest of the application.</p>
<p>// Publish changes to the gridUpdated topic representing new entries<br>
pubsub.publish( "newDataAvailable", {<br>
summary: "Apple made $5 billion",<br>
identifier: "APPL",<br>
stockPrice: 570.91<br>
});</p>
<p>pubsub.publish( "newDataAvailable", {<br>
summary: "Microsoft made $20 million",<br>
identifier: "MSFT",<br>
stockPrice: 30.85<br>
});</p>
</code><p><code class=language-javascript></code></pre><p></p>
<p><strong>Decoupling applications using Ben Alman's Pub/Sub implementation</strong></p>
<pre><code class=language-javascript>
;(function( $ ) {
<p>// Pre-compile templates and "cache" them using closure<br>
var<br>
userTemplate = _.template($( "#userTemplate" ).html()),<br>
ratingsTemplate = _.template($( "#ratingsTemplate" ).html());</p>
<p>// Subscribe to the new user topic, which adds a user<br>
// to a list of users who have submitted reviews<br>
$.subscribe( "/new/user", function( e, data ){</p>
<pre><code>if( data ){

  $('#users').append( userTemplate( data ));

}
</code></pre>
<p>});</p>
<p>// Subscribe to the new rating topic. This is composed of a title and<br>
// rating. New ratings are appended to a running list of added user<br>
// ratings.<br>
$.subscribe( "/new/rating", function( e, data ){</p>
<pre><code>if( data ){

  $( "#ratings" ).append( ratingsTemplate( data ) );

}
</code></pre>
<p>});</p>
<p>// Handler for adding a new user<br>
$("#add").on("click", function( e ) {</p>
<pre><code>e.preventDefault();

var strUser = $("#twitter_handle").val(),
   strMovie = $("#movie_seen").val(),
   strRating = $("#movie_rating").val();

// Inform the application a new user is available
$.publish( "/new/user", { name: strUser } );

// Inform the app a new rating is available
$.publish( "/new/rating", { title: strMovie, rating: strRating} );

});
</code></pre>
<p>})( jQuery );</p>
</code><p><code class=language-javascript></code></pre><p></p>
<p><strong>Decoupling an Ajax-based jQuery application</strong></p>
<pre><code class=language-javascript>
;(function( $ ) {
<p>// Pre-compile template and "cache" it using closure<br>
var resultTemplate = _.template($( "#resultTemplate" ).html());</p>
<p>// Subscribe to the new search tags topic<br>
$.subscribe( "/search/tags", function( e, tags ) {<br>
$( "#lastQuery" )<br>
.html("Searched for:" + tags);<br>
});</p>
<p>// Subscribe to the new results topic<br>
$.subscribe( "/search/resultSet", function( e, results ){</p>
<pre><code>   $( "#searchResults" ).empty().append(resultTemplate( results ));
</code></pre>
<p>});</p>
<p>// Submit a search query and publish tags on the /search/tags topic<br>
$( "#flickrSearch" ).submit( function( e ) {</p>
<pre><code>   e.preventDefault();
   var tags = $(this).find( "#query").val();

   if ( !tags ){
    return;
   }

   $.publish( "/search/tags", [ $.trim(tags) ]);
</code></pre>
<p>});</p>
<p>// Subscribe to new tags being published and perform<br>
// a search query using them. Once data has returned<br>
// publish this data for the rest of the application<br>
// to consume</p>
<p>$.subscribe("/search/tags", function( e, tags ) {</p>
<pre><code>   $.getJSON( "http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?", {
          tags: tags,
          tagmode: "any",
          format: "json"
        },

      function( data ){

          if( !data.items.length ) {
            return;
          }

          $.publish( "/search/resultSet", { items: data.items } );
   });
</code></pre>
<p>});</p>
</code><p><code class=language-javascript>})( jQuery );<br>
</code></pre><p></p>
</details>
</details></code></pre></section><code class=language-javascript><section><h2 id=mediatorpatternjavascript><a href=#mediatorpatternjavascript class=subhead-link>#</a> The Mediator Pattern</h2><p>The Mediator Pattern is a design pattern that allows one object to notify a set of other objects when an event occurs. The difference between the Mediator and Observer patterns are that the Mediator pattern allows one object to be notified of events that occur in other objects, while the Observer pattern allows one object to subscribe to multiple events that occur in other objects.<p>In the section on the Observer pattern, we were introduced to a way of channeling multiple event sources through a single object. This is also known as Publish/Subscribe or Event Aggregation. It's common for developers to think of Mediators when faced with this problem, so let's explore how they differ.<p>The dictionary refers to a mediator as <i>a neutral party that assists in negotiations and conflict resolution</i>. In our world, a mediator is a behavioral design pattern that allows us to expose a unified interface through which the different parts of a system may communicate.<p>If it appears a system has too many direct relationships between components, it may be time to have a central point of control that components communicate through instead. The Mediator promotes loose coupling by ensuring that instead of components referring to each other explicitly, their interaction is handled through this central point. This can help us decouple systems and improve the potential for component reusability.<p>A real-world analogy could be a typical airport traffic control system. A tower (Mediator) handles what planes can take off and land because all communications (notifications being listened out for or broadcast) are done from the planes to the control tower, rather than from plane-to-plane. A centralized controller is key to the success of this system and that's really the role a Mediator plays in software design.<p>Another analogy would be DOM event bubbling and event delegation. If all subscriptions in a system are made against the document rather than individual nodes, the document effectively serves as a Mediator. Instead of binding to the events of the individual nodes, a higher-level object is given the responsibility of notifying subscribers about interaction events.<p>When it comes to the Mediator and Event Aggregator patterns, there are some times where it may look like the patterns are interchangeable due to implementation similarities. However, the semantics and intent of these patterns are very different.<p>And even if the implementations both use some of the same core constructs, I believe there is a distinct difference between them. I also believe they should not be interchanged or confused in communication because of the differences.<p><strong>A Simple Mediator</strong><p>A Mediator is an object that coordinates interactions (logic and behavior) between multiple objects. It makes decisions on when to call which objects, based on the actions (or inaction) of other objects and input.<p>You can write a mediator using a single line of code:<pre><code class=language-javascript>
// We used keyword const for immutable constant declaration

const mediator = {};
</code></pre><p>Yes, of course, this is just an object literal in JavaScript. Once again, we’re talking about semantics here. The purpose of the mediator is to control the workflow between objects and we really don’t need anything more than an object literal to do this.<p>The following example shows a very basic implementation of a mediator object with some utility methods that can trigger and subscribe to events. The <code>orgChart</code> object here is a mediator that assigns actions to be taken on the occurrence of a particular event. Here, on completing the details of a new employee, a manager is assigned to the employee and the employee record is saved.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, arrow function syntax

const orgChart = {
    addNewEmployee() {
        // getEmployeeDetail provides a view that users interact with
        const employeeDetail = this.getEmployeeDetail();

        // when the employee detail is complete, the mediator (the 'orgchart' object)
        // decides what should happen next
        employeeDetail.on('complete', employee => {
            // set up additional objects that have additional events, which are used
            // by the mediator to do additional things
            const managerSelector = this.selectManager(employee);
            managerSelector.on('save', employee => {
                employee.save();
            });
        });
    },

    // ...
};
</code></pre><p>I’ve often referred to this type of object as a “workflow” object in the past, but the truth is that it is a mediator. It is an object that handles the workflow between many other objects, aggregating the responsibility of that workflow knowledge into a single object. The result is a workflow that is easier to understand and maintain.<h5>Similarities And Differences</h5><p>There are, without a doubt, similarities between the event aggregator and mediator examples that I’ve shown here. The similarities boil down to two primary items: events and third-party objects. These differences are superficial at best, though. When we dig into the intent of the pattern and see that the implementations can be dramatically different, the nature of the patterns becomes more apparent.<h6>Events</h6><p>Both the event aggregator and mediator use events, in the above examples. An event aggregator obviously deals with events – it’s in the name after all. The mediator only uses events because it makes life easy when dealing with modern JavaScript webapp frameworks. There is nothing that says a mediator must be built with events. You can build a mediator with callback methods, by handing the mediator reference to the child object, or by any of the several other means.<p>The difference, then, is why these two patterns are both using events. The event aggregator, as a pattern, is designed to deal with events. The mediator, though, only uses them because it’s convenient.<h6>Third-Party Objects</h6><p>Both the event aggregator and mediator, by design, use a third-party object to facilitate things. The event aggregator itself is a third-party to the event publisher and the event subscriber. It acts as a central hub for events to pass through. The mediator is also a third party to other objects, though. So where is the difference? Why don’t we call an event aggregator a mediator? The answer largely comes down to where the application logic and workflow is coded.<p>In the case of an event aggregator, the third-party object is there only to facilitate the pass-through of events from an unknown number of sources to an unknown number of handlers. All workflow and business logic that needs to be kicked off is put directly into the object that triggers the events and the objects that handle the events.<p>In the case of the mediator, though, the business logic and workflow is aggregated into the mediator itself. The mediator decides when an object should have its methods called and attributes updated based on factors that the mediator knows about. It encapsulates the workflow and process, coordinating multiple objects to produce the desired system behaviour. The individual objects involved in this workflow each know how to perform their own task. But it’s the mediator that tells the objects when to perform the tasks by making decisions at a higher-level than the individual objects.<p>An event aggregator facilitates a “fire and forget” model of communication. The object triggering the event doesn’t care if there are any subscribers. It just fires the event and moves on. A mediator, though, might use events to make decisions, but it is definitely not “fire and forget”. A mediator pays attention to a known set of input or activities so that it can facilitate and coordinate additional behavior with a known set of actors (objects).<h5>Relationships: When To Use Which</h5><p>Understanding the similarities and differences between an event aggregator and a mediator is important for semantic reasons. It’s equally as important to understand when to use which pattern, though. The basic semantics and intent of the patterns does inform the question of when, but actual experience in using the patterns will help you understand the more subtle points and nuanced decisions that have to be made.<h6>Event Aggregator Use</h6><p>In general, an event aggregator is used when you either have too many objects to listen to directly, or you have objects that are entirely unrelated.<p>When two objects have a direct relationship already – say, a parent view and child view – there may be a benefit in using an event aggregator. Have the child view trigger an event and the parent view can handle the event. In JavaScript framework terms, this is most commonly seen in Backbone’s Collection and Model, where all Model events are bubbled up to and through its parent Collection. A Collection often uses model events to modify the state of itself or other models. Handling “selected” items in a collection is a good example of this.<p>jQuery’s on method as an event aggregator is a great example of too many objects to listen to. If you have 10, 20, or 200 DOM elements that can trigger a “click” event, it might be a bad idea to set up a listener on all of them individually. This could quickly deteriorate the performance of the application and user experience. Instead, using jQuery’s on method allows us to aggregate all of the events and reduce the overhead of 10, 20, or 200 event handlers down to 1.<p>Indirect relationships are also a great time to use event aggregators. In modern applications, it is very common to have multiple view objects that need to communicate, but have no direct relationship. For example, a menu system might have a view that handles the menu item clicks. But we don’t want the menu to be directly tied to the content views that show all of the details and information when a menu item is clicked. Having the content and menu coupled together would make the code very difficult to maintain, in the long run. Instead, we can use an event aggregator to trigger “menu:click:foo” events, and have a “foo” object handle the click event to show its content on the screen.<h6>Mediator Use</h6><p>A mediator is best applied when two or more objects have an indirect working relationship, and business logic or workflow needs to dictate the interactions and coordination of these objects.<p>A wizard interface is a good example of this, as shown with the “orgChart” example, above. There are multiple views that facilitate the entire workflow of the wizard. Rather than tightly coupling the view together by having them reference each other directly, we can decouple them and more explicitly model the workflow between them by introducing a mediator.<p>The mediator extracts the workflow from the implementation details and creates a more natural abstraction at a higher-level, showing us at a much faster glance what that workflow is. We no longer have to dig into the details of each view in the workflow, to see what the workflow actually is.<h5>Event Aggregator (Pub/Sub) And Mediator Together</h5><p>The crux of the difference between an event aggregator and a mediator, and why these pattern names should not be interchanged with each other, is illustrated best by showing how they can be used together. The menu example for an event aggregator is the perfect place to introduce a mediator as well.<p>Clicking a menu item may trigger a series of changes throughout an application. Some of these changes will be independent of others, and using an event aggregator for this makes sense. Some of these changes may be internally related to each other, though, and may use a mediator to enact those changes.<p>A mediator, then, could be set up to listen to the event aggregator. It could run its logic and process to facilitate and coordinate many objects that are related to each other, but unrelated to the original event source.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, class, constructor,
//           arrow function syntax, template literals for string interpolation

const MenuItem = MyFrameworkView.extend({
    events: {
        'click .thatThing': 'clickedIt',
    },

    clickedIt(e) {
        e.preventDefault();

        // assume this triggers "menu:click:foo"
        MyFramework.trigger(`menu:click:${this.model.get('name')}`);
    },
});

// ... somewhere else in the app

class MyWorkflow {
    constructor() {
        MyFramework.on('menu:click:foo', this.doStuff, this);
    }

    // The static keyword defines a static method for a class.
    // Static methods are called without instantiating their class and cannot be called through a class instance.
    //  Static methods are often used to create utility functions for an application.
    static doStuff() {
        // instantiate multiple objects here.
        // set up event handlers for those objects.
        // coordinate all of the objects into a meaningful workflow.
    }
}
</code></pre><p>In this example, when the MenuItem with the right model is clicked, the <code>“menu:click:foo”</code> event will be triggered. An instance of the “MyWorkflow” <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>class</a>, will handle this specific event and will coordinate all of the objects that it knows about, to create the desired user experience and workflow.<p>An event aggregator and a mediator have been combined to create a much more meaningful experience in both the code and the application itself. We now have a clean separation between the menu and the workflow through an event aggregator and we are still keeping the workflow itself clean and maintainable through the use of a mediator.<details><summary><strong>Mediator Pattern - ES5/Classic Approach</strong></summary>The implementation of the Mediator pattern using classic JavaScript syntax is not very different from ES2015+ syntax. If we replace the keyword <code>const</code> with var and declare classes as functions, we get the ES5 compatible syntax for the pattern.<p><p><strong>Mediator Declaration</strong><pre><code class=language-javascript>
var mediator = {};
</code></pre><p><strong>Mediator Org Chart for new Employee Workflow</strong><pre><code class=language-javascript>
var orgChart = {
<p>addNewEmployee: function(){</p>
<p>The mediator extracts the workflow from the implementation details and creates a more natural abstraction at a higher-level, showing us at a much faster glance what that workflow is. We no longer have to dig into the details of each view in the workflow, to see what the workflow actually is.</p>
<pre><code>// when the employee detail is complete, the mediator (the 'orgchart' object)
// decides what should happen next
employeeDetail.on("complete", function(employee){

  // set up additional objects that have additional events, which are used
  // by the mediator to do additional things
  var managerSelector = this.selectManager(employee);
  managerSelector.on("save", function(employee){
    employee.save();
  });

});
</code></pre>
<p>},</p>
<p>// ...<br>
}</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Event Aggregator and Mediator</strong><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, class, constructor,
//           arrow function syntax, template literals for string interpolation
<p>const MenuItem = MyFrameworkView.extend({<br>
events: {<br>
'click .thatThing': 'clickedIt',<br>
},</p>
<pre><code>clickedIt(e) {
    e.preventDefault();

    // assume this triggers "menu:click:foo"
    MyFramework.trigger(`menu:click:${this.model.get('name')}`);
},
</code></pre>
<p>});</p>
<p>// ... somewhere else in the app</p>
<p>class MyWorkflow {<br>
constructor() {<br>
MyFramework.on('menu:click:foo', this.doStuff, this);<br>
}</p>
<pre><code>// The static keyword defines a static method for a class.
// Static methods are called without instantiating their class and cannot be called through a class instance.
//  Static methods are often used to create utility functions for an application.
static doStuff() {
    // instantiate multiple objects here.
    // set up event handlers for those objects.
    // coordinate all of the objects into a meaningful workflow.
}
</code></pre>
</code><p><code class=language-javascript>}<br>
</code></pre><p><p>In this example, when the MenuItem with the right model is clicked, the <code>“menu:click:foo”</code> event will be triggered. An instance of the “MyWorkflow” <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>class</a>, will handle this specific event and will coordinate all of the objects that it knows about, to create the desired user experience and workflow.<p>An event aggregator and a mediator have been combined to create a much more meaningful experience in both the code and the application itself. We now have a clean separation between the menu and the workflow through an event aggregator and we are still keeping the workflow itself clean and maintainable through the use of a mediator.<details><summary><strong>Mediator Pattern - ES5/Classic Approach</strong></summary>The implementation of the Mediator pattern using classic JavaScript syntax is not very different from ES2015+ syntax. If we replace the keyword <code>const</code> with var and declare classes as functions, we get the ES5 compatible syntax for the pattern.<p><p><strong>Mediator Declaration</strong><pre><code class=language-javascript>
var mediator = {};
</code></pre><p><strong>Mediator Org Chart for new Employee Workflow</strong><pre><code class=language-javascript>
var orgChart = {
<p>addNewEmployee: function(){</p>
<pre><code>// getEmployeeDetail provides a view that users interact with
var employeeDetail = this.getEmployeeDetail();

// when the employee detail is complete, the mediator (the 'orgchart' object)
// decides what should happen next
employeeDetail.on("complete", function(employee){

  // set up additional objects that have additional events, which are used
  // by the mediator to do additional things
  var managerSelector = this.selectManager(employee);
  managerSelector.on("save", function(employee){
    employee.save();
  });

});
</code></pre>
<p>},</p>
<p>// ...<br>
}</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Event Aggregator and Mediator</strong><pre><code class=language-javascript>
<p>var MenuItem = MyFrameworkView.extend({</p>
<p>events: {<br>
"click .thatThing": "clickedIt"<br>
},</p>
<p>clickedIt: function(e){<br>
e.preventDefault();</p>
<pre><code>// assume this triggers "menu:click:foo"
MyFramework.trigger("menu:click:" + this.model.get("name"));
</code></pre>
<p>}</p>
<p>});</p>
<p>// ... somewhere else in the app</p>
<p>var MyWorkflow = function(){<br>
MyFramework.on("menu:click:foo", this.doStuff, this);<br>
};</p>
</code><p><code class=language-javascript>MyWorkflow.prototype.doStuff = function(){<br>
// instantiate multiple objects here.<br>
// set up event handlers for those objects.<br>
// coordinate all of the objects into a meaningful workflow.<br>
};<br>
</code></pre><p></details><p><h3 id=advantagesanddisadvantages><a href=#advantagesanddisadvantages class=subhead-link>#</a> Advantages & Disadvantages</h3><p>The largest benefit of the Mediator pattern is that it reduces the communication channels needed between objects or components in a system from many to many to just many to one. Adding new publishers and subscribers is relatively easy due to the level of decoupling present.<p>Perhaps the biggest downside of using the pattern is that it can introduce a single point of failure. Placing a Mediator between modules can also cause a performance hit as they are always communicating indirectly. Because of the nature of loose coupling, it's difficult to establish how a system might react by only looking at the broadcasts.<p>That said, it's useful to remind ourselves that decoupled systems have several other benefits - if our modules communicated with each other directly, changes to modules (e.g another module throwing an exception) could easily have a domino effect on the rest of our application. This problem is less of a concern with decoupled systems.<p>At the end of the day, tight coupling causes all kinds of headaches and this is just another alternative solution, but one that can work very well if implemented correctly.<p></details></section><section><h3 id=mediatorvsfacade><a href=#mediatorvsfacade class=subhead-link>#</a> Mediator Vs. Facade</h3><p>We will be covering the Facade pattern shortly, but for reference purposes, some developers may also wonder whether there are similarities between the Mediator and Facade patterns. They do both abstract the functionality of existing modules, but there are some subtle differences.<p>The Mediator centralizes communication between modules where it's explicitly referenced by these modules. In a sense this is multidirectional. The Facade however just defines a simpler interface to a module or system but doesn't add any additional functionality. Other modules in the system aren't directly aware of the concept of a facade and could be considered unidirectional.</section><p><p> <p> <p><section><h2 id=prototypepatternjavascript><a href=#prototypepatternjavascript class=subhead-link>#</a> The Prototype Pattern</h2><p>The GoF refers to the prototype pattern as one which creates objects based on a template of an existing object through cloning.<p>We can think of the prototype pattern as being based on prototypal inheritance where we create objects which act as prototypes for other objects. The prototype object itself is effectively used as a blueprint for each object the constructor creates. If the prototype of the constructor function used contains a property called <code>name</code> for example (as per the code sample lower down), then each object created by that same constructor will also have this same property.<p>Reviewing the definitions for this pattern in existing (non-JavaScript) literature, we <strong>may</strong> find references to classes once again. The reality is that prototypal inheritance avoids using classes altogether. There isn't a "definition" object nor a core object in theory. We're simply creating copies of existing functional objects.<p>One of the benefits of using the prototype pattern is that we're working with the prototypal strengths JavaScript has to offer natively rather than attempting to imitate features of other languages. With other design patterns, this isn't always the case.<p>Not only is the pattern an easy way to implement inheritance, but it can also come with a performance boost: when defining a function in an object, they're all created by reference (so all child objects point to the same function) instead of creating their own individual copies.<p>With ES2015+ we can use <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>classes</a> and <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/constructor>constructors</a> to create objects. While this ensures that our code looks cleaner and follows OOAD principles, the classes and constructors get compiled down to functions and prototypes internally. This ensures that we are still working with the prototypal strengths of JavaScript and the accompanying performance boost.<p>For those interested, real prototypal inheritance, as defined in the ECMAScript 5 standard, requires the use of <code>Object.create</code> (which we previously looked at earlier in this section). To remind ourselves, <code>Object.create</code> creates an object which has a specified prototype and optionally contains specified properties as well (e.g <code>Object.create( prototype, optionalDescriptorObjects )</code>).<p>We can see this demonstrated in the example below:<pre><code class=language-javascript>
// ES2015+ syntax used: const

const myCar = {
    name: 'Ford Escort',

    drive() {
        console.log("Weeee. I'm driving!");
    },

    panic() {
        console.log('Wait. How do you stop this thing?');
    },
};

// Use Object.create to instantiate a new car
const yourCar = Object.create(myCar);

// Now we can see that one is a prototype of the other
console.log(yourCar.name);

</code></pre><p><p><code>Object.create</code> also allows us to easily implement advanced concepts such as differential inheritance where objects can directly inherit from other objects. Note that, the only ES2015+ keyword used here is <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const>const</a>, which makes myCar a block-scoped read-only constant.<p>We saw earlier that <code>Object.create</code> allows us to initialise object properties using the second supplied argument. For example:<p><pre><code class=language-javascript>
// ES2015+ syntax used: const, template literals for string interpolation

const vehicle = {
    getModel() {
        console.log(`The model of this vehicle is..${this.model}`);
    },
};

const car = Object.create(vehicle, {
    id: {
        value: MY_GLOBAL.nextId(),
        // writable:false, configurable:false by default
        enumerable: true,
    },

    model: {
        value: 'Ford',
        enumerable: true,
    },
});


</code></pre><p><p>Here the properties can be initialized on the second argument of <code>Object.create</code> using an object literal with a syntax similar to that used by the <code>Object.defineProperties</code> and <code>Object.defineProperty</code> methods that we looked at previously.<p>It is worth noting that prototypal relationships can cause trouble when enumerating properties of objects and (as Crockford recommends) wrapping the contents of the loop in a <code>hasOwnProperty()</code> check.<p>If we wish to implement the prototype pattern without directly using <code>Object.create</code>, we can simulate the pattern as per the above example as follows:<p> <p><pre><code class=language-javascript>
// ES2015+ syntax used: const, class, constructor, extends , super

class VehiclePrototype {
    constructor(model) {
        this.model = model;
    }

    getModel() {
        console.log('The model of this vehicle is..' + this.model);
    }

    Clone() {}
}

class Vehicle extends VehiclePrototype {
    constructor(model) {
        super(model);
    }
    Clone() {
        return new Vehicle(this.model);
    }
}

const car = new Vehicle('Ford Escort');
const car2 = car.Clone();
car2.getModel();

</code></pre><p><p><strong>Note:</strong> This alternative does not allow the user to define read-only properties in the same manner (as the vehiclePrototype may be altered if not careful).<p>A final alternative implementation of the Prototype pattern could be the following:<pre><code class=language-javascript>
// ES2015+ syntax used:  const, class, constructor new arrow function syntax
// Object.prototype can be used for adding new methods, because internally we use prototypes.

const beget = (() => {
    class F {
        constructor() {}
    }

    return proto => {
        F.prototype = proto; 
        return new F();
    };
})();

</code></pre><p>One could reference this method from the <code>vehicle</code> class. Note, however that <code>vehicle</code> here is emulating a constructor since the prototype pattern does not include any notion of initialization beyond linking an object to a prototype.<details><summary><strong>Prototype Pattern - ES5/Classic Approach</strong></summary><p>The above can be similarly accomplished in classic Javascript using objects literals, functions, and prototypes which are the base for modern Javascript constructs.<p><strong>Create objects from prototypes</strong><pre><code class=language-javascript>
var myCar = {
<p>name: "Ford Escort",</p>
<p>drive: function () {<br>
console.log( "Weeee. I'm driving!" );<br>
},</p>
<p>panic: function () {<br>
console.log( "Wait. How do you stop this thing?" );<br>
}</p>
<p>};</p>
<p>// Use Object.create to instantiate a new car<br>
var yourCar = Object.create( myCar );</p>
</code><p><code class=language-javascript>// Now we can see that one is a prototype of the other<br>
console.log( <a href=http://yourCar.name>yourCar.name</a> );<br>
</code></pre><p><p><strong>Create with Arguments</strong><pre><code class=language-javascript>
<p>var vehicle = {<br>
getModel: function () {<br>
console.log( "The model of this vehicle is.." + this.model );<br>
}<br>
};</p>
<p>var car = Object.create(vehicle, {</p>
<p>"id": {<br>
value: MY_GLOBAL.nextId(),<br>
// writable:false, configurable:false by default<br>
enumerable: true<br>
},</p>
<p>"model": {<br>
value: "Ford",<br>
enumerable: true<br>
}</p>
<p>});</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Copy prototype from one class to another</strong><pre><code class=language-javascript>
var vehiclePrototype = {
<p>init: function ( carModel ) {<br>
this.model = carModel;<br>
},</p>
<p>getModel: function () {<br>
console.log( "The model of this vehicle is.." + this.model);<br>
}<br>
};</p>
<p>function vehicle( model ) {</p>
<p>function F() {};<br>
F.prototype = vehiclePrototype;</p>
<p>var f = new F();</p>
<p>f.init( model );<br>
return f;</p>
<p>}</p>
<p>var car = vehicle( "Ford Escort" );<br>
car.getModel();</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Prototype as Argument</strong><pre><code class=language-javascript>
var beget = (function () {
<pre><code>function F() {}

return function ( proto ) {
    F.prototype = proto;
    return new F();
};
</code></pre>
</code><p><code class=language-javascript>})();<br>
</code></pre><p></details></section><p> <section><h2 id=commandpatternjavascript><a href=#commandpatternjavascript class=subhead-link>#</a> The Command Pattern</h2><p>The Command pattern aims to encapsulate method invocation, requests, or operations into a single object and gives us the ability to both parameterize and pass method calls around that can be executed at our discretion. In addition, it enables us to decouple objects invoking the action from the objects which implement them, giving us a greater degree of overall flexibility in swapping out concrete <em>classes</em> (objects).<p><em>Concrete</em> classes are best explained in terms of class-based programming languages and are related to the idea of abstract classes. An <em>abstract</em> class defines an interface but doesn't necessarily provide implementations for all of its member functions. It acts as a base class from which others are derived. A derived class that implements the missing functionality is called a <em>concrete</em> class. Base classes and concrete classes can be implemented in JavaScript(ES2015+) using the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/extends>extends</a> keyword applicable to the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>JavaScript classes</a>.<p>The general idea behind the Command pattern is that it provides us a means to separate the responsibilities of issuing commands from anything executing commands, delegating this responsibility to different objects instead.<p>Implementation-wise, simple command objects bind together both an action and the object wishing to invoke the action. They consistently include an execution operation (such as <code>run()</code> or <code>execute()</code>). All Command objects with the same interface can easily be swapped as needed and this is considered one of the larger benefits of the pattern.<p>To demonstrate the Command pattern we're going to create a simple car purchasing service.<p><pre><code class=language-javascript>
//********************** Snippet 1 **********************//
// ES2015+ Keywords/syntax used: const, template literals for string interpolation
//               new arrow function syntax


    const carManager = {
        // request information
        requestInfo(model, id) {
            return `The information for ${model} with ID ${id} is foobar`;
        },

        // purchase the car
        buyVehicle(model, id) {
            return `You have successfully purchased Item ${id}, a ${model}`;
        },

        // arrange a viewing
        arrangeViewing(model, id) {
            return `You have successfully booked a viewing of ${model} ( ${id} ) `;
        },
    };

</code></pre><p>Syntactically, here we have defined a function using <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions>arrow function</a> syntax. It exposes a <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const>constant</a> object carManager, which is our command object responsible for issuing commands to request information about a car, buy a car, and arrange a viewing.<p><p>Taking a look at the above code, it would be trivial to invoke our <code>carManager</code> methods by directly accessing the object. We would all be forgiven for thinking there is nothing wrong with this - technically, it's completely valid JavaScript. There are however scenarios where this may be disadvantageous.<p>For example, imagine if the core API behind the <code>carManager</code> changed. This would require all objects directly accessing these methods within our application to also be modified. This could be viewed as a layer of coupling that effectively goes against the OOP methodology of loosely coupling objects as much as possible. Instead, we could solve this problem by abstracting the API away further.<p>Let's now expand on our <code>carManager</code> so that our application of the Command pattern results in the following: accept any named methods that can be performed on the <code>carManager</code> object, passing along any data that might be used such as the Car model and ID.<p>Here is what we would like to be able to achieve:<p><pre><code class=language-javascript>
carManager.execute('buyVehicle', 'Ford Escort', '453543');
</code></pre><p><p>As per this structure we should now add a definition for the <code>carManager.execute</code> method as follows:<p><pre><code class=language-javascript>
carManager.execute = function(name) {
    return (
        carManager[name] &&
        carManager[name].apply(carManager, [].slice.call(arguments, 1))
    );
};
</code></pre><p><p>Our final sample calls would thus look as follows:<p><pre><code class=language-javascript>
carManager.execute('arrangeViewing', 'Ferrari', '14523');
carManager.execute('requestInfo', 'Ford Mondeo', '54323');
carManager.execute('requestInfo', 'Ford Escort', '34232');
carManager.execute('buyVehicle', 'Ford Escort', '34232');
</code></pre><p><p> <details><summary><strong>Command Pattern - ES5/Classic Approach</strong></summary><p>Since classic JS did not support arrow function syntax and constants, the function in our first example can be defined as follows. The rest of the code for the command pattern given above would be the same in ES5 implementation.<pre><code class=language-javascript>
(function(){
<p>var carManager = {</p>
<pre><code>// request information
requestInfo: function( model, id ){
  return "The information for " + model + " with ID " + id + " is foobar";
},

// purchase the car
buyVehicle: function( model, id ){
  return "You have successfully purchased Item " + id + ", a " + model;
},

// arrange a viewing
arrangeViewing: function( model, id ){
  return "You have successfully booked a viewing of " + model + " ( " + id + " ) ";
}
</code></pre>
<p>};</p>
</code><p><code class=language-javascript>})();<br>
</code></pre><p></details></section><p> <section><h2 id=facadepatternjavascript><a href=#facadepatternjavascript class=subhead-link>#</a> The Facade Pattern</h2><h3>Notes on abstraction</h3><p>Facades are a structural pattern that can often be seen in JavaScript libraries like jQuery where, although an implementation may support methods with a wide range of behaviors, only a "facade" or limited abstraction of these methods is presented to the public for use.<p>Did you know however that <code>getElementById()</code> on its own is significantly faster by a high order of magnitude? Take a look at this jsPerf test to see results on a per-browser level: <a href=http://jsperf.com/getelementbyid-vs-jquery-id>http://jsperf.com/getelementbyid-vs-jquery-id</a>. Now, of course, we have to keep in mind that jQuery (and Sizzle - its selector engine) are doing a lot more behind the scenes to optimize our query (and that a jQuery object, not just a DOM node is returned).<p>The challenge with this particular Facade is that to provide an elegant selector function capable of accepting and parsing multiple types of queries, there is an implicit cost of abstraction. The user isn't required to access <code>jQuery.getById("identifier")</code> or <code>jQuery.getByClass("identifier")</code> and so on. That said, the trade-off in performance has been tested in practice over the years and given the success of jQuery, a simple Facade actually worked out very well for the team.<p>When using the pattern, try to be aware of any performance costs involved and make a call on whether they are worth the level of abstraction offered.<details><summary><strong>Facade Pattern - ES5/Classic Approach</strong></summary><p>The examples for the Facade Pattern can be coded using ES5 or classic JavaScript syntax with minor changes like replacing constants, method definitions, arrow functions expressions, and modules import/export with their ES5 counterparts.<p><strong>Event Handler Facade</strong><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, arrow function syntax
</code><p><code class=language-javascript>const addMyEvent = (el, ev, fn) => {<br>
if (el.addEventListener) {<br>
el.addEventListener(ev, fn, false);<br>
} else if (el.attachEvent) {<br>
el.attachEvent(<code>on${ev}</code>, fn);<br>
} else {<br>
el[<code>on${ev}</code>] = fn;<br>
}<br>
};<br>
</code></pre><p><p>The above code uses ES2015+ syntax to define a <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const>constant</a> function using <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions>arrow function expressions</a>. The addEventListener, attachEvent, or on[Event] functions are used to attach the event handler depending on what is supported by the browser.<p>In a similar manner, we're all familiar with jQuery's <code>$(document).ready(..)</code>. Internally, this is actually being powered by a method called <code>bindReady()</code>, which is doing this:<pre><code class=language-javascript>
//ES2015+ syntax used: Shorter method definitions.
function bindReady() {
    // ...
    if (document.addEventListener) {
        // Use the handy event callback
        document.addEventListener('DOMContentLoaded', DOMContentLoaded, false);

        // A fallback to window.onload, that will always work
        window.addEventListener('load', jQuery.ready, false);

        // If IE event model is used
    } else if (document.attachEvent) {

        document.attachEvent('onreadystatechange', DOMContentLoaded);

        // A fallback to window.onload, that will always work
        window.attachEvent('onload', jQuery.ready);
    }
}
</code></pre><p>This is another example of a Facade, where the rest of the world simply uses the limited interface exposed by <code>$(document).ready(..)</code> and the more complex implementation powering it is kept hidden from sight.<p>Facades don't just have to be used on their own, however. They can also be integrated with other patterns such as the Module pattern. As we can see below, our instance of the module patterns contains several methods which have been privately defined. A Facade is then used to supply a much simpler API to accessing these methods:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: import, export
//        destructuring assignment syntax
const _private = {
    i: 5,
    get() {
      console.log(`current value:${this.i}`);
    },
    set(val) {
      this.i = val;
    },
    run() {
      console.log('running');
    },
    jump() {
      console.log('jumping');
    },
  };
  
  // We used the destructuring assignment syntax that makes it possible to unpack values from data structures into distinct variables.
  const module = {
    facade({ val, run }) {
      _private.set(val);
      _private.get();
      if (run) {
        _private.run();
      }
    },
  };
 
  export default module;
  
  import module from './module.js';
  // Outputs: "current value: 10" and "running"
  module.facade({
    run: true,
    val: 10,
  });

</code></pre><p>Here, we <a href=https://developer.mozilla.org/en-US/docs/web/javascript/reference/statements/export>export</a> the object <code>module</code> which contains the definition of our facade. The facade may be invoked using "run" or "jump" in the arguments. We used <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment>destructuring assignment syntax</a> to unpack the values from the arguments to the facade input variables. The sample call to the facade <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import>imports</a> the module to use it.<p>Calling <code>module.facade()</code> will actually trigger a set of private behavior within the module, but again, the user isn't concerned with this. we've made it much easier for them to consume a feature without needing to worry about implementation-level details.<h3>Notes on abstraction</h3><p>Facades generally have few disadvantages, but one concern worth noting is performance. Namely, one must determine whether there is an implicit cost to the abstraction a Facade offers to our implementation and if so, whether this cost is justifiable. Going back to the jQuery library, most of us are aware that both <code>getElementById("identifier")</code> and <code>$("#identifier")</code> can be used to query an element on a page by its ID.<p>Did you know however that <code>getElementById()</code> on its own is significantly faster by a high order of magnitude? Take a look at this jsPerf test to see results on a per-browser level: <a href=http://jsperf.com/getelementbyid-vs-jquery-id>http://jsperf.com/getelementbyid-vs-jquery-id</a>. Now, of course, we have to keep in mind that jQuery (and Sizzle - its selector engine) are doing a lot more behind the scenes to optimize our query (and that a jQuery object, not just a DOM node is returned).<p>The challenge with this particular Facade is that to provide an elegant selector function capable of accepting and parsing multiple types of queries, there is an implicit cost of abstraction. The user isn't required to access <code>jQuery.getById("identifier")</code> or <code>jQuery.getByClass("identifier")</code> and so on. That said, the trade-off in performance has been tested in practice over the years and given the success of jQuery, a simple Facade actually worked out very well for the team.<p>When using the pattern, try to be aware of any performance costs involved and make a call on whether they are worth the level of abstraction offered.<details><summary><strong>Facade Pattern - ES5/Classic Approach</strong></summary><p>The examples for the Facade Pattern can be coded using ES5 or classic JavaScript syntax with minor changes like replacing constants, method definitions, arrow functions expressions, and modules import/export with their ES5 counterparts.<p><strong>Event Handler Facade</strong><pre><code class=language-javascript>
var addMyEvent = function( el,ev,fn ){
<p>if( el.addEventListener ){<br>
el.addEventListener( ev,fn, false );<br>
}else if(el.attachEvent){<br>
el.attachEvent( "on" + ev, fn );<br>
} else{<br>
el["on" + ev] = fn;<br>
}</p>
</code><p><code class=language-javascript>};<br>
</code></pre><p></details><p><strong>jQuery Equivalent for Event Handling Facade</strong><pre><code class=language-javascript>
bindReady: function() {
    ...
    if ( document.addEventListener ) {
      // Use the handy event callback
      document.addEventListener( "DOMContentLoaded", DOMContentLoaded, false );
<pre><code>  // A fallback to window.onload, that will always work
  window.addEventListener( "load", jQuery.ready, false );

// If IE event model is used
} else if ( document.attachEvent ) {

  document.attachEvent( "onreadystatechange", DOMContentLoaded );

  // A fallback to window.onload, that will always work
  window.attachEvent( "onload", jQuery.ready );
           ...
</code></pre>
</code><p><code class=language-javascript></code></pre><p><p><strong>Facade with Module</strong><pre><code class=language-javascript>
var module = (function() {
<pre><code>var _private = {
    i: 5,
    get: function() {
        console.log( "current value:" + this.i);
    },
    set: function( val ) {
        this.i = val;
    },
    run: function() {
        console.log( "running" );
    },
    jump: function(){
        console.log( "jumping" );
    }
};

return {

    facade: function( args ) {
        _private.set(args.val);
        _private.get();
        if ( args.run ) {
            _private.run();
        }
    }
};
</code></pre>
<p>}());</p>
</code><p><code class=language-javascript>// Outputs: "current value: 10" and "running"<br>
module.facade( {run: true, val: 10} );<br>
</code></pre><p></details></section></code><section><code class=language-javascript><p> <h2 id=factorypatternjavascript><a href=#factorypatternjavascript class=subhead-link>#</a> The Factory Pattern</h2><pre><code>    return abstractVehicleFactory;
}
</code></pre><p>}<p>// Usage:<p>abstractVehicleFactory.registerVehicle('car', Car);<br>abstractVehicleFactory.registerVehicle('truck', Truck);<p>// Instantiate a new car based on the abstract vehicle type<br>const car = abstractVehicleFactory.getVehicle('car', {<br>color: 'lime green',<br>state: 'like new',<br>});<p>// Instantiate a new truck in a similar manner<br>const truck = abstractVehicleFactory.getVehicle('truck', {<br>wheelSize: 'medium',<br>color: 'neon yellow',<br>});</code><p><code class=language-javascript></code><p>Note, the use of the static keyword to define static methods in the class. Static methods are called without instantiating their class and cannot be called through a class instance. Static methods are often used to create utility functions for an application.<details><summary><strong>Factory Pattern - ES5/Classic Approach</strong></summary><p>The Factory pattern can be implemented using classic JavaScript by using functions and prototypes to implement classes and constructors. Following is the code corresponding to the examples discussed earlier:<p><strong>Simple Vehicle Factory Example</strong><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, const, 
//               destructuring assignment syntax 
<p>// Types.js - Constructors used behind the scenes</p>
<p>// A constructor for defining new cars<br>
class Car {<br>
constructor({<br>
doors,<br>
state,<br>
color<br>
}) {<br>
// some defaults<br>
this.doors = doors || 4;<br>
this.state = state || 'brand new';<br>
this.color = color || 'silver';<br>
}<br>
}<br>
// A constructor for defining new trucks<br>
class Truck {<br>
constructor({<br>
state,<br>
wheelSize,<br>
color<br>
}) {<br>
this.state = state || 'used';<br>
this.wheelSize = wheelSize || 'large';<br>
this.color = color || 'blue';<br>
}<br>
}</p>
<p>// FactoryExample.js</p>
<p>// Define a vehicle factory<br>
class VehicleFactory {<br>
// Define the prototypes and utilities for this factory</p>
<pre><code>// Our default vehicleClass is Car
constructor() {
    this.vehicleClass = Car;
}
// Our Factory method for creating new Vehicle instances
createVehicle(options) {
    switch (options.vehicleType) {
        case 'car':
            this.vehicleClass = Car;
            break;
        case 'truck':
            this.vehicleClass = Truck;
            break;
            //defaults to VehicleFactory.prototype.vehicleClass (Car)
    }

    return new this.vehicleClass(options);
}
</code></pre>
<p>}</p>
<p>// Create an instance of our factory that makes cars<br>
const carFactory = new VehicleFactory();<br>
const car = carFactory.createVehicle({<br>
vehicleType: 'car',<br>
color: 'yellow',<br>
doors: 6,<br>
});</p>
<p>// Test to confirm our car was created using the vehicleClass/prototype Car</p>
<p>// Outputs: true<br>
console.log(car instanceof Car);</p>
</code><p><code class=language-javascript>// Outputs: Car object of color "yellow", doors: 6 in a "brand new" state<br>
console.log(car);<br>
</code></pre><p><p>Here, the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>classes</a> car and truck are defined with <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/constructor>constructors</a> that set properties relevant to the respective vehicle. The VehicleFactory can create a new vehicle object, car, or truck based on the vehicleType passed.<p>There are two possible approaches to building trucks using the VehicleFactory class<p><strong>Approach #1: Modify a VehicleFactory instance to use the Truck class</strong><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const

const movingTruck = carFactory.createVehicle({
    vehicleType: 'truck',
    state: 'like new',
    color: 'red',
    wheelSize: 'small',
});

// Test to confirm our truck was created with the vehicleClass/prototype Truck

// Outputs: true
console.log(movingTruck instanceof Truck);

// Outputs: Truck object of color "red", a "like new" state
// and a "small" wheelSize
console.log(movingTruck);
</code></pre><p><p><strong>Subclass TruckFactory from VehicleFactory</strong><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, extends, const, constructor, super()
<p>class TruckFactory extends VehicleFactory {<br>
constructor() {<br>
super();<br>
this.vehicleClass = Truck;<br>
}<br>
}<br>
const truckFactory = new TruckFactory();<br>
const myBigTruck = truckFactory.createVehicle({<br>
state: 'omg..so bad.',<br>
color: 'pink',<br>
wheelSize: 'so big',<br>
});</p>
<p>// Confirms that myBigTruck was created with the prototype Truck<br>
// Outputs: true<br>
console.log(myBigTruck instanceof Truck);</p>
</code><p><code class=language-javascript>// Outputs: Truck object with the color "pink", wheelSize "so big"<br>
// and state "omg. so bad"<br>
console.log(myBigTruck);<br>
</code></pre><p><p>Here we use the ES2015+ keyword <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/extends>extends</a> to extend to create a subclass TruckFactory from VehicleFactory. Note, how the TruckFactory class calls the constructor of the parent class using the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/super>super</a> keyword to refer to the parent class.<p> <h3>When To Use The Factory Pattern</h3><p>The Factory pattern can be especially useful when applied to the following situations:<ul><li>When our object or component setup involves a high level of complexity<li>When we need to easily generate different instances of objects depending on the environment we are in<li>When we're working with many small objects or components that share the same properties<li>When composing objects with instances of other objects that need only satisfy an API contract (aka, duck typing) to work. This is useful for decoupling.</ul><p><p> <h3>When Not To Use The Factory Pattern</h3><p>When applied to the wrong type of problem, this pattern can introduce an unnecessarily great deal of complexity to an application. Unless providing an interface for object creation is a design goal for the library or framework we are writing, I would suggest sticking to explicit constructors to avoid the unnecessary overhead.<p>Since the process of object creation is effectively abstracted behind an interface, this can also introduce problems with unit testing depending on just how complex this process might be.<h3>Abstract Factories</h3><p>It is also useful to be aware of the <strong>Abstract Factory</strong> pattern, which aims to encapsulate a group of individual factories with a common goal. It separates the details of the implementation of a set of objects from their general usage.<p>An Abstract Factory should be used where a system must be independent of the way the objects it creates are generated or it needs to work with multiple types of objects.<p>An example that is both simple and easier to understand is a vehicle factory, which defines ways to get or register vehicles types. The abstract factory can be named abstractVehicleFactory. The Abstract factory will allow the definition of types of vehicle like "car" or "truck" and concrete factories will implement only classes that fulfill the vehicle contract (e.g <code>Vehicle.prototype.drive</code> and <code>Vehicle.prototype.breakDown</code>).<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, static, const

class AbstractVehicleFactory {
    constructor() {
        // Storage for our vehicle types
        this.types = {};
    }

    static getVehicle(type, customizations) {
        const Vehicle = this.types[type];

        return Vehicle ? new Vehicle(customizations) : null;
    }

    static registerVehicle(type, Vehicle) {
        const proto = Vehicle.prototype;

        // only register classes that fulfill the vehicle contract
        if (proto.drive && proto.breakDown) {
            this.types[type] = Vehicle;
        }

        return abstractVehicleFactory;
    }
}

// Usage:

abstractVehicleFactory.registerVehicle('car', Car);
abstractVehicleFactory.registerVehicle('truck', Truck);

// Instantiate a new car based on the abstract vehicle type
const car = abstractVehicleFactory.getVehicle('car', {
    color: 'lime green',
    state: 'like new',
});

// Instantiate a new truck in a similar manner
const truck = abstractVehicleFactory.getVehicle('truck', {
    wheelSize: 'medium',
    color: 'neon yellow',
});

</code></pre><p>Note, the use of the static keyword to define static methods in the class. Static methods are called without instantiating their class and cannot be called through a class instance. Static methods are often used to create utility functions for an application.<details><summary><strong>Factory Pattern - ES5/Classic Approach</strong></summary><p>The Factory pattern can be implemented using classic JavaScript by using functions and prototypes to implement classes and constructors. Following is the code corresponding to the examples discussed earlier:<p><strong>Simple Vehicle Factory Example</strong><pre><code class=language-javascript>
// Types.js - Constructors used behind the scenes
<p>// A constructor for defining new cars<br>
function Car({<br>
doors,<br>
state,<br>
color<br>
}) {</p>
<pre><code>// some defaults
this.doors = doors || 4;
this.state = state || "brand new";
this.color = color || "silver";
</code></pre>
<p>}</p>
<p>// A constructor for defining new trucks<br>
function Truck({<br>
state,<br>
wheelSize,<br>
color<br>
}) {</p>
<pre><code>this.state = state || "used";
this.wheelSize = wheelSize || "large";
this.color = color || "blue";
</code></pre>
<p>}</p>
<p>// FactoryExample.js</p>
<p>// Define a skeleton vehicle factory<br>
class VehicleFactory {<br>
// Our Factory method for creating new Vehicle instances<br>
createVehicle(options) {</p>
<pre><code>    switch (options.vehicleType) {
        case "car":
            this.vehicleClass = Car;
            break;
        case "truck":
            this.vehicleClass = Truck;
            break;
            //defaults to VehicleFactory.prototype.vehicleClass (Car)
    }

    return new this.vehicleClass(options);

}
</code></pre>
<p>}</p>
<p>// Define the prototypes and utilities for this factory</p>
<p>// Our default vehicleClass is Car<br>
VehicleFactory.prototype.vehicleClass = Car;</p>
<p>// Create an instance of our factory that makes cars<br>
const carFactory = new VehicleFactory();<br>
const car = carFactory.createVehicle({<br>
vehicleType: "car",<br>
color: "yellow",<br>
doors: 6<br>
});</p>
<p>// Test to confirm our car was created using the vehicleClass/prototype Car</p>
<p>// Outputs: true<br>
console.log(car instanceof Car);</p>
</code><p><code class=language-javascript>// Outputs: Car object of color "yellow", doors: 6 in a "brand new" state<br>
console.log(car);<br>
</code></pre><p><p><strong>Modify VehicleFactory to create Trucks</strong><pre><code class=language-javascript>
var movingTruck = carFactory.createVehicle( {
                      vehicleType: "truck",
                      state: "like new",
                      color: "red",
                      wheelSize: "small" } );
<p>// Test to confirm our truck was created with the vehicleClass/prototype Truck</p>
<p>// Outputs: true<br>
console.log( movingTruck instanceof Truck );</p>
<p>// Outputs: Truck object of color "red", a "like new" state<br>
// and a "small" wheelSize<br>
console.log( movingTruck );</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Subclass TruckFactory from VehicleFactory</strong><pre><code class=language-javascript>
function TruckFactory () {}
TruckFactory.prototype = new VehicleFactory();
TruckFactory.prototype.vehicleClass = Truck;
<p>var truckFactory = new TruckFactory();<br>
var myBigTruck = truckFactory.createVehicle( {<br>
state: "omg..so bad.",<br>
color: "pink",<br>
wheelSize: "so big" } );</p>
<p>// Confirms that myBigTruck was created with the prototype Truck<br>
// Outputs: true<br>
console.log( myBigTruck instanceof Truck );</p>
<p>// Outputs: Truck object with the color "pink", wheelSize "so big"<br>
// and state "omg. so bad"<br>
console.log( myBigTruck );</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Abstract Factory Pattern</strong><pre><code class=language-javascript>
var abstractVehicleFactory = (function () {

  // Storage for our vehicle types
  var types = {};

  return {
      getVehicle: function ( type, customizations ) {
          var Vehicle = types[type];

          return (Vehicle ? new Vehicle(customizations) : null);
      },

      registerVehicle: function ( type, Vehicle ) {
          var proto = Vehicle.prototype;

          // only register classes that fulfill the vehicle contract
          if ( proto.drive && proto.breakDown ) {
              types[type] = Vehicle;
          }

          return abstractVehicleFactory;
      }
  };
})();


// Usage:

abstractVehicleFactory.registerVehicle( "car", Car );
abstractVehicleFactory.registerVehicle( "truck", Truck );

// Instantiate a new car based on the abstract vehicle type
var car = abstractVehicleFactory.getVehicle( "car", {
            color: "lime green",
            state: "like new" } );

// Instantiate a new truck in a similar manner
var truck = abstractVehicleFactory.getVehicle( "truck", {
            wheelSize: "medium",
            color: "neon yellow" } );
</code></pre></details></details></section><section><h2 id=mixinpatternjavascript><a href=#mixinpatternjavascript class=subhead-link>#</a> The Mixin Pattern</h2><p>In traditional programming languages such as C++ and Lisp, Mixins are classes that offer functionality that can be easily inherited by a sub-class or group of sub-classes for the purpose of function re-use.<h2>Sub-classing</h2><p>For developers unfamiliar with sub-classing, we will go through a brief beginners primer on them before diving into Mixins and Decorators further.<p><em>Sub-classing</em> is a term that refers to inheriting properties for a new object from a base or <em>superclass</em> object. In traditional object-oriented programming, a class <code>B</code> is able to extend another class <code>A</code>. Here we consider <code>A</code> a superclass and <code>B</code> a subclass of <code>A</code>. As such, all instances of <code>B</code> inherit the methods from <code>A</code>. <code>B</code> is however still able to define its own methods, including those that override methods originally defined by <code>A</code>.<p>Should <code>B</code> need to invoke a method in <code>A</code> that has been overridden, we refer to this as method chaining. Should <code>B</code> need to invoke the constructor <code>A</code> (the superclass), we call this constructor chaining.<p>To demonstrate sub-classing, we first need a base <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>class</a> that can have new instances of itself created. let's model this around the concept of a person.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, const

class Person{
    constructor(firstName, lastName) {
        this.firstName = firstName;
        this.lastName = lastName;
        this.gender = "male";
    }
}
// a new instance of Person can then easily be created as follows:
const clark = new Person( 'Clark', 'Kent' );
</code></pre><p>Next, we'll want to specify a new class that's a subclass of the existing <code>Person</code> class. Let us imagine we want to add distinct properties to distinguish a <code>Person</code> from a <code>Superhero</code> whilst inheriting the properties of the <code>Person</code> "superclass". As superheroes share many common traits with normal people (e.g. name, gender), this should hopefully illustrate how sub-classing works adequately.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, extends super, const
class Superhero extends Person {
    constructor(firstName, lastName, powers) {
        // Invoke the superclass constructor 
        super(firstName, lastName);
        this.powers = powers;
    }
}
// a new instance of Person can then easily be created as follows:
const clark = new Person( 'Clark', 'Kent' );
</code></pre><p>// A new instance of Superhero can be created as follows<p>const SuperMan = new Superhero('Clark','Kent', ['flight','heat-vision']);<br>console.log(SuperMan);<p>// Outputs Person attributes as well as powers<p><details><summary><strong>Inheritance using ES5/Classic JavaScript</strong></summary><pre><code class=language-javascript>
var Person = function( firstName, lastName ){
<p>this.firstName = firstName;<br>
this.lastName = lastName;<br>
this.gender = "male";</p>
<p>};</p>
<p>var clark = new Person( "Clark", "Kent" );</p>
<p>// Define a subclass constructor for for "Superhero":<br>
var Superhero = function( firstName, lastName, powers ){</p>
<pre><code>// Invoke the superclass constructor on the new object
// then use .call() to invoke the constructor as a method of
// the object to be initialized.

Person.call( this, firstName, lastName );

// Finally, store their powers, a new array of traits not found in a normal "Person"
this.powers = powers;
</code></pre>
<p>};</p>
<p>Superhero.prototype = Object.create( Person.prototype );<br>
var superman = new Superhero( "Clark", "Kent", ["flight","heat-vision"] );<br>
console.log( superman );</p>
</code><p><code class=language-javascript>// Outputs Person attributes as well as powers<br>
</code></pre><p></details><p>The <code>Superhero</code> <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/constructor>constructor</a> creates an instance of the Superhero class which is an <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/extends>extension</a> of the <code>Person</code> class. Classes of this type have attributes of the classes that are above it in the chain and if we had set default values in the <code>Person</code> class, <code>Superhero</code> is capable of overriding any inherited values with values specific to its class.<h2>Mixins</h2><p>In JavaScript, we can look at inheriting from Mixins as a means of collecting functionality through extension. Each new class we define can have a superclass from which it can inherit methods and properties. Classes can also define their own properties and methods. We can leverage this fact to promote function re-use.<p>Mixins allow objects to borrow (or inherit) functionality from them with a minimal amount of complexity. Thus, Mixins can be viewed as classes with attributes and methods that can be easily shared across a number of other classes.<p>While JavaScript classes cannot inherit from multiple super classes, we can still mix functionality from multiple classes. A class in JavaScript can be used as an expression as well as a statement. As an expression, it returns a new class each time it's evaluated. The extends clause can also accept arbitrary expressions that return classes or constructors. These features enable us to define a mixin as a function that accepts a superclass and creates a new subclass from it.<p>Imagine that we define a Mixin containing utility functions in a standard JavaScript class as follows:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, class, extends, 
//              method declaration, arrow function

// Class can be used as an expression as well as a statement. As an expression it returns a new class each time it's evaluated.
// The extends clause accepts arbitrary expressions that return classes or constructors
// All we need to define a mixin is a function that accepts a superclass and creates a new subclass from it, like this:

const MyMixins = superclass =>
    class extends superclass {
        moveUp() {
            console.log('move up');
        }
        moveDown() {
            console.log('move down');
        }
        stop() {
            console.log('stop! in the name of love!');
        }
    };

</code></pre><p>Above, we created a <code>MyMixins</code> function that can extend a dynamic superclass. We will now create two classes <code>CarAnimator</code> and <code>PersonAnimator</code> from which MyMixins can extend and return a sub-class with methods defined in MyMixins as well as those in the class being extended.<pre><code class=language-javascript>
// ES2015+ syntax/keywords used: class, constructor, arrow functions, extends

// A skeleton carAnimator constructor
class CarAnimator {
    moveLeft() {
        console.log('move left');
    }
}
// A skeleton personAnimator constructor
class PersonAnimator {
    moveRandomly() {
        /*..*/
    }
}

// Extend MyMixins using CarAnimator
class MyAnimator extends MyMixins(CarAnimator) {}

// Create a new instance of carAnimator
const myAnimator = new MyAnimator();
myAnimator.moveLeft();
myAnimator.moveDown();
myAnimator.stop();

// Outputs:
// move left
// move down
// stop! in the name of love!

</code></pre><p>As we can see, this allows us to easily "mix" in common behaviour into classes fairly trivially.<p>In the next example, we have two classes: a Car and a Mixin. What we're going to do is augment (another way of saying extend) the Car so that it can inherit specific methods defined in the Mixin, namely <code>driveForward()</code> and <code>driveBackward()</code>.<p>This example will demonstrate how to augment a constructor to include functionality without the need to duplicate this process for every constructor function we may have.<p><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, extends, const, arrow functions

// Define a simple Car constructor
class Car {
    constructor({ model, color }) {
        this.model = model || 'no model provided';
        this.color = color || 'no colour provided';
    }
}

// Mixin
const Mixin = superclass =>
    class extends superclass {
        driveForward() {
            console.log('drive forward');
        }
        driveBackward() {
            console.log('drive backward');
        }
        driveSideways() {
            console.log('drive sideways');
        }
    };

class MyCar extends Mixin(Car) {}

// Create a new Car
const myCar = new MyCar({
    model: 'Ford Escort',
    color: 'blue',
});

// Test to make sure we now have access to the methods
myCar.driveForward();
myCar.driveBackward();

// Outputs:
// drive forward
// drive backward

const mySportCar = new MyCar({
    model: 'Porsche',
    color: 'red',
});

mySportsCar.driveSideways();

// Outputs:
// drive sideways



</code></pre><p><details><summary><strong>Mixin Pattern - ES5/Classic Approach</strong></summary><p>In classic JavaScript, each new object we define has a prototype from which it can inherit further properties. Prototypes can inherit from other object prototypes but, even more importantly, can define properties for any number of object instances.<p>We can easily extend the prototype of existing constructor functions to include this behavior using a helper such as the Underscore.js <code>_.extend()</code> method. Thus, using classic JavaScript, we have a fairly flexible way to share functionality from not just one Mixin, but effectively many through multiple inheritance.<p><strong>Creating a Mixin</strong><pre><code class=language-javascript>
var myMixins = {
<p>moveUp: function(){<br>
console.log( "move up" );<br>
},</p>
<p>moveDown: function(){<br>
console.log( "move down" );<br>
},</p>
<p>stop: function(){<br>
console.log( "stop! in the name of love!" );<br>
}</p>
</code><p><code class=language-javascript>};<br>
</code></pre><p><p><strong>Extending with a Mixin</strong><pre><code class=language-javascript>
<p>// A skeleton carAnimator constructor<br>
function CarAnimator(){<br>
this.moveLeft = function(){<br>
console.log( "move left" );<br>
};<br>
}</p>
<p>// A skeleton personAnimator constructor<br>
function PersonAnimator(){<br>
this.moveRandomly = function(){ /<em>..</em>/ };<br>
}</p>
<p>// Extend both constructors with our Mixin<br>
_.extend( CarAnimator.prototype, myMixins );<br>
_.extend( PersonAnimator.prototype, myMixins );</p>
<p>// Create a new instance of carAnimator<br>
var myAnimator = new CarAnimator();<br>
myAnimator.moveLeft();<br>
myAnimator.moveDown();<br>
myAnimator.stop();</p>
<p>// Outputs:<br>
// move left<br>
// move down<br>
// stop! in the name of love!</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Mixins with selective augmentation</strong><pre><code class=language-javascript>
// Define a simple Car constructor
var Car = function ( settings ) {
<pre><code>this.model = settings.model || "no model provided";
this.color = settings.color || "no colour provided";
</code></pre>
<p>};</p>
<p>// Mixin<br>
var Mixin = function () {};</p>
<p>Mixin.prototype = {</p>
<pre><code>driveForward: function () {
    console.log( "drive forward" );
},

driveBackward: function () {
    console.log( "drive backward" );
},

driveSideways: function () {
    console.log( "drive sideways" );
}
</code></pre>
<p>};</p>
<p>// Extend an existing object with a method from another<br>
function augment( receivingClass, givingClass ) {</p>
<pre><code>// only provide certain methods
if ( arguments[2] ) {
    for ( var i = 2, len = arguments.length; i &lt; len; i++ ) {
        receivingClass.prototype[arguments[i]] = givingClass.prototype[arguments[i]];
    }
}
// provide all methods
else {
    for ( var methodName in givingClass.prototype ) {

        // check to make sure the receiving class doesn't
        // have a method of the same name as the one currently
        // being processed
        if ( !Object.hasOwnProperty.call(receivingClass.prototype, methodName) ) {
            receivingClass.prototype[methodName] = givingClass.prototype[methodName];
        }

        // Alternatively (check prototype chain as well):
        // if ( !receivingClass.prototype[methodName] ) {
        // receivingClass.prototype[methodName] = givingClass.prototype[methodName];
        // }
    }
}
</code></pre>
<p>}</p>
<p>// Augment the Car constructor to include "driveForward" and "driveBackward"<br>
augment( Car, Mixin, "driveForward", "driveBackward" );</p>
<p>// Create a new Car<br>
var myCar = new Car({<br>
model: "Ford Escort",<br>
color: "blue"<br>
});</p>
<p>// Test to make sure we now have access to the methods<br>
myCar.driveForward();<br>
myCar.driveBackward();</p>
<p>// Outputs:<br>
// drive forward<br>
// drive backward</p>
<p>// We can also augment Car to include all functions from our mixin<br>
// by not explicitly listing a selection of them<br>
augment( Car, Mixin );</p>
<p>var mySportsCar = new Car({<br>
model: "Porsche",<br>
color: "red"<br>
});</p>
<p>mySportsCar.driveSideways();</p>
<p>// Outputs:<br>
// drive sideways</p>
</code><p><code class=language-javascript></code></pre><p></details><h3>Advantages & Disadvantages</h3><p>Mixins assist in decreasing functional repetition and increasing function re-use in a system. Where an application is likely to require shared behaviour across object instances, we can easily avoid any duplication by maintaining this shared functionality in a Mixin and thus focusing on implementing only the functionality in our system which is truly distinct.<p>That said, the downsides to Mixins are a little more debatable. Some developers feel that injecting functionality into a class or an object prototype is a bad idea as it leads to both prototype pollution and a level of uncertainty regarding the origin of our functions. In large systems, this may well be the case.<p>I would argue that strong documentation can assist in minimizing the amount of confusion regarding the source of mixed in functions, but as with every pattern, if care is taken during implementation we should be okay.<p> </section><section><h2 id=decoratorpatternjavascript>The Decorator Pattern</h2><p>Decorators are a structural design pattern that aims to promote code re-use. Similar to Mixins, they can be considered another viable alternative to object sub-classing.<p>Classically, Decorators offered the ability to add behaviour to existing classes in a system dynamically. The idea was that the <em>decoration</em> itself wasn't essential to the base functionality of the class, otherwise, it would be baked into the <em>superclass</em> itself.<p>They can be used to modify existing systems where we wish to add additional features to objects without the need to heavily modify the underlying code using them. A common reason why developers use them is their applications may contain features requiring a large number of distinct types of objects. Imagine having to define hundreds of different object constructors for say, a JavaScript game.<p>The object constructors could represent distinct player types, each with differing capabilities. A <em>Lord of the Rings</em> game could require constructors for <code>Hobbit</code>, <code>Elf</code>, <code>Orc</code>, <code>Wizard</code>, <code>Mountain Giant</code>, <code>Stone Giant</code>, and so on, but there could easily be hundreds of these. If we then factored in capabilities, imagine having to create sub-classes for each combination of capability types e.g <code>HobbitWithRing</code>, <code>HobbitWithSword</code>, <code>HobbitWithRingAndSword</code>, and so on. This isn't very practical and certainly isn't manageable when we factor in a growing number of different abilities.<p>The Decorator pattern isn't heavily tied to how objects are created but instead focuses on the problem of extending their functionality. Rather than just relying on prototypal inheritance, we work with a single base class and progressively add decorator objects which provide the additional capabilities. The idea is that rather than sub-classing, we add (decorate) properties or methods to a base object so it's a little more streamlined.<p>We can use JavaScript <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>classes</a> to create the base classes that can be decorated. Adding new attributes or methods to object instances of the class in JavaScript is a very straightforward process. With this in mind, a very simplistic decorator may be implemented as follows:<h3>Example 1: Decorating Objects With New Functionality</h3><pre><code class=language-javascript>
// ES2015+ Keywords/syntax used: class, constructor, const

// A vehicle constructor
class Vehicle {
    constructor(vehicleType) {
        // some sane defaults
        this.vehicleType = vehicleType || 'car';
        this.model = 'default';
        this.license = '00000-000';
    }
}

// Test instance for a basic vehicle
const testInstance = new Vehicle('car');
console.log(testInstance);

// Outputs:
// vehicle: car, model:default, license: 00000-000

// Lets create a new instance of vehicle, to be decorated
const truck = new Vehicle('truck');

// New functionality we're decorating vehicle with
truck.setModel = function(modelName) {
    this.model = modelName;
};

truck.setColor = function(color) {
    this.color = color;
};

// Test the value setters and value assignment works correctly
truck.setModel('CAT');
truck.setColor('blue');

console.log(truck);

// Outputs:
// vehicle:truck, model:CAT, color: blue

// Demonstrate "vehicle" is still unaltered
const secondInstance = new Vehicle('car');
console.log(secondInstance);

// Outputs:
// vehicle: car, model:default, license: 00000-000


</code></pre><p>Here, <code>truck</code> is an instance of the class <code>Vehicle</code>, and we also decorate it with additional methods <code>setColor</code> and <code>setModel</code><p>This type of simplistic implementation is functional, but it doesn't really demonstrate all of the strengths Decorators have to offer. For this, we're first going to go through my variation of the Coffee example from an excellent book called <em>Head First Design Patterns</em> by Freeman, Sierra, and Bates, which is modeled around a Macbook purchase.<h3>Example 2: Decorating Objects With Multiple Decorators</h3><pre><code class=language-javascript>
// ES2015+ Keywords/syntax used: class, constructor, const, let, extends, super

// The constructor to decorate
class MacBook {
    constructor() {
        this.cost = 997;
        this.screenSize = 11.6;
    }
    getCost() {
        return this.cost;
    }
    getScreenSize() {
        return this.screenSize;
    }
}

// Decorator 1
class Memory extends MacBook {
    constructor(macBook) {
        super();
        this.macBook = macBook;
    }

    getCost() {
        return this.macBook.getCost() + 75;
    }
}

// Decorator 2
class Engraving extends MacBook {
    constructor(macBook) {
        super();
        this.macBook = macBook;
    }

    getCost() {
        return this.macBook.getCost() + 200;
    }
}

// Decorator 3
class Insurance extends MacBook {
    constructor(macBook) {
        super();
        this.macBook = macBook;
    }

    getCost() {
        return this.macBook.getCost() + 250;
    }
}

// init main object
let mb = new MacBook();

// init decorators
mb = new Memory(mb);
mb = new Engraving(mb);
mb = new Insurance(mb);

// Outputs: 1522
console.log(mb.getCost());

// Outputs: 11.6
console.log(mb.getScreenSize());


</code></pre><p>In the above example, our Decorators are overriding the <code>MacBook()</code> super-class objects <code>.cost()</code> function to return the current price of the <code>Macbook</code> plus the cost of the upgrade being specified.<p>It's considered a decoration as the original <code>Macbook</code> objects constructor methods which are not overridden (e.g. <code>screenSize()</code>) as well as any other properties which we may define as a part of the <code>Macbook</code> remain unchanged and intact.<p>There isn't really a defined <em>interface</em> in the above example and we're shifting away the responsibility of ensuring an object meets an interface when moving from the creator to the receiver.<details><summary><strong>Decorator Pattern - ES5/Classical Approach</strong></summary><p>Following is the code for the two examples discussed above, using classic JavaScript functions to implement classes<p><strong>Decorating objects with new functionality</strong><pre><code class=language-javascript>
//********************** Snippet 1 **********************//
<p>// A vehicle constructor<br>
function Vehicle( vehicleType ){</p>
<pre><code>// some sane defaults
this.vehicleType = vehicleType || "car";
this.model = "default";
this.license = "00000-000";
</code></pre>
<p>}</p>
<p>// Test instance for a basic vehicle<br>
var testInstance = new Vehicle( "car" );<br>
console.log( testInstance );</p>
<p>// Outputs:<br>
// vehicle: car, model:default, license: 00000-000</p>
<p>// Lets create a new instance of vehicle, to be decorated<br>
var truck = new Vehicle( "truck" );</p>
<p>// New functionality we're decorating vehicle with<br>
truck.setModel = function( modelName ){<br>
this.model = modelName;<br>
};</p>
<p>truck.setColor = function( color ){<br>
this.color = color;<br>
};</p>
<p>// Test the value setters and value assignment works correctly<br>
truck.setModel( "CAT" );<br>
truck.setColor( "blue" );</p>
<p>console.log( truck );</p>
<p>// Outputs:<br>
// vehicle:truck, model:CAT, color: blue</p>
<p>// Demonstrate "vehicle" is still unaltered<br>
var secondInstance = new Vehicle( "car" );<br>
console.log( secondInstance );</p>
</code><p><code class=language-javascript>// Outputs:<br>
// vehicle: car, model:default, license: 00000-000<br>
</code></pre><p><p><strong>Decorating objects with multiple decorators</strong><pre><code class=language-javascript>
// The constructor to decorate
function MacBook() {
<p>this.cost = function () { return 997; };<br>
this.screenSize = function () { return 11.6; };</p>
<p>}</p>
<p>// Decorator 1<br>
function memory( macbook ) {</p>
<p>var v = macbook.cost();<br>
macbook.cost = function() {<br>
return v + 75;<br>
};</p>
<p>}</p>
<p>// Decorator 2<br>
function engraving( macbook ){</p>
<p>var v = macbook.cost();<br>
macbook.cost = function(){<br>
return v + 200;<br>
};</p>
<p>}</p>
<p>// Decorator 3<br>
function insurance( macbook ){</p>
<p>var v = macbook.cost();<br>
macbook.cost = function(){<br>
return v + 250;<br>
};</p>
<p>}</p>
<p>var mb = new MacBook();<br>
memory( mb );<br>
engraving( mb );<br>
insurance( mb );</p>
<p>// Outputs: 1522<br>
console.log( mb.cost() );</p>
<p>// Outputs: 11.6<br>
console.log( mb.screenSize() );</p>
</code><p><code class=language-javascript></code></pre><p></details><h2>Pseudo-classical Decorators</h2><p>We're now going to examine a variation of the Decorator first presented in a JavaScript form in <em>Pro JavaScript Design Patterns</em> (PJDP) by Dustin Diaz and Ross Harmes.<p>Unlike some of the examples from earlier, Diaz and Harmes stick more closely to how decorators are implemented in other programming languages (such as Java or C++) using the concept of an "interface", which we will define in more detail shortly.<p><strong>Note:</strong> This particular variation of the Decorator pattern is provided for reference purposes. If finding it overly complex, I recommend opting for one of the simpler implementations covered earlier.<h3>Interfaces</h3><p>PJDP describes the Decorator as a pattern that is used to transparently wrap objects inside other objects of the same interface. An interface is a way of defining the methods an object <strong>should</strong> have, however, it doesn't actually directly specify how those methods should be implemented.<p>They can also indicate what parameters the methods take, but this is considered optional.<p>So, why would we use an interface in JavaScript? The idea is that they're self-documenting and promote reusability. In theory, interfaces also make code more stable by ensuring changes to them must also be made to the objects implementing them.<p>Below is an example of an implementation of interfaces in JavaScript using duck-typing - an approach that helps determine whether an object is an instance of constructor/object based on the methods it implements.<pre><code class=language-javascript>
// ES2015+ Keywords/syntax used: class, constructor, const, destructuring assignment

// Create interfaces using a pre-defined Interface
// constructor that accepts an interface name and
// skeleton methods to expose.

// In our reminder example summary() and placeOrder()
// represent functionality the interface should
// support
const reminder = new Interface('List', ['summary', 'placeOrder']);

const properties = {
    name: 'Remember to buy the milk',
    date: '05/06/2016',
    actions: {
        summary() {
            return 'Remember to buy the milk, we are almost out!';
        },
        placeOrder() {
            return 'Ordering milk from your local grocery store';
        },
    },
};

// Now create a constructor implementing the above properties
// and methods

class Todo {
    constructor({ actions, name }) {
        // State the methods we expect to be supported
        // as well as the Interface instance being checked
        // against

        Interface.ensureImplements(actions, reminder);

        this.name = name;
        this.methods = actions;
    }
}

// Create a new instance of our Todo constructor

const todoItem = new Todo(properties);

// Finally test to make sure these function correctly

console.log(todoItem.methods.summary());
console.log(todoItem.methods.placeOrder());

// Outputs:
// Remember to buy the milk, we are almost out!
// Ordering milk from your local grocery store

</code></pre><p>Both classic JavaScript, as well as ES2015+ do not support interfaces. However, we can create our own Interface class. In the above, <code>Interface.ensureImplements</code> provides strict functionality checking and code for both this and the <code>Interface</code> constructor can be found <a href=https://gist.github.com/1057989>here</a>.<p>The biggest problem with interfaces is that, as there isn't built-in support for them in JavaScript, there is a danger of us attempting to emulate a feature of another language that may not be an ideal fit. Lightweight interfaces can be used without a great performance cost however and we will next look at <em>Abstract</em> Decorators using this same concept.<h3>Abstract Decorators</h3><p>To demonstrate the structure of this version of the Decorator pattern, we're going to imagine we have a superclass that models a <code>Macbook</code> once again and a store that allows us to "decorate" our Macbook with several different enhancements for an additional fee.<p>Enhancements can include upgrades to 4GB or 8GB Ram, engraving, Parallels, or a case. Now if we were to model this using an individual sub-class for each combination of enhancement options, it might look something like this:<pre><code class=language-javascript>
// ES2015+ keywords/classes used: const, class

const Macbook = class {
    //...
};

const MacbookWith4GBRam = class {};
const MacbookWith8GBRam = class {};
const MacbookWith4GBRamAndEngraving = class {};
const MacbookWith8GBRamAndEngraving = class {};
const MacbookWith8GBRamAndParallels = class {};
const MacbookWith4GBRamAndParallels = class {};
const MacbookWith8GBRamAndParallelsAndCase = class {};
const MacbookWith4GBRamAndParallelsAndCase = class {};
const MacbookWith8GBRamAndParallelsAndCaseAndInsurance = class {};
const MacbookWith4GBRamAndParallelsAndCaseAndInsurance = class {};

</code></pre><p>and so on.<p>This would be an impractical solution as a new subclass would be required for every possible combination of available enhancements. As we would prefer to keep things simple without maintaining a large set of subclasses, let's look at how decorators may be used to solve this problem better.<p>Rather than requiring all of the combinations we saw earlier, we should simply have to create five new decorator classes. Methods that are called on these enhancement classes would be passed on to our <code>Macbook</code> class.<p>In our next example, decorators transparently wrap around their components and can interestingly be interchanged as they use the same interface.<p>Here's the interface we're going to define for the Macbook:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, class

const Macbook = new Interface('Macbook', [
    'addEngraving',
    'addParallels',
    'add4GBRam',
    'add8GBRam',
    'addCase',
]);

// A Macbook Pro might thus be represented as follows:
class MacbookPro {
    // implements Macbook
}

// ES2015+: We still could use Object.prototype for adding new methods, because internally we use the same structure
MacbookPro.prototype = {
    addEngraving() {},
    addParallels() {},
    add4GBRam() {},
    add8GBRam() {},
    addCase() {},
    getPrice() {
        // Base price
        return 900.0;
    },
};
</code></pre><p>To make it easier for us to add as many more options as needed, later on, an Abstract Decorator class is defined with default methods required to implement the <code>Macbook</code> interface, which the rest of the options will sub-class. Abstract Decorators ensure that we can decorate a base class independently with as many decorators as needed in different combinations (remember the example earlier?) without needing to derive a class for every possible combination.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor

// Macbook decorator abstract decorator class

class MacbookDecorator {
    constructor(macbook) {
        Interface.ensureImplements(macbook, Macbook);
        this.macbook = macbook;
    }

    addEngraving() {
        return this.macbook.addEngraving();
    }

    addParallels() {
        return this.macbook.addParallels();
    }

    add4GBRam() {
        return this.macbook.add4GBRam();
    }

    add8GBRam() {
        return this.macbook.add8GBRam();
    }

    addCase() {
        return this.macbook.addCase();
    }

    getPrice() {
        return this.macbook.getPrice();
    }
}

</code></pre><p>What's happening in the above sample is that the <code>Macbook</code> Decorator accepts an object (a Macbook) to use as our base component. It's using the <code>Macbook</code> interface we defined earlier and for each method is just calling the same method on the component. We can now create our option classes for what can be added, just by using the <code>Macbook</code> Decorator.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, extends, const, super
//          arrow function, template literals for string interpolation

// Let's now extend (decorate) the CaseDecorator
// with a MacbookDecorator

class CaseDecorator extends MacbookDecorator {
    constructor(macbook) {
        super(macbook);
    }

    addCase() {
        return `${this.macbook.addCase()}Adding case to macbook`;
    }

    getPrice() {
        return this.macbook.getPrice() + 45.0;
    }
}

</code></pre><p>What we're doing here is overriding the <code>addCase()</code> and <code>getPrice()</code> methods that need to be decorated and we're achieving this by first calling these methods on the original <code>macbook</code> and then simply appending a string or numeric value (e.g 45.00) to them accordingly.<p>As there's been quite a lot of information presented in this section so far, let's try to bring it all together in a single example that will hopefully highlight what we have learned.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const

// Instantiation of the macbook
const myMacbookPro = new MacbookPro();

// Outputs: 900.00
console.log(myMacbookPro.getPrice());

// Decorate the macbook
const decoratedMacbookPro = new CaseDecorator(myMacbookPro);

// This will return 945.00
console.log(decoratedMacbookPro.getPrice());

</code></pre><p>As decorators are able to modify objects dynamically, they're a perfect pattern for changing existing systems. Occasionally, it's just simpler to create decorators around an object versus the trouble of maintaining individual sub-classes for each object type. This makes maintaining applications that may require a large number of sub-classed objects significantly more straightforward.<p>A functional version of this example can be found on <a href=http://jsbin.com/UMEJaXu/1/edit>JSBin</a>.<h2>Decorators With jQuery</h2><p>As with other patterns we've covered, there are also examples of the Decorator pattern that can be implemented with jQuery. <code>jQuery.extend()</code> allows us to extend (or merge) two or more objects (and their properties) together into a single object at run-time.<p>In this scenario, a target object can be decorated with new functionality without necessarily breaking or overriding existing methods in the source/superclass object (although this can be done).<p>In the following example, we define three objects: defaults, options, and settings. The task aims to decorate the <code>defaults</code> object with additional functionality found in <code>options</code>, which we will make available through <code>settings</code>. We must:<p>(a) Leave "defaults" in an untouched state where we don't lose the ability to access the properties or functions found in it a later point (b) Gain the ability to use the decorated properties and functions found in "options"<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, let, arrow functions, template literals for string interpolation

let decoratorApp = decoratorApp || {};

// define the objects we're going to use
decoratorApp = {
    defaults: {
        validate: false,
        limit: 5,
        name: 'foo',
        welcome() {
            console.log('welcome!');
        },
    },

    options: {
        validate: true,
        name: 'bar',
        helloWorld() {
            console.log('hello world');
        },
    },

    settings: {},

    printObj(obj) {
        const arr = [];
        let next;
        $.each(obj, (key, val) => {
            next = `${key}: `;
            next += $.isPlainObject(val) ? printObj(val) : val;
            arr.push(next);
        });

        return `{ ${arr.join(', ')} }`;
    },
};

// merge defaults and options, without modifying defaults explicitly
decoratorApp.settings = $.extend(
    {},
    decoratorApp.defaults,
    decoratorApp.options
);

// what we have done here is decorated defaults in a way that provides
// access to the properties and functionality it has to offer (as well as
// that of the decorator "options"). defaults itself is left unchanged

$('#log').append(
    decoratorApp.printObj(decoratorApp.settings) +
        +decoratorApp.printObj(decoratorApp.options) +
        +decoratorApp.printObj(decoratorApp.defaults)
);

// settings -- { validate: true, limit: 5, name: bar, welcome: function (){ console.log( "welcome!" ); },
// helloWorld: function (){ console.log( "hello world" ); } }
// options -- { validate: true, name: bar, helloWorld: function (){ console.log( "hello world" ); } }
// defaults -- { validate: false, limit: 5, name: foo, welcome: function (){ console.log("welcome!"); } }

</code></pre><details><summary><strong>Pseudo Classical Decorators - ES5/Classical Approach</strong></summary><p>Following is the code corresponding to the decorator examples discussed above, written using classic JavaScript syntax. The <a href=https://gist.github.com/1057989>Interface</a> mentioned earlier can be used with this code too.<p><strong>Interfaces with duck-typing</strong><pre><code class=language-javascript>
// Create interfaces using a pre-defined Interface
// constructor that accepts an interface name and
// skeleton methods to expose.
<p>// In our reminder example summary() and placeOrder()<br>
// represent functionality the interface should<br>
// support<br>
const reminder = new Interface('List', ['summary', 'placeOrder']);</p>
<p>const properties = {<br>
name: 'Remember to buy the milk',<br>
date: '05/06/2016',<br>
actions: {<br>
summary() {<br>
return 'Remember to buy the milk, we are almost out!';<br>
},<br>
placeOrder() {<br>
return 'Ordering milk from your local grocery store';<br>
},<br>
},<br>
};</p>
<p>// Now create a constructor implementing the above properties<br>
// and methods</p>
<p>class Todo {<br>
constructor({ actions, name }) {<br>
// State the methods we expect to be supported<br>
// as well as the Interface instance being checked<br>
// against</p>
<pre><code>    Interface.ensureImplements(actions, reminder);

    this.name = name;
    this.methods = actions;
}
</code></pre>
<p>}</p>
<p>// Create a new instance of our Todo constructor</p>
<p>const todoItem = new Todo(properties);</p>
<p>// Finally test to make sure these function correctly</p>
<p>console.log(todoItem.methods.summary());<br>
console.log(todoItem.methods.placeOrder());</p>
</code><p><code class=language-javascript>// Outputs:<br>
// Remember to buy the milk, we are almost out!<br>
// Ordering milk from your local grocery store<br>
</code></pre><p><p><strong>Abstract Decorators: Problem Definition</strong><pre><code class=language-javascript>
// ES2015+ keywords/classes used: const, class
<p>const Macbook = class {<br>
//...<br>
};</p>
<p>var  MacbookWith4GBRam = function(){},<br>
MacbookWith8GBRam = function(){},<br>
MacbookWith4GBRamAndEngraving = function(){},<br>
MacbookWith8GBRamAndEngraving = function(){},<br>
MacbookWith8GBRamAndParallels = function(){},<br>
MacbookWith4GBRamAndParallels = function(){},<br>
MacbookWith8GBRamAndParallelsAndCase = function(){},<br>
MacbookWith4GBRamAndParallelsAndCase = function(){},<br>
MacbookWith8GBRamAndParallelsAndCaseAndInsurance = function(){},<br>
MacbookWith4GBRamAndParallelsAndCaseAndInsurance = function(){};</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Abstract Decorators: Interface</strong><pre><code class=language-javascript>
var Macbook = new Interface("Macbook",
    ["addEngraving",
        "addParallels",
        "add4GBRam",
        "add8GBRam",
        "addCase"
    ]);
<p>// A Macbook Pro might thus be represented as follows:<br>
var MacbookPro = function() {<br>
// implements Macbook<br>
}</p>
</code><p><code class=language-javascript>// ES2015+: We still could use Object.prototype for adding new methods, because internally we use the same structure<br>
MacbookPro.prototype = {<br>
addEngraving: function() {},<br>
addParallels: function() {},<br>
add4GBRam: function() {},<br>
add8GBRam: function() {},<br>
addCase: function() {},<br>
getPrice: function() {<br>
// Base price<br>
return 900.00;<br>
}<br>
};<br>
</code></pre><p><p><strong>Abstract Decorators: Base Class</strong><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor
<p>// Macbook decorator abstract decorator class</p>
<p>class MacbookDecorator {<br>
constructor(macbook) {<br>
Interface.ensureImplements(macbook, Macbook);<br>
this.macbook = macbook;<br>
}</p>
<pre><code>addEngraving() {
    return this.macbook.addEngraving();
}

addParallels() {
    return this.macbook.addParallels();
}

add4GBRam() {
    return this.macbook.add4GBRam();
}

add8GBRam() {
    return this.macbook.add8GBRam();
}

addCase() {
    return this.macbook.addCase();
}

getPrice() {
    return this.macbook.getPrice();
}
</code></pre>
<p>}</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Abstract Decorators: Implementation</strong><pre><code class=language-javascript>
// First, define a way to extend an object a
// with the properties in object b. We'll use
// this shortly!
function extend( a, b ){
    for( var key in b )
        if( b.hasOwnProperty(key) )
            a[key] = b[key];
    return a;
}
<p>var CaseDecorator = function( macbook ){<br>
this.macbook = macbook;<br>
};</p>
<p>// Let's now extend (decorate) the CaseDecorator<br>
// with a MacbookDecorator</p>
<p>class CaseDecorator extends MacbookDecorator {<br>
constructor(macbook) {<br>
super(macbook);<br>
}</p>
<pre><code>addCase() {
    return `${this.macbook.addCase()}Adding case to macbook`;
}

getPrice() {
    return this.macbook.getPrice() + 45.0;
}
</code></pre>
<p>}</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Abstract Decorators: Usage</strong><pre><code class=language-javascript>
// Instantiation of the macbook
const myMacbookPro = new MacbookPro();
<p>// Outputs: 900.00<br>
console.log(myMacbookPro.getPrice());</p>
<p>// Decorate the macbook<br>
const decoratedMacbookPro = new CaseDecorator(myMacbookPro);</p>
<p>// This will return 945.00<br>
console.log( decoratedMacbookPro.getPrice() );</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Decorators in JQuery</strong><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, let, arrow functions, template literals for string interpolation
<p>let decoratorApp = decoratorApp || {};</p>
<p>// define the objects we're going to use<br>
decoratorApp = {<br>
defaults: {<br>
validate: false,<br>
limit: 5,<br>
name: 'foo',<br>
welcome() {<br>
console.log('welcome!');<br>
},<br>
},</p>
<pre><code>options: {
    validate: true,
    name: 'bar',
    helloWorld() {
        console.log('hello world');
    },
},

settings: {},

printObj(obj) {
    const arr = [];
    let next;
    $.each(obj, (key, val) => {
        next = `${key}: `;
        next += $.isPlainObject(val) ? printObj(val) : val;
        arr.push(next);
    });

    return `{ ${arr.join(', ')} }`;
},
</code></pre>
<p>};</p>
<p>// merge defaults and options, without modifying defaults explicitly<br>
decoratorApp.settings = $.extend(<br>
{},<br>
decoratorApp.defaults,<br>
decoratorApp.options<br>
);</p>
<p>// what we have done here is decorated defaults in a way that provides<br>
// access to the properties and functionality it has to offer (as well as<br>
// that of the decorator "options"). defaults itself is left unchanged</p>
<p>$('#log').append(<br>
decoratorApp.printObj(decoratorApp.settings) +<br>
+decoratorApp.printObj(decoratorApp.options) +<br>
+decoratorApp.printObj(decoratorApp.defaults)<br>
);</p>
<p>// settings -- { validate: true, limit: 5, name: bar, welcome: function (){ console.log( "welcome!" ); },<br>
// helloWorld: function (){ console.log( "hello world" ); } }<br>
// options -- { validate: true, name: bar, helloWorld: function (){ console.log( "hello world" ); } }<br>
// defaults -- { validate: false, limit: 5, name: foo, welcome: function (){ console.log("welcome!"); } }</p>
</code><p><code class=language-javascript></code></pre><p></details><h2>Advantages & Disadvantages</h2><p>Developers enjoy using this pattern as it can be used transparently and is also fairly flexible - as we've seen, objects can be wrapped or "decorated" with new behavior and then continue to be used without needing to worry about the base object being modified. In a broader context, this pattern also avoids us needing to rely on large numbers of subclasses to get the same benefits.<p>There are however drawbacks that we should be aware of when implementing the pattern. If poorly managed, it can significantly complicate our application architecture as it introduces many small, but similar objects into our namespace. The concern here is that in addition to becoming hard to manage, other developers unfamiliar with the pattern may have a hard time grasping why it's being used.<p>Sufficient commenting or pattern research should assist with the latter, however, as long as we keep a handle on how widespread we use the decorator in our applications we should be fine on both counts.<p> <p> </section><section><h1 id=detailflyweight><a href=#detailflyweight class=subhead-link>#</a> Flyweight</h1><p> <p>The Flyweight pattern is a classical structural solution for optimizing code that is repetitive, slow, and inefficiently shares data. It aims to minimize the use of memory in an application by sharing as much data as possible with related objects (e.g application configuration, state, and so on).<p>The pattern was first conceived by Paul Calder and Mark Linton in 1990 and was named after the boxing weight class that includes fighters weighing less than 112lb. The name Flyweight itself is derived from this weight classification as it refers to the small weight (memory footprint) the pattern aims to help us achieve.<p>In practice, Flyweight data sharing can involve taking several similar objects or data constructs used by a number of objects and placing this data into a single external object. We can pass through this object to those depending on this data, rather than storing identical data across each one.<h2>Using Flyweights</h2><p>There are two ways in which the Flyweight pattern can be applied. The first is at the data-layer, where we deal with the concept of sharing data between large quantities of similar objects stored in memory.<p>The second is at the DOM-layer where the Flyweight can be used as a central event-manager to avoid attaching event handlers to every child element in a parent container we wish to have some similar behavior.<p>As the data-layer is where the flyweight pattern is most used traditionally, we'll take a look at this first.<h2>Flyweights and sharing data</h2><p>For this application, there are a few more concepts around the classical Flyweight pattern that we need to be aware of. In the Flyweight pattern, there's a concept of two states - intrinsic and extrinsic. Intrinsic information may be required by internal methods in our objects which they absolutely cannot function without. Extrinsic information can however be removed and stored externally.<p>Objects with the same intrinsic data can be replaced with a single shared object, created by a factory method. This allows us to reduce the overall quantity of implicit data being stored quite significantly.<p>The benefit of this is that we're able to keep an eye on objects that have already been instantiated so that new copies are only ever created should the intrinsic state differ from the object we already have.<p>We use a manager to handle the extrinsic states. How this is implemented can vary, but one approach is to have the manager object contain a central database of the extrinsic states and the flyweight objects to which they belong.<h2>Implementing Classical Flyweights</h2><p>As the Flyweight pattern hasn't been heavily used in JavaScript in recent years, many of the implementations we might use for inspiration come from the Java and C++ worlds.<p>Our first look at Flyweights in code is my JavaScript implementation of the Java sample of the Flyweight pattern from Wikipedia (<a href=http://en.wikipedia.org/wiki/Flyweight_pattern>http://en.wikipedia.org/wiki/Flyweight_pattern</a>).<p>We will be making use of three types of Flyweight components in this implementation, which are listed below:<p><ul><li><strong>Flyweight</strong> corresponds to an interface through which flyweights can receive and act on extrinsic states<li><strong>Concrete Flyweight</strong> actually implements the Flyweight interface and stores the intrinsic state. Concrete Flyweights need to be sharable and capable of manipulating the extrinsic state.<li><strong>Flyweight Factory</strong> manages flyweight objects and creates them too. It makes sure that our flyweights are shared and manages them as a group of objects which can be queried if we require individual instances. If an object has been already created in the group it returns it, otherwise, it adds a new object to the pool and returns it.</ul><p><p>These correspond to the following definitions in our implementation:<p><ul><li>CoffeeOrder: Flyweight<li>CoffeeFlavor: Concrete Flyweight<li>CoffeeOrderContext: Helper<li>CoffeeFlavorFactory: Flyweight Factory<li>testFlyweight: Utilization of our Flyweights</ul><p><h3>Duck punching "implements"</h3><p>Duck punching allows us to extend the capabilities of a language or solution without necessarily needing to modify the runtime source. As this next solution requires the use of a Java keyword (<code>implements</code>) for implementing interfaces and isn't found in JavaScript natively, let's first duck punch it.<p><code>Function.prototype.implementsFor</code> works on an object constructor and will accept a parent class (function) or object and either inherit from this using normal inheritance (for functions) or virtual inheritance (for objects).<pre><code class=language-javascript>
// Simulate pure virtual inheritance/"implement" keyword for JS
Function.prototype.implementsFor = function(parentClassOrObject) {
    if (parentClassOrObject.constructor === Function) {
        // Normal Inheritance
        this.prototype = new parentClassOrObject();
        this.prototype.constructor = this;
        this.prototype.parent = parentClassOrObject.prototype;
    } else {
        // Pure Virtual Inheritance
        this.prototype = parentClassOrObject;
        this.prototype.constructor = this;
        this.prototype.parent = parentClassOrObject;
    }
    return this;
};
</code></pre><p>We can use this to patch the lack of an <code>implements</code> keyword by having a function inherit an interface explicitly. Below, <code>CoffeeFlavor</code> implements the <code>CoffeeOrder</code> interface and must contain its interface methods for us to assign the functionality powering these implementations to an object.<pre><code class=language-javascript>
// ES2015+ syntax/keywords used: const, let, arrow functions,
// template literals for string interpolation, parantheses optional for one parameter

// Flyweight object
const CoffeeOrder = {
    // Interfaces
    serveCoffee(context) {},
    getFlavor() {},
};

// ConcreteFlyweight object that creates ConcreteFlyweight
// Implements CoffeeOrder
function CoffeeFlavor(newFlavor) {
    const flavor = newFlavor;

    // If an interface has been defined for a feature
    // implement the feature
    if (typeof this.getFlavor === 'function') {
        this.getFlavor = () => flavor;
    }

    if (typeof this.serveCoffee === 'function') {
        this.serveCoffee = context => {
            console.log(
                `Serving Coffee flavor ${flavor} to table number ${context.getTable()}`
            );
        };
    }
}

// Implement interface for CoffeeOrder
CoffeeFlavor.implementsFor(CoffeeOrder);

// Handle table numbers for a coffee order
const CoffeeOrderContext = tableNumber => ({
    getTable() {
        return tableNumber;
    }
});

const CoffeeFlavorFactory = () => {
    const flavors = {};
    let length = 0;

    return {
        getCoffeeFlavor(flavorName) {
            let flavor = flavors[flavorName];
            if (typeof flavor === 'undefined') {
                flavor = new CoffeeFlavor(flavorName);
                flavors[flavorName] = flavor;
                length++;
            }
            return flavor;
        },

        getTotalCoffeeFlavorsMade() {
            return length;
        },
    };
};

// Sample usage:
// testFlyweight()

const testFlyweight = () => {
    // The flavors ordered.
    const flavors = [];

    // The tables for the orders.
    const tables = [];

    // Number of orders made
    let ordersMade = 0;

    // The CoffeeFlavorFactory instance
    const flavorFactory = new CoffeeFlavorFactory();

    function takeOrders(flavorIn, table) {
        flavors.push(flavorFactory.getCoffeeFlavor(flavorIn));
        tables.push(new CoffeeOrderContext(table));
        ordersMade++;
    }

    takeOrders('Cappuccino', 2);
    takeOrders('Cappuccino', 2);
    takeOrders('Frappe', 1);
    takeOrders('Frappe', 1);
    takeOrders('Xpresso', 1);
    takeOrders('Frappe', 897);
    takeOrders('Cappuccino', 97);
    takeOrders('Cappuccino', 97);
    takeOrders('Frappe', 3);
    takeOrders('Xpresso', 3);
    takeOrders('Cappuccino', 3);
    takeOrders('Xpresso', 96);
    takeOrders('Frappe', 552);
    takeOrders('Cappuccino', 121);
    takeOrders('Xpresso', 121);

    for (let i = 0; i &lt; ordersMade; ++i) {
        flavors[i].serveCoffee(tables[i]);
    }
    console.log(' ');
    console.log(
        `total CoffeeFlavor objects made: ${flavorFactory.getTotalCoffeeFlavorsMade()}`
    );
};
</code></pre><h2>Converting code to use the Flyweight pattern</h2><p>Next, let's continue our look at Flyweights by implementing a system to manage all of the books in a library. The important meta-data for each book could probably be broken down as follows:<ul><li>ID<li>Title<li>Author<li>Genre<li>Page count<li>Publisher ID<li>ISBN</ul><p>We'll also require the following properties to keep track of which member has checked out a particular book, the date they've checked it out on as well as the expected date of return.<ul><li>checkoutDate<li>checkoutMember<li>dueReturnDate<li>availability</ul><p>We create a <code>Book</code> <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes>class</a> to represent each book as follows, prior to any optimization using the Flyweight pattern. The <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/constructor>constructor</a> takes in all the properties related directly to the book as well as those required for tracking it.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, const

class Book {
  constructor(
    id,
    title,
    author,
    genre,
    pageCount,
    publisherID,
    ISBN,
    checkoutDate,
    checkoutMember,
    dueReturnDate,
    availability
  ) {
    this.id = id;
    this.title = title;
    this.author = author;
    this.genre = genre;
    this.pageCount = pageCount;
    this.publisherID = publisherID;
    this.ISBN = ISBN;
    this.checkoutDate = checkoutDate;
    this.checkoutMember = checkoutMember;
    this.dueReturnDate = dueReturnDate;
    this.availability = availability;
  }

  getTitle() {
    return this.title;
  }

  getAuthor() {
    return this.author;
  }

  getISBN() {
    return this.ISBN;
  }

  // For brevity, other getters are not shown
  updateCheckoutStatus(
    bookID,
    newStatus,
    checkoutDate,
    checkoutMember,
    newReturnDate
  ) {
    this.id = bookID;
    this.availability = newStatus;
    this.checkoutDate = checkoutDate;
    this.checkoutMember = checkoutMember;
    this.dueReturnDate = newReturnDate;
  }

  extendCheckoutPeriod(bookID, newReturnDate) {
    this.id = bookID;
    this.dueReturnDate = newReturnDate;
  }

  isPastDue(bookID) {
    const currentDate = new Date();
    return currentDate.getTime() > Date.parse(this.dueReturnDate);
  }
}
</code></pre><p>This probably works fine initially for small collections of books, however as the library expands to include a larger inventory with multiple versions and copies of each book available, we may find the management system running slower and slower over time. Using thousands of book objects may overwhelm the available memory, but we can optimize our system using the Flyweight pattern to improve this.<p>We can now separate our data into intrinsic and extrinsic states as follows: data relevant to the book object (<code>title</code>, <code>author</code>, etc) is intrinsic whilst the checkout data (<code>checkoutMember</code>, <code>dueReturnDate</code>, etc) is considered extrinsic. Effectively this means that only one Book object is required for each combination of book properties. it's still a considerable quantity of objects, but significantly fewer than we had previously.<p>An instance of the following book meta-data combination will be created for all required copies of the book object with a particular title/ISBN.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, class, constructor

// Flyweight optimized version
class Book {
  constructor(title, author, genre, pageCount, publisherID, ISBN) {
        this.title = title;
        this.author = author;
        this.genre = genre;
        this.pageCount = pageCount;
        this.publisherID = publisherID;
        this.ISBN = ISBN;
  }
}
</code></pre><p>As we can see, the extrinsic states have been removed. Everything to do with library check-outs will be moved to a manager and as the object data is now segmented, a factory can be used for instantiation.<h2>A Basic Factory</h2><p>Let's now define a very basic factory. What we're going to have it do is perform a check to see if a book with a particular title has been previously created inside the system; if it has, we'll return it - if not, a new book will be created and stored so that it can be accessed later. This makes sure that we only create a single copy of each unique intrinsic piece of data:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, let, arrow function syntax
//                  class, constructor


// Book Factory singleton
const existingBooks = {};

class BookFactory {
    constructor(title, author, genre, pageCount, publisherID, ISBN) {

        // Find out if a particular book meta-data combination has been created before
        // !! or (bang bang) forces a boolean to be returned
        this.existingBook = existingBooks[ISBN];
        if (!!this.existingBook) {
            return this.existingBook;
        } else {
            // if not, let's create a new instance of the book and store it
            const book = new Book(title, author, genre, pageCount, publisherID, ISBN);
            existingBooks[ISBN] = book;
            return book;

        }
    }
}
</code></pre><h2>Managing the extrinsic states</h2><p>Next, we need to store the states that were removed from the Book objects somewhere - luckily a manager (which we'll be defining as a Singleton) can be used to encapsulate them. Combinations of a Book object and the library member that's checked them out will be called Book records. Our manager will be storing both and will also include checkout-related logic we stripped out during our flyweight optimization of the Book class.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, const 

// BookRecordManager singleton
const bookRecordDatabase = {};

class BookRecordManager {
    // add a new book into the library system
    constructor(id, title, author, genre, pageCount, publisherID, ISBN, checkoutDate, checkoutMember, dueReturnDate, availability) {
        this.book = new BookFactory(title, author, genre, pageCount, publisherID, ISBN);

        bookRecordDatabase[id] = {
            checkoutMember,
            checkoutDate,
            dueReturnDate,
            availability,
            book: this.book,
        };
    }

    updateCheckoutStatus(bookID, newStatus, checkoutDate, checkoutMember, newReturnDate) {

        const record = bookRecordDatabase[bookID];
        record.availability = newStatus;
        record.checkoutDate = checkoutDate;
        record.checkoutMember = checkoutMember;
        record.dueReturnDate = newReturnDate;
    }

    extendCheckoutPeriod(bookID, newReturnDate) {
        bookRecordDatabase[bookID].dueReturnDate = newReturnDate;
    }

    isPastDue(bookID) {
        const currentDate = new Date();
        return currentDate.getTime() > Date.parse(bookRecordDatabase[bookID].dueReturnDate);
    }
}
</code></pre><p>The result of these changes is that all of the data that's been extracted from the Book <em>class</em> is now being stored in an attribute of the BookManager singleton (BookDatabase) - something considerably more efficient than the large number of objects we were previously using. Methods related to book checkouts are also now based here as they deal with data that's extrinsic rather than intrinsic.<p>This process does add a little complexity to our final solution, however, it's a small concern when compared to the performance issues that have been tackled. Data-wise, if we have 30 copies of the same book, we are now only storing it once. Also, every function takes up memory. With the flyweight pattern, these functions exist in one place (on the manager) and not on every object, thus saving on memory use. For the above-mentioned flyweight unoptimized version, we store just a link to the function object as we used the Book constructor's prototype but if it was implemented in another way, functions would be created for every book instance.<p><details><summary><strong>Flyweight Pattern for sharing data: ES5/Classical Approach</strong></summary><p>The Flyweight pattern can be implemented using classic JavaScript syntax with functions to replace classes and constructors. There is no change in the <code>implementsFor</code> function that we defined earlier for 'duck-punching' implements.<p><strong>Implementing Classical Flyweights - duck-punching implements</strong><pre><code class=language-javascript>
// Simulate pure virtual inheritance/"implement" keyword for JS
Function.prototype.implementsFor = function(parentClassOrObject) {
  if (parentClassOrObject.constructor === Function) {
    // Normal Inheritance
    this.prototype = new parentClassOrObject();
    this.prototype.constructor = this;
    this.prototype.parent = parentClassOrObject.prototype;
  } else {
    // Pure Virtual Inheritance
    this.prototype = parentClassOrObject;
    this.prototype.constructor = this;
    this.prototype.parent = parentClassOrObject;
  }
  return this;
};
</code></pre><p><strong>The Coffee-Order Example</strong><pre><code class=language-javascript>
// ES2015+ syntax/keywords used: const, let, arrow functions,
// template literals for string interpolation, parantheses optional for one parameter
<p>// Flyweight object<br>
const CoffeeOrder = {<br>
// Interfaces<br>
serveCoffee(context) {},<br>
getFlavor() {},<br>
};</p>
<p>// ConcreteFlyweight object that creates ConcreteFlyweight<br>
// Implements CoffeeOrder<br>
function CoffeeFlavor(newFlavor) {<br>
const flavor = newFlavor;</p>
<p>// If an interface has been defined for a feature<br>
// implement the feature<br>
if (typeof this.getFlavor === 'function') {<br>
this.getFlavor = () => flavor;<br>
}</p>
<p>if (typeof this.serveCoffee === 'function') {<br>
this.serveCoffee = context => {<br>
console.log(<br>
<code>Serving Coffee flavor ${flavor} to table number ${context.getTable()}</code><br>
);<br>
};<br>
}<br>
}</p>
<p>// Implement interface for CoffeeOrder<br>
CoffeeFlavor.implementsFor(CoffeeOrder);</p>
<p>// Handle table numbers for a coffee order<br>
const CoffeeOrderContext = tableNumber => {<br>
return {<br>
getTable() {<br>
return tableNumber;<br>
},<br>
};<br>
};</p>
<p>const CoffeeFlavorFactory = () => {<br>
const flavors = {};<br>
let length = 0;</p>
<p>return {<br>
getCoffeeFlavor(flavorName) {<br>
let flavor = flavors[flavorName];<br>
if (typeof flavor === 'undefined') {<br>
flavor = new CoffeeFlavor(flavorName);<br>
flavors[flavorName] = flavor;<br>
length++;<br>
}<br>
return flavor;<br>
},</p>
<pre><code>getTotalCoffeeFlavorsMade() {
  return length;
},
</code></pre>
<p>};<br>
};</p>
<p>// Sample usage:<br>
// testFlyweight()</p>
<p>const testFlyweight = () => {<br>
// The flavors ordered.<br>
const flavors = [];</p>
<p>// The tables for the orders.<br>
const tables = [];</p>
<p>// Number of orders made<br>
let ordersMade = 0;</p>
<p>// The CoffeeFlavorFactory instance<br>
const flavorFactory = new CoffeeFlavorFactory();</p>
<p>function takeOrders(flavorIn, table) {<br>
flavors.push(flavorFactory.getCoffeeFlavor(flavorIn));<br>
tables.push(new CoffeeOrderContext(table));<br>
ordersMade++;<br>
}</p>
<p>takeOrders('Cappuccino', 2);<br>
takeOrders('Cappuccino', 2);<br>
takeOrders('Frappe', 1);<br>
takeOrders('Frappe', 1);<br>
takeOrders('Xpresso', 1);<br>
takeOrders('Frappe', 897);<br>
takeOrders('Cappuccino', 97);<br>
takeOrders('Cappuccino', 97);<br>
takeOrders('Frappe', 3);<br>
takeOrders('Xpresso', 3);<br>
takeOrders('Cappuccino', 3);<br>
takeOrders('Xpresso', 96);<br>
takeOrders('Frappe', 552);<br>
takeOrders('Cappuccino', 121);<br>
takeOrders('Xpresso', 121);</p>
<p>for (let i = 0; i &lt; ordersMade; ++i) {<br>
flavors[i].serveCoffee(tables[i]);<br>
}<br>
console.log(' ');<br>
console.log(<br>
<code>total CoffeeFlavor objects made: ${flavorFactory.getTotalCoffeeFlavorsMade()}</code><br>
);<br>
};</p>
<p>for (var i = 0; i &lt; ordersMade; ++i) {<br>
flavors[i].serveCoffee(tables[i]);<br>
}<br>
console.log(" ");<br>
console.log("total CoffeeFlavor objects made: " + flavorFactory.getTotalCoffeeFlavorsMade());<br>
}</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Library Book: Without Flyweight optimization</strong><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: class, constructor, const
<p>class Book {<br>
constructor(<br>
id,<br>
title,<br>
author,<br>
genre,<br>
pageCount,<br>
publisherID,<br>
ISBN,<br>
checkoutDate,<br>
checkoutMember,<br>
dueReturnDate,<br>
availability<br>
) {<br>
<a href=http://this.id>this.id</a> = id;<br>
this.title = title;<br>
this.author = author;<br>
this.genre = genre;<br>
this.pageCount = pageCount;<br>
this.publisherID = publisherID;<br>
this.ISBN = ISBN;<br>
this.checkoutDate = checkoutDate;<br>
this.checkoutMember = checkoutMember;<br>
this.dueReturnDate = dueReturnDate;<br>
this.availability = availability;<br>
}</p>
<p>getTitle() {<br>
return this.title;<br>
}</p>
<p>getAuthor() {<br>
return this.author;<br>
}</p>
<p>getISBN() {<br>
return this.ISBN;<br>
}</p>
<p>// For brevity, other getters are not shown<br>
updateCheckoutStatus(<br>
bookID,<br>
newStatus,<br>
checkoutDate,<br>
checkoutMember,<br>
newReturnDate<br>
) {<br>
<a href=http://this.id>this.id</a> = bookID;<br>
this.availability = newStatus;<br>
this.checkoutDate = checkoutDate;<br>
this.checkoutMember = checkoutMember;<br>
this.dueReturnDate = newReturnDate;<br>
}</p>
<p>extendCheckoutPeriod(bookID, newReturnDate) {<br>
<a href=http://this.id>this.id</a> = bookID;<br>
this.dueReturnDate = newReturnDate;<br>
}</p>
<p>}<br>
};</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Library Book: With just the intrinsic data</strong><pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, class, constructor
<pre><code>this.title = title;
this.author = author;
this.genre = genre;
this.pageCount = pageCount;
this.publisherID = publisherID;
this.ISBN = ISBN;
</code></pre>
<p>};</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Book Factory for managing Book objects</strong><pre><code class=language-javascript>
<p>// Book Factory singleton<br>
const existingBooks = {};</p>
<p>class BookFactory {<br>
constructor(title, author, genre, pageCount, publisherID, ISBN) {</p>
<pre><code>  // Find out if a particular book meta-data combination has been created before
  // !! or (bang bang) forces a boolean to be returned
this.existingBook = existingBooks[ISBN];
if (!!this.existingBook) {
  return this.existingBook;
} else {
  // if not, let's create a new instance of the book and store it
  const book = new Book(title, author, genre, pageCount, publisherID, ISBN);
  existingBooks[ISBN] = book;
  return book;

  }
}
</code></pre>
<p>};</p>
<p>})();</p>
</code><p><code class=language-javascript></code></pre><p><p><strong>Book Record Manager: Managing extrinsic states</strong><pre><code class=language-javascript>
<p>// BookRecordManager singleton<br>
var BookRecordManager = (function () {</p>
<p>var bookRecordDatabase = {};</p>
<p>return {<br>
// add a new book into the library system<br>
addBookRecord: function ( id, title, author, genre, pageCount, publisherID, ISBN, checkoutDate, checkoutMember, dueReturnDate, availability ) {</p>
<pre><code>  var book = BookFactory.createBook( title, author, genre, pageCount, publisherID, ISBN );

  bookRecordDatabase[id] = {
    checkoutMember: checkoutMember,
    checkoutDate: checkoutDate,
    dueReturnDate: dueReturnDate,
    availability: availability,
    book: book
  };
},
updateCheckoutStatus: function ( bookID, newStatus, checkoutDate, checkoutMember, newReturnDate ) {

  var record = bookRecordDatabase[bookID];
  record.availability = newStatus;
  record.checkoutDate = checkoutDate;
  record.checkoutMember = checkoutMember;
  record.dueReturnDate = newReturnDate;
},

extendCheckoutPeriod: function ( bookID, newReturnDate ) {
  bookRecordDatabase[bookID].dueReturnDate = newReturnDate;
},

isPastDue: function ( bookID ) {
  var currentDate = new Date();
  return currentDate.getTime() > Date.parse( bookRecordDatabase[bookID].dueReturnDate );
}
</code></pre>
<p>};</p>
</code><p><code class=language-javascript>})();<br>
</code></pre><p></details><h2>The Flyweight pattern and the DOM</h2><p>The DOM (Document Object Model) supports two approaches that allow objects to detect events - either top-down (event capture) or bottom-up (event bubbling).<p>In event capture, the event is first captured by the outer-most element and propagated to the inner-most element. In event bubbling, the event is captured and given to the inner-most element and then propagated to the outer elements.<p>One of the best metaphors for describing Flyweights in this context was written by Gary Chisholm and it goes a little like this:<p><blockquote>Try to think of the flyweight in terms of a pond. A fish opens its mouth (the event), bubbles rise to the surface (the bubbling) a fly sitting on the top flies away when the bubble reaches the surface (the action). In this example, we can easily transpose the fish opening its mouth to a button being clicked, the bubbles as the bubbling effect, and the fly flying away to some function being run.</blockquote><p><p>Bubbling was introduced to handle situations where a single event (e.g a click) may be handled by multiple event handlers defined at different levels of the DOM hierarchy. Where this happens, event bubbling executes event handlers defined for specific elements at the lowest level possible. From there on, the event bubbles up to containing elements before going to those even higher up.<p>Flyweights can be used to tweak the event bubbling process further, as we will see shortly.<h3>Example 1: Centralized event handling</h3><p>For our first practical example, imagine we have a number of similar elements in a document with similar behavior executed when a user-action (e.g click, mouse-over) is performed against them.<p>Normally what we do when constructing our own accordion component, menu or other list-based widget is bind a click event to each link element in the parent container (e.g <code>$('ul li a').on(..)</code>. Instead of binding the click to multiple elements, we can easily attach a Flyweight to the top of our container which can listen for events coming from below. These can then be handled using logic that is as simple or complex as required.<p>As the types of components mentioned often have the same repeating markup for each section (e.g. each section of an accordion), there's a good chance the behavior of each element that may be clicked is going to be quite similar and relative to similar classes nearby. We'll use this information to construct a very basic accordion using the Flyweight below.<p>A stateManager namespace is used here to encapsulate our flyweight logic whilst jQuery is used to bind the initial click to a container div. In order to ensure that no other logic on the page is attaching similar handles to the container, an unbind event is first applied.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const,  arrow function syntax,
//      destructuring assignment syntax 
const stateManager = {
    fly() {
        const self = this;

        $('#container')
            .unbind()
            .on('click', 'div.toggle', ({
                target
            }) => {
                self.handleClick(target);
            });
    },

    handleClick(elem) {
        $(elem)
            .find('span')
            .toggle('slow');
    },
};
</code></pre><p>The benefit here is that we're converting many independent actions into shared ones (potentially saving on memory).<h3>Example 2: Using the Flyweight for performance optimization</h3><p>In our second example, we'll reference some further performance gains that can be achieved using Flyweights with jQuery.<p>James Padolsey previously wrote an article called <em>76 bytes for faster jQuery</em> where he reminded us that each time jQuery fires off a callback, regardless of type (filter, each, event handler), we're able to access the function's context (the DOM element related to it) via the <code>this</code> keyword.<p>Unfortunately, many of us have become used to the idea of wrapping <code>this</code> in <code>$()</code> or <code>jQuery()</code>, which means that a new instance of jQuery is unnecessarily constructed every time, rather than simply doing this:<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: template literals for string interpolation
$('div').on('click', function() {
    console.log(`You clicked: ${$(this).attr('id')}`);
});

// we should avoid using the DOM element to create a
// jQuery object (with the overhead that comes with it)
// and just use the DOM element itself like this:

$('div').on('click', function() {
    console.log(`You clicked:${this.id}`);
});
</code></pre><p>James had wanted to use jQuery's <code>jQuery.text</code> in the following context, however he disagreed with the notion that a new jQuery object had to be created on each iteration:<pre><code class=language-javascript>
$("a").map(function() {
    return $(this).text();
});
</code></pre><p>Now with respect to redundant wrapping, where possible with jQuery's utility methods, it's better to use <code>jQuery.methodName</code> (e.g <code>jQuery.text</code>) as opposed to <code>jQuery.fn.methodName</code> (e.g <code>jQuery.fn.text</code>) where methodName represents a utility such as <code>each()</code> or <code>text</code>. This avoids the need to call a further level of abstraction or construct a new jQuery object each time our function is called as <code>jQuery.methodName</code> is what the library itself uses at a lower level to power <code>jQuery.fn.methodName</code>.<p>Because however not all of jQuery's methods have corresponding single-node functions, Padolsey devised the idea of a jQuery.single utility.<p>The idea here is that a single jQuery object is created and used for each call to jQuery.single (effectively meaning only one jQuery object is ever created). The implementation for this can be found below and as we're consolidating data for multiple possible objects into a more central singular structure, it is technically also a Flyweight.<pre><code class=language-javascript>
// ES2015+ keywords/syntax used: const, arrow function syntax

jQuery.single = (o => {
    const collection = jQuery([1]);
    return element => {
        // Give collection the element:
        collection[0] = element;

        // Return the collection:
        return collection;
    };
})();
</code></pre><p>An example of this in action with chaining is:<pre><code class=language-javascript>
$('div').on('click', function() {
  const html = jQuery
    .single(this)
    .next()
    .html();
  console.log(html);
});
</code></pre><p>Note: Although we may believe that simply caching our jQuery code may offer just as equivalent performance gains, Padolsey claims that $.single() is still worth using and can perform better. That's not to say don't apply any caching at all, just be mindful that this approach can assist. For further details about $.single, I recommend reading Padolsey's full post.<details><summary><strong>Flyweight Pattern and the DOM: ES5/Classical Approach</strong></summary><p>We use a combination of jQuery with classic JavaScript here to provide the syntax corresponding to the examples discussed previously.<p><strong>Centralized Event Handling</strong><pre><code class=language-javascript>
var stateManager = {
<p>fly: function () {</p>
<pre><code>var self = this;

$( "#container" )
      .unbind()
      .on( "click", "div.toggle", function ( e ) {
        self.handleClick( e.target );
      });
</code></pre>
<p>},</p>
</code><p><code class=language-javascript>handleClick: function ( elem ) {<br>
$( elem ).find( "span" ).toggle( "slow" );<br>
}<br>
};<br>
</code></pre><p><p><strong>Flyweight for Performance Optimization</strong><p>Using DOM element itself in jQuery:<pre><code class=language-javascript>
$("div").on( "click", function () {
  console.log( "You clicked: " + $( this ).attr( "id" ));
});
<p>// we should avoid using the DOM element to create a<br>
// jQuery object (with the overhead that comes with it)<br>
// and just use the DOM element itself like this:</p>
</code><p><code class=language-javascript>$( "div" ).on( "click", function () {<br>
console.log( "You clicked:"  + <a href=http://this.id>this.id</a> );<br>
});<br>
</code></pre><p><p>Calling DOM element methods:<pre><code class=language-javascript>
$('a').map(function() {
  return $(this).text();
});
</code></pre><p>Consolidation to a Single Flyweight:<pre><code class=language-javascript>
jQuery.single = (function( o ){
<p>var collection = jQuery([1]);<br>
return function( element ) {</p>
<pre><code>   // Give collection the element:
   collection[0] = element;

    // Return the collection:
   return collection;
</code></pre>
</code><p><code class=language-javascript>};<br>
})();<br>
</code></pre><p><p>Usage with chaining:<pre><code class=language-javascript>
$( "div" ).on( "click", function () {
<p>var html = jQuery.single( this ).next().html();<br>
console.log( html );</p>
<p>});</p>
</code><p><code class=language-javascript></code></pre><p></details><p> </section><section><h1 id=detailmvcmvp><a href=#detailmvcmvp class=subhead-link>#</a> JavaScript MV* Patterns</h1><p>In this section, we're going to review three very important architectural patterns - MVC (Model-View-Controller), MVP (Model-View-Presenter) and MVVM (Model-View-ViewModel). In the past, these patterns have been heavily used for structuring desktop and server-side applications but it's only been in recent years that come to being applied to JavaScript.<p>As the majority of JavaScript developers currently using these patterns opt to utilize libraries such as Backbone.js for implementing an MVC/MV*-like structure, we will compare how modern solutions such as it differ in their interpretation of MVC compared to classical takes on these patterns.<p>Let us first now cover the basics.<h2 id=detailmvc>MVC</h2><p>MVC is an architectural design pattern that encourages improved application organization through a separation of concerns. It enforces the isolation of business data (Models) from user interfaces (Views), with a third component (Controllers) traditionally managing logic and user-input. The pattern was originally designed by <a href=http://en.wikipedia.org/wiki/Trygve_Reenskaug>Trygve Reenskaug</a> during his time working on Smalltalk-80 (1979) where it was initially called Model-View-Controller-Editor. MVC went on to be described in depth in 1995's <a href=http://www.amazon.co.uk/Design-patterns-elements-reusable-object-oriented/dp/0201633612>“Design Patterns: Elements of Reusable Object-Oriented Software”</a> (The "GoF" book), which played a role in popularizing its use.<h3>Smalltalk-80 MVC</h3><p>It's important to understand what the original MVC pattern was aiming to solve as it's mutated quite heavily since the days of its origin. Back in the 70's, graphical user-interfaces were few and far between and a concept known as <a href=http://martinfowler.com/eaaDev/uiArchs.html>Separated Presentation</a> began to be used as a means to make a clear division between domain objects which modeled concepts in the real world (e.g a photo, a person) and the presentation objects which were rendered to the user's screen.<p>The Smalltalk-80 implementation of MVC took this concept further and had an objective of separating out the application logic from the user interface. The idea was that decoupling these parts of the application would also allow the reuse of models for other interfaces in the application. There are some interesting points worth noting about Smalltalk-80's MVC architecture:<ul><li>A Model represented domain-specific data and was ignorant of the user-interface (Views and Controllers). When a model changed, it would inform its observers.<li>A View represented the current state of a Model. The Observer pattern was used for letting the View know whenever the Model was updated or modified.<li>Presentation was taken care of by the View, but there wasn't just a single View and Controller - a View-Controller pair was required for each section or element being displayed on the screen.<li>The Controllers role in this pair was handling user interaction (such as key-presses and actions e.g. clicks), making decisions for the View.</ul><p>Developers are sometimes surprised when they learn that the Observer pattern (nowadays commonly implemented as the Publish/Subscribe variation) was included as a part of MVC's architecture many decades ago. In Smalltalk-80's MVC, the View observes the Model. As mentioned in the bullet point above, anytime the Model changes, the Views react. A simple example of this is an application backed by stock market data - in order for the application to be useful, any change to the data in our Models should result in the View being refreshed instantly.<p>Martin Fowler has done an excellent job of writing about the <a href=http://martinfowler.com/eaaDev/uiArchs.html>origins</a> of MVC over the years and if interested in some further historical information about Smalltalk-80's MVC, I recommend reading his work.<h2>MVC For JavaScript Developers</h2><p>We've reviewed the 70's, but let us now return to the here and now. In modern times, the MVC pattern has been applied to a diverse range of programming languages including of most relevance to us: JavaScript. JavaScript now has a number of frameworks boasting support for MVC (or variations on it, which we refer to as the MV* family), allowing developers to easily add structure to their applications without great effort.<p>These frameworks include the likes of Backbone, Ember.js and AngularJS. Given the importance of avoiding "spaghetti" code, a term which describes code that is very difficult to read or maintain due to its lack of structure, it's imperative that the modern JavaScript developer understand what this pattern provides. This allows us to effectively appreciate what these frameworks enable us to do differently.<p>We know that MVC is composed of three core components:<h3>Models</h3><p>Models manage the data for an application. They are concerned with neither the user-interface nor presentation layers but instead represent unique forms of data that an application may require. When a model changes (e.g when it is updated), it will typically notify its observers (e.g views, a concept we will cover shortly) that a change has occurred so that they may react accordingly.<p>To understand models further, let us imagine we have a JavaScript photo gallery application. In a photo gallery, the concept of a photo would merit its own model as it represents a unique kind of domain-specific data. Such a model may contain related attributes such as a caption, image source and additional meta-data. A specific photo would be stored in an instance of a model and a model may also be reusable. Below we can see an example of a very simplistic model implemented using Backbone.<pre><code class=language-javascript>
var Photo = Backbone.Model.extend({

    // Default attributes for the photo
    defaults: {
      src: "placeholder.jpg",
      caption: "A default image",
      viewed: false
    },

    // Ensure that each photo created has an `src`.
    initialize: function() {
       this.set( { "src": this.defaults.src} );
    }

});
</code></pre><p>The built-in capabilities of models vary across frameworks, however it is quite common for them to support validation of attributes, where attributes represent the properties of the model, such as a model identifier. When using models in real-world applications we generally also desire model persistence. Persistence allows us to edit and update models with the knowledge that its most recent state will be saved in either: memory, in a user's localStorage data-store or synchronized with a database.<p>In addition, a model may also have multiple views observing it. If say, our photo model contained meta-data such as its location (longitude and latitude), friends that were present in the photo (a list of identifiers) and a list of tags, a developer may decide to provide a single view to display each of these three facets.<p>It is not uncommon for modern MVC/MV* frameworks to provide a means to group models together (e.g. in Backbone, these groups are referred to as "collections"). Managing models in groups allows us to write application logic based on notifications from the group should any model it contains be changed. This avoids the need to manually observe individual model instances.<p>A sample grouping of models into a simplified Backbone collection can be seen below.<pre><code class=language-javascript>
var PhotoGallery = Backbone.Collection.extend({

    // Reference to this collection's model.
    model: Photo,

    // Filter down the list of all photos
    // that have been viewed
    viewed: function() {
        return this.filter(function( photo ){
           return photo.get( "viewed" );
        });
    },

    // Filter down the list to only photos that
    // have not yet been viewed
    unviewed: function() {
      return this.without.apply( this, this.viewed() );
    }
});
</code></pre><p>Older texts on MVC may also contain reference to a notion of models managing application <em>state</em>.In JavaScript applications <em>state</em> has a different connotation, typically referring to the current "state" i.e view or sub-view (with specific data) on a users screen at a fixed point. State is a topic which is regularly discussed when looking at Single-page applications, where the concept of state needs to be simulated.<p>So to summarize, models are primarily concerned with business data.<h3>Views</h3><p>Views are a visual representation of models that present a filtered view of their current state. Whilst Smalltalk views are about painting and maintaining a bitmap, JavaScript views are about building and maintaining a DOM element.<p>A view typically observes a model and is notified when the model changes, allowing the view to update itself accordingly. Design pattern literature commonly refers to views as "dumb" given that their knowledge of models and controllers in an application is limited.<p>Users are able to interact with views and this includes the ability to read and edit (i.e get or set the attribute values in) models. As the view is the presentation layer, we generally present the ability to edit and update in a user-friendly fashion. For example, in the former photo gallery application we discussed earlier, model editing could be facilitated through an "edit' view where a user who has selected a specific photo could edit its meta-data.<p>The actual task of updating the model falls to controllers (which we will be covering shortly).<p>Let's explore views a little further using a vanilla JavaScript sample implementation. Below we can see a function that creates a single Photo view, consuming both a model instance and a controller instance.<p>We define a <code>render()</code> utility within our view which is responsible for rendering the contents of the <code>photoModel</code> using a JavaScript templating engine (Underscore templating) and updating the contents of our view, referenced by <code>photoEl</code>.<p>The <code>photoModel</code> then adds our <code>render()</code> callback as one of its subscribers so that through the Observer pattern we can trigger the view to update when the model changes.<p>One may wonder where user-interaction comes into play here. When users click on any elements within the view, it's not the view's responsibility to know what to do next. It relies on a controller to make this decision for it. In our sample implementation, this is achieved by adding an event listener to <code>photoEl</code> which will delegate handling the click behavior back to the controller, passing the model information along with it in case it's needed.<p>The benefit of this architecture is that each component plays its own separate role in making the application function as needed.<pre><code class=language-javascript>
var buildPhotoView = function ( photoModel, photoController ) {

  var base = document.createElement( "div" ),
      photoEl = document.createElement( "div" );

  base.appendChild(photoEl);

  var render = function () {
          // We use a templating library such as Underscore
          // templating which generates the HTML for our
          // photo entry
          photoEl.innerHTML = _.template( "#photoTemplate", {
              src: photoModel.getSrc()
          });
      };

  photoModel.addSubscriber( render );

  photoEl.addEventListener( "click", function () {
    photoController.handleEvent( "click", photoModel );
  });

  var show = function () {
    photoEl.style.display = "";
  };

  var hide = function () {
    photoEl.style.display = "none";
  };

  return {
    showView: show,
    hideView: hide
  };

};
</code></pre><p><strong>Templating</strong><p>In the context of JavaScript frameworks that support MVC/MV*, it is worth briefly discussing JavaScript templating and its relationship to views as we briefly touched upon it in the last section.<p>It has long been considered (and proven) a performance bad practice to manually create large blocks of HTML markup in-memory through string concatenation. Developers doing so have fallen prey to inperformantly iterating through their data, wrapping it in nested divs and using outdated techniques such as <code>document.write</code> to inject the "template" into the DOM. As this typically means keeping scripted markup inline with our standard markup, it can quickly become both difficult to read and more importantly, maintain such disasters, especially when building non-trivially sized applications.<p>JavaScript templating solutions (such as Handlebars.js and Mustache) are often used to define templates for views as markup (either stored externally or within script tags with a custom type - e.g text/template) containing template variables. Variables may be delimitated using a variable syntax (e.g ) and frameworks are typically smart enough to accept data in a JSON form (which model instances can be converted to) such that we only need be concerned with maintaining clean models and clean templates. Most of the grunt work to do with population is taken care of by the framework itself. This has a large number of benefits, particularly when opting to store templates externally as this can give way to templates being dynamically loaded on an as-needed basis when it comes to building larger applications.<p>Below we can see two examples of HTML templates. One implemented using the popular Handlebars.js framework and another using Underscore's templates.<p><strong>Handlebars.js:</strong><pre><code class=language-javascript>
&lt;li class="photo">
  &lt;h2>&lt;/h2>
  &lt;img class="source" src=""/>
  &lt;div class="meta-data">
    {"title":"Patterns.dev","url":"https://patterns.dev","domain":"patterns.dev","description":"Patterns.dev is a free book on design patterns and component patterns for building powerful web apps with vanilla JavaScript and React.","genre":"Book","googleAnalyticsId":"UA-195058122-1","sendWebVitals":true,"feed":{"subtitle":"Patterns.dev is a fresh look at design patterns and component patterns for building powerful web apps with vanilla JavaScript and React.","filename":"feed.xml","path":"/feed/feed.xml","id":"https://patterns.dev"},"jsonfeed":{"path":"/feed/feed.json","url":"https://patterns.dev/feed/feed.json"},"author":{"name":"The Patterns.dev team","twitterHandle":"update_me"},"publisher":{"name":"The Patterns.dev team"}}
  &lt;/div>
&lt;/li>
</code></pre><p><strong>Underscore.js Microtemplates:</strong><pre><code class=language-javascript>
&lt;li class="photo">
  &lt;h2>&lt;%= caption %>&lt;/h2>
  &lt;img class="source" src="&lt;%= src %>"/>
  &lt;div class="meta-data">
    &lt;%= metadata %>
  &lt;/div>
&lt;/li>
</code></pre><p>Note that templates are not themselves views. Developers coming from a Struts Model 2 architecture may feel like a template *is* a view, but it isn't. A view is an object which observes a model and keeps the visual representation up-to-date. A template *might* be a declarative way to specify part or even all of a view object so that it can be generated from the template specification.<p>It is also worth noting that in classical web development, navigating between independent views required the use of a page refresh. In Single-page JavaScript applications however, once data is fetched from a server via Ajax, it can simply be dynamically rendered in a new view within the same page without any such refresh being necessary.<p>The role of navigation thus falls to a "router", which assists in managing application state (e.g allowing users to bookmark a particular view they have navigated to). As routers are, however, neither a part of MVC nor present in every MVC-like framework, I will not be going into them in greater detail in this section.<p>To summarize, views are a visual representation of our application data.<h3>Controllers</h3><p>Controllers are an intermediary between models and views which are classically responsible for updating the model when the user manipulates the view.<p>In our photo gallery application, a controller would be responsible for handling changes the user made to the edit view for a particular photo, updating a specific photo model when a user has finished editing.<p>Remember that the controllers fulfill one role in MVC: the facilitation of the Strategy pattern for the view. In the Strategy pattern regard, the view delegates to the controller at the view's discretion. So, that's how the strategy pattern works. The view could delegate handling user events to the controller when the view sees fit. The view *could* delegate handling model change events to the controller if the view sees fit, but this is not the traditional role of the controller.<p>In terms of where most JavaScript MVC frameworks detract from what is conventionally considered "MVC" however, it is with controllers. The reasons for this vary, but in my honest opinion, it is that framework authors initially look at the server-side interpretation of MVC, realize that it doesn't translate 1:1 on the client-side and re-interpret the C in MVC to mean something they feel makes more sense. The issue with this however is that it is subjective, increases the complexity in both understanding the classical MVC pattern and of course the role of controllers in modern frameworks.<p>As an example, let's briefly review the architecture of the popular architectural framework Backbone.js. Backbone contains models and views (somewhat similar to what we reviewed earlier), however it doesn't actually have true controllers. Its views and routers act a little similar to a controller, but neither are actually controllers on their own.<p>In this respect, contrary to what might be mentioned in the official documentation or in blog posts, Backbone is neither a truly MVC/MVP nor MVVM framework. It's in fact better to consider it a member of the MV* family which approaches architecture in its own way. There is of course nothing wrong with this, but it is important to distinguish between classical MVC and MV* should we begin relying on advice from classical literature on the former to help with the latter.<h3>Controllers in another library (Spine.js) vs Backbone.js</h3><p><strong>Spine.js</strong><p>We now know that controllers are traditionally responsible for updating the model when the user updates the view. It's interesting to note that the most popular JavaScript MVC/MV* framework at the time of writing (Backbone) does not have it's <strong>own</strong> explicit concept of controllers.<p>It can thus be useful for us to review the controller from another MVC framework to appreciate the difference in implementations and further demonstrate how nontraditionally frameworks approach the role of the controller. For this, let's take a look at a sample controller from Spine.js:<p>In this example, we're going to have a controller called <code>PhotosController</code> which will be in charge of individual photos in the application. It will ensure that when the view updates (e.g a user edited the photo meta-data) the corresponding model does too.<p>Note: We won't be delving heavily into Spine.js at all, but will just take a ten-foot view of what its controllers can do:<pre><code class=language-javascript>

// Controllers in Spine are created by inheriting from Spine.Controller

var PhotosController = Spine.Controller.sub({

  init: function () {
    this.item.bind( "update", this.proxy( this.render ));
    this.item.bind( "destroy", this.proxy( this.remove ));
  },

  render: function () {
    // Handle templating
    this.replace( $( "#photoTemplate" ).tmpl( this.item ) );
    return this;
  },

  remove: function () {
    this.el.remove();
    this.release();
  }
});

</code></pre><p>In Spine, controllers are considered the glue for an application, adding and responding to DOM events, rendering templates and ensuring that views and models are kept in sync (which makes sense in the context of what we know to be a controller).<p>What we're doing in the above example is setting up listeners in the <code>update</code> and <code>destroy</code> events using <code>render()</code> and <code>remove()</code>. When a photo entry gets updated, we re-render the view to reflect the changes to the meta-data. Similarly, if the photo gets deleted from the gallery, we remove it from the view. In the <code>render()</code> function, we're using Underscore micro-templating (via <code>_.template()</code>) to render a JavaScript template with the ID #photoTemplate. This simply returns a compiled HTML string used to populate the contents of <code>photoEl</code>.<p>What this provides us with is a very lightweight, simple way to manage changes between the model and the view.<p><strong>Backbone.js</strong><p>Later on in this section we're going to revisit the differences between Backbone and traditional MVC, but for now let's focus on controllers.<p>In Backbone, one shares the responsibility of a controller with both the <code>Backbone.View</code> and <code>Backbone.Router</code>. Some time ago Backbone did once come with its own <code>Backbone.Controller</code>, but as the naming for this component didn't make sense for the context in which it was being used, it was later renamed to Router.<p>Routers handle a little more of the controller responsibility as it's possible to bind the events there for models and have our view respond to DOM events and rendering. As Tim Branyen (another Bocoup-based Backbone contributor) has also previously pointed out, it's possible to get away with not needing <code>Backbone.Router</code> at all for this, so a way to think about it using the Router paradigm is probably:<pre><code class=language-javascript>
var PhotoRouter = Backbone.Router.extend({
  routes: { "photos/:id": "route" },

  route: function( id ) {
    var item = photoCollection.get( id );
    var view = new PhotoView( { model: item } );

    $('.content').html( view.render().el );
  }
});
</code></pre><p>To summarize, the takeaway from this section is that controllers manage the logic and coordination between models and views in an application.<h2>What does MVC give us?</h2><p>This separation of concerns in MVC facilitates simpler modularization of an application's functionality and enables:<ul><li>Easier overall maintenance. When updates need to be made to the application it is very clear whether the changes are data-centric, meaning changes to models and possibly controllers, or merely visual, meaning changes to views.<li>Decoupling models and views means that it is significantly more straight-forward to write unit tests for business logic<li>Duplication of low-level model and controller code (i.e what we may have been using instead) is eliminated across the application<li>Depending on the size of the application and separation of roles, this modularity allows developers responsible for core logic and developers working on the user-interfaces to work simultaneously</ul><h2>Smalltalk-80 MVC In JavaScript</h2><p>Although the majority of modern-day JavaScript frameworks attempt to evolve the MVC paradigm to better fit the differing needs of web application development, there is one framework which attempts to adhere to the pure form of the pattern found in Smalltalk-80. Maria.js (<a href=https://github.com/petermichaux/maria>https://github.com/petermichaux/maria</a>) by Peter Michaux offers an implementation which is faithful to MVCs origins - Models are models, Views are views and Controllers are nothing but controllers. Whilst some developers might feel an MV* framework should address more concerns, this is a useful reference to be aware of in case you would like a JavaScript implementation of the original MVC.<h3>Delving deeper</h3><p>At this point in the book, we should have a basic understanding of what the MVC pattern provides, but there's still some fascinating information about it worth noting.<p>The GoF do not refer to MVC as a design pattern, but rather consider it a <em>set of classes to build a user interface</em>. In their view, it's actually a variation of three classical design patterns: the Observer, Strategy and Composite patterns. Depending on how MVC has been implemented in a framework, it may also use the Factory and Template patterns. The GoF book mentions these patterns as useful extras when working with MVC.<p>As we have discussed, models represent application data whilst views are what the user is presented on screen. As such, MVC relies on the Observer pattern for some of its core communication (something that surprisingly isn't covered in many articles about the MVC pattern). When a model is changed it notifies its observers (Views) that something has been updated - this is perhaps the most important relationship in MVC. The observer nature of this relationship is also what facilitates multiple views being attached to the same model.<p>For developers interested in knowing more about the decoupled nature of MVC (once again, depending on the implementation), one of the goals of the pattern is to help define one-to-many relationships between a topic (data object) and its observers. When a topic changes, its observers are updated. Views and controllers have a slightly different relationship. Controllers facilitate views to respond to different user input and are an example of the Strategy pattern.<h3>Summary</h3><p>Having reviewed the classical MVC pattern, we should now understand how it allows us to cleanly separate concerns in an application. We should also now appreciate how JavaScript MVC frameworks may differ in their interpretation of the MVC pattern, which although quite open to variation, still shares some of the fundamental concepts the original pattern has to offer.<p>When reviewing a new JavaScript MVC/MV* framework, remember - it can be useful to step back and review how it's opted to approach architecture (specifically, how it supports implementing models, views, controllers or other alternatives) as this can better help us grok how the framework expects to be used.<h2 id=detailmvp>MVP</h2><p>Model-view-presenter (MVP) is a derivative of the MVC design pattern which focuses on improving presentation logic. It originated at a company named <a href=http://en.wikipedia.org/wiki/Taligent>Taligent</a> in the early 1990s while they were working on a model for a C++ CommonPoint environment. Whilst both MVC and MVP target the separation of concerns across multiple components, there are some fundamental differences between them.<p>For the purposes of this summary we will focus on the version of MVP most suitable for web-based architectures.<h3>Models, Views & Presenters</h3><p>The P in MVP stands for presenter. It's a component which contains the user-interface business logic for the view. Unlike MVC, invocations from the view are delegated to the presenter, which are decoupled from the view and instead talk to it through an interface. This allows for all kinds of useful things such as being able to mock views in unit tests.<p>The most common implementation of MVP is one which uses a Passive View (a view which is for all intents and purposes "dumb"), containing little to no logic. If MVC and MVP are different it is because the C and P do different things. In MVP, the P observes models and updates views when models change. The P effectively binds models to views, a responsibility which was previously held by controllers in MVC.<p>Solicited by a view, presenters perform any work to do with user requests and pass data back to them. In this respect, they retrieve data, manipulate it and determine how the data should be displayed in the view. In some implementations, the presenter also interacts with a service layer to persist data (models). Models may trigger events but it's the presenters role to subscribe to them so that it can update the view. In this passive architecture, we have no concept of direct data binding. Views expose setters which presenters can use to set data.<p>The benefit of this change from MVC is that it increases the testability of our application and provides a more clean separation between the view and the model. This isn't however without its costs as the lack of data binding support in the pattern can often mean having to take care of this task separately.<p>Although a common implementation of a <a href=http://martinfowler.com/eaaDev/PassiveScreen.html>Passive View</a> is for the view to implement an interface, there are variations on it, including the use of events which can decouple the View from the Presenter a little more. As we don't have the interface construct in JavaScript, we're using more a protocol than an explicit interface here. It's technically still an API and it's probably fair for us to refer to it as an interface from that perspective.<p>There is also a <a href=http://martinfowler.com/eaaDev/SupervisingPresenter.html>Supervising Controller</a> variation of MVP, which is closer to the MVC and <a href=http://en.wikipedia.org/wiki/Model_View_ViewModel>MVVM</a> patterns as it provides data-binding from the Model directly from the View. Key-value observing (KVO) plugins (such as Derick Bailey's Backbone.ModelBinding plugin) tend to bring Backbone out of the Passive View and more into the Supervising Controller or MVVM variations.<h3>MVP or MVC?</h3><p>MVP is generally used most often in enterprise-level applications where it's necessary to reuse as much presentation logic as possible. Applications with very complex views and a great deal of user interaction may find that MVC doesn't quite fit the bill here as solving this problem may mean heavily relying on multiple controllers. In MVP, all of this complex logic can be encapsulated in a presenter, which can simplify maintenance greatly.<p>As MVP views are defined through an interface and the interface is technically the only point of contact between the system and the view (other than a presenter), this pattern also allows developers to write presentation logic without needing to wait for designers to produce layouts and graphics for the application.<p>Depending on the implementation, MVP may be easier to automatically unit test than MVC. The reason often cited for this is that the presenter can be used as a complete mock of the user-interface and so it can be unit tested independent of other components. In my experience this really depends on the languages we are implementing MVP in (there's quite a difference between opting for MVP for a JavaScript project over one for say, ASP.net).<p>At the end of the day, the underlying concerns we may have with MVC will likely hold true for MVP given that the differences between them are mainly semantic. As long as we are cleanly separating concerns into models, views and controllers (or presenters) we should be achieving most of the same benefits regardless of the variation we opt for.<h3>MVC, MVP and Backbone.js</h3><p>There are very few, if any architectural JavaScript frameworks that claim to implement the MVC or MVP patterns in their classical form as many JavaScript developers don't view MVC and MVP as being mutually exclusive (we are actually more likely to see MVP strictly implemented when looking at web frameworks such as ASP.net or GWT). This is because it's possible to have additional presenter/view logic in our application and yet still consider it a flavor of MVC.<p>Backbone contributor <a href=http://ireneros.com/ >Irene Ros</a> (of Boston-based Bocoup) subscribes to this way of thinking as when she separates views out into their own distinct components, she needs something to actually assemble them for her. This could either be a controller route (such as a <code>Backbone.Router</code>, covered later in the book) or a callback in response to data being fetched.<p>That said, some developers do however feel that Backbone.js better fits the description of MVP than it does MVC. Their view is that:<ul><li>The presenter in MVP better describes the <code>Backbone.View</code> (the layer between View templates and the data bound to it) than a controller does<li>The model fits <code>Backbone.Model</code> (it isn't greatly different to the models in MVC at all)<li>The views best represent templates (e.g Handlebars/Mustache markup templates)</ul><p>A response to this could be that the view can also just be a View (as per MVC) because Backbone is flexible enough to let it be used for multiple purposes. The V in MVC and the P in MVP can both be accomplished by <code>Backbone.View</code> because they're able to achieve two purposes: both rendering atomic components and assembling those components rendered by other views.<p>We've also seen that in Backbone the responsibility of a controller is shared with both the Backbone.View and Backbone.Router and in the following example we can actually see that aspects of that are certainly true.<p>Our Backbone <code>PhotoView</code> uses the Observer pattern to "subscribe" to changes to a View's model in the line <code>this.model.bind("change",...)</code>. It also handles templating in the <code>render()</code> method, but unlike some other implementations, user interaction is also handled in the View (see <code>events</code>).<pre><code class=language-javascript>

var PhotoView = Backbone.View.extend({

    //... is a list tag.
    tagName: "li",

    // Pass the contents of the photo template through a templating
    // function, cache it for a single photo
    template: _.template( $("#photo-template").html() ),

    // The DOM events specific to an item.
    events: {
      "click img": "toggleViewed"
    },

    // The PhotoView listens for changes to
    // its model, re-rendering. Since there's
    // a one-to-one correspondence between a
    // **Photo** and a **PhotoView** in this
    // app, we set a direct reference on the model for convenience.

    initialize: function() {
      this.model.on( "change", this.render, this );
      this.model.on( "destroy", this.remove, this );
    },

    // Re-render the photo entry
    render: function() {
      $( this.el ).html( this.template(this.model.toJSON() ));
      return this;
    },

    // Toggle the `"viewed"` state of the model.
    toggleViewed: function() {
      this.model.viewed();
    }

});
</code></pre><p>Another (quite different) opinion is that Backbone more closely resembles <a href=http://martinfowler.com/eaaDev/uiArchs.html#ModelViewController>Smalltalk-80 MVC</a>, which we went through earlier.<p>As regular Backbone blogger Derick Bailey has <a href=http://lostechies.com/derickbailey/2011/12/23/backbone-js-is-not-an-mvc-framework/ >previously</a> put it, it's ultimately best not to force Backbone to fit any specific design patterns. Design patterns should be considered flexible guides to how applications may be structured and in this respect, Backbone fits neither MVC nor MVP. Instead, it borrows some of the best concepts from multiple architectural patterns and creates a flexible framework that just works well.<p>It <em>is</em> however worth understanding where and why these concepts originated, so I hope that my explanations of MVC and MVP have been of help. Call it <strong>the Backbone way</strong>, MV* or whatever helps reference its flavor of application architecture. Most structural JavaScript frameworks will adopt their own take on classical patterns, either intentionally or by accident, but the important thing is that they help us develop applications which are organized, clean and can be easily maintained.<p> </section><section><h2 id=detailmvvm><a href=#detailmvvm class=subhead-link>#</a> MVVM</h2><p>MVVM (Model View ViewModel) is an architectural pattern based on MVC and MVP, which attempts to more clearly separate the development of user-interfaces (UI) from that of the business logic and behavior in an application. To this end, many implementations of this pattern make use of declarative data bindings to allow a separation of work on Views from other layers.<p>This facilitates UI and development work occurring almost simultaneously within the same codebase. UI developers write bindings to the ViewModel within their document markup (HTML), where the Model and ViewModel are maintained by developers working on the logic for the application.<h3>History</h3><p>MVVM (by name) was originally defined by Microsoft for use with Windows Presentation Foundation (<a href=http://en.wikipedia.org/wiki/Windows_Presentation_Foundation>WPF</a>) and <a href=http://www.microsoft.com/silverlight/ >Silverlight</a>, having been officially announced in 2005 by <a href=http://blogs.msdn.com/b/johngossman/ >John Grossman</a> in a blog post about Avalon (the codename for WPF). It also found some popularity in the Adobe Flex community as an alternative to simply using MVC.<p>Prior to Microsoft adopting the MVVM name, there was however a movement in the community to go from MVP to MVPM: Model View <a href=http://blogs.adobe.com/paulw/archives/2007/10/presentation_pa_3.html>PresentationModel</a>. Martin Fowler wrote an <a href=http://martinfowler.com/eaaDev/PresentationModel.html>article</a> on PresentationModels back in 2004 for those interested in reading more about it. The idea of a <a href=http://blogs.infragistics.com/blogs/craig_shoemaker/archive/2009/11/03/learning-model-view-viewmodel-and-presentation-model.aspx>PresentationModel</a> had been around much longer than this article, however it was considered the big break in the idea and greatly helped popularize it.<p>There was quite a lot of uproar in the "alt.net" circles after Microsoft announced MVVM as an alternative to MVPM. Many claimed the company's dominance in the GUI world was giving them the opportunity to take over the community as a whole, renaming existing concepts as they pleased for marketing purposes. A progressive crowd recognized that whilst MVVM and MVPM were effectively the same idea, they came in slightly different packages.<p>In recent years, MVVM has been implemented in JavaScript in the form of structural frameworks such as <a href=http://knockoutjs.com/ >KnockoutJS</a>, <a href=http://www.kendoui.com/web/roadmap.aspx>Kendo MVVM</a> and <a href=https://github.com/kmalakoff/knockback>Knockback.js</a>, with an overall positive response from the community.<p>Let’s now review the three components that compose MVVM.<h3>Model</h3><p>As with other members of the MV* family, the Model in MVVM represents domain-specific data or information that our application will be working with. A typical example of domain-specific data might be a user account (e.g name, avatar, e-mail) or a music track (e.g title, year, album).<p>Models hold information, but typically don’t handle behavior. They don’t format information or influence how data appears in the browser as this isn’t their responsibility. Instead, formatting of data is handled by the View, whilst behavior is considered business logic that should be encapsulated in another layer that interacts with the Model - the ViewModel.<p>The only exception to this rule tends to be validation and it’s considered acceptable for Models to validate data being used to define or update existing models (e.g does an e-mail address being input meet the requirements of a particular regular expression?).<p>In KnockoutJS, Models fall under the above definition, but often make Ajax calls to a server-side service to both read and write Model data.<p>If we were constructing a simple Todo application, a KnockoutJS Model representing a single Todo item could look as follows:<pre><code class=language-javascript>
var Todo = function ( content, done ) {
    this.content = ko.observable(content);
    this.done = ko.observable(done);
    this.editing = ko.observable(false);
};
</code></pre><p>Note: One may notice in the above snippet that we are calling the method <code>observable()</code> on the KnockoutJS namespace <code>ko</code>. In KnockoutJS, observables are special JavaScript objects that can notify subscribers about changes and automatically detect dependencies. This allows us to synchronize Models and ViewModels when the value of a Model attribute is modified.<h3>View</h3><p>As with MVC, the View is the only part of the application that users actually interact with. They are an interactive UI that represent the state of a ViewModel. In this sense, the view is considered active rather than passive, but this is also true for views in MVC and MVP. In MVC, MVP and MVVM a view can also be passive, but what does this mean?<p>A passive View only outputs a display and does not accept any user input.<p>Such a view may also have no real knowledge of the models in our application and could be manipulated by a presenter. MVVM’s active View contains the data-bindings, events and behaviors which requires an understanding of the ViewModel. Although these behaviors can be mapped to properties, the View is still responsible for handling events from the ViewModel.<p>It’s important to remember the View isn’t responsible here for handling state - it keeps this in sync with the ViewModel.<p>A KnockoutJS View is simply a HTML document with declarative bindings to link it to the ViewModel. KnockoutJS Views display information from the ViewModel, pass commands to it (e.g a user clicking on an element) and update as the state of the ViewModel changes. Templates generating markup using data from the ViewModel can however also be used for this purpose.<p>To give a brief initial example, we can look to the JavaScript MVVM framework KnockoutJS for how it allows the definition of a ViewModel and its related bindings in markup:<p>ViewModel:<pre><code class=language-javascript>
var aViewModel = {
    contactName: ko.observable("John")
};
ko.applyBindings(aViewModel);
</code></pre><p>View:<pre><code class=language-javascript>
  &lt;p>&lt;input id="source" data-bind="value: contactName, valueUpdate: 'keyup'" />&lt;/p>
  &lt;div data-bind="visible: contactName().length > 10">
      You have a really long name!
  &lt;/div>
  &lt;p>Contact name: &lt;strong data-bind="text: contactName">&lt;/strong>&lt;/p>
</code></pre><p>Our input text-box (source) obtains it's initial value from <code>contactName</code>, automatically updating this value whenever contactName changes. As the data binding is two-way, typing into the text-box will update <code>contactName</code> accordingly so the values are always in sync.<p>Although implementation specific to KnockoutJS, the <code>&lt;div></code> containing the "You have a really long name!" text also contains simple validation (once again in the form of data bindings). If the input exceeds 10 characters, it will display, otherwise it will remain hidden.<p>Moving on to a more advanced example, we can return to our Todo application. A trimmed down KnockoutJS View for this, including all the necessary data-bindings may look as follows.<pre><code class=language-javascript>
&lt;div id="todoapp">
    &lt;header>
        &lt;h1>Todos&lt;/h1>
        &lt;input id="new-todo" type="text" data-bind="value: current, valueUpdate: 'afterkeydown', enterKey: add"
               placeholder="What needs to be done?"/>
    &lt;/header>
    &lt;section id="main" data-bind="block: todos().length">

        &lt;input id="toggle-all" type="checkbox" data-bind="checked: allCompleted">
        &lt;label for="toggle-all">Mark all as complete&lt;/label>

        &lt;ul id="todo-list" data-bind="foreach: todos">

           &lt;!-- item -->
            &lt;li data-bind="css: { done: done, editing: editing }">
                &lt;div class="view" data-bind="event: { dblclick: $root.editItem }">
                    &lt;input class="toggle" type="checkbox" data-bind="checked: done">
                    &lt;label data-bind="text: content">&lt;/label>
                    &lt;a class="destroy" href="#" data-bind="click: $root.remove">&lt;/a>
                &lt;/div>
                &lt;input class="edit" type="text"
                       data-bind="value: content, valueUpdate: 'afterkeydown', enterKey: $root.stopEditing, selectAndFocus: editing, event: { blur: $root.stopEditing }"/>
            &lt;/li>

        &lt;/ul>

    &lt;/section>
&lt;/div>

</code></pre><p>Note that the basic layout of the mark-up is relatively straight-forward, containing an input textbox (<code>new-todo</code>) for adding new items, togglers for marking items as complete and a list (<code>todo-list</code>) with a template for a Todo item in the form of an <code>li</code>.<p>The data bindings in the above markup can be broken down as follows:<ul><li>The input textbox <code>new-todo</code> has a data-binding for the <code>current</code> property, which is where the value of the current item being added is stored. Our ViewModel (shown shortly) observes the <code>current</code> property and also has a binding against the <code>add</code> event. When the enter key is pressed, the <code>add</code> event is triggered and our ViewModel can then trim the value of <code>current</code> and add it to the Todo list as needed<li>The input checkbox <code>toggle-all</code> can mark all of the current items as completed if clicked. If checked, it triggers the <code>allCompleted</code> event, which can be seen in our ViewModel<li>The item <code>li</code> has the class <code>done</code>. When a task is marked as done, the CSS class <code>editing</code> is marked accordingly. If double-clicking on the item, the <code>$root.editItem</code> callback will be executed<li>The checkbox with the class <code>toggle</code> shows the state of the <code>done</code> property<li>A label contains the text value of the Todo item (<code>content</code>)<li>There is also a remove button that will call the <code>$root.remove</code> callback when clicked.<li>An input textbox used for editing mode also holds the value of the Todo item <code>content</code>. The <code>enterKey</code> event will set the <code>editing</code> property to true or false</ul><p> <h3>ViewModel</h3><p>The ViewModel can be considered a specialized Controller that acts as a data converter. It changes Model information into View information, passing commands from the View to the Model.<p>For example, let us imagine that we have a model containing a date attribute in unix format (e.g 1333832407). Rather than our models being aware of a user's view of the date (e.g 04/07/2012 @ 5:00pm), where it would be necessary to convert the attribute to its display format, our model simply holds the raw format of the data. Our View contains the formatted date and our ViewModel acts as a middle-man between the two.<p>In this sense, the ViewModel might be looked upon as more of a Model than a View but it does handle most of the View's display logic. The ViewModel may also expose methods for helping to maintain the View's state, update the model based on the action's on a View and trigger events on the View.<p>In summary, the ViewModel sits behind our UI layer. It exposes data needed by a View (from a Model) and can be viewed as the source our Views go to for both data and actions.<p>KnockoutJS interprets the ViewModel as the representation of data and operations that can be performed on a UI. This isn't the UI itself nor the data model that persists, but rather a layer that can also hold the yet to be saved data a user is working with. Knockout's ViewModels are implemented JavaScript objects with no knowledge of HTML markup. This abstract approach to their implementation allows them to stay simple, meaning more complex behavior can be more easily managed on-top as needed.<p>A partial KnockoutJS ViewModel for our Todo application could thus look as follows:<pre><code class=language-javascript>
// our main ViewModel
    var ViewModel = function ( todos ) {
        var self = this;

    // map array of passed in todos to an observableArray of Todo objects
    self.todos = ko.observableArray(
    ko.utils.arrayMap( todos, function ( todo ) {
        return new Todo( todo.content, todo.done );
    }));

    // store the new todo value being entered
    self.current = ko.observable();

    // add a new todo, when enter key is pressed
    self.add = function ( data, event ) {
        var newTodo, current = self.current().trim();
        if ( current ) {
            newTodo = new Todo( current );
            self.todos.push( newTodo );
            self.current("");
        }
    };

    // remove a single todo
    self.remove = function ( todo ) {
        self.todos.remove( todo );
    };

    // remove all completed todos
    self.removeCompleted = function () {
        self.todos.remove(function (todo) {
            return todo.done();
        });
    };

    // writeable computed observable to handle marking all complete/incomplete
    self.allCompleted = ko.computed({

        // always return true/false based on the done flag of all todos
        read:function () {
            return !self.remainingCount();
        },

        // set all todos to the written value (true/false)
        write:function ( newValue ) {
            ko.utils.arrayForEach( self.todos(), function ( todo ) {
                //set even if value is the same, as subscribers are not notified in that case
                todo.done( newValue );
            });
        }
    });

    // edit an item
    self.editItem = function( item ) {
        item.editing( true );
    };
 ..
</code></pre><p>Above we are basically providing the methods needed to add, edit or remove items as well as the logic to mark all remaining items as having been completed Note: The only real difference worth noting from previous examples in our ViewModel are observable arrays. In KnockoutJS, if we wish to detect and respond to changes on a single object, we would use <code>observables</code>. If however we wish to detect and respond to changes of a collection of things, we can use an <code>observableArray</code> instead. A simpler example of how to use observables arrays may look as follows:<pre><code class=language-javascript>
// Define an initially an empty array
var myObservableArray = ko.observableArray();

// Add a value to the array and notify our observers
myObservableArray.push( 'A new todo item' );

</code></pre><p>Note: The complete Knockout.js Todo application we reviewed above can be grabbed from <a href=http://todomvc.com>TodoMVC</a> if interested.<h3>Recap: The View and the ViewModel</h3><p>Views and ViewModels communicate using data-bindings and events. As we saw in our initial ViewModel example, the ViewModel doesn’t just expose Model attributes but also access to other methods and features such as validation.<p>Our Views handle their own user-interface events, mapping them to the ViewModel as necessary. Models and attributes on the ViewModel are synchronized and updated via two-way data-binding.<p>Triggers (data-triggers) also allow us to further react to changes in the state of our Model attributes.<h3>Recap: The ViewModel and the Model</h3><p>Whilst it may appear the ViewModel is completely responsible for the Model in MVVM, there are some subtleties with this relationship worth noting. The ViewModel can expose a Model or Model attributes for the purposes of data-binding and can also contain interfaces for fetching and manipulating properties exposed in the view.<h2>Pros and Cons</h2><p>We now hopefully have a better appreciation for what MVVM is and how it works. Let’s now review the advantages and disadvantages of employing the pattern:<h3>Advantages</h3><ul><li>MVVM Facilitates easier parallel development of a UI and the building blocks that power it<li>Abstracts the View and thus reduces the quantity of business logic (or glue) required in the code behind it<li>The ViewModel can be easier to unit test than event-driven code<li>The ViewModel (being more Model than View) can be tested without concerns of UI automation and interaction</ul><h3>Disadvantages</h3><ul><li>For simpler UIs, MVVM can be overkill<li>Whilst data-bindings can be declarative and nice to work with, they can be harder to debug than imperative code where we simply set breakpoints<li>Data-bindings in non-trivial applications can create a lot of book-keeping. We also don’t want to end up in a situation where bindings are heavier than the objects being bound to<li>In larger applications, it can be more difficult to design the ViewModel up front to get the necessary amount of generalization</ul><h2>MVVM With Looser Data-Bindings</h2><p>It’s not uncommon for JavaScript developers from an MVC or MVP background to review MVVM and complain about its true separation of concerns. Namely, the quantity of inline data-bindings maintained in the HTML markup of a View.<p>I must admit that when I first reviewed implementations of MVVM (e.g KnockoutJS, Knockback), I was surprised that any developer would want to return to the days of old where we mixed logic (JavaScript) with our markup and found it quickly unmaintainable. The reality however is that MVVM does this for a number of good reasons (which we’ve covered), including facilitating designers to more easily bind to logic from their markup.<p>For the purists among us, you’ll be happy to know that we can now also greatly reduce how reliant we are on data-bindings thanks to a feature known as custom binding providers, introduced in KnockoutJS 1.3 and available in all versions since.<p>KnockoutJS by default has a data-binding provider which searches for any elements with <code>data-bind</code> attributes on them such as in the below example.<pre><code class=language-javascript>&lt;input id="new-todo" type="text" data-bind="value: current, valueUpdate: 'afterkeydown', enterKey: add" placeholder="What needs to be done?"/>
</code></pre><p>When the provider locates an element with this attribute, it parses it and turns it into a binding object using the current data context. This is the way KnockoutJS has always worked, allowing us to declaratively add bindings to elements which KnockoutJS binds to the data at that layer.<p>Once we start building Views that are no longer trivial, we may end up with a large number of elements and attributes whose bindings in markup can become difficult to manage. With custom binding providers however, this is no longer a problem.<p>A binding provider is primarily interested in two things:<ul><li>When given a DOM node, does it contain any data-bindings?<li>If the node passed this first question, what does the binding object look like in the current data context?</ul><p>Binding providers implement two functions:<ul><li><code>nodeHasBindings</code>: this takes in a DOM node which doesn’t necessarily have to be an element<li><code>getBindings</code>: returns an object representing the bindings as applied to the current data context</ul><p>A skeleton binding provider might thus look as follows:<pre><code class=language-javascript>
var ourBindingProvider = {
  nodeHasBindings: function( node ) {
      // returns true/false
  },

  getBindings: function( node, bindingContext ) {
      // returns a binding object
  }
};
</code></pre><p>Before we get to fleshing out this provider, let’s briefly discuss logic in data-bind attributes.<p>If when using Knockout’s MVVM we find yourself dissatisfied with the idea of application logic being overly tied into your View, we can change this. We could implement something a little like CSS classes to assign bindings by name to elements. Ryan Niemeyer (of knockmeout.net) has previously suggested using <code>data-class</code> for this to avoid confusing presentation classes with data classes, so let’s get our <code>nodeHasBindings</code> function supporting this:<pre><code class=language-javascript>
// does an element have any bindings?
function nodeHasBindings( node ) {
    return node.getAttribute ? node.getAttribute("data-class") : false;
};
</code></pre><p>Next, we need a sensible <code>getBindings()</code> function. As we’re sticking with the idea of CSS classes, why not also consider supporting space-separated classes to allow us to share binding specs between different elements?<p>Let’s first review what our bindings will look like. We create an object to hold them where our property names need to match the keys we wish to use in our data-classes.<p>Note: There isn’t a great deal of work required to convert a KnockoutJS application from using traditional data-bindings over to unobtrusive bindings with custom binding providers. We simply pull our all of our data-bind attributes, replace them with data-class attributes and place our bindings in a binding object as per below:<pre><code class=language-javascript>
var viewModel = new ViewModel( todos || [] ),
    bindings = {

        newTodo: {
            value: viewModel.current,
            valueUpdate: "afterkeydown",
            enterKey: viewModel.add
        },

        taskTooltip: {
            visible: viewModel.showTooltip
        },
        checkAllContainer: {
            visible: viewModel.todos().length
        },
        checkAll: {
            checked: viewModel.allCompleted
        },

        todos: {
            foreach: viewModel.todos
        },
        todoListItem: function() {
            return {
                css: {
                    editing: this.editing
                }
            };
        },
        todoListItemWrapper: function() {
            return {
                css: {
                    done: this.done
                }
            };
        },
        todoCheckBox: function() {
            return {
                checked: this.done
            };
        },
        todoContent: function() {
            return {
                text: this.content,
                event: {
                    dblclick: this.edit
                }
            };
        },
        todoDestroy: function() {
            return {
                click: viewModel.remove
            };
        },

        todoEdit: function() {
            return {
                value: this.content,
                valueUpdate: "afterkeydown",
                enterKey: this.stopEditing,
                event: {
                    blur: this.stopEditing
                }
            };
        },

        todoCount: {
            visible: viewModel.remainingCount
        },
        remainingCount: {
            text: viewModel.remainingCount
        },
        remainingCountWord: function() {
            return {
                text: viewModel.getLabel(viewModel.remainingCount)
            };
        },
        todoClear: {
            visible: viewModel.completedCount
        },
        todoClearAll: {
            click: viewModel.removeCompleted
        },
        completedCount: {
            text: viewModel.completedCount
        },
        completedCountWord: function() {
            return {
                text: viewModel.getLabel(viewModel.completedCount)
            };
        },
        todoInstructions: {
            visible: viewModel.todos().length
        }
    };

    ....
</code></pre><p>There are however two lines missing from the above snippet - we still need our <code>getBindings</code> function, which will loop through each of the keys in our data-class attributes and build up the resulting object from each of them. If we detect that the binding object is a function, we call it with our current data using the context <code>this</code>. Our complete custom binding provider would look as follows:<pre><code class=language-javascript>

    // We can now create a bindingProvider that uses
    // something different than data-bind attributes
    ko.customBindingProvider = function( bindingObject ) {
        this.bindingObject = bindingObject;

        // determine if an element has any bindings
        this.nodeHasBindings = function( node ) {
            return node.getAttribute ? node.getAttribute( "data-class" ) : false;
        };
      };

    // return the bindings given a node and the bindingContext
    this.getBindings = function( node, bindingContext ) {

        var result = {},
            classes = node.getAttribute( "data-class" );

        if ( classes ) {
            classes = classes.split( "" );

            //evaluate each class, build a single object to return
            for ( var i = 0, j = classes.length; i &lt; j; i++ ) {

               var bindingAccessor = this.bindingObject[classes[i]];
               if ( bindingAccessor ) {
                   var binding = typeof bindingAccessor === "function" ? bindingAccessor.call(bindingContext.$data) : bindingAccessor;
                   ko.utils.extend(result, binding);
               }

            }
        }

        return result;
    };
};
</code></pre><p>Thus, the final few lines of our <code>bindings</code> object can be defined as follows:<pre><code class=language-javascript>

// set ko's current bindingProvider equal to our new binding provider
ko.bindingProvider.instance = new ko.customBindingProvider( bindings );

// bind a new instance of our ViewModel to the page
ko.applyBindings( viewModel );

})();
</code></pre><p>What we’re doing here is effectively defining constructor for our binding handler which accepts an object (bindings) which we use to lookup our bindings. We could then re-write the markup for our application View using data-classes as follows:<pre><code class=language-javascript>
&lt;div id="create-todo">
                &lt;input id="new-todo" data-class="newTodo" placeholder="What needs to be done?" />
                &lt;span class="ui-tooltip-top" data-class="taskTooltip" style="display: none;">Press Enter to save this task&lt;/span>
            &lt;/div>
            &lt;div id="todos">
                &lt;div data-class="checkAllContainer" >
                    &lt;input id="check-all" class="check" type="checkbox" data-class="checkAll" />
                    &lt;label for="check-all">Mark all as complete&lt;/label>
                &lt;/div>
                &lt;ul id="todo-list" data-class="todos" >
                    &lt;li data-class="todoListItem" >
                        &lt;div class="todo" data-class="todoListItemWrapper" >
                            &lt;div class="display">
                                &lt;input class="check" type="checkbox" data-class="todoCheckBox" />
                                &lt;div class="todo-content" data-class="todoContent" style="cursor: pointer;">&lt;/div>
                                &lt;span class="todo-destroy" data-class="todoDestroy">&lt;/span>
                            &lt;/div>
                            &lt;div class="edit'>
                                &lt;input class="todo-input" data-class="todoEdit'/>
                            &lt;/div>
                        &lt;/div>
                    &lt;/li>
                &lt;/ul>
            &lt;/div>
</code></pre><p>Neil Kerkin has put together a complete TodoMVC demo app using the above, which can be accessed and played around with <a href=http://jsfiddle.net/nkerkin/hmq7D/light/ >here</a>.<p>Whilst it may look like quite a lot of work in the explanation above, now that we have a generic <code>getBindings</code> method written, it’s a lot more trivial to simply re-use it and use data-classes rather than strict data-bindings for writing our KnockoutJS applications instead. The net result is hopefully cleaner markup with our data bindings being shifted from the View to a bindings object instead.<h2>MVC Vs. MVP Vs. MVVM</h2><p>Both MVP and MVVM are derivatives of MVC. The key difference between it and its derivatives is the dependency each layer has on other layers as well as how tightly bound they are to each other.<p>In MVC, the View sits on top of our architecture with the controller beside it. Models sit below the controller and so our Views know about our controllers and controllers know about Models. Here, our Views have direct access to Models. Exposing the complete Model to the View however may have security and performance costs, depending on the complexity of our application. MVVM attempts to avoid these issues.<p>In MVP, the role of the controller is replaced with a Presenter. Presenters sit at the same level as views, listening to events from both the View and model and mediating the actions between them. Unlike MVVM, there isn’t a mechanism for binding Views to ViewModels, so we instead rely on each View implementing an interface allowing the Presenter to interact with the View.<p>MVVM consequently allows us to create View-specific subsets of a Model which can contain state and logic information, avoiding the need to expose the entire Model to a View. Unlike MVP’s Presenter, a ViewModel is not required to reference a View. The View can bind to properties on the ViewModel which in turn expose data contained in Models to the View. As we’ve mentioned, the abstraction of the View means there is less logic required in the code behind it.<p>One of the downsides to this however is that a level of interpretation is needed between the ViewModel and the View and this can have performance costs. The complexity of this interpretation can also vary - it can be as simple as copying data or as complex as manipulating them to a form we would like the View to see. MVC doesn’t have this problem as the whole Model is readily available and such manipulation can be avoided.<h2>Backbone.js Vs. KnockoutJS</h2><p>Understanding the subtle differences between MVC, MVP and MVVM are important but developers ultimately will ask whether they should consider using KnockoutJS over Backbone based in what we’ve learned. The following notes may be of help here:<ul><li><p>Both libraries are designed with different goals in mind and its often not as simple as just choosing MVC or MVVM<li><p>If data-binding and two-way communication are your main concerns, KnockoutJS is definitely the way to go.Practically any attribute or value stored in DOM nodes can be mapped to JavaScript objects with this approach.<li><p>Backbone excels with its ease of integration with RESTful services, whilst KnockoutJS Models are simply JavaScript objects and code needed for updating the Model must be written by the developer.<li><p>KnockoutJS has a focus on automating UI bindings, which requires significantly more verbose custom code if attempting to do this with Backbone. This isn't a problem with Backbone itself per se as it purposefully attempts to stay out of the UI. Knockback does however attempt to assist with this problem.<li><p>With KnockoutJS, we can bind our own functions to ViewModel observables, which are executed anytime the observable changes. This allows us the same level of flexibility as can be found in Backbone<li><p>Backbone has a solid routing solution built-in, whilst KnockoutJS offers no routing options out of the box. One can however easily fill this behavior in if needed using Ben Alman’s <a href=http://benalman.com/projects/jquery-bbq-plugin/ >BBQ plugin</a> or a standalone routing system like Miller Medeiros’s excellent <a href=http://millermedeiros.github.com/crossroads.js/ >Crossroads</a>.</ul><p>To conclude, I personally find KnockoutJS more suitable for smaller applications whilst Backbone’s feature set really shines when building anything non-trivial. That said, many developers have used both frameworks to write applications of varying complexity and I recommend trying out both at a smaller scale before making a decision on which might work best for your project.<p><strong>For further reading about MVVM or Knockout, I recommend the following articles:</strong><ul><li><a href=http://www.silverlightshow.net/news/The-Advantages-of-MVVM.aspx>The Advantages Of MVVM</a><li><a href=http://stackoverflow.com/questions/883895/what-are-the-problems-of-the-mvvm-pattern>SO: What are the problems with MVVM?</a><li><a href=http://www.codeproject.com/Articles/100175/Model-View-ViewModel-MVVM-Explained>MVVM Explained</a><li><a href=http://www.quora.com/Pros-and-cons-of-MVVM-framework-and-how-I-can-campare-it-with-MVC>How does MVVM compare to MVC?</a><li><a href=http://www.knockmeout.net/2011/09/ko-13-preview-part-2-custom-binding.html>Custom bindings in KnockoutJS</a><li><a href=http://gratdevel.blogspot.co.uk/2012/02/exploring-todomvc-and-knockoutjs-with.html>Exploring Knockout with TodoMVC</a></ul></section><section><h1 id=modularjavascript><a href=#modularjavascript class=subhead-link>#</a> Modular Design Patterns for Classic JavaScript</h1><div><h2>Modular Programming before ES2015+</h2></div><p>We have covered the importance of modular programming and the modern way of implementing modular design patterns in the sections on <em>JavaScript Modules</em>, and <em>Module Pattern</em>. Whilst <a href=https://262.ecma-international.org/6.0/ >ES2015</a> introduced native modules to JavaScript, writing modular JavaScript was still possible before 2015.<p>In this section, we're going to look at three formats for modular JavaScript using classic JavaScript (ES5) syntax: <strong>AMD</strong>, <strong>CommonJS</strong>, and <strong>UMD</strong><div class=hr></div><details><summary><strong>A Note On Script Loaders</strong></summary><p>It's difficult to discuss AMD and CommonJS modules without talking about the elephant in the room - <a href=http://msdn.microsoft.com/en-us/scriptjunkie/hh227261>script loaders</a>. Script loading was a means to a goal, that goal being modular JavaScript that can be used in applications - for this, the use of a compatible script loader is unfortunately necessary. To get the most out of this section, I recommend gaining a <strong>basic understanding</strong> of how popular script loading tools work so the explanations of module formats make sense in context.<p>There are many great loaders for handling module loading in the AMD and CommonJS formats, but my personal preferences are <a href=http://requirejs.org>RequireJS</a> and <a href=https://github.com/unscriptable/curl>curl.js</a>. Complete tutorials on these tools are outside the scope of this book, but I can recommend reading John Hann's article about <a href=http://unscriptable.com/index.php/2011/03/30/curl-js-yet-another-amd-loader/ >curl.js</a> and James Burke's <a href=http://requirejs.org/docs/api.html>RequireJS</a> API documentation for more.<p>From a production perspective, the use of optimization tools (like the RequireJS optimizer) to concatenate scripts is recommended for deployment when working with such modules. Interestingly, with the <a href=https://github.com/jrburke/almond>Almond</a> AMD shim, RequireJS doesn't need to be rolled in the deployed site, and what one might consider a script loader can be easily shifted outside of development.<p>That said, James Burke would probably say that being able to dynamically load scripts after page load still has its use cases and RequireJS can assist with this too. With these notes in mind, let's get started.<div class=hr></div></details><div><h2 id=detailamd>AMD</h2></div><h3>A Format For Writing Modular JavaScript In The Browser</h3><p>The overall goal for the AMD (Asynchronous Module Definition) format is to provide a solution for modular JavaScript that developers could use. It was born out of Dojo's real-world experience using XHR+eval and proponents of this format wanted to avoid any future solutions suffering from the weaknesses of those in the past.<p>The AMD module format itself is a proposal for defining modules where both the module and dependencies can be <a href=http://dictionary.reference.com/browse/asynchronous>asynchronously</a> loaded. It has several distinct advantages including being both asynchronous and highly flexible by nature which removes the tight coupling one might commonly find between code and module identity. Many developers enjoyed using AMD and one could consider it was a reliable stepping stone towards <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules>JavaScript Modules </a>which were not available at the time.<p>AMD began as a draft specification for a module format on the CommonJS list but as it wasn't able to reach full consensus, further development of the format moved to the <a href=https://github.com/amdjs>amdjs</a> group.<p>It has been embraced by projects including Dojo, MooTools, Firebug, and even jQuery. Although the term <i>CommonJS AMD format</i> has been seen in the wild on occasion, it's best to refer to it as just AMD or Async Module support as not all participants on the CommonJS list wished to pursue it.<p><div class=alert-message><strong>Note:</strong> There was a time when the proposal was referred to as Modules Transport/C, however as the spec wasn't geared towards transporting existing CommonJS modules, but rather - for defining modules - it made more sense to opt for the AMD naming convention.</div><p><div class=hr></div><h3>Getting Started With Modules</h3><p>The first two concepts worth noting about AMD are the idea of a <code>define</code> method for facilitating module definition and a <code>require</code> method for handling dependency loading. <em>define</em> is used to define named or unnamed modules based using the following signature:<pre><code class=language-javascript>
define(
    module_id /*optional*/,
    [dependencies] /*optional*/,
    definition function /*function for instantiating the module or object*/
);
</code></pre><p>As we can tell by the inline comments, the <code>module_id</code> is an optional argument that is typically only required when non-AMD concatenation tools are being used (there may be some other edge cases where it's useful too). When this argument is left out, we refer to the module as <em>anonymous</em>.<p>When working with anonymous modules, the idea of a module's identity is DRY, making it trivial to avoid duplication of filenames and code. Because the code is more portable, it can be easily moved to other locations (or around the file-system) without needing to alter the code itself or change its module ID. Consider the <code>module_id</code> similar to the concept of folder paths.<p>Note: Developers can run this same code on multiple environments just by using an AMD optimizer that works with a CommonJS environment such as <a href=https://github.com/jrburke/r.js/ >r.js</a>.<p>Back to the <code>define</code> signature, the dependencies argument represents an array of dependencies that are required by the module we are defining and the third argument ("definition function" or "factory function") is a function that's executed to instantiate our module. A barebone module could be defined as follows:<h4>Understanding AMD: define()</h4><pre><code class=language-javascript>

// A module_id (myModule) is used here for demonstration purposes only
define( "myModule",

    ["foo", "bar"],

    // module definition function
    // dependencies (foo and bar) are mapped to function parameters
    function ( foo, bar ) {
        // return a value that defines the module export
        // (i.e the functionality we want to expose for consumption)

        // create your module here
        var myModule = {
            doStuff: function () {
                console.log( "Yay! Stuff" );
            }
        };

    return myModule;
});

// An alternative version could be..
define( "myModule",

    ["math", "graph"],

    function ( math, graph ) {

        // Note that this is a slightly different pattern
        // With AMD, it's possible to define modules in a few
        // different ways due to it's flexibility with
        // certain aspects of the syntax
        return {
            plot: function( x, y ){
                return graph.drawPie( math.randomGrid( x, y ) );
            }
        };
});

</code></pre><p><em>require</em> on the other hand is typically used to load code in a top-level JavaScript file or within a module should we wish to dynamically fetch dependencies. An example of its usage is:<h4>Understanding AMD: require()</h4><pre><code class=language-javascript>
// Consider "foo" and "bar" are two external modules
// In this example, the "exports" from the two modules
// loaded are passed as function arguments to the
// callback (foo and bar) so that they can similarly be accessed

require(["foo", "bar"], function ( foo, bar ) {
    // rest of your code here
    foo.doSomething();
});
</code></pre><h4>Dynamically-loaded Dependencies</h4><pre><code class=language-javascript>

define(function ( require ) {
    var isReady = false, foobar;

    // note the inline require within our module definition
    require(["foo", "bar"], function ( foo, bar ) {
        isReady = true;
        foobar = foo() + bar();
    });

    // we can still return a module
    return {
        isReady: isReady,
        foobar: foobar
    };
});

</code></pre><h4>Understanding AMD: plugins</h4><p>The following is an example of defining an AMD-compatible plugin:<pre><code class=language-javascript>
// With AMD, it's possible to load in assets of almost any kind
// including text-files and HTML. This enables us to have template
// dependencies which can be used to skin components either on
// page-load or dynamically.

define( ["./templates", "text!./template.md","css!./template.css" ],

    function( templates, template ){
        console.log( templates );
        // do something with our templates here
    }

});
</code></pre><p><div class=alert-message><strong>Note:</strong> Although css! is included for loading CSS dependencies in the above example, it's important to remember that this approach has some caveats such as it not being fully possible to establish when the CSS is fully loaded. Depending on how we approach our build process, it may also result in CSS being included as a dependency in the optimized file, so use CSS as a loaded dependency in such cases with caution. If interested in doing the above, we can also explore @VIISON's RequireJS CSS plugin further <a href=https://github.com/VIISON/RequireCSS>here</a>.</div><p><h4>Loading AMD Modules Using RequireJS</h4><pre><code class=language-javascript>
require(["app/myModule"],

    function( myModule ){
        // start the main module which in-turn
        // loads other modules
        var module = new myModule();
        module.doStuff();
});
</code></pre><p>This example could simply be looked at as <code>requirejs(["app/myModule"], function(){})</code> which indicates the loader's top-level globals are being used. This is how to kick off top-level loading of modules with different AMD loaders however with a <code>define()</code> function, if it's passed a local require all <code>require([])</code> examples apply to both types of loader (curl.js and RequireJS).<h4>Loading AMD Modules Using curl.js</h4><pre><code class=language-javascript>
curl(["app/myModule.js"],

    function( myModule ){
        // start the main module which in-turn
        // loads other modules
        var module = new myModule();
        module.doStuff();

});
</code></pre><h4>Modules With Deferred Dependencies</h4><pre><code class=language-javascript>
// This could be compatible with jQuery's Deferred implementation,
// futures.js (slightly different syntax) or any one of a number
// of other implementations

define(["lib/Deferred"], function( Deferred ){
    var defer = new Deferred();

    require(["lib/templates/?index.html","lib/data/?stats"],
        function( template, data ){
            defer.resolve( { template: template, data:data } );
        }
    );
    return defer.promise();
});
</code></pre><p> <div class=hr></div><h3>AMD Modules With Dojo</h3><p>Defining AMD-compatible modules using Dojo is fairly straightforward. As per above, define any module dependencies in an array as the first argument and provide a callback (factory) which will execute the module once the dependencies have been loaded. e.g:<pre><code class=language-javascript>
define(["dijit/Tooltip"], function( Tooltip ){

    //Our dijit tooltip is now available for local use
    new Tooltip(...);

});
</code></pre><p>Note the anonymous nature of the module, which can now be consumed by a Dojo asynchronous loader, RequireJS, or the standard <a href=http://livedocs.dojotoolkit.org/dojo/require>dojo.require()</a> module loader.<p>There are some interesting gotchas with module referencing that are useful to know here. Although the AMD-advocated way of referencing modules declares them in the dependency list with a set of matching arguments, this isn't supported by the older Dojo 1.6 build system - it really only works for AMD-compliant loaders. e.g:<pre><code class=language-javascript>
define(["dojo/cookie", "dijit/Tooltip"], function( cookie, Tooltip ){

    var cookieValue = cookie( "cookieName" );
    new Tooltip(...);

});
</code></pre><p>This has many advantages over nested namespacing as modules no longer need to directly reference complete namespaces every time - all we require is the "dojo/cookie" path in dependencies, which once aliased to an argument, can be referenced by that variable. This removes the need to repeatedly type out "dojo." in our applications.<p>The final gotcha to be aware of is that if we wish to continue using the older Dojo build system or wish to migrate older modules to this newer AMD-style, the following more verbose version enables easier migration. Notice that dojo and dijit and referenced as dependencies too:<pre><code class=language-javascript>
define(["dojo", "dijit', "dojo/cookie", "dijit/Tooltip"], function( dojo, dijit ){
    var cookieValue = dojo.cookie( "cookieName" );
    new dijit.Tooltip(...);
});
</code></pre><p> <div class=hr></div><h3>AMD Module Design Patterns (Dojo)</h3><p>As we've seen in previous sections, design patterns can be highly effective in improving how we approach structuring solutions to common development problems. <a href=http://twitter.com/unscriptable>John Hann</a> has given some excellent presentations about AMD module design patterns covering the Singleton, Decorator, Mediator, and others and I highly recommend checking out his <a href=http://unscriptable.com/code/AMD-module-patterns/ >slides</a> if we get a chance.<p>A selection of AMD design patterns can be found below.<p><strong>Decorator pattern:</strong><pre><code class=language-javascript>
// mylib/UpdatableObservable: a Decorator for dojo/store/Observable
define(["dojo", "dojo/store/Observable"], function ( dojo, Observable ) {
    return function UpdatableObservable ( store ) {

        var observable = dojo.isFunction( store.notify ) ? store :
                new Observable(store);

        observable.updated = function( object ) {
            dojo.when( object, function ( itemOrArray) {
                dojo.forEach( [].concat(itemOrArray), this.notify, this );
            });
        };

        return observable;
    };
});


// Decorator consumer
// a consumer for mylib/UpdatableObservable

define(["mylib/UpdatableObservable"], function ( makeUpdatable ) {
    var observable,
        updatable,
        someItem;

    // make the observable store updatable
    updatable = makeUpdatable( observable ); // `new` is optional!

    // we can then call .updated() later on if we wish to pass
    // on data that has changed
    //updatable.updated( updatedItem );
});


</code></pre><p><strong>Adapter pattern</strong><pre><code class=language-javascript>

// "mylib/Array" adapts `each` function to mimic jQuerys:
define(["dojo/_base/lang", "dojo/_base/array"], function ( lang, array ) {
    return lang.delegate( array, {
        each: function ( arr, lambda ) {
            array.forEach( arr, function ( item, i ) {
                lambda.call( item, i, item ); // like jQuery's each
            });
        }
    });
});

// Adapter consumer
// "myapp/my-module":
define(["mylib/Array"], function ( array ) {
    array.each( ["uno", "dos", "tres"], function ( i, esp ) {
        // here, `this` == item
    });
});

</code></pre><div class=hr></div><h3>AMD Modules With jQuery</h3><p>Unlike Dojo, jQuery really only comes with one file, however, given the plugin-based nature of the library, we can demonstrate how straightforward it is to define an AMD module that uses it below.<pre><code class=language-javascript>
define(["js/jquery.js","js/jquery.color.js","js/underscore.js"],

    function( $, colorPlugin, _ ){
        // Here we've passed in jQuery, the color plugin and Underscore
        // None of these will be accessible in the global scope, but we
        // can easily reference them below.

        // Pseudo-randomize an array of colors, selecting the first
        // item in the shuffled array
        var shuffleColor = _.first( _.shuffle( ["#666","#333","#111"] ) );

        // Animate the background-color of any elements with the class
        // "item" on the page using the shuffled color
        $( ".item" ).animate( {"backgroundColor": shuffleColor } );

        // What we return can be used by other modules
        return {};
    });
</code></pre><p>There is however something missing from this example and it's the concept of registration.<h4>Registering jQuery As An Async-compatible Module</h4><p>One of the key features that landed in jQuery 1.7 was support for registering jQuery as an asynchronous module. There are a number of compatible script loaders (including RequireJS and curl) that are capable of loading modules using an asynchronous module format and this means fewer hacks are required to get things working.<p>If a developer wants to use AMD and does not want their jQuery version leaking into the global space, they should call <code>noConflict</code> in their top-level module that uses jQuery. In addition, since multiple versions of jQuery can be on a page there are special considerations that an AMD loader must account for, and so jQuery only registers with AMD loaders that have recognized these concerns, which are indicated by the loader specifying <code>define.amd.jQuery</code>. RequireJS and curl are two loaders that do so<p>The named AMD provides a safety blanket of being both robust and safe for most use-cases.<pre><code class=language-javascript>
// Account for the existence of more than one global
// instances of jQuery in the document, cater for testing
// .noConflict()

var jQuery = this.jQuery || "jQuery",
$ = this.$ || "$",
originaljQuery = jQuery,
original$ = $;

define(["jquery"], function ( $ ) {
    $( ".items" ).css( "background","green" );
    return function () {};
});
</code></pre><h4>Why was AMD A Better Choice For Writing Modular JavaScript?</h4><ul><li>Provides a clear proposal for how to approach defining flexible modules.<li>Significantly cleaner than the global namespace and <code>&lt;script></code> tag solutions that many of us used in the past. There's a clean way to declare stand-alone modules and dependencies they may have.<li>Module definitions are encapsulated, helping us to avoid pollution of the global namespace.<li>Arguably works better than some alternative solutions (e.g. CommonJS, which we'll be looking at shortly). It doesn't have issues with cross-domain, local, or debugging and doesn't have a reliance on server-side tools to be used. Most AMD loaders support loading modules in the browser without a build process.<li>Provides a "transport" approach for including multiple modules in a single file. Other approaches like CommonJS have yet to agree on a transport format.<li>It's possible to lazy load scripts if this is needed.</ul><p><strong>Note:</strong> Many of the above could be said about YUI's module loading strategy as well.<p> <div class="alert-message block-message info"><p><b>Related Reading</b><p><a href=http://requirejs.org/docs/whyamd.html>The RequireJS Guide To AMD</a><p><a href=http://unscriptable.com/index.php/2011/09/21/what-is-the-fastest-way-to-load-amd-modules/ >What's the fastest way to load AMD modules?</a><p><a href=http://unscriptable.com/index.php/2011/09/30/amd-versus-cjs-whats-the-best-format/ >AMD vs. CommonJS, what's the better format?</a><p><a href=http://blog.millermedeiros.com/2011/09/amd-is-better-for-the-web-than-commonjs-modules/ >AMD Is Better For The Web Than CommonJS Modules</a><p><a href=http://unscriptable.com/code/Modules-Frameworks/ >The Future Is Modules Not Frameworks</a><p><a href="http://groups.google.com/group/commonjs/browse_thread/thread/96a0963bcb4ca78f/cf73db49ce267ce1?lnk=gst#">AMD No Longer A CommonJS Specification</a><p><a href=http://tagneto.blogspot.com/2011/04/on-inventing-js-module-formats-and.html>On Inventing JavaScript Module Formats And Script Loaders</a><p><a href=http://groups.google.com/group/amd-implement>The AMD Mailing List</a></div><h4>What Script Loaders & Frameworks Support AMD?</h4><h5>In-browser:</h5><ul><li>RequireJS <a href=http://requirejs.org>http://requirejs.org</a><li>curl.js <a href=http://github.com/unscriptable/curl>http://github.com/unscriptable/curl</a><li>bdLoad <a href=http://bdframework.com/bdLoad>http://bdframework.com/bdLoad</a><li>Yabble <a href=http://github.com/jbrantly/yabble>http://github.com/jbrantly/yabble</a><li>PINF <a href=http://github.com/pinf/loader-js>http://github.com/pinf/loader-js</a><li>(and more)</ul><h5>Server-side:</h5><ul><li>RequireJS <a href=http://requirejs.org>http://requirejs.org</a><li>PINF <a href=http://github.com/pinf/loader-js>http://github.com/pinf/loader-js</a></ul><p> <h3>AMD Conclusions</h3><p>Having used AMD for a number of projects, my conclusions are that it ticked a lot of the checkboxes developers creating serious applications might desire from a better module format. It avoids the need to worry about globals, supports named modules, doesn't require server transformation to function, and is a pleasure to use for dependency management.<p>It's also an excellent addition for modular development using Backbone.js, ember.js, or any number of other structural frameworks for keeping applications organized.<p>As AMD was heavily discussed within the Dojo and CommonJS worlds, we know it had time to mature and evolve. We also know it had been battle-tested in the wild by many companies to build non-trivial applications (IBM, BBC iPlayer) and so, if it didn't work, chances are they would have abandoned it, but did not.<p>That said, there are still areas where AMD could be improved. Developers who have used the format for some time may feel the AMD boilerplate/wrapper code is an annoying overhead. Whilst I share this concern, there are tools such as <a href=https://github.com/volojs/volo>Volo</a> that can help work around these issues and I would argue that on the whole, the pros with using AMD far outweighed the cons.<p> <p> </section><section><div class=hr></div><div><h2 id=detailcommonjs>CommonJS</h2></div><h3>A Module Format Optimized For The Server</h3><p>The CommonJS module proposal specifies a simple API for declaring modules server-side and unlike AMD attempts to cover a broader set of concerns such as io, file-system, promises, and more.<p>The format was proposed by <a href=http://www.commonjs.org/ >CommonJS</a> - a volunteer working group that aims to design, prototype, and standardize JavaScript APIs. To date, they've attempted to ratify standards for both <a href=http://www.commonjs.org/specs/modules/1.0/ >modules</a> and <a href=http://wiki.commonjs.org/wiki/Packages/1.0>packages</a>.<h3>Getting Started</h3><p>From a structure perspective, a CommonJS module is a reusable piece of JavaScript that exports specific objects made available to any dependent code. Unlike AMD, there are typically no function wrappers around such modules (so we won't see <code>define</code> here for example).<p>CommonJS modules basically contain two primary parts: a free variable named <code>exports</code> which contains the objects a module wishes to make available to other modules and a <code>require</code> function that modules can use to import the exports of other modules.<h4>Understanding CommonJS: require() and exports</h4><pre><code class=language-javascript>
// package/lib is a dependency we require
var lib = require( "package/lib" );

// behaviour for our module
function foo(){
    lib.log( "hello world!" );
}

// export (expose) foo to other modules
exports.foo = foo;
</code></pre><h4>Basic consumption of exports</h4><pre><code class=language-javascript>

// define more behaviour we would like to expose
function foobar(){
  this.foo = function(){
    console.log( "Hello foo" );
  }

  this.bar = function(){
    console.log( "Hello bar" );
  }
}

// expose foobar to other modules
exports.foobar = foobar;

// an application consuming "foobar"

// access the module relative to the path
// where both usage and module files exist
// in the same directory

var foobar = require("./foobar").foobar,
    test   = new foobar();

// Outputs: "Hello bar"
test.bar();

</code></pre><h4>AMD-equivalent Of The First CommonJS Example</h4><pre><code class=language-javascript>
define(function(require){
   var lib = require( "package/lib" );

    // some behaviour for our module
    function foo(){
        lib.log( "hello world!" );
    }

    // export (expose) foo for other modules
    return {
        foobar: foo
    };
});
</code></pre><p>This can be done as AMD supports a <a href=http://requirejs.org/docs/whyamd.html#sugar>simplified CommonJS wrapping</a> feature.<h4>Consuming Multiple Dependencies</h4><h5>app.js</h5><pre><code class=language-javascript>
var modA = require( "./foo" );
var modB = require( "./bar" );

exports.app = function(){
    console.log( "Im an application!" );
}

exports.foo = function(){
    return modA.helloWorld();
}
</code></pre><h5>bar.js</h5><pre><code class=language-javascript>
exports.name = "bar";
</code></pre><h5>foo.js</h5><pre><code class=language-javascript>
require( "./bar" );
exports.helloWorld = function(){
    return "Hello World!!"
}
</code></pre><h4>What Loaders & Frameworks Support CommonJS?</h4><h5>In-browser:</h5><ul><li>curl.js <a href=http://github.com/unscriptable/curl>http://github.com/unscriptable/curl</a><li>SproutCore 1.1 <a href=http://sproutcore.com>http://sproutcore.com</a><li>PINF <a href=http://github.com/pinf/loader-js>http://github.com/pinf/loader-js</a></ul><h5>Server-side:</h5><ul><li>Node<a href=http://nodejs.org>http://nodejs.org</a><li>Narwhal <a href=https://github.com/tlrobinson/narwhal>https://github.com/tlrobinson/narwhal</a><li>Persevere <a href=http://www.persvr.org/ >http://www.persvr.org/</a><li>Wakanda <a href=http://www.wakandasoft.com/ >http://www.wakandasoft.com/</a></ul><p> <h4>Is CommonJS Suitable For The Browser?</h4><p>Some developers feel that CommonJS is better suited to server-side development which is one reason there was a level of <strong>disagreement</strong> over which format should be used as the de-facto standard before ES2015. Some of the arguments against CommonJS included a note that many CommonJS APIs address server-oriented features which one would simply not be able to implement at a browser-level in JavaScript - for example, <em>io</em>, <em>system</em>, and <em>js</em> could be considered unimplementable by the nature of their functionality.<p>That said, it's useful to know how to structure CommonJS modules regardless so that we can better appreciate how they fit in when defining modules that may be used everywhere. Modules that have applications on both the client and server include validation, conversion, and templating engines. The way some developers are approaching choosing which format to use is opting for CommonJS when a module can be used in a server-side environment and using AMD if this is not the case.<p>As AMD modules are capable of using plugins and can define more granular things like constructors and functions this makes sense. CommonJS modules are only able to define objects which can be tedious to work with if we're trying to obtain constructors out of them.<p>Although it's beyond the scope of this section, one may have also noticed that there were different types of "require" methods mentioned when discussing AMD and CommonJS. The concern with a similar naming convention is of course confusion and the community is split on the merits of a global require function. John Hann's suggestion here is that rather than calling it "require", which would probably fail to achieve the goal of informing users about the difference between a global and inner require, it may make more sense to rename the global loader method something else (e.g. the name of the library). It's for this reason that a loader like curl.js uses <code>curl()</code> as opposed to <code>require</code>.<p><div class="alert-message block-message info"><p><b>Related Reading</b><p><a href=http://dailyjs.com/2010/10/18/modules/ >Demystifying CommonJS Modules</a><p><a href=http://www.slideshare.net/davidpadbury/javascript-growing-up>JavaScript Growing Up</a><p><a href=http://requirejs.org/docs/commonjs.html>The RequireJS Notes On CommonJS</a><p><a href=http://elegantcode.com/2011/02/04/taking-baby-steps-with-node-js-commonjs-and-creating-custom-modules/ >Taking Baby Steps With Node.js And CommonJS - Creating Custom Modules</a><p><a href=http://www.sitepen.com/blog/2010/07/16/asynchronous-commonjs-modules-for-the-browser-and-introducing-transporter/ >Asynchronous CommonJS Modules for the Browser</a><p><a href=http://groups.google.com/group/commonjs>The CommonJS Mailing List</a></div><div class=hr></div><p> <p> <div><h2>AMD && CommonJS <small>Competing, But Equally Valid Standards</small></h2></div><p>Both AMD and CommonJS are valid module formats with different end-goals.<p>AMD adopts a browser-first approach to development, opting for asynchronous behavior and simplified backward compatibility but it doesn't have any concept of File I/O. It supports objects, functions, constructors, strings, JSON, and many other types of modules, running natively in the browser. It's incredibly flexible.<p>CommonJS on the other hand takes a server-first approach, assuming synchronous behavior, no global <i>baggage</i>, and attempts to cater for the future (on the server). What we mean by this is that because CommonJS supports unwrapped modules, it can feel a little more close to the ES2015+ specifications, freeing us of the <code>define()</code> wrapper that AMD enforces. CommonJS modules however only support objects as modules.<h2 id=detailumd>UMD: AMD And CommonJS-Compatible Modules For Plugins</h2><p>For developers wishing to create modules that can work in both browser and server-side environments, these solutions could be considered a little lacking. To help alleviate this, James Burke, I and a number of other developers created UMD (Universal Module Definition) <a href=https://github.com/umdjs/umd>https://github.com/umdjs/umd</a>.<p>UMD is an experimental module format that allows the definition of modules that work in both client and server environments with all or most of the popular script-loading techniques available at the time of writing. Although the idea of (yet) another module format may be daunting, we will cover UMD briefly for the sake of thoroughness.<p>We originally began defining UMD by taking a look at the simplified CommonJS wrapper supported in the AMD specification. For developers wishing to write modules as if they were CommonJS modules, the following CommonJS-compatible format could be used:<h4>Basic AMD Hybrid Format</h4><pre><code class=language-javascript>
define( function ( require, exports, module ){

    var shuffler = require( "lib/shuffle" );

    exports.randomize = function( input ){
        return shuffler.shuffle( input );
    }
});
</code></pre><p>It's important however to note that a module is really only treated as a CommonJS module if it doesn't contain a dependency array and the definition function contains one parameter at minimum. This also won't work correctly on some devices (e.g the PS3). For further information about the above wrapper, see <a href=http://requirejs.org/docs/api.html#cjsmodule>http://requirejs.org/docs/api.html#cjsmodule</a>.<p>Taking this further, we wanted to provide a number of different patterns that not just worked with AMD and CommonJS, but also solved common compatibility problems developers wishing to develop such modules had with other environments.<p>One such variation we can see below allows us to use CommonJS, AMD, or browser globals to create a module.<h4>Using CommonJS, AMD, or browser globals to create a module</h4><p>Define a module <code>commonJsStrict</code>, which depends on another module called <code>b</code>. The name of the module is implied by the file name and its best practice for the file name and the exported global to have the same name.<p>If module <code>b</code> also uses the same type of boilerplate in the browser, it will create a global <code>.b</code> that is used. If we don't wish to support the browser global patch, we can remove the <code>root</code> and the passing <code>this</code> as the first argument to the top function.<pre><code class=language-javascript>

(function ( root, factory ) {
    if ( typeof exports === 'object' ) {
        // CommonJS
        factory( exports, require('b') );
    } else if ( typeof define === 'function' && define.amd ) {
        // AMD. Register as an anonymous module.
        define( ['exports', 'b'], factory);
    } else {
        // Browser globals
        factory( (root.commonJsStrict = {}), root.b );
    }
}(this, function ( exports, b ) {
    //use b in some fashion.

    // attach properties to the exports object to define
    // the exported module properties.
    exports.action = function () {};
}));
</code></pre><p>The UMD repository contains variations covering modules that work optimally in the browser, those best for providing exports, those optimal for CommonJS runtimes, and even those that work best for defining jQuery plugins, which we will look at next.<h4>jQuery plugins that function in all environments</h4><p>UMD provides two patterns for working with jQuery plugins - one which defines plugins that work well with AMD and browser globals and another which can also work in CommonJS environments. jQuery is not likely to be used in most CommonJS environments so keep this in mind unless we're working with an environment that does play well with it.<p>We will now define a plugin composed of a core and an extension to that core. The core plugin is loaded into a <code>$.core</code> namespace, which can then be easily extended using plugin extensions via the namespacing pattern. Plugins loaded via script tags automatically populate a <code>plugin</code> namespace under <code>core</code> (i.e. <code>$.core.plugin.methodName()</code>).<p>The pattern can be quite nice to work with because plugin extensions can access properties and methods defined in the base or, with a little tweaking, override default behavior so that it can be extended to do more. A loader is also not required to make any of this fully functional.<p>For more details of what is being done, please see the inline comments in the code samples below.<p><strong>usage.html</strong><pre><code class=language-javascript>
&lt;script type="text/javascript" src="jquery-1.7.2.min.js">&lt;/script>
&lt;script type="text/javascript" src="pluginCore.js">&lt;/script>
&lt;script type="text/javascript" src="pluginExtension.js">&lt;/script>

&lt;script type="text/javascript">

$(function(){

    // Our plugin "core" is exposed under a core namespace in
    // this example, which we first cache
    var core = $.core;

    // Then use use some of the built-in core functionality to
    // highlight all divs in the page yellow
    core.highlightAll();

    // Access the plugins (extensions) loaded into the "plugin"
    // namespace of our core module:

    // Set the first div in the page to have a green background.
    core.plugin.setGreen( "div:first");
    // Here we're making use of the core's "highlight" method
    // under the hood from a plugin loaded in after it

    // Set the last div to the "errorColor" property defined in
    // our core module/plugin. If we review the code further down,
    // we can see how easy it is to consume properties and methods
    // between the core and other plugins
    core.plugin.setRed("div:last");
});

&lt;/script>
</code></pre><p><strong>pluginCore.js</strong><pre><code class=language-javascript>
// Module/Plugin core
// Note: the wrapper code we see around the module is what enables
// us to support multiple module formats and specifications by
// mapping the arguments defined to what a specific format expects
// to be present. Our actual module functionality is defined lower
// down, where a named module and exports are demonstrated.
//
// Note that dependencies can just as easily be declared if required
// and should work as demonstrated earlier with the AMD module examples.

(function ( name, definition ){
  var theModule = definition(),
      // this is considered "safe":
      hasDefine = typeof define === "function" && define.amd,
      // hasDefine = typeof define === "function",
      hasExports = typeof module !== "undefined" && module.exports;

  if ( hasDefine ){ // AMD Module
    define(theModule);
  } else if ( hasExports ) { // Node.js Module
    module.exports = theModule;
  } else { // Assign to common namespaces or simply the global object (window)
    ( this.jQuery || this.ender || this.$ || this)[name] = theModule;
  }
})( "core", function () {
    var module = this;
    module.plugins = [];
    module.highlightColor = "yellow";
    module.errorColor = "red";

  // define the core module here and return the public API

  // This is the highlight method used by the core highlightAll()
  // method and all of the plugins highlighting elements different
  // colors
  module.highlight = function( el,strColor ){
    if( this.jQuery ){
      jQuery(el).css( "background", strColor );
    }
  }
  return {
      highlightAll:function(){
        module.highlight("div", module.highlightColor);
      }
  };

});
</code></pre><p><strong>pluginExtension.js</strong><pre><code class=language-javascript>
// Extension to module core

(function ( name, definition ) {
    var theModule = definition(),
        hasDefine = typeof define === "function",
        hasExports = typeof module !== "undefined" && module.exports;

    if ( hasDefine ) { // AMD Module
        define(theModule);
    } else if ( hasExports ) { // Node.js Module
        module.exports = theModule;
    } else {

        // Assign to common namespaces or simply the global object (window)
        // account for for flat-file/global module extensions
        var obj = null,
            namespaces,
            scope;

        obj = null;
        namespaces = name.split(".");
        scope = ( this.jQuery || this.ender || this.$ || this );

        for ( var i = 0; i &lt; namespaces.length; i++ ) {
            var packageName = namespaces[i];
            if ( obj && i == namespaces.length - 1 ) {
                obj[packageName] = theModule;
            } else if ( typeof scope[packageName] === "undefined" ) {
                scope[packageName] = {};
            }
            obj = scope[packageName];
        }

    }
})( "core.plugin", function () {

    // Define our module here and return the public API.
    // This code could be easily adapted with the core to
    // allow for methods that overwrite and extend core functionality
    // in order to expand the highlight method to do more if we wish.
    return {
        setGreen: function ( el ) {
            highlight(el, "green");
        },
        setRed: function ( el ) {
            highlight(el, errorColor);
        }
    };

});

</code></pre><p>UMD did not aim to replace AMD nor CommonJS but merely offered some supplemental assistance for developers wishing to get their code working in more environments with classic JavaScript. For further information or to contribute suggestions towards this experimental format, see <a href=https://github.com/umdjs/umd>https://github.com/umdjs/umd</a>.<h4>Further Reading</h4><ul><li>“<a href=http://unscriptable.com/code/Using-AMD-loaders/#0>Using AMD Loaders to Write and Manage Modular JavaScript</a>,” John Hann<li>“<a href=http://dailyjs.com/2010/10/18/modules/ >Demystifying CommonJS Modules</a>,” Alex Young<li>“<a href=http://unscriptable.com/index.php/2011/09/22/amd-module-patterns-singleton/ >AMD Module Patterns: Singleton</a>,” John Hann<li>“<a href=http://www.sitepen.com/blog/2010/09/30/run-anywhere-javascript-modules-boilerplate-code/ >Run-Anywhere JavaScript Modules Boilerplate Code</a>,” Kris Zyp<li>“<a href=http://tagneto.blogspot.com/2010/12/standards-and-proposals-for-javascript.html>Standards And Proposals for JavaScript Modules And jQuery</a>,” James Burke</ul></section><section><p> <h1 id=designpatternsjquery><a href=#designpatternsjquery class=subhead-link>#</a> Design Patterns In jQuery</h1><p> <p>jQuery is currently the most popular JavaScript DOM manipulation library and provides an abstracted layer for interacting with the DOM in a safe, cross-browser manner. Interestingly, the library also serves as an example of how design patterns can be effectively used to create an API which is both readable and easy to use.<p>Whilst in many cases the core contributors that wrote jQuery didn't set out to use specific patterns, they exist there regardless and are useful to learn from. Let's take a look at what some of these patterns are and how they are used in the API.<p> <h2 id=compositepatternjquery><a href=#compositepatternjquery class=subhead-link>#</a> The Composite Pattern</h2><p><strong>The Composite Pattern</strong> describes a group of objects that can be treated in the same way a single instance of an object may be.<p>This allows us to treat both individual objects and compositions in a uniform manner, meaning that the same behavior will be applied regardless of whether we're working with one item or a thousand.<p>In jQuery, when we're applying methods to an element or collection of elements, we can treat both sets in a uniform manner as both selections return a jQuery object.<p>This is demonstrated by the code sample using the jQuery selector below. Here it's possible to add an <code>active</code> class to both selections for a single element (e.g an element with a unique ID) or a group of elements with the same tag name or class, without additional effort:<pre><code class=language-javascript>
// Single elements
$( "#singleItem" ).addClass( "active" );
$( "#container" ).addClass( "active" );

// Collections of elements
$( "div" ).addClass( "active" );
$( ".item" ).addClass( "active" );
$( "input" ).addClass( "active" );
</code></pre><p> <p>The jQuery <code>addClass()</code> implementation could either directly use native <em>for</em> loops (or jQuery's <code>jQuery.each()</code>/<code>jQuery.fn.each()</code>) to iterate through a collection in order to apply the method to both single items or groups. Looking through the source we can see this is indeed the case:<pre><code class=language-javascript>
    addClass: function( value ) {
    var classNames, i, l, elem,
      setClass, c, cl;

    if ( jQuery.isFunction( value ) ) {
      return this.each(function( j ) {
        jQuery( this ).addClass( value.call(this, j, this.className) );
      });
    }

    if ( value && typeof value === "string" ) {
      classNames = value.split( rspace );

      for ( i = 0, l = this.length; i &lt; l; i++ ) {
        elem = this[ i ];

        if ( elem.nodeType === 1 ) {
          if ( !elem.className && classNames.length === 1 ) {
            elem.className = value;

          } else {
            setClass = " " + elem.className + " ";

            for ( c = 0, cl = classNames.length; c &lt; cl; c++ ) {
              if ( !~setClass.indexOf( " " + classNames[ c ] + " " ) ) {
                setClass += classNames[ c ] + " ";
              }
            }
            elem.className = jQuery.trim( setClass );
          }
        }
      }
    }

    return this;
  }
</code></pre><h2 id=wrapperpatternjquery><strong>The Adapter Pattern</strong></h2><p><strong>The Adapter Pattern</strong> translates an <em>interface</em> for an object or class into an interface compatible with a specific system.<p>Adapters basically allow objects or classes to function together which normally couldn't due to their incompatible interfaces. The adapter translates calls to its interface into calls to the original interface and the code required to achieve this is usually quite minimal.<p>One example of an adapter we may have used is the jQuery <code>jQuery.fn.css()</code> method. It helps normalize the interfaces to how styles can be applied across a number of browsers, making it trivial for us to use a simple syntax which is adapted to use what the browser actually supports behind the scenes:<pre><code class=language-javascript>

// Cross browser opacity:
// opacity: 0.9; Chrome 4+, FF2+, Saf3.1+, Opera 9+, IE9, iOS 3.2+, Android 2.1+
// filter: alpha(opacity=90); IE6-IE8

// Setting opacity
$( ".container" ).css( { opacity: .5 } );

// Getting opacity
var currentOpacity = $( ".container" ).css('opacity');
</code></pre><p> <p>The corresponding jQuery core cssHook which makes the above possible can be seen below:<pre><code class=language-javascript>
get: function( elem, computed ) {
  // IE uses filters for opacity
  return ropacity.test( (
        computed && elem.currentStyle ?
            elem.currentStyle.filter : elem.style.filter) || "" ) ?
    ( parseFloat( RegExp.$1 ) / 100 ) + "" :
    computed ? "1" : "";
},

set: function( elem, value ) {
  var style = elem.style,
    currentStyle = elem.currentStyle,
    opacity = jQuery.isNumeric( value ) ?
          "alpha(opacity=" + value * 100 + ")" : "",
    filter = currentStyle && currentStyle.filter || style.filter || "";

  // IE has trouble with opacity if it does not have layout
  // Force it by setting the zoom level
  style.zoom = 1;

  // if setting opacity to 1, and no other filters
  //exist - attempt to remove filter attribute #6652
  if ( value >= 1 && jQuery.trim( filter.replace( ralpha, "" ) ) === "" ) {

    // Setting style.filter to null, "" & " " still leave
    // "filter:" in the cssText if "filter:" is present at all,
    // clearType is disabled, we want to avoid this style.removeAttribute
    // is IE Only, but so apparently is this code path...
    style.removeAttribute( "filter" );

    // if there there is no filter style applied in a css rule, we are done
    if ( currentStyle && !currentStyle.filter ) {
      return;
    }
  }

  // otherwise, set new filter values
  style.filter = ralpha.test( filter ) ?
    filter.replace( ralpha, opacity ) :
    filter + " " + opacity;
}
};
</code></pre><h2 id=facadepatternjquery><a href=#facadepatternjquery class=subhead-link>#</a> The Facade Pattern</h2><p>As we reviewed earlier in the book, the <strong>Facade Pattern</strong> provides a simpler abstracted interface to a larger (potentially more complex) body of code.<p>Facades can be frequently found across the jQuery library and provide developers easy access to implementations for handling DOM manipulation, animation and of particular interest, cross-browser Ajax.<p>The following are facades for jQuery's <code>$.ajax()</code>:<pre><code class=language-javascript>
$.get( url, data, callback, dataType );
$.post( url, data, callback, dataType );
$.getJSON( url, data, callback );
$.getScript( url, callback );
  </code></pre><p><p>These are translated behind the scenes to:<pre><code class=language-javascript>
// $.get()
$.ajax({
  url: url,
  data: data,
  dataType: dataType
}).done( callback );

// $.post
$.ajax({
  type: "POST",
  url: url,
  data: data,
  dataType: dataType
}).done( callback );

// $.getJSON()
$.ajax({
  url: url,
  dataType: "json",
  data: data,
}).done( callback );

// $.getScript()
$.ajax({
  url: url,
  dataType: "script",
}).done( callback );

</code></pre><p>What's even more interesting is that the above facades are actually facades in their own right, hiding a great deal of complexity behind the scenes.<p>This is because the <code>jQuery.ajax()</code> implementation in jQuery core is a non-trivial piece of code to say the least. At minimum it normalizes the cross-browser differences between XHR (XMLHttpRequest) and makes it trivial for us to perform common HTTP actions (e.g <code>get</code>, <code>post</code> etc), work with Deferreds and so on.<p>As it would take an entire chapter to show all of the code related to the above facades, here is instead the code in jQuery core normalizing XHR:<pre><code class=language-javascript>
// Functions to create xhrs
function createStandardXHR() {
  try {
    return new window.XMLHttpRequest();
  } catch( e ) {}
}

function createActiveXHR() {
  try {
    return new window.ActiveXObject( "Microsoft.XMLHTTP" );
  } catch( e ) {}
}

// Create the request object
jQuery.ajaxSettings.xhr = window.ActiveXObject ?
  /* Microsoft failed to properly
   * implement the XMLHttpRequest in IE7 (can't request local files),
   * so we use the ActiveXObject when it is available
   * Additionally XMLHttpRequest can be disabled in IE7/IE8 so
   * we need a fallback.
   */
  function() {
    return !this.isLocal && createStandardXHR() || createActiveXHR();
  } :
  // For all other browsers, use the standard XMLHttpRequest object
  createStandardXHR;
  ...
</code></pre><p>Whilst the following block of code is also a level above the actual jQuery XHR (<code>jqXHR</code>) implementation, it's the convenience facade that we actually most commonly interact with:<pre><code class=language-javascript>
    // Request the remote document
    jQuery.ajax({
      url: url,
      type: type,
      dataType: "html",
      data: params,
      // Complete callback (responseText is used internally)
      complete: function( jqXHR, status, responseText ) {
        // Store the response as specified by the jqXHR object
        responseText = jqXHR.responseText;
        // If successful, inject the HTML into all the matched elements
        if ( jqXHR.isResolved() ) {
          // Get the actual response in case
          // a dataFilter is present in ajaxSettings
          jqXHR.done(function( r ) {
            responseText = r;
          });
          // See if a selector was specified
          self.html( selector ?
            // Create a dummy div to hold the results
            jQuery("%3Cdiv%3E")
              // inject the contents of the document in, removing the scripts
              // to avoid any 'Permission Denied' errors in IE
              .append(responseText.replace(rscript, ""))

              // Locate the specified elements
              .find(selector) :

            // If not, just inject the full result
            responseText );
        }

        if ( callback ) {
          self.each( callback, [ responseText, status, jqXHR ] );
        }
      }
    });

    return this;
  }
</code></pre></section><p> <section><h2 id=observerpatternjquery><a href=#observerpatternjquery class=subhead-link>#</a> The Observer Pattern</h2><p>Another pattern we reviewed earlier is the Observer (Publish/Subscribe) pattern. This is where the objects in a system may subscribe to other objects and be notified by them when an event of interest occurs.<p>jQuery core has come with built-in support for a publish/subscribe-like system for a few years now, which it refers to as <em>custom events</em>.<p>In earlier versions of the library, access to these custom events was possible using <code>jQuery.bind()</code> (subscribe), <code>jQuery.trigger()</code> (publish) and <code>jQuery.unbind()</code> (unsubscribe), but in recent versions this can be done using <code>jQuery.on()</code>, <code>jQuery.trigger()</code> and <code>jQuery.off()</code>.<p>Below we can see an example of this being used in practice:<p><pre><code class=language-javascript>

// Equivalent to subscribe(topicName, callback)
$( document ).on( "topicName", function () {
    //..perform some behaviour
});

// Equivalent to publish(topicName)
$( document ).trigger( "topicName" );

// Equivalent to unsubscribe(topicName)
$( document ).off( "topicName" );
  </code></pre><p><p>Calls to <code>jQuery.on()</code> and <code>jQuery.off()</code> eventually go through the jQuery events system. Similar to Ajax, as the implementation for this is relatively long, we can instead look at where and how the actual event handlers for custom events are attached:<pre><code class=language-javascript>
jQuery.event = {

    add(elem, types, handler, data, selector) {
        let elemData;
        let eventHandle;
        let events;
        let t;
        let tns;
        let type;
        let namespaces;
        let handleObj;
        let handleObjIn;
        let quick;
        let handlers;
        let special;

        //...

        // Init the element's event structure and main handler,
        //if this is the first
        events = elemData.events;
        if (!events) {
            elemData.events = events = {};
        }
        //...

        // Handle multiple events separated by a space
        // jQuery(...).bind("mouseover mouseout", fn);
        jtypes = jQuery.trim(hoverHack(types)).split(" ");

        for (t = 0; t &lt; types.length; t++) {
            // ...
            // Init the event handler queue if we're the first
            handlers = events[type];
            if (!handlers) {
                handlers = events[type] = [];
                handlers.delegateCount = 0;

                // Only use addEventListener/attachEvent if the special
                // events handler returns false
                if (!special.setup || special.setup.call(elem, data,
                        namespaces, eventHandle) === false) {
                    // Bind the global event handler to the element
                    if (elem.addEventListener) {
                        elem.addEventListener(type, eventHandle, false);

                    } else if (elem.attachEvent) {
                        elem.attachEvent(`on${type}`, eventHandle);
                    }
                }
            }
        }
    }
}
</code></pre><p>For those that prefer to use the conventional naming scheme for the Observer pattern, <a href=https://gist.github.com/661855>Ben Alman</a> created a simple wrapper around the above methods which provides us access to <code>jQuery.publish()</code>, <code>jQuery.subscribe</code>, and <code>jQuery.unsubscribe</code> methods. I've previously linked to them earlier in the book, but we can see the wrapper in full below.<pre><code class=language-javascript>
(function( $ ) {

  var o = $({});

  $.subscribe = function() {
    o.on.apply(o, arguments);
  };

  $.unsubscribe = function() {
    o.off.apply(o, arguments);
  };

  $.publish = function() {
    o.trigger.apply(o, arguments);
  };

}( jQuery ));
</code></pre><p>In recent versions of jQuery, a multi-purpose callbacks object (<code>jQuery.Callbacks</code>) was made available to enable users to write new solutions based on callback lists. One such solution to write using this feature is another Publish/Subscribe system. An implementation of this is the following:<pre><code class=language-javascript>
var topics = {};

jQuery.Topic = function( id ) {
    var callbacks,
        topic = id && topics[ id ];
    if ( !topic ) {
        callbacks = jQuery.Callbacks();
        topic = {
            publish: callbacks.fire,
            subscribe: callbacks.add,
            unsubscribe: callbacks.remove
        };
        if ( id ) {
            topics[ id ] = topic;
        }
    }
    return topic;
};
</code></pre><p>which can then be used as follows:<pre><code class=language-javascript>
// Subscribers
$.Topic( "mailArrived" ).subscribe( fn1 );
$.Topic( "mailArrived" ).subscribe( fn2 );
$.Topic( "mailSent" ).subscribe( fn1 );

// Publisher
$.Topic( "mailArrived" ).publish( "hello world!" );
$.Topic( "mailSent" ).publish( "woo! mail!" );

// Here, "hello world!" gets pushed to fn1 and fn2
// when the "mailArrived" notification is published
// with "woo! mail!" also being pushed to fn1 when
// the "mailSent" notification is published.

// Outputs:
// hello world!
// fn2 says: hello world!
// woo! mail!

</code></pre></section><p> <section><h2 id=iteratorpatternjquery><a href=#iteratorpatternjquery class=subhead-link>#</a> The Iterator Pattern</h2><p>The Iterator is a design pattern where iterators (objects that allow us to traverse through all the elements of a collection) access the elements of an aggregate object sequentially without needing to expose its underlying form.<p>Iterators encapsulate the internal structure of how that particular iteration occurs. In the case of jQuery's <code>jQuery.fn.each()</code> iterator, we are actually able to use the underlying code behind <code>jQuery.each()</code> to iterate through a collection, without needing to see or understand the code working behind the scenes providing this capability.<p>This is a pattern that could be considered a special case of the facade, where we explicitly deal with problems related to iteration.<pre><code class=language-javascript>
$.each( ["john","dave","rick","julian"], function( index, value ) {
  console.log( index + ": " + value);
});

$( "li" ).each( function ( index ) {
  console.log( index + ": " + $( this ).text());
});
</code></pre><p>Here we can see the code for <code>jQuery.fn.each()</code>:<pre><code class=language-javascript>
// Execute a callback for every element in the matched set.
each: function( callback, args ) {
  return jQuery.each( this, callback, args );
}
</code></pre><p>Followed by the code behind <code>jQuery.each()</code> which handles two ways of iterating through objects:<pre><code class=language-javascript>
  each: function( object, callback, args ) {
    var name, i = 0,
      length = object.length,
      isObj = length === undefined || jQuery.isFunction( object );

    if ( args ) {
      if ( isObj ) {
        for ( name in object ) {
          if ( callback.apply( object[ name ], args ) === false ) {
            break;
          }
        }
      } else {
        for ( ; i &lt; length; ) {
          if ( callback.apply( object[ i++ ], args ) === false ) {
            break;
          }
        }
      }

    // A special, fast, case for the most common use of each
    } else {
      if ( isObj ) {
        for ( name in object ) {
          if ( callback.call( object[ name ], name, object[ name ] ) === false ) {
            break;
          }
        }
      } else {
        for ( ; i &lt; length; ) {
          if ( callback.call( object[ i ], i, object[ i++ ] ) === false ) {
            break;
          }
        }
      }
    }

    return object;
  };
</code></pre><p> <h2 id=lazyinitialisationjquery>The Lazy Initialization Pattern</h2><p><strong>Lazy Initialization </strong>is a design pattern which allows us to delay expensive processes until the first instance they are needed. An example of this is the <code>.ready()</code> function in jQuery that only executes a callback once the DOM is ready.<pre><code class=language-javascript>
$( document ).ready( function () {

    // The ajax request won't attempt to execute until
    // the DOM is ready

    var jqxhr = $.ajax({
      url: "http://domain.com/api/",
      data: "display=latest&order=ascending"
    })
    .done( function( data ) ){
        $(".status").html( "content loaded" );
        console.log( "Data output:" + data );
    });

});

</code></pre><p><p><code>jQuery.fn.ready()</code> is powered by <code>jQuery.bindReady()</code>, seen below:<pre><code class=language-javascript>
  bindReady: function() {
    if ( readyList ) {
      return;
    }

    readyList = jQuery.Callbacks( "once memory" );

    // Catch cases where $(document).ready() is called after the
    // browser event has already occurred.
    if ( document.readyState === "complete" ) {
      // Handle it asynchronously to allow scripts the opportunity to delay ready
      return setTimeout( jQuery.ready, 1 );
    }

    // Mozilla, Opera and webkit support this event
    if ( document.addEventListener ) {
      // Use the handy event callback
      document.addEventListener( "DOMContentLoaded", DOMContentLoaded, false );

      // A fallback to window.onload, that will always work
      window.addEventListener( "load", jQuery.ready, false );

    // If IE event model is used
    } else if ( document.attachEvent ) {
      // ensure firing before onload,
      // maybe late but safe also for iframes
      document.attachEvent( "onreadystatechange", DOMContentLoaded );

      // A fallback to window.onload, that will always work
      window.attachEvent( "onload", jQuery.ready );

      // If IE and not a frame
      // continually check to see if the document is ready
      var toplevel = false;

      try {
        toplevel = window.frameElement == null;
      } catch(e) {}

      if ( document.documentElement.doScroll && toplevel ) {
        doScrollCheck();
      }
    }
  },
</code></pre><p>Whilst not directly used in jQuery core, some developers may also be familiar with the concept of LazyLoading via plugins such as <a href=http://www.appelsiini.net/projects/lazyload>this</a>.<p>LazyLoading is effectively the same as Lazy initialization and is a technique whereby additional data on a page is loaded when needed (e.g. when a user has scrolled to the end of the page). In recent years this pattern has become quite prominent and can be currently be found in both the Twitter and Facebook UIs.<p> </section><section><h2 id=proxypatternjquery><a href=#proxypatternjquery class=subhead-link>#</a> The Proxy Pattern</h2><p>There are times when it is necessary for us to control the access and context behind an object and this is where the Proxy pattern can be useful.<p>It can help us control when an expensive object should be instantiated, provide advanced ways to reference the object or modify the object to function a particular way in specific contexts.<p>In jQuery core, a <code>jQuery.proxy()</code> method exists which accepts as input a function and returns a new one which will always have a specific context. This ensures that the value of <code>this</code> within a function is the value we expect.<p>An example of where this is useful is when we're making use of timers within a <code>click</code> event handler. Imagine we have the following handler prior to adding any timers:<pre><code class=language-javascript>
$( "button" ).on( "click", function () {
  // Within this function, "this" refers to the element that was clicked
  $( this ).addClass( "active" );
});
</code></pre><p>If we wished to add a hard delay before the <code>active</code> class was added, we <em>could</em> use <code>setTimeout()</code> to achieve this. Unfortunately there is a small problem with this solution: whatever function is passed to <code>setTimeout()</code> will have a different value for <code>this</code> within that function. It will instead refer to the <code>window</code> object, which is not what we desire.<pre><code class=language-javascript>
$( "button" ).on( "click", function () {
  setTimeout(function () {
    // "this" doesn't refer to our element!
    // It refers to window
    $( this ).addClass( "active" );
  });
});
</code></pre><p>To work around this problem, we can use <code>jQuery.proxy()</code> to implement a type of proxy pattern. By calling it with the function and value we would like assigned to <code>this</code> it will actually return a function that retains the value we desire within the correct context. Here's how this would look:<pre><code class=language-javascript>
$( "button" ).on( "click", function () {

    setTimeout( $.proxy( function () {
        // "this" now refers to our element as we wanted
        $( this ).addClass( "active" );
    }, this), 500);

    // the last "this" we're passing tells $.proxy() that our DOM element
    // is the value we want "this" to refer to.
});
</code></pre><p>jQuery's implementation of <code>jQuery.proxy()</code> can be found below:<pre><code class=language-javascript>
  // Bind a function to a context, optionally partially applying any
  // arguments.
  proxy: function( fn, context ) {
    if ( typeof context === "string" ) {
      var tmp = fn[ context ];
      context = fn;
      fn = tmp;
    }

    // Quick check to determine if target is callable, in the spec
    // this throws a TypeError, but we will just return undefined.
    if ( !jQuery.isFunction( fn ) ) {
      return undefined;
    }

    // Simulated bind
    var args = slice.call( arguments, 2 ),
      proxy = function() {
        return fn.apply( context, args.concat( slice.call( arguments ) ) );
      };

    // Set the guid of unique handler to the same of original handler, so it can be removed
    proxy.guid = fn.guid = fn.guid || proxy.guid || jQuery.guid++;

    return proxy;
  }
</code></pre><h2 id=builderpatternjquery><a href=#builderpatternjquery class=subhead-link>#</a> The Builder Pattern</h2><p>When working with the DOM, we often want to construct new elements dynamically - a process which can increase in complexity depending on the final markup, attributes and properties we wish our constructed elements to contain.<p>Complex elements require special care when being defined, especially if we want the flexibility to either literally define the final markup for our elements (which can get messy) or take a more readable object-oriented route instead. Having a mechanism for building our complex DOM objects that is independent from the objects themselves gives us this flexibility and that is exactly what the Builder pattern provides.<p>Builders allow us to construct complex objects by only specifying the type and content of the object, shielding us from the process of creating or representing the object explicitly.<p>The jQuery dollar sign allows us to do just this as it provides a number of different means for dynamically building new jQuery (and DOM) objects, by either passing in the complete markup for an element, partial markup and content or using the jQuery for construction:<pre><code class=language-javascript>
$( '&lt;div class="foo">bar&lt;/div>' );

$( '&lt;p id="test">foo &lt;em>bar&lt;/em>&lt;/p>').appendTo("body");

var newParagraph = $( "&lt;p />" ).text( "Hello world" );

$( "&lt;input />" )
      .attr({ "type": "text", "id":"sample"})
      .appendTo("#container");
</code></pre><p><p> <p>Below is a snippet from jQuery core's internal <code>jQuery.prototype</code> method which assists with the construction of jQuery objects from markup passed to the <code>jQuery()</code> selector. Regardless of whether or not <code>document.createElement</code> is used to create a new element, a reference to the element (found or created) is injected into the returned object so further methods such as <code>.attr()</code> can be easily used on it right after.<pre><code class=language-javascript>
  // HANDLE: $(html) -> $(array)
    if ( match[1] ) {
      context = context instanceof jQuery ? context[0] : context;
      doc = ( context ? context.ownerDocument || context : document );

      // If a single string is passed in and it's a single tag
      // just do a createElement and skip the rest
      ret = rsingleTag.exec( selector );

      if ( ret ) {
        if ( jQuery.isPlainObject( context ) ) {
          selector = [ document.createElement( ret[1] ) ];
          jQuery.fn.attr.call( selector, context, true );

        } else {
          selector = [ doc.createElement( ret[1] ) ];
        }

      } else {
        ret = jQuery.buildFragment( [ match[1] ], [ doc ] );
        selector = ( ret.cacheable ? jQuery.clone(ret.fragment) : ret.fragment ).childNodes;
      }

      return jQuery.merge( this, selector );
</code></pre></section><section><p> <h1 id=jquerypluginpatterns><a href=#jquerypluginpatterns class=subhead-link>#</a> jQuery Plugin Design Patterns</h1><p>jQuery plugin development has evolved over the past few years. We no longer have just one way to write plugins, but many. In reality, certain plugin design patterns might work better for a particular problem or component than others.<p>Some developers may wish to use the jQuery UI <a href=http://ajpiano.com/widgetfactory/#slide1>widget factory</a>; it’s great for complex, flexible UI components. Some may not.<p>Some might like to structure their plugins more like modules (similar to the module pattern) or use a more modern module format such as AMD.<p>Some might want their plugins to harness the power of prototypal inheritance. Others may wish to use custom events or Publish/Subscribe to communicate from plugins to the rest of their app. And so on.<p>I began to think about plugin patterns after noticing a number of efforts to create a one-size-fits-all jQuery plugin boilerplate. While such a boilerplate is a great idea in theory, the reality is that we rarely write plugins in one fixed way, using a single pattern all the time.<p>Let us assume that we’ve tried our hand at writing our own jQuery plugins at some point and we’re comfortable putting together something that works. It’s functional. It does what it needs to do, but perhaps we feel it could be structured better. Maybe it could be more flexible or could be designed to address more of the issues developers commonly run into. If this sounds familiar, then you might find this chapter useful. In it, we're going to explore a number of jQuery plugin patterns that have worked well for other developers in the wild.<p><strong>Note:</strong> This chapter is targeted at intermediate to advanced developers, although we will briefly review some jQuery plugin fundamentals to begin.<p>If you don’t feel quite ready for this just yet, I’m happy to recommend the official jQuery <a href=http://docs.jquery.com/Plugins/Authoring>Plugins/Authoring</a> guide, Ben Alman’s <a href=http://msdn.microsoft.com/en-us/scriptjunkie/ff696759>plugin style guide</a> and Remy Sharp’s “<a href=http://remysharp.com/2010/06/03/signs-of-a-poorly-written-jquery-plugin/ >Signs of a Poorly Written jQuery Plugin</a>.” as reading material prior to starting this section.<h3>Patterns</h3><p>jQuery plugins have few concrete rules, which is one of the reasons for the incredible diversity in how they are implemented across the community. At the most basic level, we can write a plugin simply by adding a new function property to jQuery’s <code>jQuery.fn</code> object, as follows:<pre><code class=language-javascript>
$.fn.myPluginName = function () {
    // our plugin logic
};
</code></pre><p>This is great for compactness, but the following would be a better foundation to build on:<pre><code class=language-javascript>
(function( $ ){
  $.fn.myPluginName = function () {
    // our plugin logic
  };
})( jQuery );
</code></pre><p>Here, we’ve wrapped our plugin logic in an anonymous function. To ensure that our use of the <code>$</code> sign as a shorthand creates no conflicts between jQuery and other JavaScript libraries, we simply pass it to this closure, which maps it to the dollar sign. This ensures that it can’t be affected by anything outside of its scope of execution.<p>An alternative way to write this pattern would be to use <code>jQuery.extend()</code>, which enables us to define multiple functions at once and which sometimes make more sense semantically:<pre><code class=language-javascript>
(function( $ ){
    $.extend($.fn, {
        myplugin: function(){
            // your plugin logic
        }
    });
})( jQuery );
</code></pre><p>We have now reviewed some jQuery plugin fundamentals, but a lot more could be done to take this further. <em>A Lightweight Start</em> is the first complete plugin design pattern we’ll be exploring and it covers some best practices that we can use for basic everyday plugin development, taking into account common gotchas worth applying.<h4>Note</h4><p>While most of the patterns below will be explained, I recommend reading through the comments in the code, because they will offer more insight into why certain best practices are applied.<p>I should also mention that none of this would be possible without the previous work, input and advice of other members of the jQuery community. I’ve listed them inline with each pattern so that one can read up on their individual work if interested.<p> <p> <h3>'A Lightweight Start' Pattern</h3><p>Let’s begin our deeper look at plugin patterns with something basic that follows best practices (including those in the jQuery plugin-authoring guide). This pattern is ideal for developers who are either new to plugin development or who just want to achieve something simple (such as a utility plugin). <em>A Lightweight Start</em> uses the following:<ul><li>Common best practices such as a semi-colon placed before the functions invocation (we'll go through why in the comments below)<li><code>window, document, undefined</code> passed in as arguments.<li>A basic defaults object.<li>A simple plugin constructor for logic related to the initial creation and the assignment of the element to work with.<li>Extending the options with defaults.<li>A lightweight wrapper around the constructor, which helps to avoid issues such as multiple instantiations.<li>Adherence to the jQuery core style guidelines for maximized readability.</ul><pre><code class=language-javascript>
/*!
 * jQuery lightweight plugin boilerplate
 * Original author: @ajpiano
 * Further changes, comments: @addyosmani
 * Licensed under the MIT license
 */


// the semi-colon before the function invocation is a safety
// net against concatenated scripts and/or other plugins
// that are not closed properly.
;(function ( $, window, document, undefined ) {

    // undefined is used here as the undefined global
    // variable in ECMAScript 3 and is mutable (i.e. it can
    // be changed by someone else). undefined isn't really
    // being passed in so we can ensure that its value is
    // truly undefined. In ES5, undefined can no longer be
    // modified.

    // window and document are passed through as local
    // variables rather than as globals, because this (slightly)
    // quickens the resolution process and can be more
    // efficiently minified (especially when both are
    // regularly referenced in our plugin).

    // Create the defaults once
    var pluginName = "defaultPluginName",
        defaults = {
            propertyName: "value"
        };

    // The actual plugin constructor
    function Plugin( element, options ) {
        this.element = element;

        // jQuery has an extend method that merges the
        // contents of two or more objects, storing the
        // result in the first object. The first object
        // is generally empty because we don't want to alter
        // the default options for future instances of the plugin
        this.options = $.extend( {}, defaults, options) ;

        this._defaults = defaults;
        this._name = pluginName;

        this.init();
    }

    Plugin.prototype.init = function () {
        // Place initialization logic here
        // We already have access to the DOM element and
        // the options via the instance, e.g. this.element
        // and this.options
    };

    // A really lightweight plugin wrapper around the constructor,
    // preventing against multiple instantiations
    $.fn[pluginName] = function ( options ) {
        return this.each(function () {
            if ( !$.data(this, "plugin_" + pluginName )) {
                $.data( this, "plugin_" + pluginName,
                new Plugin( this, options ));
            }
        });
    }

})( jQuery, window, document );
</code></pre><p>Usage:<p><pre><code class=language-javascript>
$("#elem").defaultPluginName({
  propertyName: "a custom value"
});
</code></pre><p><h4>Further Reading</h4><ul><li><a href=http://docs.jquery.com/Plugins/Authoring>Plugins/Authoring</a>, jQuery<li>“<a href=http://remysharp.com/2010/06/03/signs-of-a-poorly-written-jquery-plugin/ >Signs of a Poorly Written jQuery Plugin</a>,” Remy Sharp<li>“<a href=http://msdn.microsoft.com/en-us/scriptjunkie/ff608209>How to Create Your Own jQuery Plugin</a>,” Elijah Manor<li>“<a href=http://msdn.microsoft.com/en-us/scriptjunkie/ff696759>Style in jQuery Plugins and Why It Matters</a>,” Ben Almon<li>“<a href=http://enterprisejquery.com/2010/07/create-your-first-jquery-plugin-part-2-revising-your-plugin/ >Create Your First jQuery Plugin, Part 2</a>,” Andrew Wirick</ul><p> <p> <h3>“Complete” Widget Factory Pattern</h3><p>While the jQuery plugin authoring guide is a great introduction to plugin development, it doesn't help obscure away common plugin plumbing tasks that we have to deal with on a regular basis.<p>The jQuery UI Widget Factory is a solution to this problem that helps us build complex, stateful plugins based on object-oriented principles. It also eases communication with our plugins instance, obfuscating a number of the repetitive tasks that we would have to code when working with basic plugins.<p>Stateful plugins help us keep track of their current state, also allowing us to change properties of the plugin after it has been initialized.<p>One of the great things about the Widget Factory is that the majority of the jQuery UI library actually uses it as a base for its components. This means that if we’re looking for further guidance on structure beyond this pattern, we won’t have to look beyond the jQuery UI repository on GitHub (<a href=https://github.com/jquery/jquery-ui>https://github.com/jquery/jquery-ui</a>).<p>This jQuery UI Widget Factory pattern covers almost all of the supported default factory methods, including triggering events. As per the last pattern, comments are included for all of the methods used and further guidance is given in the inline comments.<pre><code class=language-javascript>
/*!
 * jQuery UI Widget-factory plugin boilerplate (for 1.8/9+)
 * Author: @addyosmani
 * Further changes: @peolanha
 * Licensed under the MIT license
 */


;(function ( $, window, document, undefined ) {

    // define our widget under a namespace of your choice
    // with additional parameters e.g.
    // $.widget( "namespace.widgetname", (optional) - an
    // existing widget prototype to inherit from, an object
    // literal to become the widget's prototype );

    $.widget( "namespace.widgetname", {

        //Options to be used as defaults
        options: {
            someValue: null
        },

        //Setup widget (e.g. element creation, apply theming
        //, bind events etc.)
        _create: function () {

            // _create will automatically run the first time
            // this widget is called. Put the initial widget
            // setup code here, then we can access the element
            // on which the widget was called via this.element.
            // The options defined above can be accessed
            // via this.options this.element.addStuff();
        },

        // Destroy an instantiated plugin and clean up
        // modifications the widget has made to the DOM
        destroy: function () {

            // this.element.removeStuff();
            // For UI 1.8, destroy must be invoked from the
            // base widget
            $.Widget.prototype.destroy.call( this );
            // For UI 1.9, define _destroy instead and don't
            // worry about
            // calling the base widget
        },

        methodB: function ( event ) {
            //_trigger dispatches callbacks the plugin user
            // can subscribe to
            // signature: _trigger( "callbackName", [eventObject],
            // [uiObject] )
            // e.g. this._trigger( "hover", e /*where e.type ==
            // "mouseenter"*/, { hovered: $(e.target)});
            this._trigger( "methodA", event, {
                key: value
            });
        },

        methodA: function ( event ) {
            this._trigger( "dataChanged", event, {
                key: value
            });
        },

        // Respond to any changes the user makes to the
        // option method
        _setOption: function ( key, value ) {
            switch ( key ) {
            case "someValue":
                // this.options.someValue = doSomethingWith( value );
                break;
            default:
                // this.options[ key ] = value;
                break;
            }

            // For UI 1.8, _setOption must be manually invoked
            // from the base widget
            $.Widget.prototype._setOption.apply( this, arguments );
            // For UI 1.9 the _super method can be used instead
            // this._super( "_setOption", key, value );
        }
    });

})( jQuery, window, document );
</code></pre><p>Usage:<p><pre><code class=language-javascript>
var collection = $("#elem").widgetName({
  foo: false
});

collection.widgetName("methodB");
</code></pre><p><h4>Further Reading</h4><ul><li><a href=http://ajpiano.com/widgetfactory/#slide1>The jQuery UI Widget Factory</a><li>“<a href=http://msdn.microsoft.com/en-us/scriptjunkie/ff706600>Introduction to Stateful Plugins and the Widget Factory</a>,” Doug Neiner<li>“<a href=http://wiki.jqueryui.com/w/page/12138135/Widgetfactory>Widget Factory</a>” (explained), Scott Gonzalez<li>“<a href=http://bililite.com/blog/understanding-jquery-ui-widgets-a-tutorial/ >Understanding jQuery UI Widgets: A Tutorial</a>,” Hacking at 0300</ul><p> <p> </section><section><h3>Nested Namespacing Plugin Pattern</h3><p>As we've previously covered in the book, namespacing our code is a way to avoid collisions with other objects and variables in the global namespace. They’re important because we want to safeguard our plugin from breaking in the event that another script on the page uses the same variable or plugin names as ours. As a good citizen of the global namespace, we must also do our best not to prevent other developers scripts from executing because of the same issues.<p>JavaScript doesn't really have built-in support for namespaces as other languages do, but it does have objects that can be used to achieve a similar effect. Employing a top-level object as the name of our namespace, we can easily check for the existence of another object on the page with the same name. If such an object does not exist, then we define it; if it does exist, then we simply extend it with our plugin.<p>Objects (or, rather, object literals) can be used to create nested namespaces, such as <code>namespace.subnamespace.pluginName</code> and so on. But to keep things simple, the namespacing boilerplate below should show us everything we need to get started with these concepts.<pre><code class=language-javascript>
/*!
 * jQuery namespaced "Starter" plugin boilerplate
 * Author: @dougneiner
 * Further changes: @addyosmani
 * Licensed under the MIT license
 */

;(function ( $ ) {
    if (!$.myNamespace) {
        $.myNamespace = {};
    };

    $.myNamespace.myPluginName = function ( el, myFunctionParam, options ) {
        // To avoid scope issues, use "base" instead of "this"
        // to reference this class from internal events and functions.
        var base = this;

        // Access to jQuery and DOM versions of element
        base.$el = $( el );
        base.el = el;

        // Add a reverse reference to the DOM object
        base.$el.data( "myNamespace.myPluginName", base );

        base.init = function () {
            base.myFunctionParam = myFunctionParam;

            base.options = $.extend({},
            $.myNamespace.myPluginName.defaultOptions, options);

            // Put our initialization code here
        };

        // Sample Function, Uncomment to use
        // base.functionName = function( parameters ){
        //
        // };
        // Run initializer
        base.init();
    };

    $.myNamespace.myPluginName.defaultOptions = {
        myDefaultValue: ""
    };

    $.fn.mynamespace_myPluginName = function
        ( myFunctionParam, options ) {
        return this.each(function () {
            (new $.myNamespace.myPluginName( this,
            myFunctionParam, options ));
        });
    };

})( jQuery );
</code></pre><p>Usage:<p><pre><code class=language-javascript>
$("#elem").mynamespace_myPluginName({
  myDefaultValue: "foobar"
});
</code></pre><p><h4>Further Reading</h4><ul><li>“<a href=http://javascriptweblog.wordpress.com/2010/12/07/namespacing-in-javascript/ >Namespacing in JavaScript</a>,” Angus Croll<li>“<a href=http://ryanflorence.com/use-your-fn-jquery-namespace/ >Use Your $.fn jQuery Namespace</a>,” Ryan Florence<li>“<a href=http://michaux.ca/articles/javascript-namespacing>JavaScript Namespacing</a>,” Peter Michaux<li>“<a href=http://www.2ality.com/2011/04/modules-and-namespaces-in-javascript.html>Modules and namespaces in JavaScript</a>,” Axel Rauschmayer</ul><p> <p> <h3>Custom Events Plugin Pattern (With The Widget factory)</h3><p>In the <em>JavaScript Design Patterns</em> section of the book, we discussed the Observer pattern and later went on to cover jQuery's support for custom events, which offer a similar solution for implementing Publish/Subscribe. This same pattern can be used when writing jQuery plugins.<p>The basic idea here is that objects in a page can publish event notifications when something interesting occurs in our application. Other objects then subscribe to (or listen) for these events and respond accordingly. This results in the logic for our application being significantly more decoupled, as each object no longer needs to directly communicate with another.<p>In the following jQuery UI widget factory pattern, we’ll implement a basic custom event-based Publish/Subscribe system that allows our plugin to subscribe to event notifications from the rest of our application, which will be responsible for publishing them.<pre><code class=language-javascript>
/*!
 * jQuery custom-events plugin boilerplate
 * Author: DevPatch
 * Further changes: @addyosmani
 * Licensed under the MIT license
 */

// In this pattern, we use jQuery's custom events to add
// pub/sub (publish/subscribe) capabilities to widgets.
// Each widget would publish certain events and subscribe
// to others. This approach effectively helps to decouple
// the widgets and enables them to function independently.

;(function ( $, window, document, undefined ) {
    $.widget( "ao.eventStatus", {
        options: {

        },

        _create: function() {
            var self = this;

            //self.element.addClass( "my-widget" );

            //subscribe to "myEventStart"
            self.element.on( "myEventStart", function( e ) {
                console.log( "event start" );
            });

            //subscribe to "myEventEnd"
            self.element.on( "myEventEnd", function( e ) {
                console.log( "event end" );
            });

            //unsubscribe to "myEventStart"
            //self.element.off( "myEventStart", function(e){
                ///console.log( "unsubscribed to this event" );
            //});
        },

        destroy: function(){
            $.Widget.prototype.destroy.apply( this, arguments );
        },
    });
})( jQuery, window, document );

// Publishing event notifications
// $( ".my-widget" ).trigger( "myEventStart");
// $( ".my-widget" ).trigger( "myEventEnd" );
</code></pre><p>Usage:<p><pre><code class=language-javascript>
var el = $( "#elem" );
el.eventStatus();
el.eventStatus().trigger( "myEventStart" );
</code></pre><p><h4>Further Reading</h4><ul><li>“<a href=http://www.devpatch.com/articles/2010-03-22-communication-between-jquery-ui-widgets/ >Communication Between jQuery UI Widgets</a>,” Benjamin Sternthal</ul><p> <p> <h3>Prototypal Inheritance With The DOM-To-Object Bridge Pattern</h3><p>As covered earlier, in JavaScript, we don’t have the traditional notion of classes that we would find in other classical programming languages, but we do have prototypal inheritance. With prototypal inheritance, an object inherits from another object. We can apply this concept to jQuery plugin development.<p>Yepnope.js author <a href=http://alexsexton.com/ >Alex Sexton</a> and jQuery team member <a href=http://scottgonzalez.com/ >Scott Gonzalez</a> have looked at this topic in detail. In sum, they discovered that for organized modular development, clearly separating the object that defines the logic for a plugin from the plugin-generation process itself can be beneficial.<p>The benefit is that testing our plugins code becomes significantly easier and we are also able to adjust the way things work behind the scenes without altering the way that any object APIs we implement are used.<p>In Sexton’s article on this topic, he implemented a bridge that enables us to attach our general logic to a particular plugin, which we’ve implemented in the pattern below.<p>One of the other advantages of this pattern is that we don’t have to constantly repeat the same plugin initialization code, thus ensuring that the concepts behind DRY development are maintained. Some developers might also find this pattern easier to read than others.<pre><code class=language-javascript>
/*!
 * jQuery prototypal inheritance plugin boilerplate
 * Author: Alex Sexton, Scott Gonzalez
 * Further changes: @addyosmani
 * Licensed under the MIT license
 */


// myObject - an object representing a concept we wish to model
// (e.g. a car)
var myObject = {
  init: function( options, elem ) {
    // Mix in the passed-in options with the default options
    this.options = $.extend( {}, this.options, options );

    // Save the element reference, both as a jQuery
    // reference and a normal reference
    this.elem = elem;
    this.$elem = $( elem );

    // Build the DOM's initial structure
    this._build();

    // return this so that we can chain and use the bridge with less code.
    return this;
  },
  options: {
    name: "No name"
  },
  _build: function(){
    //this.$elem.html( "&lt;h1>"+this.options.name+"&lt;/h1>" );
  },
  myMethod: function( msg ){
    // We have direct access to the associated and cached
    // jQuery element
    // this.$elem.append( "&lt;p>"+msg+"&lt;/p>" );
  }
};


// Object.create support test, and fallback for browsers without it
if ( typeof Object.create !== "function" ) {
    Object.create = function (o) {
        function F() {}
        F.prototype = o;
        return new F();
    };
}


// Create a plugin based on a defined object
$.plugin = function( name, object ) {
  $.fn[name] = function( options ) {
    return this.each(function() {
      if ( ! $.data( this, name ) ) {
        $.data( this, name, Object.create( object ).init(
        options, this ) );
      }
    });
  };
};
</code></pre><p>Usage:<p><pre><code class=language-javascript>
$.plugin( "myobj", myObject );

$("#elem").myobj( {name: "John"} );

var collection = $( "#elem" ).data( "myobj" );
collection.myMethod( "I am a method");
</code></pre><p><h4>Further Reading</h4><ul><li>“<a href="http://alexsexton.com/?p=51">Using Inheritance Patterns To Organize Large jQuery Applications</a>,” Alex Sexton<li>“<a href=http://www.slideshare.net/SlexAxton/how-to-manage-large-jquery-apps>How to Manage Large Applications With jQuery or Whatever</a>” (further discussion), Alex Sexton<li>“<a href=http://blog.bigbinary.com/2010/03/12/pratical-example-of-need-for-prototypal-inheritance.html>Practical Example of the Need for Prototypal Inheritance</a>,” Neeraj Singh<li>“<a href=http://javascript.crockford.com/prototypal.html>Prototypal Inheritance in JavaScript</a>,” Douglas Crockford</ul></section><p> <p> <section><h3>jQuery UI Widget Factory Bridge Pattern</h3><p>If you liked the idea of generating plugins based on objects in the last design pattern, then you might be interested in a method found in the jQuery UI Widget Factory called <code>$.widget.bridge</code>.<p>This bridge basically serves as a middle layer between a JavaScript object that is created using <code>$.widget</code> and the jQuery core API, providing a more built-in solution to achieving object-based plugin definition. Effectively, we’re able to create stateful plugins using a custom constructor.<p>Moreover,<code>$.widget.bridge</code> provides access to a number of other capabilities, including the following:<ul><li>Both public and private methods are handled as one would expect in classical OOP (i.e. public methods are exposed, while calls to private methods are not possible).<li>Automatic protection against multiple initializations.<li>Automatic generation of instances of a passed object, and storage of them within the selection’s internal <code>$.data</code> cache.<li>Options can be altered post-initialization.</ul><p>For further information on how to use this pattern, please see the inline comments below:<pre><code class=language-javascript>
/*!
 * jQuery UI Widget factory "bridge" plugin boilerplate
 * Author: @erichynds
 * Further changes, additional comments: @addyosmani
 * Licensed under the MIT license
 */


// a "widgetName" object constructor
// required: this must accept two arguments,
// options: an object of configuration options
// element: the DOM element the instance was created on
var widgetName = function( options, element ){
  this.name = "myWidgetName";
  this.options = options;
  this.element = element;
  this._init();
}

// the "widgetName" prototype
widgetName.prototype = {

    // _create will automatically run the first time this
    // widget is called
    _create: function(){
        // creation code
    },

    // required: initialization logic for the plugin goes into _init
    // This fires when our instance is first created and when
    // attempting to initialize the widget again (by the bridge)
    // after it has already been initialized.
    _init: function(){
        // init code
    },

    // required: objects to be used with the bridge must contain an
    // "option". Post-initialization, the logic for changing options
    // goes here.
    option: function( key, value ){

        // optional: get/change options post initialization
        // ignore if you don't require them.

        // signature: $("#foo").bar({ cool:false });
        if( $.isPlainObject( key ) ){
            this.options = $.extend( true, this.options, key );

        // signature: $( "#foo" ).option( "cool" ); - getter
        } else if ( key && typeof value === "undefined" ){
            return this.options[ key ];

        // signature: $( "#foo" ).bar("option", "baz", false );
        } else {
            this.options[ key ] = value;
        }

        // required: option must return the current instance.
        // When re-initializing an instance on elements, option
        // is called first and is then chained to the _init method.
        return this;
    },

    // notice no underscore is used for public methods
    publicFunction: function(){
        console.log( "public function" );
    },

    // underscores are used for private methods
    _privateFunction: function(){
        console.log( "private function" );
    }
};

</code></pre><p>Usage:<p><pre><code class=language-javascript>
// connect the widget obj to jQuery's API under the "foo" namespace
$.widget.bridge( "foo", widgetName );

// create an instance of the widget for use
var instance = $( "#foo" ).foo({
   baz: true
});

// our widget instance exists in the elem's data
// Outputs: #elem
console.log(instance.data( "foo" ).element);

// bridge allows us to call public methods
// Outputs: "public method"
instance.foo("publicFunction");

// bridge prevents calls to internal methods
instance.foo("_privateFunction");
</code></pre><p><h4>Further Reading</h4><ul><li>“<a href=http://erichynds.com/jquery/using-jquery-ui-widget-factory-bridge/ >Using $.widget.bridge Outside of the Widget Factory</a>,” Eric Hynds</ul><p> <p> <h3>jQuery Mobile Widgets With The Widget factory</h3><p>jQuery mobile is a jQuery project framework that encourages the design of ubiquitous web applications that work both on popular mobile devices and platforms and on the desktop. Rather than writing unique applications for each device or OS, we simply write the code once and it should ideally run on many of the A-, B- and C-grade browsers out there at the moment.<p>The fundamentals behind jQuery mobile can also be applied to plugin and widget development.<p>What’s interesting in this next pattern is that although there are small, subtle differences in writing a “mobile”-optimized widget, those familiar with using the jQuery UI Widget Factory pattern from earlier should be able to grasp this in next to no time.<p>The mobile-optimized widget below has a number of interesting differences than the standard UI widget pattern we saw earlier:<ul><li><code>$.mobile.widget</code> is referenced as an existing widget prototype from which to inherit. For standard widgets, passing through any such prototype is unnecessary for basic development, but using this jQuery-mobile specific widget prototype provides internal access to further “options” formatting.<li>In <code>_create()</code>, a guide is provided on how the official jQuery mobile widgets handle element selection, opting for a role-based approach that better fits the jQM mark-up. This isn’t at all to say that standard selection isn’t recommended, only that this approach might make more sense given the structure of jQuery Mobile pages.<li>Guidelines are also provided in comment form for applying our plugin methods on <code>pagecreate</code> as well as for selecting the plugin application via data roles and data attributes.</ul><pre><code class=language-javascript>
/*!
 * (jQuery mobile) jQuery UI Widget-factory plugin boilerplate (for 1.8/9+)
 * Author: @scottjehl
 * Further changes: @addyosmani
 * Licensed under the MIT license
 */

;(function ( $, window, document, undefined ) {

    // define a widget under a namespace of our choice
    // here "mobile" has been used in the first argument
    $.widget( "mobile.widgetName", $.mobile.widget, {

        // Options to be used as defaults
        options: {
            foo: true,
            bar: false
        },

        _create: function() {
            // _create will automatically run the first time this
            // widget is called. Put the initial widget set-up code
            // here, then we can access the element on which
            // the widget was called via this.element
            // The options defined above can be accessed via
            // this.options

            // var m = this.element,
            // p = m.parents( ":jqmData(role="page")" ),
            // c = p.find( ":jqmData(role="content")" )
        },

        // Private methods/props start with underscores
        _dosomething: function(){ ... },

        // Public methods like these below can can be called
        // externally:
        // $("#myelem").foo( "enable", arguments );

        enable: function() { ... },

        // Destroy an instantiated plugin and clean up modifications
        // the widget has made to the DOM
        destroy: function () {
            // this.element.removeStuff();
            // For UI 1.8, destroy must be invoked from the
            // base widget
            $.Widget.prototype.destroy.call( this );
            // For UI 1.9, define _destroy instead and don't
            // worry about calling the base widget
        },

        methodB: function ( event ) {
            //_trigger dispatches callbacks the plugin user can
            // subscribe to
            // signature: _trigger( "callbackName", [eventObject],
            // [uiObject] )
            // e.g. this._trigger( "hover", e /*where e.type ==
            // "mouseenter"*/, { hovered: $(e.target)});
            this._trigger( "methodA", event, {
                key: value
            });
        },

        methodA: function ( event ) {
            this._trigger( "dataChanged", event, {
                key: value
            });
        },

        // Respond to any changes the user makes to the option method
        _setOption: function ( key, value ) {
            switch ( key ) {
            case "someValue":
                // this.options.someValue = doSomethingWith( value );
                break;
            default:
                // this.options[ key ] = value;
                break;
            }

            // For UI 1.8, _setOption must be manually invoked from
            // the base widget
            $.Widget.prototype._setOption.apply(this, arguments);
            // For UI 1.9 the _super method can be used instead
            // this._super( "_setOption", key, value );
        }
    });

})( jQuery, window, document );
</code></pre><p>Usage:<p><pre><code class=language-javascript>
var instance = $( "#foo" ).widgetName({
  foo: false
});

instance.widgetName( "methodB" );
</code></pre><p><p>We can also self-initialize this widget whenever a new page in jQuery Mobile is created. jQuery Mobile's <em>page</em> plugin dispatches a <em>create</em> event when a jQuery Mobile page (found via the <code>data-role="page"</code> attribute) is first initialized. We can listen for that event (called "pagecreate") and run our plugin automatically whenever a new page is created.<p><pre><code class=language-javascript>
$(document).on("pagecreate", function ( e ) {
    // In here, e.target refers to the page that was created
    // (it's the target of the pagecreate event)
    // So, we can simply find elements on this page that match a
    // selector of our choosing, and call our plugin on them.
    // Here's how we'd call our "foo" plugin on any element with a
    // data-role attribute of "foo":
    $(e.target).find( "[data-role="foo"]" ).foo( options );

    // Or, better yet, let's write the selector accounting for the configurable
    // data-attribute namespace
    $( e.target ).find( ":jqmData(role="foo")" ).foo( options );
});
</code></pre><p><p>We can now simply reference the script containing our widget and <code>pagecreate</code> binding in a page running jQuery Mobile site, and it will automatically run like any other jQuery Mobile plugin.<p> <p> <h3>RequireJS And The jQuery UI Widget Factory</h3><p>As we covered in the section on <em>Modern Module Design Patterns</em>, RequireJS is an AMD-compatible script loader that provides a clean solution for encapsulating application logic inside manageable modules.<p>It’s able to load modules in the correct order (through its order plugin), simplifies the process of combining scripts via its excellent r.js optimizer and provides the means for defining dynamic dependencies on a per-module basis.<p>In the boilerplate pattern below, we demonstrate how an AMD (and thus RequireJS) compatible jQuery UI widget can be defined that does the following:<ul><li>Allows the definition of widget module dependencies, building on top of the previous jQuery UI Widget Factory pattern presented earlier.<li>Demonstrates one approach to passing in HTML template assets for creating templated widgets (using Underscore.js micro-templating).<li>Includes a quick tip on adjustments that we can make to our widget module if we wish to later pass it through to the RequireJS optimizer.</ul><pre><code class=language-javascript>
/*!
 * jQuery UI Widget + RequireJS module boilerplate (for 1.8/9+)
 * Authors: @jrburke, @addyosmani
 * Licensed under the MIT license
 */

// Note from James:
//
// This assumes we are using the RequireJS+jQuery file, and
// that the following files are all in the same directory:
//
// - require-jquery.js
// - jquery-ui.custom.min.js (custom jQuery UI build with widget factory)
// - templates/
// - asset.html
// - ao.myWidget.js

// Then we can construct the widget as follows:

// ao.myWidget.js file:
define( "ao.myWidget", ["jquery", "text!templates/asset.html", "underscore", "jquery-ui.custom.min"], function ( $, assetHtml, _ ) {

    // define our widget under a namespace of our choice
    // "ao" is used here as a demonstration
    $.widget( "ao.myWidget", {

        // Options to be used as defaults
        options: {},

        // Set up widget (e.g. create element, apply theming,
        // bind events, etc.)
        _create: function () {

            // _create will automatically run the first time
            // this widget is called. Put the initial widget
            // set-up code here, then we can access the element
            // on which the widget was called via this.element.
            // The options defined above can be accessed via
            // this.options

            // this.element.addStuff();
            // this.element.addStuff();

            // We can then use Underscore templating with
            // with the assetHtml that has been pulled in
            // var template = _.template( assetHtml );
            // this.content.append( template({}) );
        },

        // Destroy an instantiated plugin and clean up modifications
        // that the widget has made to the DOM
        destroy: function () {
            // this.element.removeStuff();
            // For UI 1.8, destroy must be invoked from the base
            // widget
            $.Widget.prototype.destroy.call( this );
            // For UI 1.9, define _destroy instead and don't worry
            // about calling the base widget
        },

        methodB: function ( event ) {
            // _trigger dispatches callbacks the plugin user can
            // subscribe to
            // signature: _trigger( "callbackName", [eventObject],
            // [uiObject] )
            this._trigger( "methodA", event, {
                key: value
            });
        },

        methodA: function ( event ) {
            this._trigger("dataChanged", event, {
                key: value
            });
        },

        // Respond to any changes the user makes to the option method
        _setOption: function ( key, value ) {
            switch (key) {
            case "someValue":
                // this.options.someValue = doSomethingWith( value );
                break;
            default:
                // this.options[ key ] = value;
                break;
            }

            // For UI 1.8, _setOption must be manually invoked from
            // the base widget
            $.Widget.prototype._setOption.apply( this, arguments );
            // For UI 1.9 the _super method can be used instead
            // this._super( "_setOption", key, value );
        }

    });
});

</code></pre><p>Usage:<p>index.html:<p><pre><code class=language-javascript>
&lt;script data-main="scripts/main" src="http://requirejs.org/docs/release/1.0.1/minified/require.js">&lt;/script>
</code></pre><p><p>main.js<p><pre><code class=language-javascript>
require({

    paths: {
        "jquery": "https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min",
        "jqueryui": "https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min",
        "boilerplate": "../patterns/jquery.widget-factory.requirejs.boilerplate"
    }
}, ["require", "jquery", "jqueryui", "boilerplate"],
function (req, $) {

    $(function () {

        var instance = $("#elem").myWidget();
        instance.myWidget("methodB");

    });
});
</code></pre><p><h4>Further Reading</h4><ul><li>“<a href=http://speakerrate.com/talks/2983-fast-modular-code-with-jquery-and-requirejs>Fast Modular Code With jQuery and RequireJS</a>,” James Burke<li>“<a href=http://jquerysbestfriends.com/#slide1>jQuery’s Best Friends</a>,” Alex Sexton<li>“<a href=http://www.angrycoding.com/2011/09/managing-dependencies-with-requirejs.html>Managing Dependencies With RequireJS</a>,” Ruslan Matveev</ul><p> <p> <h3>Globally And Per-Call Overridable Options (Best Options Pattern)</h3><p>For our next pattern, we’ll look at an optimal approach to configuring options and defaults for a plugin. The way most of us are probably familiar with defining plugin options is to pass through an object literal of defaults to <code>$.extend()</code>, as demonstrated in our basic plugin boilerplate.<p>If, however, we’re working with a plugin with many customizable options that we would like users to be able to override either globally or on a per-call level, then we can structure things a little more optimally.<p>Instead, by referring to an options object defined within the plugin namespace explicitly (for example, <code>$fn.pluginName.options</code>) and merging this with any options passed through to the plugin when it is initially invoked, users have the option of either passing options through during plugin initialization or overriding options outside of the plugin (as demonstrated here).<pre><code class=language-javascript>
/*!
 * jQuery "best options" plugin boilerplate
 * Author: @cowboy
 * Further changes: @addyosmani
 * Licensed under the MIT license
 */


;(function ( $, window, document, undefined ) {

    $.fn.pluginName = function ( options ) {

        // Here's a best practice for overriding "defaults"
        // with specified options. Note how, rather than a
        // regular defaults object being passed as the second
        // parameter, we instead refer to $.fn.pluginName.options
        // explicitly, merging it with the options passed directly
        // to the plugin. This allows us to override options both
        // globally and on a per-call level.

        options = $.extend( {}, $.fn.pluginName.options, options );

        return this.each(function () {

            var elem = $(this);

        });
    };

    // Globally overriding options
    // Here are our publicly accessible default plugin options
    // that are available in case the user doesn't pass in all
    // of the values expected. The user is given a default
    // experience but can also override the values as necessary.
    // e.g. $fn.pluginName.key ="otherval";

    $.fn.pluginName.options = {

        key: "value",
        myMethod: function ( elem, param ) {

        }
    };

})( jQuery, window, document );
</code></pre><p>Usage:<p><pre><code class=language-javascript>
$("#elem").pluginName({
  key: "foobar"
});
</code></pre><p><h4>Further Reading</h4><ul><li><a href=http://benalman.com/talks/jquery-pluginization.html>jQuery Pluginization</a> and the <a href=https://gist.github.com/472783/e8bf47340413129a8abe5fac55c83336efb5d4e1>accompanying gist</a>, Ben Alman</ul></section><p> <p> <section><h3>A Highly Configurable And Mutable Plugin Pattern</h3><p>In this pattern, similar to Alex Sexton's prototypal inheritance plugin pattern, logic for our plugin isn’t nested in a jQuery plugin itself. We instead define our plugin logic using a constructor and an object literal defined on its prototype. jQuery is then used for the actual instantiation of the plugin object.<p>Customization is taken to the next level by employing two little tricks, one of which we’ve seen in previous patterns:<ul><li>Options can be overridden both globally and per collection of elements/<li>Options can be customized on a <strong>per-element</strong> level through HTML5 data attributes (as shown below). This facilitates plugin behavior that can be applied to a collection of elements but then customized inline without the need to instantiate each element with a different default value.</ul><p>We don’t see the latter option in the wild too often, but it can be a significantly cleaner solution (as long as we don’t mind the inline approach). If wondering where this could be useful, imagine writing a draggable plugin for a large set of elements. We could go about customizing their options as follows:<pre><code class=language-javascript>
$( ".item-a" ).draggable( {"defaultPosition":"top-left"} );
$( ".item-b" ).draggable( {"defaultPosition":"bottom-right"} );
$( ".item-c" ).draggable( {"defaultPosition":"bottom-left"} );
//etc
</code></pre><p>But using our patterns inline approach, the following would be possible:<pre><code class=language-javascript>
$( ".items" ).draggable();
</code></pre><pre><code>
&lt;li class="item" data-plugin-options="{"defaultPosition":"top-left"}">&lt;/div>
&lt;li class="item" data-plugin-options="{"defaultPosition":"bottom-left"}">&lt;/div>
</code></pre><p>And so on. We may well have a preference for one of these approaches, but it is just another variation worth being aware of.<pre><code class=language-javascript>
/*
 * "Highly configurable" mutable plugin boilerplate
 * Author: @markdalgleish
 * Further changes, comments: @addyosmani
 * Licensed under the MIT license
 */


// Note that with this pattern, as per Alex Sexton's, the plugin logic
// hasn't been nested in a jQuery plugin. Instead, we just use
// jQuery for its instantiation.

;(function( $, window, document, undefined ){

  // our plugin constructor
  var Plugin = function( elem, options ){
      this.elem = elem;
      this.$elem = $(elem);
      this.options = options;

      // This next line takes advantage of HTML5 data attributes
      // to support customization of the plugin on a per-element
      // basis. For example,
      // &lt;div class="item" data-plugin-options="{'message':'Goodbye World!'}">&lt;/div>
      this.metadata = this.$elem.data( "plugin-options" );
    };

  // the plugin prototype
  Plugin.prototype = {
    defaults: {
      message: "Hello world!"
    },

    init: function() {
      // Introduce defaults that can be extended either
      // globally or using an object literal.
      this.config = $.extend( {}, this.defaults, this.options,
      this.metadata );

      // Sample usage:
      // Set the message per instance:
      // $( "#elem" ).plugin( { message: "Goodbye World!"} );
      // or
      // var p = new Plugin( document.getElementById( "elem" ),
      // { message: "Goodbye World!"}).init()
      // or, set the global default message:
      // Plugin.defaults.message = "Goodbye World!"

      this.sampleMethod();
      return this;
    },

    sampleMethod: function() {
      // e.g. show the currently configured message
      // console.log(this.config.message);
    }
  }

  Plugin.defaults = Plugin.prototype.defaults;

  $.fn.plugin = function( options ) {
    return this.each(function() {
      new Plugin( this, options ).init();
    });
  };

  // optional: window.Plugin = Plugin;

})( jQuery, window, document );
</code></pre><p>Usage:<p><pre><code class=language-javascript>
$("#elem").plugin({
  message: "foobar"
});
</code></pre><p><h4>Further Reading</h4><ul><li>“<a href=http://markdalgleish.com/2011/05/creating-highly-configurable-jquery-plugins/ >Creating Highly Configurable jQuery Plugins</a>,” Mark Dalgleish<li>“<a href=http://markdalgleish.com/2011/09/html5data-creating-highly-configurable-jquery-plugins-part-2/ >Writing Highly Configurable jQuery Plugins, Part 2</a>,” Mark Dalgleish</ul><p> </section><section><h3>What Makes A Good Plugin Beyond Patterns?</h3><p>At the end of the day, design patterns are just one facet to writing maintainable jQuery plugins. There are a number of other factors worth considering and I would like to share my own criteria for selecting third-party plugins to address some of the other concerns. I hope this helps increase the overall quality of your plugin projects:<p><strong>Quality</strong><p>Adhere to best practices with respect to both the JavaScript and jQuery that you write. Are efforts being made to lint the plugin code using either jsHint or jsLint? Is the plugin written optimally?<p><strong>Code Style</strong><p>Does the plugin follow a consistent code style guide such as the <a href=http://docs.jquery.com/JQuery_Core_Style_Guidelines>jQuery Core Style Guidelines</a>? If not, is your code at least relatively clean and readable?<p><strong>Compatibility</strong><p>Which versions of jQuery is the plugin compatible with? Has it been tested with the latest jQuery-git builds or latest stable? If the plugin was written before jQuery 1.6, then it might have issues with attributes and properties, because the way they were approached changed in that release.<p>New versions of jQuery offer improvements and opportunities for the jQuery project to improve on what the core library offers. With this comes occasional breakages (mainly in major releases) as we move towards a better way of doing things. I’d like to see plugin authors update their code when necessary or, at a minimum, test their plugins with new versions to make sure everything works as expected.<p><strong>Reliability</strong><p>The plugin should come with its own set of unit tests. Not only do these prove it actually functions as expected, but they can also improve the design without breaking it for end users. I consider unit tests essential for any serious jQuery plugin that is meant for a production environment, and they’re not that hard to write. For an excellent guide to automated JavaScript testing with QUnit, you may be interested in “<a href=http://msdn.microsoft.com/en-us/scriptjunkie/gg749824>Automating JavaScript Testing With QUnit</a>,” by <a href=http://bassistance.de/ >Jörn Zaefferer</a>.<p><strong>Performance</strong><p>If the plugin needs to perform tasks that require extensive processing or heavily manipulation of the DOM, one should follow best practices for benchmarking to help minimize this. Use <a href=http://jsperf.com>jsPerf.com</a> to test segments of the code to a) how well it performs in different browsers and b) discover what, if anything, might be optimized further.<p><strong>Documentation</strong><p>If the intension is for other developers to use the plugin, ensure that it’s well documented. Document the API and how the plugin is to be used. What methods and options does the plugin support? Does it have any gotchas that users need to be aware of? If users cannot figure out how to use the plugin, they’ll likely look for an alternative. It is also of great help to comment your plugin code. This is by far the best gift you can offer other developers. If someone feels they can navigate your code base well enough to use it or improve it, then you’ve done a good job.<p><strong>Likelihood of maintenance</strong><p>When releasing a plugin, estimate how much time may be required for maintenance and support. We all love to share our plugins with the community, but one needs to set expectations for ones ability to answer questions, address issues and make continuous improvements. This can be done simply by stating the project intentions for maintenance support upfront in the <em>README</em> file.<h2>Conclusions</h2><p>In this chapter, we explored several time-saving design patterns and best practices that can be employed to improve how jQuery plugins can be written. Some are better suited to certain use cases than others, but I hope on the whole these patterns are useful.<p>Remember, when selecting a pattern, it is important to be practical. Don’t use a plugin pattern just for the sake of it, rather, invest time in understanding the underlying structure, and establish how well it solves your problem or fits the component you’re trying to build.<h2 id=detailnamespacing>Namespacing Patterns</h2><p>In this section, we're going to explore patterns for namespacing in JavaScript. Namespaces can be considered a logical grouping of units of code under a unique identifier. The identifier can be referenced in many namespaces and each identifier can itself contain a hierarchy of its own nested (or sub) namespaces.<p>In application development, we employ namespaces for a number of important reasons. In JavaScript, they help us avoid <b>collisions</b> with other objects or variables in the global namespace. They're also extremely useful for helping organize blocks of functionality in a code-base so that it can be more easily referenced and used.<p>Namespacing any serious script or application is critical as it's important to safeguard our code from breaking in the event of another script on the page using the <b>same</b> variable or method names we are. With the number of <b>third-party</b> tags regularly injected into pages these days, this can be a common problem we all need to tackle at some point in our careers. As a well-behaved "citizen" of the global namespace, it's also imperative that we do our best to similarly not prevent other developer's scripts executing due to the same issues.<p>Whilst JavaScript doesn't really have built-in support for namespaces like other languages, it does have objects and closures which can be used to achieve a similar effect.<p><a name=beginners></a><h2>Namespacing Fundamentals</h2><p>Namespaces can be found in almost any serious JavaScript application. Unless we're working with a simple code-snippet, it's imperative that we do our best to ensure that we're implementing namespacing correctly as it's not just simple to pick-up, it'll also avoid third party code clobbering our own. The patterns we'll be examining in this section are:<ol><li>Single global variables<li>Prefix namespacing<li>Object literal notation<li>Nested namespacing<li>Immediately-invoked Function Expressions<li>Namespace injection</ol><h3>1. Single global variables</h3><p>One popular pattern for namespacing in JavaScript is opting for a single global variable as our primary object of reference. A skeleton implementation of this where we return an object with functions and properties can be found below:<pre><code class=language-javascript>
var myApplication = (function () {
  function() {
    //...
  },
  return {
    //...
  }
})();

</code></pre><p>Although this works for certain situations, the biggest challenge with the single global variable pattern is ensuring that no one else has used the same global variable name as we have in the page.<h3>2. Prefix namespacing</h3><p>One solution to the above problem, as mentioned by <a href=http://michaux.ca/articles/javascript-namespacing>Peter Michaux</a>, is to use prefix namespacing. It's a simple concept at heart, but the idea is we select a unique prefix namespace we wish to use (in this example, <code>myApplication_</code>) and then define any methods, variables or other objects after the prefix as follows:<pre><code class=language-javascript>
var myApplication_propertyA = {};
var myApplication_propertyB = {};
function myApplication_myMethod() {
  //...
}
</code></pre><p>This is effective from the perspective of decreasing the chances of a particular variable existing in the global scope, but remember that a uniquely named object can have the same effect.<p>This aside, the biggest issue with the pattern is that it can result in a large number of global objects once our application starts to grow. There is also quite a heavy reliance on our prefix not being used by any other developers in the global namespace, so be careful if opting to use this.<p>For more on Peter's views about the single global variable pattern, read his excellent post on them <a href=http://peter.michaux.ca/articles/javascript-namespacing>http://peter.michaux.ca/articles/javascript-namespacing</a>.<h3>3. Object literal notation</h3><p>Object literal notation (which we also cover in the module pattern section of the book) can be thought of as an object containing a collection of key:value pairs with a colon separating each pair of keys and values where keys can also represent new namespaces.<pre><code class=language-javascript>
var myApplication = {

  // As we've seen, we can easily define functionality for
  // this object literal..
  getInfo: function() {
    //...
  },

  // but we can also populate it to support
  // further object namespaces containing anything
  // anything we wish:
  models: {},
  views: {
      pages: {}
  },
  collections: {}
};
</code></pre><p>One can also opt for adding properties directly to the namespace:<pre><code class=language-javascript>
myApplication.foo = function() {
  return "bar";
}

myApplication.utils = {
  toString: function() {
      //...
  },
  export: function() {
      //...
  }
}
</code></pre><p>Object literals have the advantage of not polluting the global namespace but assist in organizing code and parameters logically. They are truly beneficial if we wish to create easily-readable structures that can be expanded to support deep nesting. Unlike simple global variables, object literals often also take into account tests for the existence of a variable by the same name so the chances of collision occurring are significantly reduced.<p>In the next sample, we demonstrate a number of different ways in which we can check to see if a variable (object or plugin namespace) already exists, defining it if it doesn't.<pre><code class=language-javascript>
// This doesn't check for existence of "myApplication" in
// the global namespace. Bad practice as we can easily
// clobber an existing variable/namespace with the same name
var myApplication = {};

// The following options *do* check for variable/namespace existence.
// If already defined, we use that instance, otherwise we assign a new
// object literal to myApplication.
//
// Option 1: var myApplication = myApplication || {};
// Option 2: if( !MyApplication ){ MyApplication = {} };
// Option 3: window.myApplication || ( window.myApplication = {} );
// Option 4: var myApplication = $.fn.myApplication = function() {};
// Option 5: var myApplication = myApplication === undefined ? {} : myApplication;

</code></pre><p>We'll often see developers opting for Option 1 or Option 2 - they are both straight-forward to understand and are equivalent in terms of their end-result.<p>Option 3 assumes that we're working in the global namespace, but it could also be written as:<pre><code class=language-javascript>
myApplication || (myApplication = {});
</code></pre><p>This variation assumes that <code>myApplication</code> has already been initialized and so it's only really useful for a parameter/argument scenario as in the following example:<pre><code class=language-javascript>
function foo() {
  myApplication || ( myApplication = {} );
}

// myApplication hasn't been initialized,
// so foo() throws a ReferenceError

foo();

// However accepting myApplication as an
// argument

function foo( myApplication ) {
  myApplication || ( myApplication = {} );
}

foo();

// Even if myApplication === undefined, there is no error
// and myApplication gets set to {} correctly

</code></pre><p>Options 4 can be useful for writing jQuery plugins where:<pre><code class=language-javascript>
// If we were to define a new plugin..
var myPlugin = $.fn.myPlugin = function() { ... };

// Then later rather than having to type:
$.fn.myPlugin.defaults = {};

// We can do:
myPlugin.defaults = {};
</code></pre><p>This results in better compression (minification) and can save on scope lookups.<p>Option 5 is a little similar to Option 4, but is a long-form which evaluates whether <code>myApplication</code> is <code>undefined</code> inline such that it's defined as an object if not, otherwise set to an existing value for <code>myApplication</code> if so.<p>It is shown just for the sake of being thorough but in most situations, Options 1-4 will more than suffice for most needs.<p>There is of course a great deal of variance in how and where object literals are used for organizing and structuring code. For smaller applications wishing to expose a nested API for a particular self-enclosed module, we may just find ourselves using the Revealing Module Pattern, which we covered earlier in the book:<pre><code class=language-javascript>

var namespace = (function () {

    // defined within the local scope
    var privateMethod1 = function () { /* ... */ },
        privateMethod2 = function () { /* ... */ },
        privateProperty1 = "foobar";

  return {

    // the object literal returned here can have as many
    // nested depths as we wish, however as mentioned,
    // this way of doing things works best for smaller,
    // limited-scope applications in my personal opinion
    publicMethod1: privateMethod1,

    // nested namespace with public properties
    properties: {
        publicProperty1: privateProperty1
    },

    // another tested namespace
    utils: {
        publicMethod2: privateMethod2
    }
    ...
  }
})();
</code></pre><p>The benefit of object literals is that they offer us a very elegant key/value syntax to work with; one where we're able to easily encapsulate any distinct logic or functionality for our application in a way that clearly separates it from others and provides a solid foundation for extending our code.<p>A possible downside however is that object literals have the potential to grow into long syntactic constructs. Opting to take advantage of the nested namespace pattern (which also uses the same pattern as its base)<p>This pattern has a number of other useful applications too. In addition to namespacing, it's often of benefit to decouple the default configuration for our application into a single area that can be easily modified without the need to search through our entire codebase just to alter them - object literals work great for this purpose. Here's an example of a hypothetical object literal for configuration:<pre><code class=language-javascript>
var myConfig = {

  language: "english",

  defaults: {
    enableGeolocation: true,
    enableSharing: false,
    maxPhotos: 20
  },

  theme: {
    skin: "a",
    toolbars: {
      index: "ui-navigation-toolbar",
      pages: "ui-custom-toolbar"
    }
  }
}

</code></pre><p>Note that JSON is a subset of object literal notation and there are really only minor syntactical differences between it and the above (e.g JSON keys must be strings). If for any reason one wishes to use JSON for storing configuration data instead (e.g. for simpler storage when sending to the back-end), feel free to. For more on the object literal pattern, I recommend reading Rebecca Murphey's excellent <a href=https://github.com/rmurphey/rmurphey/blob/master/public/blog/using-objects-to-organize-your-code.md>article</a> on the topic as she covers a few areas we didn't touch upon.<h3>4. Nested namespacing</h3><p>An extension of the object literal pattern is nested namespacing. It's another common pattern used that offers a lower risk of collision due to the fact that even if a namespace already exists, it's unlikely the same nested children do.<p>Does this look familiar?<pre><code class=language-javascript>
jsYAHOO.util.Dom.getElementsByClassName("test");
</code></pre><p>Older versions of Yahoo!'s YUI library use the nested object namespacing pattern regularly. During my time as an engineer at AOL, we also used this pattern in many of our larger applications. A sample implementation of nested namespacing may look like this:<pre><code class=language-javascript>

var myApp = myApp || {};

// perform a similar existence check when defining nested
// children
myApp.routers = myApp.routers || {};
myApp.model = myApp.model || {};
myApp.model.special = myApp.model.special || {};

// nested namespaces can be as complex as required:
// myApp.utilities.charting.html5.plotGraph(/*..*/);
// myApp.modules.financePlanner.getSummary();
// myApp.services.social.facebook.realtimeStream.getLatest();

</code></pre><p><strong>Note: The above differs from how YUI3 approaches namespacing as modules there use a sandboxed API host object with far less and far shallower namespacing.</strong><p>We can also opt to declare new nested namespaces/properties as indexed properties as follows:<pre><code class=language-javascript>
myApp["routers"] = myApp["routers"] || {};
myApp["models"] = myApp["models"] || {};
myApp["controllers"] = myApp["controllers"] || {};
</code></pre><p>Both options are readable, organized and offer a relatively safe way of namespacing our application in a similar fashion to what we may be used to in other languages. The only real caveat however is that it requires our browser's JavaScript engine first locating the myApp object and then digging down until it gets to the function we actually wish to use.<p>This can mean an increased amount of work to perform lookups, however developers such as <a href=http://twitter.com/kangax>Juriy Zaytsev</a> have previously tested and found the performance differences between single object namespacing vs the "nested" approach to be quite negligible.<h3>5. Immediately-invoked Function Expressions (IIFE)s</h3><p>Earlier in the book, we briefly covered the concept of an <a href=http://benalman.com/news/2010/11/immediately-invoked-function-expression/ >IIFE</a> (immediately-invoked function expression) which is effectively an unnamed function, immediately invoked after it's been defined. If it sounds familiar it's because you may have previous come across it referred to as a self-executing (or self-invoked) anonymous function, however I personally feel Ben Alman's IIFE naming is more accurate. In JavaScript, because both variables and functions explicitly defined within such a context may only be accessed inside of it, function invocation provides an easy means to achieving privacy.<p>IIFEs are a popular approach to encapsulating application logic to protect it from the global namespace but also have their use in the world of namespacing.<p>Examples of IIFEs can be found below:<pre><code class=language-javascript>
// an (anonymous) immediately-invoked function expression
(function () { /*...*/ })();

// a named immediately-invoked function expression
(function foobar () { /*..*/ })();
</code></pre><p>Examples of self-executing functions, which are quite different than IIFEs, can be found below:<pre><code class=language-javascript>
// named self-executing function
function foobar () { foobar(); }

// anonymous self-executing function
var foobar = function () { arguments.callee(); }
</code></pre><p>Back to the IIFEs, a slightly more expanded version of the first IIFE example might look like:<pre><code class=language-javascript>
var namespace = namespace || {};

// here a namespace object is passed as a function
// parameter, where we assign public methods and
// properties to it
(function( o ) {
  o.foo = "foo";
  o.bar = function() {
    return "bar";
  };
})( namespace );

console.log( namespace );
</code></pre><p>Whilst readable, this example could be significantly expanded on to address common development concerns such as defined levels of privacy (public/private functions and variables) as well as convenient namespace extension. Let's go through some more code:<pre><code class=language-javascript>

// namespace (our namespace name) and undefined are passed here
// to ensure 1. namespace can be modified locally and isn't
// overwritten outside of our function context
// 2. the value of undefined is guaranteed as being truly
// undefined. This is to avoid issues with undefined being
// mutable pre-ES5.

;(function ( namespace, undefined ) {

  // private properties
  var foo = "foo",
      bar = "bar";

  // public methods and properties
  namespace.foobar = "foobar";

  namespace.say = function ( msg ) {
    speak( msg );
  };

  namespace.sayHello = function () {
    namespace.say( "hello world" );
  };

  // private method
  function speak(msg) {
    console.log( "You said: " + msg );
  };

  // check to evaluate whether "namespace" exists in the
  // global namespace - if not, assign window.namespace an
  // object literal

})( window.namespace = window.namespace || {} );


// we can then test our properties and methods as follows

// public

// Outputs: foobar
console.log( namespace.foobar );

// Outputs: You said: hello world
namespace.sayHello();

// assigning new properties
namespace.foobar2 = "foobar";

// Outputs: foobar
console.log( namespace.foobar2 );
</code></pre><p>Extensibility is of course key to any scalable namespacing pattern and IIFEs can be used to achieve this quite easily. In the below example, our "namespace" is once again passed as an argument to our anonymous function and is then extended (or decorated) with further functionality:<pre><code class=language-javascript>
// let's extend the namespace with new functionality
(function( namespace, undefined ) {

  // public method
  namespace.sayGoodbye = function () {
    namespace.say( "goodbye" );
  }
})( window.namespace = window.namespace || {});

// Outputs: goodbye
namespace.sayGoodbye();
</code></pre><p>If you would like to find out more about this pattern, I recommend reading Ben's <a href=http://benalman.com/news/2010/11/immediately-invoked-function-expression/ >IIFE post</a> for more information.<h3>6. Namespace injection</h3><p>Namespace injection is another variation on the IIFE where we "inject" the methods and properties for a specific namespace from within a function wrapper using <i>this</i> as a namespace proxy. The benefit this pattern offers is easy application of functional behaviour to multiple objects or namespaces and can come in useful when applying a set of base methods to be built on later (e.g. getters and setters).<p>The disadvantages of this pattern are that there may be easier or more optimal approaches to achieving this goal (e.g. deep object extension / merging) which I cover earlier in the section.<p>Below we can see an example of this pattern in action, where we use it to populate the behaviour for two namespaces: one initially defined (utils) and another which we dynamically create as a part of the functionality assignment for utils (a new namespace called <i>tools</i>).<pre><code class=language-javascript>
var myApp = myApp || {};
myApp.utils = {};

(function () {
  var val = 5;

  this.getValue = function () {
    return val;
  };

  this.setValue = function( newVal ) {
    val = newVal;
  }

  // also introduce a new sub-namespace
  this.tools = {};

}).apply( myApp.utils );

// inject new behaviour into the tools namespace
// which we defined via the utilities module

(function () {
    this.diagnose = function() {
      return "diagnosis";
    }
}).apply( myApp.utils.tools );

// note, this same approach to extension could be applied
// to a regular IIFE, by just passing in the context as
// an argument and modifying the context rather than just
// "this"

// Usage:

// Outputs our populated namespace
console.log( myApp );

// Outputs: 5
console.log( myApp.utils.getValue() );

// Sets the value of `val` and returns it
myApp.utils.setValue( 25 );
console.log( myApp.utils.getValue() );

// Testing another level down
console.log( myApp.utils.tools.diagnose() );

</code></pre><p>Angus Croll has also <a href=http://msdn.microsoft.com/en-us/scriptjunkie/gg578608>previously</a> suggested the idea of using the call API to provide a natural separation between contexts and arguments. This pattern can feel a lot more like a module creator, but as modules still offer an encapsulation solution, we'll briefly cover it for the sake of thoroughness:<pre><code class=language-javascript>
// define a namespace we can use later
var ns = ns || {},
    ns2 = ns2 || {};

// the module/namespace creator
var creator = function( val ) {

  var val = val || 0;

  this.next = function () {
    return val++
  };

  this.reset = function () {
    val = 0;
  };
};

creator.call( ns );

// ns.next, ns.reset now exist
creator.call( ns2, 5000 );

// ns2 contains the same methods
// but has an overridden value for val
// of 5000

</code></pre><p>As mentioned, this type of pattern is useful for assigning a similar base set of functionality to multiple modules or namespaces. I would however only really suggest using it where explicitly declaring functionality within an object/closure for direct access doesn't make sense.<h2>Advanced namespacing patterns</h2><p>We'll now explore some advanced patterns and utilities that I have found invaluable when working on larger applications - some of which have required a re-think of traditional approaches to application namespacing. I'll note that I am not advocating any of the following as <em>the</em> way to namespace, but rather ways that I have found work in practice.<h3>Automating nested namespacing</h3><p>As we've reviewed, nested namespaces can provide an organized hierarchy of structure for a unit of code. An example of such a namespace could be the following: <i>application.utilities.drawing.canvas.2d</i>. This can also be expanded using the object literal pattern to be:<pre><code class=language-javascript>
var application = {
  utilities: {
    drawing: {
      canvas: {
        2d:{
          //...
        }
      }
    }
  }
};
</code></pre><p>One of the obvious challenges with this pattern is that each additional layer we wish to create requires yet another object to be defined as a child of some parent in our top-level namespace. This can become particularly laborious when multiple depths are required as our application increases in complexity.<p>How can this problem be better solved? In <a href=http://www.amazon.com/JavaScript-Patterns-Stoyan-Stefanov/dp/0596806752>JavaScript Patterns</a>, <a href=http://jspatterns.com>Stoyan Stefanov</a> presents a very-clever approach for automatically defining nested namespaces under an existing global variable. He suggests a convenience method that takes a single string argument for a nest, parses this and automatically populates our base namespace with the objects required.<p>The method he suggests using is the following, which I've updated it to be a generic function for easier re-use with multiple namespaces:<pre><code class=language-javascript>
// top-level namespace being assigned an object literal
var myApp = myApp || {};

// a convenience function for parsing string namespaces and
// automatically generating nested namespaces
function extend( ns, ns_string ) {
  var parts = ns_string.split("."),
      parent = ns,
      pl;

  pl = parts.length;

  for ( var i = 0; i &lt; pl; i++ ) {
    // create a property if it doesn't exist
    if ( typeof parent[parts[i]] === "undefined" ) {
      parent[parts[i]] = {};
    }

    parent = parent[parts[i]];
  }

  return parent;
}

// Usage:
// extend myApp with a deeply nested namespace
var mod = extend(myApp, "modules.module2");

// the correct object with nested depths is output
console.log(mod);

// minor test to check the instance of mod can also
// be used outside of the myApp namesapce as a clone
// that includes the extensions

// Outputs: true
console.log(mod == myApp.modules.module2);

// further demonstration of easier nested namespace
// assignment using extend
extend(myApp, "moduleA.moduleB.moduleC.moduleD");
extend(myApp, "longer.version.looks.like.this");
console.log(myApp);

</code></pre><h3>Dependency declaration pattern</h3><p>We're now going to explore a minor augmentation to the nested namespacing pattern which we'll refer to as the Dependency Declaration pattern. We all know that local references to objects can decrease overall lookup times, but let's apply this to namespacing to see how it might look in practice:<pre><code class=language-javascript>
// common approach to accessing nested namespaces
myApp.utilities.math.fibonacci( 25 );
myApp.utilities.math.sin( 56 );
myApp.utilities.drawing.plot( 98,50,60 );

// with local/cached references
var utils = myApp.utilities,
maths = utils.math,
drawing = utils.drawing;

// easier to access the namespace
maths.fibonacci( 25 );
maths.sin( 56 );
drawing.plot( 98, 50,60 );

// note that the above is particularly performant when
// compared to hundreds or thousands of calls to nested
// namespaces vs. a local reference to the namespace
</code></pre><p>Working with a local variable here is almost always faster than working with a top-level global (e.g.myApp). It's also both more convenient and more performant than accessing nested properties/sub-namespaces on every subsequent line and can improve readability in more complex applications.<p>Stoyan recommends declaring localized namespaces required by a function or module at the top of our function scope (using the single-variable pattern) and calls this a dependency declaration pattern. One of the benefits this offers is a decrease in locating dependencies and resolving them, should we have an extendable architecture that dynamically loads modules into our namespace when required.<p>In my opinion this pattern works best when working at a modular level, localizing a namespace to be used by a group of methods. Localizing namespaces on a per-function level, especially where there is significant overlap between namespace dependencies would be something I would recommend avoiding where possible. Instead, define it further up and just have them all access the same reference.<h3>Deep object extension</h3><p>An alternative approach to automatic namespacing is deep object extension. Namespaces defined using object literal notation may be easily extended (or merged) with other objects (or namespaces) such that the properties and functions of both namespaces can be accessible under the same namespace post-merge.<p>This is something that's been made fairly easy to accomplish with modern JavaScript frameworks (e.g. see jQuery's <a href=http://api.jquery.com/jQuery.extend/ >$.extend</a>), however, if looking to extend object (namespaces) using vanilla JS, the following routine may be of assistance.<pre><code class=language-javascript>
// extend.js
// Written by Andrew Dupont, optimized by Addy Osmani

function extend( destination, source ) {

  var toString = Object.prototype.toString,
      objTest = toString.call({});

  for ( var property in source ) {
    if ( source[property] && objTest === toString.call(source[property]) ) {
      destination[property] = destination[property] || {};
      extend(destination[property], source[property]);
    } else {
      destination[property] = source[property];
    }
  }

  return destination;
};

console.group( "objExtend namespacing tests" );

// define a top-level namespace for usage
var myNS = myNS || {};

// 1. extend namespace with a "utils" object
extend(myNS, {
  utils:{
    //...
  }
});

console.log( "test 1", myNS);
// myNS.utils now exists

// 2. extend with multiple depths (namespace.hello.world.wave)
extend(myNS, {
  hello: {
    world: {
      wave: {
        test: function() {
          //...
        }
      }
    }
  }
});

// test direct assignment works as expected
myNS.hello.test1 = "this is a test";
myNS.hello.world.test2 = "this is another test";
console.log( "test 2", myNS );

// 3. what if myNS already contains the namespace being added
// (e.g. "library")? we want to ensure no namespaces are being
// overwritten during extension

myNS.library = {
  foo:function () {}
};

extend( myNS, {
  library: {
    bar: function() {
      //...
    }
  }
});

// confirmed that extend is operating safely (as expected)
// myNS now also contains library.foo, library.bar
console.log( "test 3", myNS );

// 4. what if we wanted easier access to a specific namespace without having
// to type the whole namespace out each time?

var shorterAccess1 = myNS.hello.world;
shorterAccess1.test3 = "hello again";
console.log( "test 4", myNS);

//success, myApp.hello.world.test3 is now "hello again"

console.groupEnd();

</code></pre><p><strong>Note:</strong> The above implementation is not cross-browser compatible for all objects and should be considered a proof-of-concept only. One may find the Underscore.js <code>extend()</code> method a simpler, more cross-browser implementation to start with <a href=http://documentcloud.github.io/underscore/docs/underscore.html#section-82>http://documentcloud.github.io/underscore/docs/underscore.html#section-82</a>.<p>For developers that are going to use jQuery in their application, one can achieve the exact same object namespace extensibility with <code>$.extend</code> as follows:<pre><code class=language-javascript>
// top-level namespace
var myApp = myApp || {};

// directly assign a nested namespace
myApp.library = {
  foo: function() {
    //...
  }
};

// deep extend/merge this namespace with another
// to make things interesting, let's say it's a namespace
// with the same name but with a different function
// signature: $.extend( deep, target, object1, object2 )
$.extend( true, myApp, {
  library:{
    bar: function(){
      //...
    }
  }
});

console.log("test", myApp);
// myApp now contains both library.foo() and library.bar() methods
// nothing has been overwritten which is what we're hoping for.
</code></pre><p>For the sake of thoroughness, please see <a href=https://gist.github.com/1221980>here</a> for jQuery $.extend equivalents to the rest of the namespacing experiments found in this section.<h3>Recommendation</h3><p>Reviewing the namespace patterns we've explored in this section, the option that I would personally use for most larger applications is nested object namespacing with the object literal pattern. Where possible, I would implement this using automated nested namespacing, however this is just a personal preference.<p>IIFEs and single global variables may work fine for applications in the small to medium range, however, larger codebases requiring both namespaces and deep sub-namespaces require a succinct solution that promotes readability and scales. I feel this pattern achieves all of these objectives well.<p>I would also recommend trying out some of the suggested advanced utility methods for namespace extension as they really can save us time in the long-run.<p> <h1 id=conclusions>Conclusions</h1><p>That's it for this introductory adventure into the world of design patterns in JavaScript and jQuery - I hope you've found it beneficial.<p>Design patterns make it easy for us to build on the shoulders of developers who have defined solutions to challenging problems and architectures over a number of decades. The contents of this book should hopefully provide sufficient information to get started using the patterns we covered in your own scripts, plugins and web applications.<p>It's important for us to be aware of these patterns but it's also essential to know how and when to use them. Study the pros and cons of each pattern before employing them. Take the time out to experiment with patterns to fully appreciate what they offer and make usage judgements based on a pattern's true value to your application.<p>If I’ve encouraged your interest in this area further and you would like to learn more about design patterns, there are a number of excellent titles on this area available for generic software development and of course, JavaScript.<p>I am happy to recommend:<ol><li>"<a href=http://www.amazon.com/Patterns-Enterprise-Application-Architecture-Martin/dp/0321127420>Patterns Of Enterprise Application Architecture</a>" by Martin Fowler<li>"<a href="http://www.amazon.com/JavaScript-Patterns-Stoyan-Stefanov/dp/0596806752/ref=sr_1_1?ie=UTF8&amp;s=books&amp;qid=1289759956&amp;sr=1-1">JavaScript Patterns</a>" by Stoyan Stefanov</ol><p> </section><section><p>Thanks for reading <em>Learning JavaScript Design Patterns</em>. For more educational material on learning JavaScript, please feel free to read more from me on my blog at <a href=http://addyosmani.com>http://addyosmani.com</a> or on Twitter <a href=https://twitter.com/addyosmani>@addyosmani</a>.<p> <p>Until next time, the very best of luck with your adventures in JavaScript!<p> <h1 id=references><span id=internal-source-marker_0.05095413855216446>References</span></h1><ol id=references-list><li>Design Principles and Design Patterns - Robert C Martin <a href=http://www.objectmentor.com/resources/articles/Principles_and_Patterns.pdf>http://www.objectmentor.com/resources/articles/Principles_and_Patterns.pdf</a><li>Ralph Johnson - Special Issue of ACM On Patterns and Pattern Languages - <a href=http://www.cs.wustl.edu/%7Eschmidt/CACM-editorial.html>http://www.cs.wustl.edu/~schmidt/CACM-editorial.html</a><li>Hillside Engineering Design Patterns Library - <a href=http://hillside.net/patterns/ >http://hillside.net/patterns/</a><li>Pro JavaScript Design Patterns - Ross Harmes and Dustin Diaz <a href=http://jsdesignpatterns.com/ >http://jsdesignpatterns.com/</a><li>Design Pattern Definitions - <a href=http://en.wikipedia.org/wiki/Design_Patterns>http://en.wikipedia.org/wiki/Design_Patterns</a><li>Patterns and Software Terminology <a href=http://www.cmcrossroads.com/bradapp/docs/patterns-intro.html>http://www.cmcrossroads.com/bradapp/docs/patterns-intro.html</a><li>Reap the benefits of Design Patterns - Jeff Juday <a href=http://www.techrepublic.com/article/reap-the-benefits-of-design-patterns-in-software-development/ >http://articles.techrepublic.com.com/5100-10878_11-5173591.html</a><li>JavaScript Design Patterns - Subramanyan Guhan <a href=http://www.slideshare.net/rmsguhan/javascript-design-patterns>http://www.slideshare.net/rmsguhan/javascript-design-patterns</a><li>What Are Design Patterns and Do I Need Them? - James Moaoriello <a href=http://www.developer.com/design/article.php/1474561>http://www.developer.com/design/article.php/1474561</a><li>Software Design Patterns - Alex Barnett <a href=http://alexbarnett.net/blog/archive/2007/07/20/software-design-patterns.aspx>http://alexbarnett.net/blog/archive/2007/07/20/software-design-patterns.aspx</a><li>Evaluating Software Design Patterns - Gunni Rode <a href=http://www.rode.dk/thesis/ >http://www.rode.dk/thesis/</a><li>SourceMaking Design Patterns <a href=http://sourcemaking.com/design_patterns>http://sourcemaking.com/design_patterns</a><li>JavaScript Patterns - Stoyan Stevanov - <a href=http://www.slideshare.net/stoyan/javascript-patterns>http://www.slideshare.net/stoyan/javascript-patterns</a><li>Stack Overflow - Design Pattern Implementations in JavaScript (discussion) <a href=http://stackoverflow.com/questions/24642/what-are-some-examples-of-design-pattern-implementations-using-javascript>http://stackoverflow.com/questions/24642/what-are-some-examples-of-design-pattern-implementations-using-javascript</a><li>The Elements of a Design Pattern - Jared Spool <a href=http://www.uie.com/articles/elements_of_a_design_pattern/ >http://www.uie.com/articles/elements_of_a_design_pattern/</a><li>Stack Overflow - Examples of Practical JS Design Patterns (discussion) <a href=http://stackoverflow.com/questions/3722820/examples-of-practical-javascript-object-oriented-design-patterns>http://stackoverflow.com/questions/3722820/examples-of-practical-javascript-object-oriented-design-patterns</a><li>Design Patterns in JavaScript Part 1 - Nicholas Zakas <a href=http://www.webreference.com/programming/javascript/ncz/column5/ >http://www.webreference.com/programming/javascript/ncz/column5/</a><li>Stack Overflow - Design Patterns in jQuery <a href=http://stackoverflow.com/questions/3631039/design-patterns-used-in-the-jquery-library>http://stackoverflow.com/questions/3631039/design-patterns-used-in-the-jquery-library</a><li>Classifying Design Patterns By AntiClue - Elyse Neilson <a href=http://www.anticlue.net/archives/000198.htm>http://www.anticlue.net/archives/000198.htm</a><li>Design Patterns, Pattern Languages and Frameworks - Douglas Schmidt <a href=http://www.cs.wustl.edu/%7Eschmidt/patterns.html>http://www.cs.wustl.edu/~schmidt/patterns.html</a><li>Show Love To The Module Pattern - Christian Heilmann <a href=http://www.wait-till-i.com/2007/07/24/show-love-to-the-module-pattern/ >http://www.wait-till-i.com/2007/07/24/show-love-to-the-module-pattern/</a><li>Software Designs Made Simple - Anoop Mashudanan <a href=http://www.scribd.com/doc/16352479/Software-Design-Patterns-Made-Simple>http://www.scribd.com/doc/16352479/Software-Design-Patterns-Made-Simple</a><li>Introduction to the JavaScript Module Pattern <a href=https://www.unleashed-technologies.com/blog/2010/12/09/introduction-javascript-module-design-pattern>https://www.unleashed-technologies.com/blog/2010/12/09/introduction-javascript-module-design-pattern</a><li>Design Patterns Explained - <a href=http://c2.com/cgi/wiki?DesignPatterns>http://c2.com/cgi/wiki?DesignPatterns</a><li>Mixins explained <a href=http://en.wikipedia.org/wiki/Mixin>http://en.wikipedia.org/wiki/Mixin</a><li>Working with GoF's Design Patterns In JavaScript <a href=http://aspalliance.com/1782_Working_with_GoFs_Design_Patterns_in_JavaScript_Programming.all>http://aspalliance.com/1782_Working_with_GoFs_Design_Patterns_in_JavaScript_Programming.all</a><li>Using Object.create <a href=http://stackoverflow.com/questions/2709612/using-object-create-instead-of-new>http://stackoverflow.com/questions/2709612/using-object-create-instead-of-new</a><li>t3knomanster's JavaScript Design Patterns - <a href=http://t3knomanser.livejournal.com/922171.html>http://t3knomanser.livejournal.com/922171.html</a><li>JavaScript Advantages - Object Literals <a href=http://stackoverflow.com/questions/1600130/javascript-advantages-of-object-literal>http://stackoverflow.com/questions/1600130/javascript-advantages-of-object-literal</a><li>JavaScript Class Patterns - Liam McLennan <a href=http://geekswithblogs.net/liammclennan/archive/2011/02/06/143842.aspx>http://geekswithblogs.net/liammclennan/archive/2011/02/06/143842.aspx</a><li>Understanding proxies in jQuery - <a href=http://stackoverflow.com/questions/4986329/understanding-proxy-in-jquery>http://stackoverflow.com/questions/4986329/understanding-proxy-in-jquery</a><li>Observer Pattern Using JavaScript - <a href=http://www.codeproject.com/Articles/13914/Observer-Design-Pattern-Using-JavaScript>http://www.codeproject.com/Articles/13914/Observer-Design-Pattern-Using-JavaScript</a><li>Speaking on the Observer pattern - <a href=http://www.javaworld.com/javaworld/javaqa/2001-05/04-qa-0525-observer.html>http://www.javaworld.com/javaworld/javaqa/2001-05/04-qa-0525-observer.html</a></ol><p></section></section></div></div></div><div class="mx-auto max-w-xs sm:flex sm:justify-center sm:max-w-none"><div><a href=../command-pattern/index.html class="mb-4 bg-gray-900 btn hover:bg-gray-800 mb-0 mr-8 text-white w-auto w-full" title="Command Pattern">Previous</a></div><div style=width:64px;></div><div><a href="" class="mb-4 bg-gray-900 btn hover:bg-gray-800 mb-0 mr-8 text-white w-auto w-full" style=opacity:0.5; disabled title="">Next</a></div></div></div></div></article></div></div></div></section><share-widget><button aria-label=Share href=https://patterns.dev/posts/classic-design-patterns/ on-click=share><div></div></button></share-widget><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"Learning JavaScript Design Patterns","image":["https://patterns.dev/img/remote/Z2dzbwc.jpg"],"author":"The Patterns.dev team","genre":"Book","publisher":{"@type":"Organization","name":"The Patterns.dev team","logo":{"@type":"ImageObject","url":"/img/favicon/favicon-192x192.png?hash=b4b7ad3f7c"}},"url":"https://patterns.dev/posts/classic-design-patterns/","mainEntityOfPage":"https://patterns.dev/posts/classic-design-patterns/","datePublished":"2022-08-14","dateModified":"2022-08-12","description":"Copyright &amp;copy; Addy Osmani 2012-2021. Learning JavaScript Design Patterns is released under a Creative Commons..."}</script></main><footer><div class="mx-auto max-w-6xl sm:px-6 px-4"><div class="border-gray-200 border-t gap-8 grid md:py-12 py-8 sm:grid-cols-12"><div class="lg:col-span-3 sm:col-span-12"><div class=mb-2><a href=../../index.html class=inline-block aria-label=Cruip><svg viewBox="0 0 122 28" xmlns=http://www.w3.org/2000/svg height=28px version=1.1 width=122px xmlns:xlink=http://www.w3.org/1999/xlink><title>patterns@1.5x</title><g fill=none fill-rule=evenodd id=Page-1 stroke=none stroke-width=1><g fill=#000000 fill-rule=nonzero id=01 transform="translate(-215.000000, -16.000000)"><path d="M221.372159,43.1363636 L221.372159,34.3153409 L221.457386,34.3153409 C221.684659,34.8693182 222.009588,35.3647017 222.432173,35.8014915 C222.854759,36.2382812 223.366122,36.5827415 223.966264,36.8348722 C224.566406,37.0870028 225.25,37.2130682 226.017045,37.2130682 C227.181818,37.2130682 228.252486,36.9076705 229.229048,36.296875 C230.205611,35.6860795 230.986861,34.759233 231.572798,33.5163352 C232.158736,32.2734375 232.451705,30.7073864 232.451705,28.8181818 C232.451705,26.84375 232.144531,25.2386364 231.530185,24.0028409 C230.915838,22.7670455 230.120384,21.8615057 229.143821,21.2862216 C228.167259,20.7109375 227.139205,20.4232955 226.059659,20.4232955 C225.25,20.4232955 224.539773,20.5635653 223.928977,20.8441051 C223.318182,21.1246449 222.806818,21.4975142 222.394886,21.9627131 C221.982955,22.4279119 221.670455,22.9375 221.457386,23.4914773 L221.457386,23.4914773 L221.329545,23.4914773 L221.329545,20.6363636 L215.491477,20.6363636 L215.491477,43.1363636 L221.372159,43.1363636 Z M223.84375,32.6960227 C223.303977,32.6960227 222.840554,32.5379972 222.45348,32.221946 C222.066406,31.9058949 221.768111,31.4584517 221.558594,30.8796165 C221.349077,30.3007812 221.244318,29.6136364 221.244318,28.8181818 C221.244318,28.0085227 221.349077,27.3142756 221.558594,26.7354403 C221.768111,26.1566051 222.066406,25.7127131 222.45348,25.4037642 C222.840554,25.0948153 223.303977,24.9403409 223.84375,24.9403409 C224.383523,24.9403409 224.843395,25.0948153 225.223366,25.4037642 C225.603338,25.7127131 225.894531,26.1566051 226.096946,26.7354403 C226.299361,27.3142756 226.400568,28.0085227 226.400568,28.8181818 C226.400568,29.6278409 226.299361,30.3220881 226.096946,30.9009233 C225.894531,31.4797585 225.603338,31.9236506 225.223366,32.2325994 C224.843395,32.5415483 224.383523,32.6960227 223.84375,32.6960227 Z M238.624587,37.2556818 C239.334815,37.2556818 239.986448,37.1704545 240.579488,37 C241.172528,36.8295455 241.701647,36.556108 242.166846,36.1796875 C242.632045,35.803267 243.027996,35.3096591 243.354701,34.6988636 L243.354701,34.6988636 L243.482542,34.6988636 L243.482542,37 L248.979701,37 L248.979701,25.7926136 C248.979701,25.0326705 248.807471,24.3277699 248.463011,23.6779119 C248.11855,23.028054 247.619616,22.4598722 246.966207,21.9733665 C246.312798,21.4868608 245.520894,21.1068892 244.590496,20.8334517 C243.660099,20.5600142 242.608962,20.4232955 241.437087,20.4232955 C239.810667,20.4232955 238.454133,20.6772017 237.367485,21.1850142 C236.280837,21.6928267 235.455198,22.3675426 234.890567,23.2091619 C234.325937,24.0507812 234.00811,24.96875 233.937087,25.9630682 L233.937087,25.9630682 L239.349019,25.9630682 C239.420042,25.4588068 239.631335,25.0841619 239.982897,24.8391335 C240.33446,24.5941051 240.790781,24.4715909 241.35186,24.4715909 C241.863224,24.4715909 242.282258,24.5852273 242.608962,24.8125 C242.935667,25.0397727 243.099019,25.3664773 243.099019,25.7926136 L243.099019,25.7926136 L243.099019,25.8352273 C243.099019,26.1477273 242.974729,26.3980824 242.72615,26.5862926 C242.47757,26.7745028 242.074516,26.9200994 241.516988,27.0230824 C240.95946,27.1260653 240.222599,27.2130682 239.306406,27.2840909 C238.461235,27.3480114 237.674658,27.4865057 236.946675,27.6995739 C236.218692,27.912642 235.581263,28.2215909 235.034388,28.6264205 C234.487513,29.03125 234.061377,29.5514915 233.755979,30.1871449 C233.450582,30.8227983 233.297883,31.5880682 233.297883,32.4829545 C233.297883,33.5696023 233.525156,34.4644886 233.979701,35.1676136 C234.434246,35.8707386 235.061022,36.3945312 235.860028,36.7389915 C236.659033,37.0834517 237.580553,37.2556818 238.624587,37.2556818 Z M240.542201,33.5482955 C240.045042,33.5482955 239.636661,33.4275568 239.317059,33.1860795 C238.997457,32.9446023 238.837656,32.5965909 238.837656,32.1420455 C238.837656,31.8579545 238.906903,31.6004972 239.045397,31.3696733 C239.183891,31.1388494 239.39696,30.9435369 239.684602,30.7837358 C239.972244,30.6239347 240.343337,30.5085227 240.797883,30.4375 C241.032258,30.4019886 241.257755,30.3629261 241.474374,30.3203125 C241.690994,30.2776989 241.89696,30.2315341 242.092272,30.1818182 C242.287585,30.1321023 242.472244,30.0788352 242.646249,30.022017 C242.820255,29.9651989 242.985383,29.9048295 243.141633,29.8409091 L243.141633,29.8409091 L243.141633,31.2045455 C243.141633,31.7017045 243.017343,32.1242898 242.768763,32.4723011 C242.520184,32.8203125 242.198806,33.0866477 241.80463,33.2713068 C241.410454,33.4559659 240.989644,33.5482955 240.542201,33.5482955 Z M254.737101,36.8135653 C255.653294,37.1651278 256.786107,37.3053977 258.135538,37.234375 C258.803152,37.1988636 259.380212,37.1242898 259.866717,37.0106534 C260.353223,36.897017 260.727868,36.8011364 260.990652,36.7230114 L260.990652,36.7230114 L260.138379,32.5894886 C260.024743,32.6178977 259.848962,32.6534091 259.611035,32.6960227 C259.373109,32.7386364 259.165368,32.7599432 258.987811,32.7599432 C258.732129,32.7599432 258.522612,32.7226562 258.35926,32.6480824 C258.195908,32.5735085 258.075169,32.4598722 257.997044,32.3071733 C257.918919,32.1544744 257.879857,31.9644886 257.879857,31.7372159 L257.879857,31.7372159 L257.879,24.898 L260.692357,24.8977273 L260.692357,20.6363636 L257.879,20.637 L257.879857,16.7159091 L251.999175,16.7159091 L251.999,20.637 L249.911107,20.6363636 L249.911107,24.8977273 L251.999,24.898 L251.999175,32.2911932 C251.986261,33.3307076 252.169981,34.2117416 252.550335,34.9342952 L252.670339,35.1463068 C253.131987,35.90625 253.820908,36.4620028 254.737101,36.8135653 Z M266.02362,36.8135653 C266.939813,37.1651278 268.072626,37.3053977 269.422057,37.234375 C270.089671,37.1988636 270.666731,37.1242898 271.153236,37.0106534 C271.639742,36.897017 272.014387,36.8011364 272.277171,36.7230114 L272.277171,36.7230114 L271.424898,32.5894886 C271.311262,32.6178977 271.135481,32.6534091 270.897555,32.6960227 C270.659629,32.7386364 270.451887,32.7599432 270.27433,32.7599432 C270.018648,32.7599432 269.809131,32.7226562 269.645779,32.6480824 C269.482427,32.5735085 269.361688,32.4598722 269.283563,32.3071733 C269.205438,32.1544744 269.166376,31.9644886 269.166376,31.7372159 L269.166376,31.7372159 L269.166,24.898 L271.978876,24.8977273 L271.978876,20.6363636 L269.166,20.637 L269.166376,16.7159091 L263.285694,16.7159091 L263.285,20.637 L261.197626,20.6363636 L261.197626,24.8977273 L263.285,24.898 L263.285694,32.2911932 C263.272781,33.3307076 263.456501,34.2117416 263.836854,34.9342952 L263.956859,35.1463068 C264.418506,35.90625 265.107427,36.4620028 266.02362,36.8135653 Z M281.177327,37.2982955 C282.690111,37.2982955 284.012909,37.0692472 285.145722,36.6111506 C286.278534,36.153054 287.189401,35.5067472 287.878321,34.6722301 C288.567241,33.8377131 289.004031,32.8522727 289.18869,31.7159091 L289.18869,31.7159091 L283.819372,31.7159091 C283.705736,32.0213068 283.528179,32.2823153 283.286702,32.4989347 C283.045224,32.715554 282.755807,32.8806818 282.418449,32.9943182 C282.081091,33.1079545 281.709997,33.1647727 281.305168,33.1647727 C280.722781,33.1647727 280.225622,33.0475852 279.81369,32.8132102 C279.401758,32.5788352 279.085707,32.2556818 278.865537,31.84375 C278.645366,31.4318182 278.535281,30.9630682 278.535281,30.4375 L278.535281,30.4375 L278.535,30.182 L289.18869,30.1818182 L289.18869,28.8181818 C289.18869,27.5184659 288.996929,26.350142 288.613406,25.3132102 C288.229883,24.2762784 287.683008,23.393821 286.972781,22.6658381 C286.262554,21.9378551 285.40673,21.3821023 284.40531,20.9985795 C283.403889,20.6150568 282.285281,20.4232955 281.049486,20.4232955 C279.359145,20.4232955 277.892526,20.774858 276.649628,21.477983 C275.40673,22.181108 274.444372,23.1647727 273.762554,24.4289773 C273.080736,25.6931818 272.739827,27.1704545 272.739827,28.8607955 C272.739827,30.6221591 273.07896,32.1331676 273.757227,33.393821 C274.435494,34.6544744 275.404954,35.6203835 276.665608,36.2915483 C277.926261,36.9627131 279.430168,37.2982955 281.177327,37.2982955 Z M278.535281,26.9431818 C278.549486,26.4673295 278.675551,26.0518466 278.913477,25.696733 C279.151403,25.3416193 279.46923,25.0628551 279.866957,24.8604403 C280.264685,24.6580256 280.701474,24.5568182 281.177327,24.5568182 C281.667383,24.5568182 282.105949,24.6580256 282.493023,24.8604403 C282.880097,25.0628551 283.189045,25.3433949 283.419869,25.7020597 C283.650693,26.0607244 283.769656,26.4744318 283.776758,26.9431818 L283.776758,26.9431818 L278.535281,26.9431818 Z M296.597369,37 L296.597369,28.4772727 C296.597369,27.8522727 296.728761,27.3071733 296.991545,26.8419744 C297.254329,26.3767756 297.614769,26.0145597 298.072866,25.7553267 C298.530962,25.4960938 299.047653,25.3664773 299.622937,25.3664773 C299.928334,25.3664773 300.294102,25.3913352 300.720238,25.4410511 C301.146374,25.490767 301.505039,25.5653409 301.796232,25.6647727 L301.796232,25.6647727 L301.796232,20.647017 C301.561857,20.5759943 301.318604,20.5209517 301.066474,20.4818892 C300.814343,20.4428267 300.560437,20.4232955 300.304755,20.4232955 C299.431175,20.4232955 298.669457,20.6896307 298.019599,21.2223011 C297.369741,21.7549716 296.895664,22.5965909 296.597369,23.7471591 L296.597369,23.7471591 L296.426914,23.7471591 L296.426914,20.6363636 L290.716687,20.6363636 L290.716687,37 L296.597369,37 Z M308.73616,37 L308.73616,27.7954545 C308.743263,27.2556818 308.842695,26.7922585 309.034456,26.4051847 C309.226217,26.0181108 309.50143,25.7198153 309.860095,25.5102983 C310.21876,25.3007812 310.63957,25.1960227 311.122524,25.1960227 C311.86116,25.1960227 312.43822,25.4268466 312.853703,25.8884943 C313.269186,26.350142 313.473376,26.9857955 313.466274,27.7954545 L313.466274,27.7954545 L313.466274,37 L319.347114,37 L319.347114,26.5596591 C319.354058,25.3735795 319.121459,24.318892 318.649158,23.3955966 C318.176856,22.4723011 317.512794,21.7460938 316.65697,21.2169744 C315.801146,20.6878551 314.794399,20.4232955 313.636729,20.4232955 C312.436445,20.4232955 311.387084,20.7180398 310.488646,21.3075284 C309.590209,21.897017 308.963433,22.7102273 308.60832,23.7471591 L308.60832,23.7471591 L308.437865,23.7471591 L308.437865,20.6363636 L302.855479,20.6363636 L302.855479,37 L308.73616,37 Z M328.886316,37.2982955 C330.3991,37.2982955 331.746756,37.065696 332.929285,36.6004972 C334.111813,36.1352983 335.045762,35.4747869 335.731131,34.6189631 C336.416501,33.7631392 336.762736,32.7528409 336.769839,31.5880682 C336.762736,30.3806818 336.349029,29.4165483 335.528717,28.6956676 C334.708404,27.9747869 333.46018,27.4616477 331.784043,27.15625 L331.784043,27.15625 L328.46018,26.5596591 C327.83518,26.4460227 327.41437,26.2862216 327.197751,26.0802557 C326.981131,25.8742898 326.876373,25.6505682 326.883475,25.4090909 C326.876373,25.0681818 327.05393,24.8053977 327.416146,24.6207386 C327.778361,24.4360795 328.2116,24.34375 328.715861,24.34375 C329.106486,24.34375 329.463376,24.409446 329.786529,24.5408381 C330.109682,24.6722301 330.374242,24.8586648 330.580208,25.100142 C330.786174,25.3416193 330.903361,25.6292614 330.931771,25.9630682 L330.931771,25.9630682 L336.343702,25.9630682 C336.27268,24.2301136 335.553574,22.8735795 334.186387,21.8934659 C332.819199,20.9133523 330.953077,20.4232955 328.588021,20.4232955 C327.032623,20.4232955 325.688518,20.6310369 324.555705,21.0465199 C323.422893,21.4620028 322.552864,22.065696 321.94562,22.8575994 C321.338376,23.6495028 321.038305,24.6136364 321.045407,25.75 C321.038305,27.0355114 321.450236,28.0866477 322.281202,28.9034091 C323.112168,29.7201705 324.362168,30.2741477 326.031202,30.5653409 L326.031202,30.5653409 L328.92893,31.0767045 C329.568134,31.1903409 330.03866,31.3394886 330.340506,31.5241477 C330.642353,31.7088068 330.796827,31.9573864 330.80393,32.2698864 C330.796827,32.6107955 330.617495,32.8735795 330.265932,33.0582386 C329.91437,33.2428977 329.468702,33.3352273 328.92893,33.3352273 C328.261316,33.3352273 327.709114,33.1949574 327.272324,32.9144176 C326.835535,32.6338778 326.578077,32.234375 326.499952,31.7159091 L326.499952,31.7159091 L320.661884,31.7159091 C320.825236,33.3920455 321.611813,34.7414773 323.021614,35.7642045 C324.431415,36.7869318 326.386316,37.2982955 328.886316,37.2982955 Z" id=patterns></path></g></g></svg></a></div></div><div class="lg:col-span-2 md:col-span-3 sm:col-span-6"><h6 class="mb-2 font-medium text-gray-800">Resources</h6><ul class=text-sm><li class=mb-2><a href=../index.html class="text-gray-600 duration-150 ease-in-out hover:text-gray-900 transition">Patterns</a><li class=mb-2><a href=https://forms.gle/nBaTUseGL38J7jR89 class="text-gray-600 duration-150 ease-in-out hover:text-gray-900 transition" target=_blank>Submit Feedback</a></ul></div><div class="lg:col-span-2 md:col-span-3 sm:col-span-6"><h6 class="mb-2 font-medium text-gray-800">Team</h6><ul class=text-sm><li class=mb-2><a href=../../index.html class="text-gray-600 duration-150 ease-in-out hover:text-gray-900 transition">Home</a><li class=mb-2><a href=../../about/index.html class="text-gray-600 duration-150 ease-in-out hover:text-gray-900 transition">About us</a></ul></div></div><div class="border-gray-200 border-t md:flex md:items-center md:justify-between md:py-8 py-4"><ul class="flex mb-4 md:mb-0 md:ml-4 md:order-1" style=display:none><li><a href=#0 class="text-gray-600 duration-150 ease-in-out hover:text-gray-900 transition bg-white flex hover:bg-white-100 items-center justify-center rounded-full shadow" aria-label=Twitter><svg viewBox="0 0 32 32" xmlns=http://www.w3.org/2000/svg class="fill-current h-8 w-8"><path d="M24 11.5c-.6.3-1.2.4-1.9.5.7-.4 1.2-1 1.4-1.8-.6.4-1.3.6-2.1.8-.6-.6-1.5-1-2.4-1-1.7 0-3.2 1.5-3.2 3.3 0 .3 0 .5.1.7-2.7-.1-5.2-1.4-6.8-3.4-.3.5-.4 1-.4 1.7 0 1.1.6 2.1 1.5 2.7-.5 0-1-.2-1.5-.4 0 1.6 1.1 2.9 2.6 3.2-.3.1-.6.1-.9.1-.2 0-.4 0-.6-.1.4 1.3 1.6 2.3 3.1 2.3-1.1.9-2.5 1.4-4.1 1.4H8c1.5.9 3.2 1.5 5 1.5 6 0 9.3-5 9.3-9.3v-.4c.7-.5 1.3-1.1 1.7-1.8z"></path></svg></a><li class=ml-4><a href=#0 class="text-gray-600 duration-150 ease-in-out hover:text-gray-900 transition bg-white flex hover:bg-white-100 items-center justify-center rounded-full shadow" aria-label=Github><svg viewBox="0 0 32 32" xmlns=http://www.w3.org/2000/svg class="fill-current h-8 w-8"><path d="M16 8.2c-4.4 0-8 3.6-8 8 0 3.5 2.3 6.5 5.5 7.6.4.1.5-.2.5-.4V22c-2.2.5-2.7-1-2.7-1-.4-.9-.9-1.2-.9-1.2-.7-.5.1-.5.1-.5.8.1 1.2.8 1.2.8.7 1.3 1.9.9 2.3.7.1-.5.3-.9.5-1.1-1.8-.2-3.6-.9-3.6-4 0-.9.3-1.6.8-2.1-.1-.2-.4-1 .1-2.1 0 0 .7-.2 2.2.8.6-.2 1.3-.3 2-.3s1.4.1 2 .3c1.5-1 2.2-.8 2.2-.8.4 1.1.2 1.9.1 2.1.5.6.8 1.3.8 2.1 0 3.1-1.9 3.7-3.7 3.9.3.4.6.9.6 1.6v2.2c0 .2.1.5.6.4 3.2-1.1 5.5-4.1 5.5-7.6-.1-4.4-3.7-8-8.1-8z"></path></svg></a><li class=ml-4><a href=#0 class="text-gray-600 duration-150 ease-in-out hover:text-gray-900 transition bg-white flex hover:bg-white-100 items-center justify-center rounded-full shadow" aria-label=Facebook><svg viewBox="0 0 32 32" xmlns=http://www.w3.org/2000/svg class="fill-current h-8 w-8"><path d="M14.023 24L14 17h-3v-3h3v-2c0-2.7 1.672-4 4.08-4 1.153 0 2.144.086 2.433.124v2.821h-1.67c-1.31 0-1.563.623-1.563 1.536V14H21l-1 3h-2.72v7h-3.257z"></path></svg></a></ul><div class="text-gray-600 mr-4 text-sm">© 2020-2022 Patterns.dev. All rights reserved.</div></div></div></footer></div>